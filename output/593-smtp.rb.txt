#Source[
   #List[
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['net/protocol']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['digest/md5']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['timeout']
         ]
      ]
      $statement: #ExceptionBlock[
         $main: #ApplyExpr[
            #Self['self']
            $recv: #NameExpr['require']
            $param: #List[
               $expression: #StringExpr['openssl']
            ]
         ]
         $rescue: #List[
            $rescue: #Rescue[
               $class: #NameExpr['LoadError']
               $then: #Empty['']
            ]
         ]
      ]
      $statement: #Module[
         $name: #NameExpr['Net']
         $body: #BlockExpr[
            $main: #List[
               $statement: #Module[
                  $name: #NameExpr['SMTPError']
                  $body: #BlockExpr[
                     $main: #Empty['']
                  ]
               ]
               $statement: #Class[
                  $name: #NameExpr['SMTPAuthenticationError']
                  $super: #NameExpr['ProtoAuthError']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['include']
                        $param: #List[
                           $expression: #NameExpr['SMTPError']
                        ]
                     ]
                  ]
               ]
               $statement: #Class[
                  $name: #NameExpr['SMTPServerBusy']
                  $super: #NameExpr['ProtoServerError']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['include']
                        $param: #List[
                           $expression: #NameExpr['SMTPError']
                        ]
                     ]
                  ]
               ]
               $statement: #Class[
                  $name: #NameExpr['SMTPSyntaxError']
                  $super: #NameExpr['ProtoSyntaxError']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['include']
                        $param: #List[
                           $expression: #NameExpr['SMTPError']
                        ]
                     ]
                  ]
               ]
               $statement: #Class[
                  $name: #NameExpr['SMTPFatalError']
                  $super: #NameExpr['ProtoFatalError']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['include']
                        $param: #List[
                           $expression: #NameExpr['SMTPError']
                        ]
                     ]
                  ]
               ]
               $statement: #Class[
                  $name: #NameExpr['SMTPUnknownError']
                  $super: #NameExpr['ProtoUnknownError']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['include']
                        $param: #List[
                           $expression: #NameExpr['SMTPError']
                        ]
                     ]
                  ]
               ]
               $statement: #Class[
                  $name: #NameExpr['SMTPUnsupportedCommand']
                  $super: #NameExpr['ProtocolError']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['include']
                        $param: #List[
                           $expression: #NameExpr['SMTPError']
                        ]
                     ]
                  ]
               ]
               $statement: #Class[
                  $name: #NameExpr['SMTP']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['Revision']
                           $right: #Indexer[
                              $recv: #ApplyExpr[
                                 $recv: #ParcentNotation['%q$Revision$']
                                 $recv: #NameExpr['split']
                              ]
                              $index: #List[
                                 $expression: #IntExpr['1']
                              ]
                           ]
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['SMTP']
                           $name: #NameExpr['default_port']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #IntExpr['25']
                           ]
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['SMTP']
                           $name: #NameExpr['default_submission_port']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #IntExpr['587']
                           ]
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['SMTP']
                           $name: #NameExpr['default_tls_port']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #IntExpr['465']
                           ]
                        ]
                        $statement: #SClass[
                           $path: #Self['self']
                           $body: #BlockExpr[
                              $main: #Alias[
                                 $newname: #NameExpr['default_ssl_port']
                                 $target: #NameExpr['default_tls_port']
                              ]
                           ]
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['SMTP']
                           $name: #NameExpr['default_ssl_context']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['SSLContext']
                                 ]
                                 $recv: #NameExpr['new']
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['initialize']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['address']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['port']
                                 $default: #Nil['nil']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@address']
                                    $right: #NameExpr['address']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@port']
                                    $right: #LOr[
                                       $left: #NameExpr['port']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['SMTP']
                                          $recv: #NameExpr['default_port']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@esmtp']
                                    $right: #TrueExpr['true']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@capabilities']
                                    $right: #Nil['nil']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@socket']
                                    $right: #Nil['nil']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@started']
                                    $right: #FalseExpr['false']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@open_timeout']
                                    $right: #IntExpr['30']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@read_timeout']
                                    $right: #IntExpr['60']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@error_occurred']
                                    $right: #FalseExpr['false']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@debug_output']
                                    $right: #Nil['nil']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@tls']
                                    $right: #FalseExpr['false']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@starttls']
                                    $right: #FalseExpr['false']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@ssl_context']
                                    $right: #Nil['nil']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['inspect']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #StringExpr[
                                 $inner: #ApplyExpr[
                                    $recv: #Self['self']
                                    $recv: #NameExpr['class']
                                 ]
                                 $inner: #NameExpr['@address']
                                 $inner: #NameExpr['@port']
                                 $inner: #NameExpr['@started']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['attr_accessor']
                           $param: #List[
                              $expression: #NameExpr['esmtp']
                           ]
                        ]
                        $statement: #Alias[
                           $newname: #NameExpr['esmtp?']
                           $target: #NameExpr['esmtp']
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['capable_starttls?']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['capable?']
                                 $param: #List[
                                    $expression: #StringExpr['STARTTLS']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['capable?']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['key']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #Unless[
                                    $then: #RReturnStmt[
                                       $expr: #List[
                                          $expression: #Nil['nil']
                                       ]
                                    ]
                                    $cond: #NameExpr['@capabilities']
                                 ]
                                 $statement: #Conditional[
                                    $cond: #Indexer[
                                       $recv: #NameExpr['@capabilities']
                                       $index: #List[
                                          $expression: #NameExpr['key']
                                       ]
                                    ]
                                    $then: #TrueExpr['true']
                                    $else: #FalseExpr['false']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['private']
                           $param: #List[
                              $expression: #NameExpr['capable?']
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['capable_plain_auth?']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['auth_capable?']
                                 $param: #List[
                                    $expression: #StringExpr['PLAIN']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['capable_login_auth?']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['auth_capable?']
                                 $param: #List[
                                    $expression: #StringExpr['LOGIN']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['capable_cram_md5_auth?']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['auth_capable?']
                                 $param: #List[
                                    $expression: #StringExpr['CRAM-MD5']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['auth_capable?']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['type']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #Unless[
                                    $then: #RReturnStmt[
                                       $expr: #List[
                                          $expression: #Nil['nil']
                                       ]
                                    ]
                                    $cond: #NameExpr['@capabilities']
                                 ]
                                 $statement: #Unless[
                                    $then: #RReturnStmt[
                                       $expr: #List[
                                          $expression: #FalseExpr['false']
                                       ]
                                    ]
                                    $cond: #Indexer[
                                       $recv: #NameExpr['@capabilities']
                                       $index: #List[
                                          $expression: #StringExpr['AUTH']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #Indexer[
                                       $recv: #NameExpr['@capabilities']
                                       $index: #List[
                                          $expression: #StringExpr['AUTH']
                                       ]
                                    ]
                                    $recv: #NameExpr['include?']
                                    $param: #List[
                                       $expression: #NameExpr['type']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['private']
                           $param: #List[
                              $expression: #NameExpr['auth_capable?']
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['capable_auth_types']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #Unless[
                                    $then: #RReturnStmt[
                                       $expr: #List[
                                          $expression: #Array['[]']
                                       ]
                                    ]
                                    $cond: #NameExpr['@capabilities']
                                 ]
                                 $statement: #Unless[
                                    $then: #RReturnStmt[
                                       $expr: #List[
                                          $expression: #Array['[]']
                                       ]
                                    ]
                                    $cond: #Indexer[
                                       $recv: #NameExpr['@capabilities']
                                       $index: #List[
                                          $expression: #StringExpr['AUTH']
                                       ]
                                    ]
                                 ]
                                 $statement: #Indexer[
                                    $recv: #NameExpr['@capabilities']
                                    $index: #List[
                                       $expression: #StringExpr['AUTH']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['tls?']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #NameExpr['@tls']
                           ]
                        ]
                        $statement: #Alias[
                           $newname: #NameExpr['ssl?']
                           $target: #NameExpr['tls?']
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['enable_tls']
                           $param: #List[
                              $param: #OptionalParam[
                                 $name: #NameExpr['context']
                                 $default: #ApplyExpr[
                                    $recv: #NameExpr['SMTP']
                                    $recv: #NameExpr['default_ssl_context']
                                 ]
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #Unless[
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #StringExpr['openssl library not installed']
                                       ]
                                    ]
                                    $cond: #Defined[
                                       $base: #NameExpr['OpenSSL']
                                    ]
                                 ]
                                 $statement: #IfExpr[
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #NameExpr['ArgumentError']
                                          $expression: #StringExpr['SMTPS and STARTTLS is exclusive']
                                       ]
                                    ]
                                    $cond: #NameExpr['@starttls']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@tls']
                                    $right: #TrueExpr['true']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@ssl_context']
                                    $right: #NameExpr['context']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #Alias[
                           $newname: #NameExpr['enable_ssl']
                           $target: #NameExpr['enable_tls']
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['disable_tls']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@tls']
                                    $right: #FalseExpr['false']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@ssl_context']
                                    $right: #Nil['nil']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #Alias[
                           $newname: #NameExpr['disable_ssl']
                           $target: #NameExpr['disable_tls']
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['starttls?']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #NameExpr['@starttls']
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['starttls_always?']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #EqExpr[
                                 $left: #NameExpr['@starttls']
                                 $right: #NameExpr['always']
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['starttls_auto?']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #EqExpr[
                                 $left: #NameExpr['@starttls']
                                 $right: #NameExpr['auto']
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['enable_starttls']
                           $param: #List[
                              $param: #OptionalParam[
                                 $name: #NameExpr['context']
                                 $default: #ApplyExpr[
                                    $recv: #NameExpr['SMTP']
                                    $recv: #NameExpr['default_ssl_context']
                                 ]
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #Unless[
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #StringExpr['openssl library not installed']
                                       ]
                                    ]
                                    $cond: #Defined[
                                       $base: #NameExpr['OpenSSL']
                                    ]
                                 ]
                                 $statement: #IfExpr[
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #NameExpr['ArgumentError']
                                          $expression: #StringExpr['SMTPS and STARTTLS is exclusive']
                                       ]
                                    ]
                                    $cond: #NameExpr['@tls']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@starttls']
                                    $right: #NameExpr['always']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@ssl_context']
                                    $right: #NameExpr['context']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['enable_starttls_auto']
                           $param: #List[
                              $param: #OptionalParam[
                                 $name: #NameExpr['context']
                                 $default: #ApplyExpr[
                                    $recv: #NameExpr['SMTP']
                                    $recv: #NameExpr['default_ssl_context']
                                 ]
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #Unless[
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #StringExpr['openssl library not installed']
                                       ]
                                    ]
                                    $cond: #Defined[
                                       $base: #NameExpr['OpenSSL']
                                    ]
                                 ]
                                 $statement: #IfExpr[
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #NameExpr['ArgumentError']
                                          $expression: #StringExpr['SMTPS and STARTTLS is exclusive']
                                       ]
                                    ]
                                    $cond: #NameExpr['@tls']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@starttls']
                                    $right: #NameExpr['auto']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@ssl_context']
                                    $right: #NameExpr['context']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['disable_starttls']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@starttls']
                                    $right: #FalseExpr['false']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@ssl_context']
                                    $right: #Nil['nil']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['attr_reader']
                           $param: #List[
                              $expression: #NameExpr['address']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['attr_reader']
                           $param: #List[
                              $expression: #NameExpr['port']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['attr_accessor']
                           $param: #List[
                              $expression: #NameExpr['open_timeout']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['attr_reader']
                           $param: #List[
                              $expression: #NameExpr['read_timeout']
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['read_timeout=']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['sec']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #IfExpr[
                                    $then: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['@socket']
                                          $name: #NameExpr['read_timeout']
                                       ]
                                       $right: #NameExpr['sec']
                                    ]
                                    $cond: #NameExpr['@socket']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@read_timeout']
                                    $right: #NameExpr['sec']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['debug_output=']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['arg']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #AssignExpr[
                                 $left: #NameExpr['@debug_output']
                                 $right: #NameExpr['arg']
                              ]
                           ]
                        ]
                        $statement: #Alias[
                           $newname: #NameExpr['set_debug_output']
                           $target: #NameExpr['debug_output=']
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['SMTP']
                           $name: #NameExpr['start']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['address']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['port']
                                 $default: #Nil['nil']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['helo']
                                 $default: #StringExpr['localhost']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['user']
                                 $default: #Nil['nil']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['secret']
                                 $default: #Nil['nil']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['authtype']
                                 $default: #Nil['nil']
                              ]
                              $param: #ProcedureParam[
                                 $name: #NameExpr['block']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #NameExpr['address']
                                       $expression: #NameExpr['port']
                                    ]
                                 ]
                                 $recv: #NameExpr['start']
                                 $param: #List[
                                    $expression: #NameExpr['helo']
                                    $expression: #NameExpr['user']
                                    $expression: #NameExpr['secret']
                                    $expression: #NameExpr['authtype']
                                    $procedure: #Procedure[
                                       $base: #NameExpr['block']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['started?']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #NameExpr['@started']
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['start']
                           $param: #List[
                              $param: #OptionalParam[
                                 $name: #NameExpr['helo']
                                 $default: #StringExpr['localhost']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['user']
                                 $default: #Nil['nil']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['secret']
                                 $default: #Nil['nil']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['authtype']
                                 $default: #Nil['nil']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #IfExpr[
                                 $cond: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['block_given?']
                                 ]
                                 $then: #ExceptionBlock[
                                    $main: #List[
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['do_start']
                                          $param: #List[
                                             $expression: #NameExpr['helo']
                                             $expression: #NameExpr['user']
                                             $expression: #NameExpr['secret']
                                             $expression: #NameExpr['authtype']
                                          ]
                                       ]
                                       $statement: #RReturnStmt[
                                          $expr: #List[
                                             $command: #Yield[
                                                $param: #List[
                                                   $expression: #Self['self']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                    $ensure: #NameExpr['do_finish']
                                 ]
                                 $else: #List[
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['do_start']
                                       $param: #List[
                                          $expression: #NameExpr['helo']
                                          $expression: #NameExpr['user']
                                          $expression: #NameExpr['secret']
                                          $expression: #NameExpr['authtype']
                                       ]
                                    ]
                                    $statement: #RReturnStmt[
                                       $expr: #List[
                                          $expression: #Self['self']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['finish']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #Unless[
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #NameExpr['IOError']
                                          $expression: #StringExpr['not yet started']
                                       ]
                                    ]
                                    $cond: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['started?']
                                    ]
                                 ]
                                 $statement: #NameExpr['do_finish']
                              ]
                           ]
                        ]
                        $statement: #NameExpr['private']
                        $statement: #FuncDecl[
                           $name: #NameExpr['tcp_socket']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['address']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['port']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 $base: #NameExpr['TCPSocket']
                                 $recv: #NameExpr['open']
                                 $param: #List[
                                    $expression: #NameExpr['address']
                                    $expression: #NameExpr['port']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['do_start']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['helo_domain']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['user']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['secret']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['authtype']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #IfExpr[
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #NameExpr['IOError']
                                          $expression: #StringExpr['SMTP session already started']
                                       ]
                                    ]
                                    $cond: #NameExpr['@started']
                                 ]
                                 $statement: #IfExpr[
                                    $cond: #OrExpr[
                                       $left: #NameExpr['user']
                                       $right: #NameExpr['secret']
                                    ]
                                    $then: #List[
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['check_auth_method']
                                          $param: #List[
                                             $expression: #LOr[
                                                $left: #NameExpr['authtype']
                                                $right: #NameExpr['DEFAULT_AUTH_TYPE']
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['check_auth_args']
                                          $param: #List[
                                             $expression: #NameExpr['user']
                                             $expression: #NameExpr['secret']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['s']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['Timeout']
                                       $recv: #NameExpr['timeout']
                                       $param: #List[
                                          $expression: #NameExpr['@open_timeout']
                                          $expression: #Field[
                                             $recv: #NameExpr['Net']
                                             $name: #NameExpr['OpenTimeout']
                                          ]
                                       ]
                                       $body: #Block[
                                          $body: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['tcp_socket']
                                             $param: #List[
                                                $expression: #NameExpr['@address']
                                                $expression: #NameExpr['@port']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['logging']
                                    $param: #List[
                                       $expression: #StringExpr[
                                          $inner: #NameExpr['@address']
                                          $inner: #NameExpr['@port']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@socket']
                                    $right: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['new_internet_message_io']
                                       $param: #List[
                                          $expression: #Conditional[
                                             $cond: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['tls?']
                                             ]
                                             $then: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['tlsconnect']
                                                $param: #List[
                                                   $expression: #NameExpr['s']
                                                ]
                                             ]
                                             $else: #NameExpr['s']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['check_response']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['critical']
                                          $body: #Block[
                                             $body: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['recv_response']
                                                $param: #Empty['']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['do_helo']
                                    $param: #List[
                                       $expression: #NameExpr['helo_domain']
                                    ]
                                 ]
                                 $statement: #IfExpr[
                                    $cond: #OrExpr[
                                       $left: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['starttls_always?']
                                       ]
                                       $right: #AndExpr[
                                          $left: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['capable_starttls?']
                                          ]
                                          $right: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['starttls_auto?']
                                          ]
                                       ]
                                    ]
                                    $then: #List[
                                       $statement: #Unless[
                                          $cond: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['capable_starttls?']
                                          ]
                                          $then: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['raise']
                                             $param: #List[
                                                $expression: #NameExpr['SMTPUnsupportedCommand']
                                                $expression: #StringExpr['STARTTLS is not supported on this server']
                                             ]
                                          ]
                                       ]
                                       $statement: #NameExpr['starttls']
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['@socket']
                                          $right: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['new_internet_message_io']
                                             $param: #List[
                                                $expression: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['tlsconnect']
                                                   $param: #List[
                                                      $expression: #NameExpr['s']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['do_helo']
                                          $param: #List[
                                             $expression: #NameExpr['helo_domain']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #IfExpr[
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['authenticate']
                                       $param: #List[
                                          $expression: #NameExpr['user']
                                          $expression: #NameExpr['secret']
                                          $expression: #LOr[
                                             $left: #NameExpr['authtype']
                                             $right: #NameExpr['DEFAULT_AUTH_TYPE']
                                          ]
                                       ]
                                    ]
                                    $cond: #NameExpr['user']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@started']
                                    $right: #TrueExpr['true']
                                 ]
                              ]
                              $ensure: #Unless[
                                 $cond: #NameExpr['@started']
                                 $then: #List[
                                    $statement: #IfExpr[
                                       $then: #ApplyExpr[
                                          $recv: #NameExpr['s']
                                          $recv: #NameExpr['close']
                                       ]
                                       $cond: #AndExpr[
                                          $left: #NameExpr['s']
                                          $right: #[
                                             $base: #ApplyExpr[
                                                $recv: #NameExpr['s']
                                                $recv: #NameExpr['closed?']
                                             ]
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['@socket']
                                       $right: #Nil['nil']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['ssl_socket']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['socket']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['context']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 $base: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['SSLSocket']
                                 ]
                                 $recv: #NameExpr['new']
                                 $param: #List[
                                    $expression: #NameExpr['socket']
                                    $expression: #NameExpr['context']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['tlsconnect']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['s']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['verified']
                                    $right: #FalseExpr['false']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['s']
                                    $right: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['ssl_socket']
                                       $param: #List[
                                          $expression: #NameExpr['s']
                                          $expression: #NameExpr['@ssl_context']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['logging']
                                    $param: #List[
                                       $expression: #StringExpr['TLS connection started']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['s']
                                       $name: #NameExpr['sync_close']
                                    ]
                                    $right: #TrueExpr['true']
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['s']
                                    $recv: #NameExpr['connect']
                                 ]
                                 $statement: #IfExpr[
                                    $cond: #NeExpr[
                                       $left: #ApplyExpr[
                                          $recv: #NameExpr['@ssl_context']
                                          $recv: #NameExpr['verify_mode']
                                       ]
                                       $right: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $name: #NameExpr['VERIFY_NONE']
                                       ]
                                    ]
                                    $then: #ApplyExpr[
                                       $recv: #NameExpr['s']
                                       $recv: #NameExpr['post_connection_check']
                                       $param: #List[
                                          $expression: #NameExpr['@address']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['verified']
                                    $right: #TrueExpr['true']
                                 ]
                                 $statement: #NameExpr['s']
                              ]
                              $ensure: #Unless[
                                 $then: #ApplyExpr[
                                    $recv: #NameExpr['s']
                                    $recv: #NameExpr['close']
                                 ]
                                 $cond: #NameExpr['verified']
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['new_internet_message_io']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['s']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['io']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['InternetMessageIO']
                                       $recv: #NameExpr['new']
                                       $param: #List[
                                          $expression: #NameExpr['s']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['io']
                                       $name: #NameExpr['read_timeout']
                                    ]
                                    $right: #NameExpr['@read_timeout']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['io']
                                       $name: #NameExpr['debug_output']
                                    ]
                                    $right: #NameExpr['@debug_output']
                                 ]
                                 $statement: #NameExpr['io']
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['do_helo']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['helo_domain']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['res']
                                    $right: #Conditional[
                                       $cond: #NameExpr['@esmtp']
                                       $then: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['ehlo']
                                          $param: #List[
                                             $expression: #NameExpr['helo_domain']
                                          ]
                                       ]
                                       $else: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['helo']
                                          $param: #List[
                                             $expression: #NameExpr['helo_domain']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@capabilities']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['res']
                                       $recv: #NameExpr['capabilities']
                                    ]
                                 ]
                              ]
                              $rescue: #List[
                                 $rescue: #Rescue[
                                    $class: #NameExpr['SMTPError']
                                    $then: #List[
                                       $statement: #IfExpr[
                                          $cond: #NameExpr['@esmtp']
                                          $then: #List[
                                             $statement: #AssignExpr[
                                                $left: #NameExpr['@esmtp']
                                                $right: #FalseExpr['false']
                                             ]
                                             $statement: #AssignExpr[
                                                $left: #NameExpr['@error_occurred']
                                                $right: #FalseExpr['false']
                                             ]
                                             $statement: #Retry['retry']
                                          ]
                                       ]
                                       $statement: #NameExpr['raise']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['do_finish']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #IfExpr[
                                 $then: #NameExpr['quit']
                                 $cond: #AndExpr[
                                    $left: #AndExpr[
                                       $left: #NameExpr['@socket']
                                       $right: #[
                                          $base: #ApplyExpr[
                                             $recv: #NameExpr['@socket']
                                             $recv: #NameExpr['closed?']
                                          ]
                                       ]
                                    ]
                                    $right: #[
                                       $base: #NameExpr['@error_occurred']
                                    ]
                                 ]
                              ]
                              $ensure: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@started']
                                    $right: #FalseExpr['false']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@error_occurred']
                                    $right: #FalseExpr['false']
                                 ]
                                 $statement: #IfExpr[
                                    $then: #ApplyExpr[
                                       $recv: #NameExpr['@socket']
                                       $recv: #NameExpr['close']
                                    ]
                                    $cond: #AndExpr[
                                       $left: #NameExpr['@socket']
                                       $right: #[
                                          $base: #ApplyExpr[
                                             $recv: #NameExpr['@socket']
                                             $recv: #NameExpr['closed?']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@socket']
                                    $right: #Nil['nil']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #NameExpr['public']
                        $statement: #FuncDecl[
                           $name: #NameExpr['send_message']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['msgstr']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['from_addr']
                              ]
                              $param: #VariadicParam[
                                 $name: #NameExpr['to_addrs']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #Unless[
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #NameExpr['IOError']
                                          $expression: #StringExpr['closed session']
                                       ]
                                    ]
                                    $cond: #NameExpr['@socket']
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['mailfrom']
                                    $param: #List[
                                       $expression: #NameExpr['from_addr']
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['rcptto_list']
                                    $param: #List[
                                       $expression: #NameExpr['to_addrs']
                                    ]
                                    $body: #Block[
                                       $body: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['data']
                                          $param: #List[
                                             $expression: #NameExpr['msgstr']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #Alias[
                           $newname: #NameExpr['send_mail']
                           $target: #NameExpr['send_message']
                        ]
                        $statement: #Alias[
                           $newname: #NameExpr['sendmail']
                           $target: #NameExpr['send_message']
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['open_message_stream']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['from_addr']
                              ]
                              $param: #VariadicParam[
                                 $name: #NameExpr['to_addrs']
                              ]
                              $param: #ProcedureParam[
                                 $name: #NameExpr['block']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #Unless[
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #NameExpr['IOError']
                                          $expression: #StringExpr['closed session']
                                       ]
                                    ]
                                    $cond: #NameExpr['@socket']
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['mailfrom']
                                    $param: #List[
                                       $expression: #NameExpr['from_addr']
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['rcptto_list']
                                    $param: #List[
                                       $expression: #NameExpr['to_addrs']
                                    ]
                                    $body: #Block[
                                       $body: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['data']
                                          $param: #List[
                                             $procedure: #Procedure[
                                                $base: #NameExpr['block']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #Alias[
                           $newname: #NameExpr['ready']
                           $target: #NameExpr['open_message_stream']
                        ]
                        $statement: #NameExpr['public']
                        $statement: #AssignExpr[
                           $left: #NameExpr['DEFAULT_AUTH_TYPE']
                           $right: #NameExpr['plain']
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['authenticate']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['user']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['secret']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['authtype']
                                 $default: #NameExpr['DEFAULT_AUTH_TYPE']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['check_auth_method']
                                    $param: #List[
                                       $expression: #NameExpr['authtype']
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['check_auth_args']
                                    $param: #List[
                                       $expression: #NameExpr['user']
                                       $expression: #NameExpr['secret']
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['send']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['auth_method']
                                          $param: #List[
                                             $expression: #NameExpr['authtype']
                                          ]
                                       ]
                                       $expression: #NameExpr['user']
                                       $expression: #NameExpr['secret']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['auth_plain']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['user']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['secret']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['check_auth_args']
                                    $param: #List[
                                       $expression: #NameExpr['user']
                                       $expression: #NameExpr['secret']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['res']
                                    $right: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['critical']
                                       $body: #Block[
                                          $body: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['get_response']
                                             $param: #List[
                                                $expression: #AddExpr[
                                                   $left: #StringExpr['AUTH PLAIN ']
                                                   $right: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #NameExpr['base64_encode']
                                                      $param: #List[
                                                         $expression: #StringExpr[
                                                            $inner: #NameExpr['user']
                                                            $inner: #NameExpr['secret']
                                                         ]
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['check_auth_response']
                                    $param: #List[
                                       $expression: #NameExpr['res']
                                    ]
                                 ]
                                 $statement: #NameExpr['res']
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['auth_login']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['user']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['secret']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['check_auth_args']
                                    $param: #List[
                                       $expression: #NameExpr['user']
                                       $expression: #NameExpr['secret']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['res']
                                    $right: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['critical']
                                       $body: #Block[
                                          $body: #List[
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['check_auth_continue']
                                                $param: #List[
                                                   $expression: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #NameExpr['get_response']
                                                      $param: #List[
                                                         $expression: #StringExpr['AUTH LOGIN']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['check_auth_continue']
                                                $param: #List[
                                                   $expression: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #NameExpr['get_response']
                                                      $param: #List[
                                                         $expression: #ApplyExpr[
                                                            #Self['self']
                                                            $recv: #NameExpr['base64_encode']
                                                            $param: #List[
                                                               $expression: #NameExpr['user']
                                                            ]
                                                         ]
                                                      ]
                                                   ]
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['get_response']
                                                $param: #List[
                                                   $expression: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #NameExpr['base64_encode']
                                                      $param: #List[
                                                         $expression: #NameExpr['secret']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['check_auth_response']
                                    $param: #List[
                                       $expression: #NameExpr['res']
                                    ]
                                 ]
                                 $statement: #NameExpr['res']
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['auth_cram_md5']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['user']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['secret']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['check_auth_args']
                                    $param: #List[
                                       $expression: #NameExpr['user']
                                       $expression: #NameExpr['secret']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['res']
                                    $right: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['critical']
                                       $body: #Block[
                                          $body: #List[
                                             $statement: #AssignExpr[
                                                $left: #NameExpr['res0']
                                                $right: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['get_response']
                                                   $param: #List[
                                                      $expression: #StringExpr['AUTH CRAM-MD5']
                                                   ]
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['check_auth_continue']
                                                $param: #List[
                                                   $expression: #NameExpr['res0']
                                                ]
                                             ]
                                             $statement: #AssignExpr[
                                                $left: #NameExpr['crammed']
                                                $right: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['cram_md5_response']
                                                   $param: #List[
                                                      $expression: #NameExpr['secret']
                                                      $expression: #ApplyExpr[
                                                         $recv: #NameExpr['res0']
                                                         $recv: #NameExpr['cram_md5_challenge']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['get_response']
                                                $param: #List[
                                                   $expression: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #NameExpr['base64_encode']
                                                      $param: #List[
                                                         $expression: #StringExpr[
                                                            $inner: #NameExpr['user']
                                                            $inner: #NameExpr['crammed']
                                                         ]
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['check_auth_response']
                                    $param: #List[
                                       $expression: #NameExpr['res']
                                    ]
                                 ]
                                 $statement: #NameExpr['res']
                              ]
                           ]
                        ]
                        $statement: #NameExpr['private']
                        $statement: #FuncDecl[
                           $name: #NameExpr['check_auth_method']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['type']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #Unless[
                                 $cond: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['respond_to?']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['auth_method']
                                          $param: #List[
                                             $expression: #NameExpr['type']
                                          ]
                                       ]
                                       $expression: #TrueExpr['true']
                                    ]
                                 ]
                                 $then: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['raise']
                                    $param: #List[
                                       $expression: #NameExpr['ArgumentError']
                                       $expression: #StringExpr[
                                          $inner: #NameExpr['type']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['auth_method']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['type']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 $recv: #StringExpr[
                                    $inner: #ApplyExpr[
                                       $recv: #ApplyExpr[
                                          $recv: #NameExpr['type']
                                          $recv: #NameExpr['to_s']
                                       ]
                                       $recv: #NameExpr['downcase']
                                    ]
                                 ]
                                 $recv: #NameExpr['intern']
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['check_auth_args']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['user']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['secret']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['authtype']
                                 $default: #NameExpr['DEFAULT_AUTH_TYPE']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #Unless[
                                    $cond: #NameExpr['user']
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #NameExpr['ArgumentError']
                                          $expression: #StringExpr['SMTP-AUTH requested but missing user name']
                                       ]
                                    ]
                                 ]
                                 $statement: #Unless[
                                    $cond: #NameExpr['secret']
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #NameExpr['ArgumentError']
                                          $expression: #StringExpr['SMTP-AUTH requested but missing secret phrase']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['base64_encode']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['str']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 $recv: #Array[
                                    $index: #List[
                                       $expression: #NameExpr['str']
                                    ]
                                 ]
                                 $recv: #NameExpr['pack']
                                 $param: #List[
                                    $expression: #StringExpr['m0']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['IMASK']
                           $right: #HexInteger['0x36']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['OMASK']
                           $right: #HexInteger['0x5c']
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['cram_md5_response']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['secret']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['challenge']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['tmp']
                                    $right: #ApplyExpr[
                                       $recv: #Field[
                                          $recv: #NameExpr['Digest']
                                          $name: #NameExpr['MD5']
                                       ]
                                       $recv: #NameExpr['digest']
                                       $param: #List[
                                          $expression: #AddExpr[
                                             $left: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['cram_secret']
                                                $param: #List[
                                                   $expression: #NameExpr['secret']
                                                   $expression: #NameExpr['IMASK']
                                                ]
                                             ]
                                             $right: #NameExpr['challenge']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['Digest']
                                       $name: #NameExpr['MD5']
                                    ]
                                    $recv: #NameExpr['hexdigest']
                                    $param: #List[
                                       $expression: #AddExpr[
                                          $left: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['cram_secret']
                                             $param: #List[
                                                $expression: #NameExpr['secret']
                                                $expression: #NameExpr['OMASK']
                                             ]
                                          ]
                                          $right: #NameExpr['tmp']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['CRAM_BUFSIZE']
                           $right: #IntExpr['64']
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['cram_secret']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['secret']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['mask']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #IfExpr[
                                    $then: #AssignExpr[
                                       $left: #NameExpr['secret']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #NameExpr['Digest']
                                             $name: #NameExpr['MD5']
                                          ]
                                          $recv: #NameExpr['digest']
                                          $param: #List[
                                             $expression: #NameExpr['secret']
                                          ]
                                       ]
                                    ]
                                    $cond: #GtExpr[
                                       $left: #ApplyExpr[
                                          $recv: #NameExpr['secret']
                                          $recv: #NameExpr['size']
                                       ]
                                       $right: #NameExpr['CRAM_BUFSIZE']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['buf']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['secret']
                                       $recv: #NameExpr['ljust']
                                       $param: #List[
                                          $expression: #NameExpr['CRAM_BUFSIZE']
                                          $expression: #StringExpr['\\0']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #IntExpr['0']
                                    $recv: #NameExpr['upto']
                                    $param: #List[
                                       $expression: #SubExpr[
                                          $left: #ApplyExpr[
                                             $recv: #NameExpr['buf']
                                             $recv: #NameExpr['size']
                                          ]
                                          $right: #IntExpr['1']
                                       ]
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['i']
                                       $body: #AssignExpr[
                                          $left: #Indexer[
                                             $base: #NameExpr['buf']
                                             $index: #List[
                                                $expression: #NameExpr['i']
                                             ]
                                          ]
                                          $right: #ApplyExpr[
                                             $recv: #XorExpr[
                                                $left: #ApplyExpr[
                                                   $recv: #Indexer[
                                                      $recv: #NameExpr['buf']
                                                      $index: #List[
                                                         $expression: #NameExpr['i']
                                                      ]
                                                   ]
                                                   $recv: #NameExpr['ord']
                                                ]
                                                $right: #NameExpr['mask']
                                             ]
                                             $recv: #NameExpr['chr']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #NameExpr['buf']
                              ]
                           ]
                        ]
                        $statement: #NameExpr['public']
                        $statement: #FuncDecl[
                           $name: #NameExpr['rset']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['getok']
                                 $param: #List[
                                    $expression: #StringExpr['RSET']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['starttls']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['getok']
                                 $param: #List[
                                    $expression: #StringExpr['STARTTLS']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['helo']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['domain']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['getok']
                                 $param: #List[
                                    $expression: #StringExpr[
                                       $inner: #NameExpr['domain']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['ehlo']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['domain']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['getok']
                                 $param: #List[
                                    $expression: #StringExpr[
                                       $inner: #NameExpr['domain']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['mailfrom']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['from_addr']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #IfExpr[
                                    $cond: #GtExpr[
                                       $left: #NameExpr['$SAFE']
                                       $right: #IntExpr['0']
                                    ]
                                    $then: #IfExpr[
                                       $then: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['raise']
                                          $param: #List[
                                             $expression: #NameExpr['SecurityError']
                                             $expression: #StringExpr['tainted from_addr']
                                          ]
                                       ]
                                       $cond: #ApplyExpr[
                                          $recv: #NameExpr['from_addr']
                                          $recv: #NameExpr['tainted?']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['getok']
                                    $param: #List[
                                       $expression: #StringExpr[
                                          $inner: #NameExpr['from_addr']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['rcptto_list']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['to_addrs']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #IfExpr[
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #NameExpr['ArgumentError']
                                          $expression: #StringExpr['mail destination not given']
                                       ]
                                    ]
                                    $cond: #ApplyExpr[
                                       $recv: #NameExpr['to_addrs']
                                       $recv: #NameExpr['empty?']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ok_users']
                                    $right: #Array['[]']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['unknown_users']
                                    $right: #Array['[]']
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #ApplyExpr[
                                       $recv: #NameExpr['to_addrs']
                                       $recv: #NameExpr['flatten']
                                    ]
                                    $recv: #NameExpr['each']
                                    $body: #Block[
                                       $param: #NameExpr['addr']
                                       $body: #ExceptionBlock[
                                          $main: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['rcptto']
                                             $param: #List[
                                                $expression: #NameExpr['addr']
                                             ]
                                          ]
                                          $rescue: #List[
                                             $rescue: #Rescue[
                                                $class: #NameExpr['SMTPAuthenticationError']
                                                $then: #LShiftExpr[
                                                   $left: #NameExpr['unknown_users']
                                                   $right: #ApplyExpr[
                                                      $recv: #NameExpr['addr']
                                                      $recv: #NameExpr['dump']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $else: #LShiftExpr[
                                             $left: #NameExpr['ok_users']
                                             $right: #NameExpr['addr']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #IfExpr[
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #NameExpr['ArgumentError']
                                          $expression: #StringExpr['mail destination not given']
                                       ]
                                    ]
                                    $cond: #ApplyExpr[
                                       $recv: #NameExpr['ok_users']
                                       $recv: #NameExpr['empty?']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ret']
                                    $right: #Yield['yield']
                                 ]
                                 $statement: #Unless[
                                    $cond: #ApplyExpr[
                                       $recv: #NameExpr['unknown_users']
                                       $recv: #NameExpr['empty?']
                                    ]
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #NameExpr['SMTPAuthenticationError']
                                          $expression: #StringExpr[
                                             $inner: #ApplyExpr[
                                                $recv: #NameExpr['unknown_users']
                                                $recv: #NameExpr['join']
                                                $param: #List[
                                                   $expression: #StringExpr[', ']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #NameExpr['ret']
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['rcptto']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['to_addr']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #IfExpr[
                                    $cond: #GtExpr[
                                       $left: #NameExpr['$SAFE']
                                       $right: #IntExpr['0']
                                    ]
                                    $then: #IfExpr[
                                       $then: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['raise']
                                          $param: #List[
                                             $expression: #NameExpr['SecurityError']
                                             $expression: #StringExpr['tainted to_addr']
                                          ]
                                       ]
                                       $cond: #ApplyExpr[
                                          $recv: #NameExpr['to_addr']
                                          $recv: #NameExpr['tainted?']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['getok']
                                    $param: #List[
                                       $expression: #StringExpr[
                                          $inner: #NameExpr['to_addr']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['data']
                           $param: #List[
                              $param: #OptionalParam[
                                 $name: #NameExpr['msgstr']
                                 $default: #Nil['nil']
                              ]
                              $param: #ProcedureParam[
                                 $name: #NameExpr['block']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #IfExpr[
                                    $cond: #AndExpr[
                                       $left: #NameExpr['msgstr']
                                       $right: #NameExpr['block']
                                    ]
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #NameExpr['ArgumentError']
                                          $expression: #StringExpr['message and block are exclusive']
                                       ]
                                    ]
                                 ]
                                 $statement: #Unless[
                                    $cond: #OrExpr[
                                       $left: #NameExpr['msgstr']
                                       $right: #NameExpr['block']
                                    ]
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #NameExpr['ArgumentError']
                                          $expression: #StringExpr['message or block is required']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['res']
                                    $right: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['critical']
                                       $body: #Block[
                                          $body: #List[
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['check_continue']
                                                $param: #List[
                                                   $expression: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #NameExpr['get_response']
                                                      $param: #List[
                                                         $expression: #StringExpr['DATA']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                             $statement: #AssignExpr[
                                                $left: #NameExpr['socket_sync_bak']
                                                $right: #ApplyExpr[
                                                   $recv: #ApplyExpr[
                                                      $recv: #NameExpr['@socket']
                                                      $recv: #NameExpr['io']
                                                   ]
                                                   $recv: #NameExpr['sync']
                                                ]
                                             ]
                                             $statement: #ExceptionBlock[
                                                $main: #List[
                                                   $statement: #AssignExpr[
                                                      $left: #Field[
                                                         $base: #ApplyExpr[
                                                            $recv: #NameExpr['@socket']
                                                            $recv: #NameExpr['io']
                                                         ]
                                                         $name: #NameExpr['sync']
                                                      ]
                                                      $right: #FalseExpr['false']
                                                   ]
                                                   $statement: #IfExpr[
                                                      $cond: #NameExpr['msgstr']
                                                      $then: #ApplyExpr[
                                                         $base: #NameExpr['@socket']
                                                         $recv: #NameExpr['write_message']
                                                         $param: #List[
                                                            $expression: #NameExpr['msgstr']
                                                         ]
                                                      ]
                                                      $else: #ApplyExpr[
                                                         $recv: #NameExpr['@socket']
                                                         $recv: #NameExpr['write_message_by_block']
                                                         $param: #List[
                                                            $procedure: #Procedure[
                                                               $base: #NameExpr['block']
                                                            ]
                                                         ]
                                                      ]
                                                   ]
                                                ]
                                                $ensure: #List[
                                                   $statement: #ApplyExpr[
                                                      $recv: #ApplyExpr[
                                                         $recv: #NameExpr['@socket']
                                                         $recv: #NameExpr['io']
                                                      ]
                                                      $recv: #NameExpr['flush']
                                                   ]
                                                   $statement: #AssignExpr[
                                                      $left: #Field[
                                                         $base: #ApplyExpr[
                                                            $recv: #NameExpr['@socket']
                                                            $recv: #NameExpr['io']
                                                         ]
                                                         $name: #NameExpr['sync']
                                                      ]
                                                      $right: #NameExpr['socket_sync_bak']
                                                   ]
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['recv_response']
                                                $param: #Empty['']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['check_response']
                                    $param: #List[
                                       $expression: #NameExpr['res']
                                    ]
                                 ]
                                 $statement: #NameExpr['res']
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['quit']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['getok']
                                 $param: #List[
                                    $expression: #StringExpr['QUIT']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #NameExpr['private']
                        $statement: #FuncDecl[
                           $name: #NameExpr['validate_line']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['line']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #IfExpr[
                                 $cond: #Match[
                                    $left: #Regex['/[\\r\\n]/']
                                    $right: #NameExpr['line']
                                 ]
                                 $then: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['raise']
                                    $param: #List[
                                       $expression: #NameExpr['ArgumentError']
                                       $expression: #StringExpr['A line must not contain CR or LF']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['getok']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['reqline']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['validate_line']
                                    $param: #List[
                                       $expression: #NameExpr['reqline']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['res']
                                    $right: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['critical']
                                       $body: #Block[
                                          $body: #List[
                                             $statement: #ApplyExpr[
                                                $base: #NameExpr['@socket']
                                                $recv: #NameExpr['writeline']
                                                $param: #List[
                                                   $expression: #NameExpr['reqline']
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['recv_response']
                                                $param: #Empty['']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['check_response']
                                    $param: #List[
                                       $expression: #NameExpr['res']
                                    ]
                                 ]
                                 $statement: #NameExpr['res']
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['get_response']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['reqline']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['validate_line']
                                    $param: #List[
                                       $expression: #NameExpr['reqline']
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $base: #NameExpr['@socket']
                                    $recv: #NameExpr['writeline']
                                    $param: #List[
                                       $expression: #NameExpr['reqline']
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['recv_response']
                                    $param: #Empty['']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['recv_response']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['buf']
                                    $right: #StringExpr['']
                                 ]
                                 $statement: #While[
                                    $cond: #TrueExpr['true']
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['line']
                                          $right: #ApplyExpr[
                                             $recv: #NameExpr['@socket']
                                             $recv: #NameExpr['readline']
                                          ]
                                       ]
                                       $statement: #LShiftExpr[
                                          $left: #LShiftExpr[
                                             $left: #NameExpr['buf']
                                             $right: #NameExpr['line']
                                          ]
                                          $right: #StringExpr['\\n']
                                       ]
                                       $statement: #Unless[
                                          $then: #Break['break']
                                          $cond: #EqExpr[
                                             $left: #Indexer[
                                                $recv: #NameExpr['line']
                                                $index: #List[
                                                   $expression: #IntExpr['3']
                                                   $expression: #IntExpr['1']
                                                ]
                                             ]
                                             $right: #StringExpr['-']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['Response']
                                    $recv: #NameExpr['parse']
                                    $param: #List[
                                       $expression: #NameExpr['buf']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['critical']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #IfExpr[
                                    $then: #RReturnStmt[
                                       $expr: #List[
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['Response']
                                             $recv: #NameExpr['parse']
                                             $param: #List[
                                                $expression: #StringExpr['200 dummy reply code']
                                             ]
                                          ]
                                       ]
                                    ]
                                    $cond: #NameExpr['@error_occurred']
                                 ]
                                 $statement: #ExceptionBlock[
                                    $main: #RReturnStmt[
                                       $expr: #List[
                                          $command: #Yield[
                                             $param: #List[
                                                $expression: #Empty['']
                                             ]
                                          ]
                                       ]
                                    ]
                                    $rescue: #List[
                                       $rescue: #Rescue[
                                          $class: #NameExpr['Exception']
                                          $then: #List[
                                             $statement: #AssignExpr[
                                                $left: #NameExpr['@error_occurred']
                                                $right: #TrueExpr['true']
                                             ]
                                             $statement: #NameExpr['raise']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['check_response']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['res']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #Unless[
                                 $cond: #ApplyExpr[
                                    $recv: #NameExpr['res']
                                    $recv: #NameExpr['success?']
                                 ]
                                 $then: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['raise']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['res']
                                          $recv: #NameExpr['exception_class']
                                       ]
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['res']
                                          $recv: #NameExpr['message']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['check_continue']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['res']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #Unless[
                                 $cond: #ApplyExpr[
                                    $recv: #NameExpr['res']
                                    $recv: #NameExpr['continue?']
                                 ]
                                 $then: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['raise']
                                    $param: #List[
                                       $expression: #NameExpr['SMTPUnknownError']
                                       $expression: #StringExpr[
                                          $inner: #ApplyExpr[
                                             $recv: #NameExpr['res']
                                             $recv: #NameExpr['status']
                                          ]
                                          $inner: #ApplyExpr[
                                             $recv: #NameExpr['res']
                                             $recv: #NameExpr['string']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['check_auth_response']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['res']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #Unless[
                                 $cond: #ApplyExpr[
                                    $recv: #NameExpr['res']
                                    $recv: #NameExpr['success?']
                                 ]
                                 $then: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['raise']
                                    $param: #List[
                                       $expression: #NameExpr['SMTPAuthenticationError']
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['res']
                                          $recv: #NameExpr['message']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['check_auth_continue']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['res']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #Unless[
                                 $cond: #ApplyExpr[
                                    $recv: #NameExpr['res']
                                    $recv: #NameExpr['continue?']
                                 ]
                                 $then: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['raise']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['res']
                                          $recv: #NameExpr['exception_class']
                                       ]
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['res']
                                          $recv: #NameExpr['message']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #Class[
                           $name: #NameExpr['Response']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #SFuncDecl[
                                    $path: #Self['self']
                                    $name: #NameExpr['parse']
                                    $param: #List[
                                       $param: #Param[
                                          $param: #NameExpr['str']
                                       ]
                                    ]
                                    $body: #BlockExpr[
                                       $main: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['new']
                                          $param: #List[
                                             $expression: #Indexer[
                                                $recv: #NameExpr['str']
                                                $index: #List[
                                                   $expression: #IntExpr['0']
                                                   $expression: #IntExpr['3']
                                                ]
                                             ]
                                             $expression: #NameExpr['str']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #FuncDecl[
                                    $name: #NameExpr['initialize']
                                    $param: #List[
                                       $param: #Param[
                                          $param: #NameExpr['status']
                                       ]
                                       $param: #Param[
                                          $param: #NameExpr['string']
                                       ]
                                    ]
                                    $body: #BlockExpr[
                                       $main: #List[
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['@status']
                                             $right: #NameExpr['status']
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['@string']
                                             $right: #NameExpr['string']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['attr_reader']
                                    $param: #List[
                                       $expression: #NameExpr['status']
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['attr_reader']
                                    $param: #List[
                                       $expression: #NameExpr['string']
                                    ]
                                 ]
                                 $statement: #FuncDecl[
                                    $name: #NameExpr['status_type_char']
                                    $param: #List['']
                                    $body: #BlockExpr[
                                       $main: #Indexer[
                                          $recv: #NameExpr['@status']
                                          $index: #List[
                                             $expression: #IntExpr['0']
                                             $expression: #IntExpr['1']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #FuncDecl[
                                    $name: #NameExpr['success?']
                                    $param: #List['']
                                    $body: #BlockExpr[
                                       $main: #EqExpr[
                                          $left: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['status_type_char']
                                             $param: #Empty['']
                                          ]
                                          $right: #StringExpr['2']
                                       ]
                                    ]
                                 ]
                                 $statement: #FuncDecl[
                                    $name: #NameExpr['continue?']
                                    $param: #List['']
                                    $body: #BlockExpr[
                                       $main: #EqExpr[
                                          $left: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['status_type_char']
                                             $param: #Empty['']
                                          ]
                                          $right: #StringExpr['3']
                                       ]
                                    ]
                                 ]
                                 $statement: #FuncDecl[
                                    $name: #NameExpr['message']
                                    $param: #List['']
                                    $body: #BlockExpr[
                                       $main: #ApplyExpr[
                                          $recv: #ApplyExpr[
                                             $recv: #NameExpr['@string']
                                             $recv: #NameExpr['lines']
                                          ]
                                          $recv: #NameExpr['first']
                                       ]
                                    ]
                                 ]
                                 $statement: #FuncDecl[
                                    $name: #NameExpr['cram_md5_challenge']
                                    $param: #List['']
                                    $body: #BlockExpr[
                                       $main: #Indexer[
                                          $recv: #ApplyExpr[
                                             $recv: #Indexer[
                                                $recv: #ApplyExpr[
                                                   $recv: #NameExpr['@string']
                                                   $recv: #NameExpr['split']
                                                   $param: #List[
                                                      $expression: #Regex['/ /']
                                                   ]
                                                ]
                                                $index: #List[
                                                   $expression: #IntExpr['1']
                                                ]
                                             ]
                                             $recv: #NameExpr['unpack']
                                             $param: #List[
                                                $expression: #StringExpr['m']
                                             ]
                                          ]
                                          $index: #List[
                                             $expression: #IntExpr['0']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #FuncDecl[
                                    $name: #NameExpr['capabilities']
                                    $param: #List['']
                                    $body: #BlockExpr[
                                       $main: #List[
                                          $statement: #Unless[
                                             $then: #RReturnStmt[
                                                $expr: #List[
                                                   $expression: #List['{}']
                                                ]
                                             ]
                                             $cond: #EqExpr[
                                                $left: #Indexer[
                                                   $recv: #NameExpr['@string']
                                                   $index: #List[
                                                      $expression: #IntExpr['3']
                                                      $expression: #IntExpr['1']
                                                   ]
                                                ]
                                                $right: #StringExpr['-']
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['h']
                                             $right: #List['{}']
                                          ]
                                          $statement: #ApplyExpr[
                                             $recv: #ApplyExpr[
                                                $recv: #ApplyExpr[
                                                   $recv: #NameExpr['@string']
                                                   $recv: #NameExpr['lines']
                                                ]
                                                $recv: #NameExpr['drop']
                                                $param: #List[
                                                   $expression: #IntExpr['1']
                                                ]
                                             ]
                                             $recv: #NameExpr['each']
                                             $body: #Block[
                                                $param: #NameExpr['line']
                                                $body: #List[
                                                   $statement: #MultipleAssign[
                                                      $left: #MultipleLeftHandSideExpression[
                                                         $item: #NameExpr['k']
                                                         $item: #Variadic[
                                                            $item: #NameExpr['v']
                                                         ]
                                                      ]
                                                      $right: #ApplyExpr[
                                                         $recv: #ApplyExpr[
                                                            $recv: #Indexer[
                                                               $recv: #NameExpr['line']
                                                               $index: #List[
                                                                  $expression: #ClosedRange[
                                                                     #IntExpr['4']
                                                                     #MinusExpr[
                                                                        $expr: #IntExpr['1']
                                                                     ]
                                                                  ]
                                                               ]
                                                            ]
                                                            $recv: #NameExpr['chomp']
                                                         ]
                                                         $recv: #NameExpr['split']
                                                      ]
                                                   ]
                                                   $statement: #AssignExpr[
                                                      $left: #Indexer[
                                                         $base: #NameExpr['h']
                                                         $index: #List[
                                                            $expression: #NameExpr['k']
                                                         ]
                                                      ]
                                                      $right: #NameExpr['v']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #NameExpr['h']
                                       ]
                                    ]
                                 ]
                                 $statement: #FuncDecl[
                                    $name: #NameExpr['exception_class']
                                    $param: #List['']
                                    $body: #BlockExpr[
                                       $main: #Case[
                                          $cond: #NameExpr['@status']
                                          $body: #List[
                                             $when: #When[
                                                $cond: #List[
                                                   $expression: #Regex['/\\A4/']
                                                ]
                                                $then: #NameExpr['SMTPServerBusy']
                                             ]
                                             $when: #When[
                                                $cond: #List[
                                                   $expression: #Regex['/\\A50/']
                                                ]
                                                $then: #NameExpr['SMTPSyntaxError']
                                             ]
                                             $when: #When[
                                                $cond: #List[
                                                   $expression: #Regex['/\\A53/']
                                                ]
                                                $then: #NameExpr['SMTPAuthenticationError']
                                             ]
                                             $when: #When[
                                                $cond: #List[
                                                   $expression: #Regex['/\\A5/']
                                                ]
                                                $then: #NameExpr['SMTPFatalError']
                                             ]
                                          ]
                                          $else: #NameExpr['SMTPUnknownError']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['logging']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['msg']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #IfExpr[
                                 $then: #LShiftExpr[
                                    $left: #NameExpr['@debug_output']
                                    $right: #AddExpr[
                                       $left: #NameExpr['msg']
                                       $right: #StringExpr['\\n']
                                    ]
                                 ]
                                 $cond: #NameExpr['@debug_output']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #AssignExpr[
                  $left: #NameExpr['SMTPSession']
                  $right: #NameExpr['SMTP']
               ]
            ]
         ]
      ]
   ]
   #Comsumed['comsumed']
]
