#Source[
   #List[
      $statement: #ExceptionBlock[
         $main: #ApplyExpr[
            #Self['self']
            $recv: #NameExpr['gem']
            $param: #List[
               $expression: #StringExpr['minitest']
               $expression: #StringExpr['~> 4.0']
            ]
         ]
         $rescue: #List[
            $rescue: #Rescue[
               $class: #MultipleRightHandSideExpression[
                  $expression: #NameExpr['NoMethodError']
                  $expression: #Field[
                     $recv: #NameExpr['Gem']
                     $name: #NameExpr['LoadError']
                  ]
               ]
               $then: #Empty['']
            ]
         ]
      ]
      $statement: #IfExpr[
         $cond: #ApplyExpr[
            #Self['self']
            $recv: #NameExpr['defined?']
            $param: #List[
               $expression: #Field[
                  $recv: #NameExpr['Gem']
                  $name: #NameExpr['QuickLoader']
               ]
            ]
         ]
         $then: #ApplyExpr[
            $recv: #Field[
               $recv: #NameExpr['Gem']
               $name: #NameExpr['QuickLoader']
            ]
            $recv: #NameExpr['load_full_rubygems_library']
         ]
         $else: #ApplyExpr[
            #Self['self']
            $recv: #NameExpr['require']
            $param: #List[
               $expression: #StringExpr['rubygems']
            ]
         ]
      ]
      $statement: #ExceptionBlock[
         $main: #ApplyExpr[
            #Self['self']
            $recv: #NameExpr['gem']
            $param: #List[
               $expression: #StringExpr['minitest']
            ]
         ]
         $rescue: #List[
            $rescue: #Rescue[
               $class: #Field[
                  $recv: #NameExpr['Gem']
                  $name: #NameExpr['LoadError']
               ]
               $then: #Empty['']
            ]
         ]
      ]
      $statement: #Unless[
         $cond: #ApplyExpr[
            $recv: #ApplyExpr[
               $recv: #ApplyExpr[
                  $recv: #Field[
                     $recv: #NameExpr['Gem']
                     $name: #NameExpr['Dependency']
                  ]
                  $recv: #NameExpr['new']
                  $param: #List[
                     $expression: #StringExpr['rdoc']
                     $expression: #StringExpr['>= 3.10']
                  ]
               ]
               $recv: #NameExpr['matching_specs']
            ]
            $recv: #NameExpr['empty?']
         ]
         $then: #List[
            $statement: #ApplyExpr[
               #Self['self']
               $recv: #NameExpr['gem']
               $param: #List[
                  $expression: #StringExpr['rdoc']
               ]
            ]
            $statement: #ApplyExpr[
               #Self['self']
               $recv: #NameExpr['gem']
               $param: #List[
                  $expression: #StringExpr['json']
               ]
            ]
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['minitest/autorun']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['rubygems/deprecate']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['fileutils']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['pathname']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['pp']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['rubygems/package']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['shellwords']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['tmpdir']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['uri']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['zlib']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['benchmark']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['rubygems/mock_gem_ui']
         ]
      ]
      $statement: #Module[
         $name: #NameExpr['Gem']
         $body: #BlockExpr[
            $main: #List[
               $statement: #SFuncDecl[
                  $path: #Self['self']
                  $name: #NameExpr['searcher=']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['searcher']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #AssignExpr[
                        $left: #NameExpr['@searcher']
                        $right: #NameExpr['searcher']
                     ]
                  ]
               ]
               $statement: #SFuncDecl[
                  $path: #Self['self']
                  $name: #NameExpr['win_platform=']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['val']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #AssignExpr[
                        $left: #NameExpr['@@win_platform']
                        $right: #NameExpr['val']
                     ]
                  ]
               ]
               $statement: #SFuncDecl[
                  $path: #Self['self']
                  $name: #NameExpr['ruby=']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['ruby']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #AssignExpr[
                        $left: #NameExpr['@ruby']
                        $right: #NameExpr['ruby']
                     ]
                  ]
               ]
               $statement: #Module[
                  $name: #NameExpr['DefaultUserInteraction']
                  $body: #BlockExpr[
                     $main: #AssignExpr[
                        $left: #NameExpr['@ui']
                        $right: #ApplyExpr[
                           $recv: #Field[
                              $recv: #NameExpr['Gem']
                              $name: #NameExpr['MockGemUi']
                           ]
                           $recv: #NameExpr['new']
                        ]
                     ]
                  ]
               ]
            ]
         ]
      ]
      $statement: #Class[
         $name: #NestedName[
            $path: #NameExpr['Gem']
            $name: #NameExpr['TestCase']
         ]
         $super: #Field[
            $recv: #Field[
               $recv: #NameExpr['MiniTest']
               $name: #NameExpr['Unit']
            ]
            $name: #NameExpr['TestCase']
         ]
         $body: #BlockExpr[
            $main: #List[
               $statement: #ApplyExpr[
                  #Self['self']
                  $recv: #NameExpr['attr_accessor']
                  $param: #List[
                     $expression: #NameExpr['fetcher']
                  ]
               ]
               $statement: #ApplyExpr[
                  #Self['self']
                  $recv: #NameExpr['attr_accessor']
                  $param: #List[
                     $expression: #NameExpr['gem_repo']
                  ]
               ]
               $statement: #ApplyExpr[
                  #Self['self']
                  $recv: #NameExpr['attr_accessor']
                  $param: #List[
                     $expression: #NameExpr['uri']
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['assert_activate']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['expected']
                     ]
                     $param: #VariadicParam[
                        $name: #NameExpr['specs']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['specs']
                           $recv: #NameExpr['each']
                           $body: #Block[
                              $param: #NameExpr['spec']
                              $body: #Case[
                                 $cond: #NameExpr['spec']
                                 $body: #List[
                                    $when: #When[
                                       $cond: #List[
                                          $expression: #NameExpr['String']
                                       ]
                                       $then: #ApplyExpr[
                                          $recv: #ApplyExpr[
                                             $recv: #Field[
                                                $recv: #NameExpr['Gem']
                                                $name: #NameExpr['Specification']
                                             ]
                                             $recv: #NameExpr['find_by_name']
                                             $param: #List[
                                                $expression: #NameExpr['spec']
                                             ]
                                          ]
                                          $recv: #NameExpr['activate']
                                       ]
                                    ]
                                    $when: #When[
                                       $cond: #List[
                                          $expression: #Field[
                                             $recv: #NameExpr['Gem']
                                             $name: #NameExpr['Specification']
                                          ]
                                       ]
                                       $then: #ApplyExpr[
                                          $recv: #NameExpr['spec']
                                          $recv: #NameExpr['activate']
                                       ]
                                    ]
                                 ]
                                 $else: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['flunk']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['spec']
                                          $recv: #NameExpr['inspect']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['loaded']
                           $right: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['loaded_specs']
                                 ]
                                 $recv: #NameExpr['values']
                              ]
                              $recv: #NameExpr['map']
                              $param: #List[
                                 $procedure: #Procedure[
                                    $base: #NameExpr['full_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #IfExpr[
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['expected']
                                    $recv: #NameExpr['sort']
                                 ]
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['loaded']
                                    $recv: #NameExpr['sort']
                                 ]
                              ]
                           ]
                           $cond: #NameExpr['expected']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['assert_path_exists']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['path']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['msg']
                        $default: #Nil['nil']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['msg']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['message']
                              $param: #List[
                                 $expression: #NameExpr['msg']
                              ]
                              $body: #Block[
                                 $body: #StringExpr[
                                    $inner: #NameExpr['path']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['exist?']
                                 $param: #List[
                                    $expression: #NameExpr['path']
                                 ]
                              ]
                              $expression: #NameExpr['msg']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['enable_shared']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['value']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['enable_shared']
                           $right: #Indexer[
                              $recv: #Field[
                                 $recv: #NameExpr['RbConfig']
                                 $name: #NameExpr['CONFIG']
                              ]
                              $index: #List[
                                 $expression: #StringExpr['ENABLE_SHARED']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #Field[
                                 $recv: #NameExpr['RbConfig']
                                 $name: #NameExpr['CONFIG']
                              ]
                              $index: #List[
                                 $expression: #StringExpr['ENABLE_SHARED']
                              ]
                           ]
                           $right: #NameExpr['value']
                        ]
                        $statement: #Yield['yield']
                     ]
                     $ensure: #IfExpr[
                        $cond: #NameExpr['enable_shared']
                        $then: #AssignExpr[
                           $left: #Indexer[
                              $base: #Field[
                                 $recv: #NameExpr['RbConfig']
                                 $name: #NameExpr['CONFIG']
                              ]
                              $index: #List[
                                 $expression: #StringExpr['enable_shared']
                              ]
                           ]
                           $right: #NameExpr['enable_shared']
                        ]
                        $else: #ApplyExpr[
                           $base: #Field[
                              $recv: #NameExpr['RbConfig']
                              $name: #NameExpr['CONFIG']
                           ]
                           $recv: #NameExpr['delete']
                           $param: #List[
                              $expression: #StringExpr['enable_shared']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['refute_path_exists']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['path']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['msg']
                        $default: #Nil['nil']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['msg']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['message']
                              $param: #List[
                                 $expression: #NameExpr['msg']
                              ]
                              $body: #Block[
                                 $body: #StringExpr[
                                    $inner: #NameExpr['path']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['exist?']
                                 $param: #List[
                                    $expression: #NameExpr['path']
                                 ]
                              ]
                              $expression: #NameExpr['msg']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['scan_make_command_lines']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['output']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        $recv: #NameExpr['output']
                        $recv: #NameExpr['scan']
                        $param: #List[
                           $expression: #Regex['/^#{Regexp.escape make_command}(?:[[:blank:]].*)?$/']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['parse_make_command_line']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['line']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #MultipleAssign[
                           $left: #MultipleLeftHandSideExpression[
                              $item: #NameExpr['command']
                              $item: #Variadic[
                                 $item: #NameExpr['args']
                              ]
                           ]
                           $right: #ApplyExpr[
                              $recv: #NameExpr['line']
                              $recv: #NameExpr['shellsplit']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['targets']
                           $right: #Array['[]']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['macros']
                           $right: #List['{}']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['args']
                           $recv: #NameExpr['each']
                           $body: #Block[
                              $param: #NameExpr['arg']
                              $body: #Case[
                                 $cond: #NameExpr['arg']
                                 $body: #List[
                                    $when: #When[
                                       $cond: #List[
                                          $expression: #Regex['/\\A(\\w+)=/']
                                       ]
                                       $then: #AssignExpr[
                                          $left: #Indexer[
                                             $base: #NameExpr['macros']
                                             $index: #List[
                                                $expression: #MatchedRegex['$1']
                                             ]
                                          ]
                                          $right: #BuiltInVariable['$\'']
                                       ]
                                    ]
                                 ]
                                 $else: #LShiftExpr[
                                    $left: #NameExpr['targets']
                                    $right: #NameExpr['arg']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #IfExpr[
                           $then: #LShiftExpr[
                              $left: #NameExpr['targets']
                              $right: #StringExpr['']
                           ]
                           $cond: #ApplyExpr[
                              $recv: #NameExpr['targets']
                              $recv: #NameExpr['empty?']
                           ]
                        ]
                        $statement: #List[
                           $hash: #Hash[
                              $key: #NameExpr['command']
                              $value: #NameExpr['command']
                           ]
                           $hash: #Hash[
                              $key: #NameExpr['targets']
                              $value: #NameExpr['targets']
                           ]
                           $hash: #Hash[
                              $key: #NameExpr['macros']
                              $value: #NameExpr['macros']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['assert_contains_make_command']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['target']
                     ]
                     $param: #Param[
                        $param: #NameExpr['output']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['msg']
                        $default: #Nil['nil']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $cond: #ApplyExpr[
                              $recv: #NameExpr['output']
                              $recv: #NameExpr['match']
                              $param: #List[
                                 $expression: #Regex['/\\n/']
                              ]
                           ]
                           $then: #AssignExpr[
                              $left: #NameExpr['msg']
                              $right: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['message']
                                 $param: #List[
                                    $expression: #NameExpr['msg']
                                 ]
                                 $body: #Block[
                                    $body: #ModExpr[
                                       $left: #StringExpr['Expected output containing make command "%s": %s']
                                       $right: #Array[
                                          $index: #List[
                                             $expression: #ApplyExpr[
                                                $recv: #ModExpr[
                                                   $left: #StringExpr['%s %s']
                                                   $right: #Array[
                                                      $index: #List[
                                                         $expression: #NameExpr['make_command']
                                                         $expression: #NameExpr['target']
                                                      ]
                                                   ]
                                                ]
                                                $recv: #NameExpr['rstrip']
                                             ]
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['output']
                                                $recv: #NameExpr['inspect']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $else: #AssignExpr[
                              $left: #NameExpr['msg']
                              $right: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['message']
                                 $param: #List[
                                    $expression: #NameExpr['msg']
                                 ]
                                 $body: #Block[
                                    $body: #ModExpr[
                                       $left: #StringExpr['Expected make command "%s": %s']
                                       $right: #Array[
                                          $index: #List[
                                             $expression: #ApplyExpr[
                                                $recv: #ModExpr[
                                                   $left: #StringExpr['%s %s']
                                                   $right: #Array[
                                                      $index: #List[
                                                         $expression: #NameExpr['make_command']
                                                         $expression: #NameExpr['target']
                                                      ]
                                                   ]
                                                ]
                                                $recv: #NameExpr['rstrip']
                                             ]
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['output']
                                                $recv: #NameExpr['inspect']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['scan_make_command_lines']
                                    $param: #List[
                                       $expression: #NameExpr['output']
                                    ]
                                 ]
                                 $recv: #NameExpr['any?']
                                 $body: #Block[
                                    $param: #NameExpr['line']
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['make']
                                          $right: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['parse_make_command_line']
                                             $param: #List[
                                                $expression: #NameExpr['line']
                                             ]
                                          ]
                                       ]
                                       $statement: #IfExpr[
                                          $cond: #ApplyExpr[
                                             $recv: #Indexer[
                                                $recv: #NameExpr['make']
                                                $index: #List[
                                                   $expression: #NameExpr['targets']
                                                ]
                                             ]
                                             $recv: #NameExpr['include?']
                                             $param: #List[
                                                $expression: #NameExpr['target']
                                             ]
                                          ]
                                          $then: #List[
                                             $statement: #IfExpr[
                                                $then: #Yield[
                                                   $param: #List[
                                                      $expression: #NameExpr['make']
                                                      $expression: #NameExpr['line']
                                                   ]
                                                ]
                                                $cond: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['block_given?']
                                                ]
                                             ]
                                             $statement: #TrueExpr['true']
                                          ]
                                          $else: #FalseExpr['false']
                                       ]
                                    ]
                                 ]
                              ]
                              $expression: #NameExpr['msg']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #ApplyExpr[
                  #Self['self']
                  $recv: #NameExpr['include']
                  $param: #List[
                     $expression: #Field[
                        $recv: #NameExpr['Gem']
                        $name: #NameExpr['DefaultUserInteraction']
                     ]
                  ]
               ]
               $statement: #IfExpr[
                  $then: #ApplyExpr[
                     #Self['self']
                     $recv: #NameExpr['undef_method']
                     $param: #List[
                        $expression: #NameExpr['default_test']
                     ]
                  ]
                  $cond: #OrExpr[
                     $left: #ApplyExpr[
                        $base: #NameExpr['instance_methods']
                        $recv: #NameExpr['include?']
                        $param: #List[
                           $expression: #StringExpr['default_test']
                        ]
                     ]
                     $right: #ApplyExpr[
                        $base: #NameExpr['instance_methods']
                        $recv: #NameExpr['include?']
                        $param: #List[
                           $expression: #NameExpr['default_test']
                        ]
                     ]
                  ]
               ]
               $statement: #Unless[
                  $then: #AssignExpr[
                     $left: #NameExpr['@@project_dir']
                     $right: #ApplyExpr[
                        $recv: #ApplyExpr[
                           $recv: #NameExpr['Dir']
                           $recv: #NameExpr['pwd']
                        ]
                        $recv: #NameExpr['untaint']
                     ]
                  ]
                  $cond: #Defined[
                     $base: #NameExpr['@@project_dir']
                  ]
               ]
               $statement: #AssignExpr[
                  $left: #NameExpr['@@initial_reset']
                  $right: #FalseExpr['false']
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['setup']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #Super['super']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@orig_gem_home']
                           $right: #Indexer[
                              $recv: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['GEM_HOME']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@orig_gem_path']
                           $right: #Indexer[
                              $recv: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['GEM_PATH']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@orig_gem_vendor']
                           $right: #Indexer[
                              $recv: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['GEM_VENDOR']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@orig_gem_spec_cache']
                           $right: #Indexer[
                              $recv: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['GEM_SPEC_CACHE']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@orig_rubygems_gemdeps']
                           $right: #Indexer[
                              $recv: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['RUBYGEMS_GEMDEPS']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@orig_rubygems_host']
                           $right: #Indexer[
                              $recv: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['RUBYGEMS_HOST']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #NameExpr['ENV']
                                 $recv: #NameExpr['keys']
                              ]
                              $recv: #NameExpr['find_all']
                              $body: #Block[
                                 $param: #NameExpr['k']
                                 $body: #ApplyExpr[
                                    $recv: #NameExpr['k']
                                    $recv: #NameExpr['start_with?']
                                    $param: #List[
                                       $expression: #StringExpr['GEM_REQUIREMENT_']
                                    ]
                                 ]
                              ]
                           ]
                           $recv: #NameExpr['each']
                           $body: #Block[
                              $param: #NameExpr['k']
                              $body: #ApplyExpr[
                                 $base: #NameExpr['ENV']
                                 $recv: #NameExpr['delete']
                                 $param: #List[
                                    $expression: #NameExpr['k']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@orig_gem_env_requirements']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['ENV']
                              $recv: #NameExpr['to_hash']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['GEM_VENDOR']
                              ]
                           ]
                           $right: #Nil['nil']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@current_dir']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['Dir']
                              $recv: #NameExpr['pwd']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #Nil['nil']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@ui']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['MockGemUi']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['tmpdir']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['expand_path']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['Dir']
                                    $recv: #NameExpr['tmpdir']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['tmpdir']
                           $recv: #NameExpr['untaint']
                        ]
                        $statement: #IfExpr[
                           $cond: #Indexer[
                              $recv: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['KEEP_FILES']
                              ]
                           ]
                           $then: #AssignExpr[
                              $left: #NameExpr['@tempdir']
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['tmpdir']
                                    $expression: #StringExpr[
                                       $inner: #BuiltInVariable['$$']
                                       $inner: #ApplyExpr[
                                          $recv: #ApplyExpr[
                                             $recv: #NameExpr['Time']
                                             $recv: #NameExpr['now']
                                          ]
                                          $recv: #NameExpr['to_i']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $else: #AssignExpr[
                              $left: #NameExpr['@tempdir']
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['tmpdir']
                                    $expression: #StringExpr[
                                       $inner: #BuiltInVariable['$$']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@tempdir']
                           $recv: #NameExpr['untaint']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir_p']
                           $param: #List[
                              $expression: #NameExpr['@tempdir']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['chdir']
                           $param: #List[
                              $expression: #NameExpr['@tempdir']
                           ]
                           $body: #Block[
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@tempdir']
                                    $right: #ApplyExpr[
                                       $base: #NameExpr['File']
                                       $recv: #NameExpr['expand_path']
                                       $param: #List[
                                          $expression: #StringExpr['.']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['@tempdir']
                                    $recv: #NameExpr['untaint']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #IfExpr[
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['win_platform?']
                           ]
                           $then: #List[
                              $statement: #AssignExpr[
                                 $left: #NameExpr['@tempdir']
                                 $right: #Indexer[
                                    $recv: #Indexer[
                                       $recv: #NameExpr['Dir']
                                       $index: #List[
                                          $expression: #NameExpr['@tempdir']
                                       ]
                                    ]
                                    $index: #List[
                                       $expression: #IntExpr['0']
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #NameExpr['@tempdir']
                                 $recv: #NameExpr['untaint']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@gemhome']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@tempdir']
                                 $expression: #StringExpr['gemhome']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@userhome']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@tempdir']
                                 $expression: #StringExpr['userhome']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['GEM_SPEC_CACHE']
                              ]
                           ]
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@tempdir']
                                 $expression: #StringExpr['spec_cache']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@orig_ruby']
                           $right: #IfExpr[
                              $cond: #Indexer[
                                 $recv: #NameExpr['ENV']
                                 $index: #List[
                                    $expression: #StringExpr['RUBY']
                                 ]
                              ]
                              $then: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ruby']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['Gem']
                                       $recv: #NameExpr['ruby']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['Gem']
                                       $name: #NameExpr['ruby']
                                    ]
                                    $right: #Indexer[
                                       $recv: #NameExpr['ENV']
                                       $index: #List[
                                          $expression: #StringExpr['RUBY']
                                       ]
                                    ]
                                 ]
                                 $statement: #NameExpr['ruby']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@git']
                           $right: #LOr[
                              $left: #Indexer[
                                 $recv: #NameExpr['ENV']
                                 $index: #List[
                                    $expression: #StringExpr['GIT']
                                 ]
                              ]
                              $right: #StringExpr['git']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Gem']
                           $recv: #NameExpr['ensure_gem_subdirectories']
                           $param: #List[
                              $expression: #NameExpr['@gemhome']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@orig_LOAD_PATH']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['$LOAD_PATH']
                              $recv: #NameExpr['dup']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['$LOAD_PATH']
                           $recv: #NameExpr['map!']
                           $body: #Block[
                              $param: #NameExpr['s']
                              $body: #Conditional[
                                 $cond: #EqExpr[
                                    $left: #AssignExpr[
                                       $left: #NameExpr['expand_path']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['File']
                                          $recv: #NameExpr['expand_path']
                                          $param: #List[
                                             $expression: #NameExpr['s']
                                          ]
                                       ]
                                    ]
                                    $right: #NameExpr['s']
                                 ]
                                 $then: #NameExpr['s']
                                 $else: #ApplyExpr[
                                    $recv: #NameExpr['expand_path']
                                    $recv: #NameExpr['untaint']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['chdir']
                           $param: #List[
                              $expression: #NameExpr['@tempdir']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@orig_ENV_HOME']
                           $right: #Indexer[
                              $recv: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['HOME']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['HOME']
                              ]
                           ]
                           $right: #NameExpr['@userhome']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Gem']
                           $recv: #NameExpr['instance_variable_set']
                           $param: #List[
                              $expression: #NameExpr['@user_home']
                              $expression: #Nil['nil']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Gem']
                           $recv: #NameExpr['instance_variable_set']
                           $param: #List[
                              $expression: #NameExpr['@gemdeps']
                              $expression: #Nil['nil']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Gem']
                           $recv: #NameExpr['instance_variable_set']
                           $param: #List[
                              $expression: #NameExpr['@env_requirements_by_name']
                              $expression: #Nil['nil']
                           ]
                        ]
                        $statement: #IfExpr[
                           $then: #ApplyExpr[
                              $base: #NameExpr['Gem']
                              $recv: #NameExpr['send']
                              $param: #List[
                                 $expression: #NameExpr['remove_instance_variable']
                                 $expression: #NameExpr['@ruby_version']
                              ]
                           ]
                           $cond: #ApplyExpr[
                              $base: #ApplyExpr[
                                 $recv: #NameExpr['Gem']
                                 $recv: #NameExpr['instance_variables']
                              ]
                              $recv: #NameExpr['include?']
                              $param: #List[
                                 $expression: #NameExpr['@ruby_version']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir_p']
                           $param: #List[
                              $expression: #NameExpr['@gemhome']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir_p']
                           $param: #List[
                              $expression: #NameExpr['@userhome']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@orig_gem_private_key_passphrase']
                           $right: #Indexer[
                              $recv: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['GEM_PRIVATE_KEY_PASSPHRASE']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['GEM_PRIVATE_KEY_PASSPHRASE']
                              ]
                           ]
                           $right: #NameExpr['PRIVATE_KEY_PASSPHRASE']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@default_dir']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@tempdir']
                                 $expression: #StringExpr['default']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@default_spec_dir']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@default_dir']
                                 $expression: #StringExpr['specifications']
                                 $expression: #StringExpr['default']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Gem']
                           $recv: #NameExpr['instance_variable_set']
                           $param: #List[
                              $expression: #NameExpr['@default_dir']
                              $expression: #NameExpr['@default_dir']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir_p']
                           $param: #List[
                              $expression: #NameExpr['@default_spec_dir']
                           ]
                        ]
                        $statement: #IfExpr[
                           $cond: #NameExpr['@@initial_reset']
                           $then: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #NameExpr['Gem']
                                    $name: #NameExpr['Specification']
                                 ]
                                 $recv: #NameExpr['unresolved_deps']
                              ]
                              $recv: #NameExpr['clear']
                           ]
                           $else: #List[
                              $statement: #AssignExpr[
                                 $left: #NameExpr['@@initial_reset']
                                 $right: #TrueExpr['true']
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #NameExpr['Gem']
                                    $name: #NameExpr['Specification']
                                 ]
                                 $recv: #NameExpr['reset']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['Gem']
                           $recv: #NameExpr['use_paths']
                           $param: #List[
                              $expression: #NameExpr['@gemhome']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #Field[
                              $recv: #NameExpr['Gem']
                              $name: #NameExpr['Security']
                           ]
                           $recv: #NameExpr['reset']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['loaded_specs']
                           ]
                           $recv: #NameExpr['clear']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['Gem']
                           $recv: #NameExpr['clear_default_specs']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Specification']
                              ]
                              $recv: #NameExpr['unresolved_deps']
                           ]
                           $recv: #NameExpr['clear']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #ApplyExpr[
                                 $recv: #NameExpr['Gem']
                                 $recv: #NameExpr['configuration']
                              ]
                              $name: #NameExpr['verbose']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #ApplyExpr[
                                 $recv: #NameExpr['Gem']
                                 $recv: #NameExpr['configuration']
                              ]
                              $name: #NameExpr['update_sources']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $name: #NameExpr['fetcher']
                           ]
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['FakeFetcher']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@gem_repo']
                           $right: #StringExpr['http://gems.example.com/']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@uri']
                           $right: #ApplyExpr[
                              $base: #NameExpr['URI']
                              $recv: #NameExpr['parse']
                              $param: #List[
                                 $expression: #NameExpr['@gem_repo']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['sources']
                           ]
                           $recv: #NameExpr['replace']
                           $param: #List[
                              $expression: #Array[
                                 $index: #List[
                                    $expression: #NameExpr['@gem_repo']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['Gem']
                              $name: #NameExpr['searcher']
                           ]
                           $right: #Nil['nil']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['SpecFetcher']
                              ]
                              $name: #NameExpr['fetcher']
                           ]
                           $right: #Nil['nil']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@orig_BASERUBY']
                           $right: #Indexer[
                              $recv: #Field[
                                 $recv: #NameExpr['RbConfig']
                                 $name: #NameExpr['CONFIG']
                              ]
                              $index: #List[
                                 $expression: #StringExpr['BASERUBY']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #Field[
                                 $recv: #NameExpr['RbConfig']
                                 $name: #NameExpr['CONFIG']
                              ]
                              $index: #List[
                                 $expression: #StringExpr['BASERUBY']
                              ]
                           ]
                           $right: #Indexer[
                              $recv: #Field[
                                 $recv: #NameExpr['RbConfig']
                                 $name: #NameExpr['CONFIG']
                              ]
                              $index: #List[
                                 $expression: #StringExpr['ruby_install_name']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@orig_arch']
                           $right: #Indexer[
                              $recv: #Field[
                                 $recv: #NameExpr['RbConfig']
                                 $name: #NameExpr['CONFIG']
                              ]
                              $index: #List[
                                 $expression: #StringExpr['arch']
                              ]
                           ]
                        ]
                        $statement: #IfExpr[
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['win_platform?']
                           ]
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_set_arch']
                              $param: #List[
                                 $expression: #StringExpr['i386-mswin32']
                              ]
                           ]
                           $else: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_set_arch']
                              $param: #List[
                                 $expression: #StringExpr['i686-darwin8.10.1']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@marshal_version']
                           $right: #StringExpr[
                              $inner: #Field[
                                 $recv: #NameExpr['Marshal']
                                 $name: #NameExpr['MAJOR_VERSION']
                              ]
                              $inner: #Field[
                                 $recv: #NameExpr['Marshal']
                                 $name: #NameExpr['MINOR_VERSION']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@orig_LOADED_FEATURES']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['$LOADED_FEATURES']
                              $recv: #NameExpr['dup']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['teardown']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $then: #ApplyExpr[
                              $base: #NameExpr['$LOAD_PATH']
                              $recv: #NameExpr['replace']
                              $param: #List[
                                 $expression: #NameExpr['@orig_LOAD_PATH']
                              ]
                           ]
                           $cond: #NameExpr['@orig_LOAD_PATH']
                        ]
                        $statement: #IfExpr[
                           $cond: #NameExpr['@orig_LOADED_FEATURES']
                           $then: #IfExpr[
                              $cond: #NameExpr['@orig_LOAD_PATH']
                              $then: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['paths']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['@orig_LOAD_PATH']
                                       $recv: #NameExpr['map']
                                       $body: #Block[
                                          $param: #NameExpr['path']
                                          $body: #ApplyExpr[
                                             $recv: #NameExpr['File']
                                             $recv: #NameExpr['join']
                                             $param: #List[
                                                $expression: #ApplyExpr[
                                                   $recv: #NameExpr['File']
                                                   $recv: #NameExpr['expand_path']
                                                   $param: #List[
                                                      $expression: #NameExpr['path']
                                                   ]
                                                ]
                                                $expression: #StringExpr['/']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #SubExpr[
                                       $left: #NameExpr['$LOADED_FEATURES']
                                       $right: #NameExpr['@orig_LOADED_FEATURES']
                                    ]
                                    $recv: #NameExpr['each']
                                    $body: #Block[
                                       $param: #NameExpr['feat']
                                       $body: #Unless[
                                          $cond: #ApplyExpr[
                                             $recv: #NameExpr['paths']
                                             $recv: #NameExpr['any?']
                                             $body: #Block[
                                                $param: #NameExpr['path']
                                                $body: #ApplyExpr[
                                                   $recv: #NameExpr['feat']
                                                   $recv: #NameExpr['start_with?']
                                                   $param: #List[
                                                      $expression: #NameExpr['path']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $then: #ApplyExpr[
                                             $recv: #NameExpr['$LOADED_FEATURES']
                                             $recv: #NameExpr['delete']
                                             $param: #List[
                                                $expression: #NameExpr['feat']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $else: #ApplyExpr[
                                 $base: #NameExpr['$LOADED_FEATURES']
                                 $recv: #NameExpr['replace']
                                 $param: #List[
                                    $expression: #NameExpr['@orig_LOADED_FEATURES']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #IfExpr[
                           $cond: #NameExpr['@orig_BASERUBY']
                           $then: #AssignExpr[
                              $left: #Indexer[
                                 $base: #Field[
                                    $recv: #NameExpr['RbConfig']
                                    $name: #NameExpr['CONFIG']
                                 ]
                                 $index: #List[
                                    $expression: #StringExpr['BASERUBY']
                                 ]
                              ]
                              $right: #NameExpr['@orig_BASERUBY']
                           ]
                           $else: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['RbConfig']
                                 $name: #NameExpr['CONFIG']
                              ]
                              $recv: #NameExpr['delete']
                              $param: #List[
                                 $expression: #StringExpr['BASERUBY']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #Field[
                                 $recv: #NameExpr['RbConfig']
                                 $name: #NameExpr['CONFIG']
                              ]
                              $index: #List[
                                 $expression: #StringExpr['arch']
                              ]
                           ]
                           $right: #NameExpr['@orig_arch']
                        ]
                        $statement: #IfExpr[
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['defined?']
                              $param: #List[
                                 $expression: #Field[
                                    $recv: #NameExpr['Gem']
                                    $name: #NameExpr['RemoteFetcher']
                                 ]
                              ]
                           ]
                           $then: #AssignExpr[
                              $left: #Field[
                                 $base: #Field[
                                    $recv: #NameExpr['Gem']
                                    $name: #NameExpr['RemoteFetcher']
                                 ]
                                 $name: #NameExpr['fetcher']
                              ]
                              $right: #Nil['nil']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['chdir']
                           $param: #List[
                              $expression: #NameExpr['@current_dir']
                           ]
                        ]
                        $statement: #Unless[
                           $then: #ApplyExpr[
                              $base: #NameExpr['FileUtils']
                              $recv: #NameExpr['rm_rf']
                              $param: #List[
                                 $expression: #NameExpr['@tempdir']
                              ]
                           ]
                           $cond: #Indexer[
                              $recv: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['KEEP_FILES']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['ENV']
                           $recv: #NameExpr['clear']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@orig_gem_env_requirements']
                           $recv: #NameExpr['each']
                           $body: #Block[
                              $param: #MultipleLeftHandSideExpression[
                                 $item: #NameExpr['k']
                                 $item: #NameExpr['v']
                              ]
                              $body: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #NameExpr['ENV']
                                    $index: #List[
                                       $expression: #NameExpr['k']
                                    ]
                                 ]
                                 $right: #NameExpr['v']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['GEM_HOME']
                              ]
                           ]
                           $right: #NameExpr['@orig_gem_home']
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['GEM_PATH']
                              ]
                           ]
                           $right: #NameExpr['@orig_gem_path']
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['GEM_VENDOR']
                              ]
                           ]
                           $right: #NameExpr['@orig_gem_vendor']
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['GEM_SPEC_CACHE']
                              ]
                           ]
                           $right: #NameExpr['@orig_gem_spec_cache']
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['RUBYGEMS_GEMDEPS']
                              ]
                           ]
                           $right: #NameExpr['@orig_rubygems_gemdeps']
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['RUBYGEMS_HOST']
                              ]
                           ]
                           $right: #NameExpr['@orig_rubygems_host']
                        ]
                        $statement: #IfExpr[
                           $then: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['Gem']
                                 $name: #NameExpr['ruby']
                              ]
                              $right: #NameExpr['@orig_ruby']
                           ]
                           $cond: #NameExpr['@orig_ruby']
                        ]
                        $statement: #IfExpr[
                           $cond: #NameExpr['@orig_ENV_HOME']
                           $then: #AssignExpr[
                              $left: #Indexer[
                                 $base: #NameExpr['ENV']
                                 $index: #List[
                                    $expression: #StringExpr['HOME']
                                 ]
                              ]
                              $right: #NameExpr['@orig_ENV_HOME']
                           ]
                           $else: #ApplyExpr[
                              $base: #NameExpr['ENV']
                              $recv: #NameExpr['delete']
                              $param: #List[
                                 $expression: #StringExpr['HOME']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Gem']
                           $recv: #NameExpr['instance_variable_set']
                           $param: #List[
                              $expression: #NameExpr['@default_dir']
                              $expression: #Nil['nil']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['GEM_PRIVATE_KEY_PASSPHRASE']
                              ]
                           ]
                           $right: #NameExpr['@orig_gem_private_key_passphrase']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #Field[
                              $recv: #NameExpr['Gem']
                              $name: #NameExpr['Specification']
                           ]
                           $recv: #NameExpr['_clear_load_cache']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Specification']
                              ]
                              $recv: #NameExpr['unresolved_deps']
                           ]
                           $recv: #NameExpr['clear']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['common_installer_setup']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #NameExpr['common_installer_teardown']
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['Gem']
                           $recv: #NameExpr['post_build']
                           $body: #Block[
                              $param: #NameExpr['installer']
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@post_build_hook_arg']
                                    $right: #NameExpr['installer']
                                 ]
                                 $statement: #TrueExpr['true']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['Gem']
                           $recv: #NameExpr['post_install']
                           $body: #Block[
                              $param: #NameExpr['installer']
                              $body: #AssignExpr[
                                 $left: #NameExpr['@post_install_hook_arg']
                                 $right: #NameExpr['installer']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['Gem']
                           $recv: #NameExpr['post_uninstall']
                           $body: #Block[
                              $param: #NameExpr['uninstaller']
                              $body: #AssignExpr[
                                 $left: #NameExpr['@post_uninstall_hook_arg']
                                 $right: #NameExpr['uninstaller']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['Gem']
                           $recv: #NameExpr['pre_install']
                           $body: #Block[
                              $param: #NameExpr['installer']
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@pre_install_hook_arg']
                                    $right: #NameExpr['installer']
                                 ]
                                 $statement: #TrueExpr['true']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['Gem']
                           $recv: #NameExpr['pre_uninstall']
                           $body: #Block[
                              $param: #NameExpr['uninstaller']
                              $body: #AssignExpr[
                                 $left: #NameExpr['@pre_uninstall_hook_arg']
                                 $right: #NameExpr['uninstaller']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['common_installer_teardown']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['post_build_hooks']
                           ]
                           $recv: #NameExpr['clear']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['post_install_hooks']
                           ]
                           $recv: #NameExpr['clear']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['done_installing_hooks']
                           ]
                           $recv: #NameExpr['clear']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['post_reset_hooks']
                           ]
                           $recv: #NameExpr['clear']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['post_uninstall_hooks']
                           ]
                           $recv: #NameExpr['clear']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['pre_install_hooks']
                           ]
                           $recv: #NameExpr['clear']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['pre_reset_hooks']
                           ]
                           $recv: #NameExpr['clear']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['pre_uninstall_hooks']
                           ]
                           $recv: #NameExpr['clear']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['git_gem']
                  $param: #List[
                     $param: #OptionalParam[
                        $name: #NameExpr['name']
                        $default: #StringExpr['a']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['version']
                        $default: #IntExpr['1']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['have_git?']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['directory']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #StringExpr['git']
                                 $expression: #NameExpr['name']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['directory']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['expand_path']
                              $param: #List[
                                 $expression: #NameExpr['directory']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['git_spec']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Specification']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #NameExpr['name']
                                 $expression: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['version']
                                    $body: #Block[
                                       $param: #NameExpr['specification']
                                       $body: #IfExpr[
                                          $then: #Yield[
                                             $param: #List[
                                                $expression: #NameExpr['specification']
                                             ]
                                          ]
                                          $cond: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['block_given?']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir_p']
                           $param: #List[
                              $expression: #NameExpr['directory']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gemspec']
                           $right: #StringExpr[
                              $inner: #NameExpr['name']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['open']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['directory']
                                    $expression: #NameExpr['gemspec']
                                 ]
                              ]
                              $expression: #StringExpr['w']
                           ]
                           $body: #Block[
                              $param: #NameExpr['io']
                              $body: #ApplyExpr[
                                 $base: #NameExpr['io']
                                 $recv: #NameExpr['write']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['git_spec']
                                       $recv: #NameExpr['to_ruby']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['head']
                           $right: #Nil['nil']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['chdir']
                           $param: #List[
                              $expression: #NameExpr['directory']
                           ]
                           $body: #Block[
                              $body: #List[
                                 $statement: #Unless[
                                    $cond: #ApplyExpr[
                                       $base: #NameExpr['File']
                                       $recv: #NameExpr['exist?']
                                       $param: #List[
                                          $expression: #StringExpr['.git']
                                       ]
                                    ]
                                    $then: #List[
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['system']
                                          $param: #List[
                                             $expression: #NameExpr['@git']
                                             $expression: #StringExpr['init']
                                             $expression: #StringExpr['--quiet']
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['system']
                                          $param: #List[
                                             $expression: #NameExpr['@git']
                                             $expression: #StringExpr['config']
                                             $expression: #StringExpr['user.name']
                                             $expression: #StringExpr['RubyGems Tests']
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['system']
                                          $param: #List[
                                             $expression: #NameExpr['@git']
                                             $expression: #StringExpr['config']
                                             $expression: #StringExpr['user.email']
                                             $expression: #StringExpr['rubygems@example']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['system']
                                    $param: #List[
                                       $expression: #NameExpr['@git']
                                       $expression: #StringExpr['add']
                                       $expression: #NameExpr['gemspec']
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['system']
                                    $param: #List[
                                       $expression: #NameExpr['@git']
                                       $expression: #StringExpr['commit']
                                       $expression: #StringExpr['-a']
                                       $expression: #StringExpr['-m']
                                       $expression: #StringExpr['a non-empty commit message']
                                       $expression: #StringExpr['--quiet']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['head']
                                    $right: #ApplyExpr[
                                       $recv: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #NameExpr['Gem']
                                             $name: #NameExpr['Util']
                                          ]
                                          $recv: #NameExpr['popen']
                                          $param: #List[
                                             $expression: #StringExpr['git']
                                             $expression: #StringExpr['rev-parse']
                                             $expression: #StringExpr['master']
                                          ]
                                       ]
                                       $recv: #NameExpr['strip']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #RReturnStmt[
                           $expr: #List[
                              $expression: #NameExpr['name']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['git_spec']
                                 $recv: #NameExpr['version']
                              ]
                              $expression: #NameExpr['directory']
                              $expression: #NameExpr['head']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['have_git?']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $then: #RReturnStmt['return']
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['in_path?']
                              $param: #List[
                                 $expression: #NameExpr['@git']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['skip']
                           $param: #List[
                              $expression: #StringExpr['cannot find git executable, use GIT environment variable to set']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['in_path?']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['executable']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $then: #RReturnStmt[
                              $expr: #List[
                                 $expression: #TrueExpr['true']
                              ]
                           ]
                           $cond: #AndExpr[
                              $left: #Match[
                                 $left: #Regex['%r%\\A([A-Z]:|/)%']
                                 $right: #NameExpr['executable']
                              ]
                              $right: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['exist?']
                                 $param: #List[
                                    $expression: #NameExpr['executable']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #Indexer[
                                 $recv: #NameExpr['ENV']
                                 $index: #List[
                                    $expression: #StringExpr['PATH']
                                 ]
                              ]
                              $recv: #NameExpr['split']
                              $param: #List[
                                 $expression: #Field[
                                    $recv: #NameExpr['File']
                                    $name: #NameExpr['PATH_SEPARATOR']
                                 ]
                              ]
                           ]
                           $recv: #NameExpr['any?']
                           $body: #Block[
                              $param: #NameExpr['directory']
                              $body: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['exist?']
                                 $param: #List[
                                    $command: #ApplyExpr[
                                       $base: #NameExpr['File']
                                       $recv: #NameExpr['join']
                                       $param: #List[
                                          $expression: #NameExpr['directory']
                                          $expression: #NameExpr['executable']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['install_gem']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['spec']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['options']
                        $default: #List['{}']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['require']
                           $param: #List[
                              $expression: #StringExpr['rubygems/installer']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gem']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@tempdir']
                                 $expression: #StringExpr['gems']
                                 $expression: #StringExpr[
                                    $inner: #ApplyExpr[
                                       $recv: #NameExpr['spec']
                                       $recv: #NameExpr['full_name']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #Unless[
                           $cond: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['exist?']
                              $param: #List[
                                 $expression: #NameExpr['gem']
                              ]
                           ]
                           $then: #List[
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['use_ui']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['MockGemUi']
                                       ]
                                       $recv: #NameExpr['new']
                                       $body: #Block[
                                          $body: #ApplyExpr[
                                             $base: #NameExpr['Dir']
                                             $recv: #NameExpr['chdir']
                                             $param: #List[
                                                $expression: #NameExpr['@tempdir']
                                             ]
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   $base: #Field[
                                                      $recv: #NameExpr['Gem']
                                                      $name: #NameExpr['Package']
                                                   ]
                                                   $recv: #NameExpr['build']
                                                   $param: #List[
                                                      $expression: #NameExpr['spec']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['gem']
                                 $right: #ApplyExpr[
                                    $recv: #ApplyExpr[
                                       $recv: #NameExpr['File']
                                       $recv: #NameExpr['join']
                                       $param: #List[
                                          $expression: #NameExpr['@tempdir']
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['File']
                                             $recv: #NameExpr['basename']
                                             $param: #List[
                                                $expression: #ApplyExpr[
                                                   $recv: #NameExpr['spec']
                                                   $recv: #NameExpr['cache_file']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                    $recv: #NameExpr['untaint']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $recv: #NameExpr['at']
                              $param: #List[
                                 $expression: #NameExpr['gem']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['options']
                                    $recv: #NameExpr['merge']
                                    $param: #List[
                                       $expression: #List[
                                          $hash: #Hash[
                                             $key: #NameExpr['wrappers']
                                             $value: #TrueExpr['true']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $recv: #NameExpr['install']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['install_gem_user']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['spec']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['install_gem']
                        $param: #List[
                           $expression: #NameExpr['spec']
                           $hash: #Hash[
                              $key: #NameExpr['user_install']
                              $value: #TrueExpr['true']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['uninstall_gem']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['spec']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['require']
                           $param: #List[
                              $expression: #StringExpr['rubygems/uninstaller']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #NameExpr['Class']
                                 $recv: #NameExpr['new']
                                 $param: #List[
                                    $expression: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['Uninstaller']
                                    ]
                                 ]
                                 $body: #Block[
                                    $body: #FuncDecl[
                                       $name: #NameExpr['ask_if_ok']
                                       $param: #List[
                                          $param: #Param[
                                             $param: #NameExpr['spec']
                                          ]
                                       ]
                                       $body: #BlockExpr[
                                          $main: #TrueExpr['true']
                                       ]
                                    ]
                                 ]
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['spec']
                                    $recv: #NameExpr['name']
                                 ]
                                 $hash: #Hash[
                                    $key: #NameExpr['executables']
                                    $value: #TrueExpr['true']
                                 ]
                                 $hash: #Hash[
                                    $key: #NameExpr['user_install']
                                    $value: #TrueExpr['true']
                                 ]
                              ]
                           ]
                           $recv: #NameExpr['uninstall']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['create_tmpdir']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['tmpdir']
                           $right: #Nil['nil']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['chdir']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['Dir']
                                 $recv: #NameExpr['tmpdir']
                                 $body: #Block[
                                    $body: #AssignExpr[
                                       $left: #NameExpr['tmpdir']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['Dir']
                                          $recv: #NameExpr['pwd']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['tmpdir']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['tmpdir']
                                 $expression: #StringExpr[
                                    $inner: #BuiltInVariable['$$']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir_p']
                           $param: #List[
                              $expression: #NameExpr['tmpdir']
                           ]
                        ]
                        $statement: #RReturnStmt[
                           $expr: #List[
                              $expression: #NameExpr['tmpdir']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['mu_pp']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['obj']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['s']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['String']
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['s']
                           $right: #ApplyExpr[
                              $base: #NameExpr['PP']
                              $recv: #NameExpr['pp']
                              $param: #List[
                                 $expression: #NameExpr['obj']
                                 $expression: #NameExpr['s']
                              ]
                           ]
                        ]
                        $statement: #IfExpr[
                           $then: #AssignExpr[
                              $left: #NameExpr['s']
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['s']
                                 $recv: #NameExpr['force_encoding']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['Encoding']
                                       $recv: #NameExpr['default_external']
                                    ]
                                 ]
                              ]
                           ]
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['defined?']
                              $param: #List[
                                 $expression: #NameExpr['Encoding']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['s']
                           $recv: #NameExpr['chomp']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['read_cache']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['path']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['open']
                        $param: #List[
                           $expression: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #NameExpr['path']
                                 $recv: #NameExpr['dup']
                              ]
                              $recv: #NameExpr['untaint']
                           ]
                           $expression: #StringExpr['rb']
                        ]
                        $body: #Block[
                           $param: #NameExpr['io']
                           $body: #ApplyExpr[
                              $base: #NameExpr['Marshal']
                              $recv: #NameExpr['load']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['io']
                                    $recv: #NameExpr['read']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['read_binary']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['path']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        $base: #NameExpr['Gem']
                        $recv: #NameExpr['read_binary']
                        $param: #List[
                           $expression: #NameExpr['path']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['write_file']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['path']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #Unless[
                           $then: #AssignExpr[
                              $left: #NameExpr['path']
                              $right: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@gemhome']
                                    $expression: #NameExpr['path']
                                 ]
                              ]
                           ]
                           $cond: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #NameExpr['Pathname']
                                 $recv: #NameExpr['new']
                                 $param: #List[
                                    $expression: #NameExpr['path']
                                 ]
                              ]
                              $recv: #NameExpr['absolute?']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['dir']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['dirname']
                              $param: #List[
                                 $expression: #NameExpr['path']
                              ]
                           ]
                        ]
                        $statement: #Unless[
                           $then: #ApplyExpr[
                              $base: #NameExpr['FileUtils']
                              $recv: #NameExpr['mkdir_p']
                              $param: #List[
                                 $expression: #NameExpr['dir']
                              ]
                           ]
                           $cond: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['directory?']
                              $param: #List[
                                 $expression: #NameExpr['dir']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['open']
                           $param: #List[
                              $expression: #NameExpr['path']
                              $expression: #StringExpr['wb']
                           ]
                           $body: #Block[
                              $param: #NameExpr['io']
                              $body: #IfExpr[
                                 $then: #Yield[
                                    $param: #List[
                                       $expression: #NameExpr['io']
                                    ]
                                 ]
                                 $cond: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['block_given?']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #NameExpr['path']
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['all_spec_names']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        $recv: #Field[
                           $recv: #NameExpr['Gem']
                           $name: #NameExpr['Specification']
                        ]
                        $recv: #NameExpr['map']
                        $param: #List[
                           $procedure: #Procedure[
                              $base: #NameExpr['full_name']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['quick_gem']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['name']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['version']
                        $default: #StringExpr['2']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['require']
                           $param: #List[
                              $expression: #StringExpr['rubygems/specification']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Specification']
                              ]
                              $recv: #NameExpr['new']
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['platform']
                                       ]
                                       $right: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['Gem']
                                             $name: #NameExpr['Platform']
                                          ]
                                          $name: #NameExpr['RUBY']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['name']
                                       ]
                                       $right: #NameExpr['name']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['version']
                                       ]
                                       $right: #NameExpr['version']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['author']
                                       ]
                                       $right: #StringExpr['A User']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['email']
                                       ]
                                       $right: #StringExpr['example@example.com']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['homepage']
                                       ]
                                       $right: #StringExpr['http://example.com']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['summary']
                                       ]
                                       $right: #StringExpr['this is a summary']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['description']
                                       ]
                                       $right: #StringExpr['This is a test description']
                                    ]
                                    $statement: #IfExpr[
                                       $then: #Yield[
                                          $param: #List[
                                             $expression: #NameExpr['s']
                                          ]
                                       ]
                                       $cond: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['block_given?']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #Field[
                              $recv: #NameExpr['Gem']
                              $name: #NameExpr['Specification']
                           ]
                           $recv: #NameExpr['map']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['written_path']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['write_file']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['spec']
                                    $recv: #NameExpr['spec_file']
                                    $body: #Block[
                                       $param: #NameExpr['io']
                                       $body: #ApplyExpr[
                                          $base: #NameExpr['io']
                                          $recv: #NameExpr['write']
                                          $param: #List[
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['spec']
                                                $recv: #NameExpr['to_ruby_for_cache']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['spec']
                              $name: #NameExpr['loaded_from']
                           ]
                           $right: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['spec']
                                 $name: #NameExpr['loaded_from']
                              ]
                              $right: #NameExpr['written_path']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #Field[
                              $recv: #NameExpr['Gem']
                              $name: #NameExpr['Specification']
                           ]
                           $recv: #NameExpr['reset']
                        ]
                        $statement: #RReturnStmt[
                           $expr: #List[
                              $expression: #NameExpr['spec']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['quick_spec']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['name']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['version']
                        $default: #StringExpr['2']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['util_spec']
                        $param: #List[
                           $expression: #NameExpr['name']
                           $expression: #NameExpr['version']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['util_build_gem']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['spec']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['dir']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['spec']
                              $recv: #NameExpr['gem_dir']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir_p']
                           $param: #List[
                              $expression: #NameExpr['dir']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['chdir']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['dir']
                                 $body: #Block[
                                    $body: #List[
                                       $statement: #ApplyExpr[
                                          $recv: #ApplyExpr[
                                             $recv: #NameExpr['spec']
                                             $recv: #NameExpr['files']
                                          ]
                                          $recv: #NameExpr['each']
                                          $body: #Block[
                                             $param: #NameExpr['file']
                                             $body: #List[
                                                $statement: #IfExpr[
                                                   $then: #Next['next']
                                                   $cond: #ApplyExpr[
                                                      $base: #NameExpr['File']
                                                      $recv: #NameExpr['exist?']
                                                      $param: #List[
                                                         $expression: #NameExpr['file']
                                                      ]
                                                   ]
                                                ]
                                                $statement: #ApplyExpr[
                                                   $base: #NameExpr['FileUtils']
                                                   $recv: #NameExpr['mkdir_p']
                                                   $param: #List[
                                                      $expression: #ApplyExpr[
                                                         $recv: #NameExpr['File']
                                                         $recv: #NameExpr['dirname']
                                                         $param: #List[
                                                            $expression: #NameExpr['file']
                                                         ]
                                                      ]
                                                   ]
                                                ]
                                                $statement: #ApplyExpr[
                                                   $base: #NameExpr['File']
                                                   $recv: #NameExpr['open']
                                                   $param: #List[
                                                      $expression: #NameExpr['file']
                                                      $expression: #StringExpr['w']
                                                   ]
                                                   $body: #Block[
                                                      $param: #NameExpr['fp']
                                                      $body: #ApplyExpr[
                                                         $base: #NameExpr['fp']
                                                         $recv: #NameExpr['puts']
                                                         $param: #List[
                                                            $expression: #StringExpr[
                                                               $inner: #NameExpr['file']
                                                            ]
                                                         ]
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['use_ui']
                                          $param: #List[
                                             $expression: #ApplyExpr[
                                                $recv: #Field[
                                                   $recv: #NameExpr['Gem']
                                                   $name: #NameExpr['MockGemUi']
                                                ]
                                                $recv: #NameExpr['new']
                                                $body: #Block[
                                                   $body: #ApplyExpr[
                                                      $base: #Field[
                                                         $recv: #NameExpr['Gem']
                                                         $name: #NameExpr['Package']
                                                      ]
                                                      $recv: #NameExpr['build']
                                                      $param: #List[
                                                         $expression: #NameExpr['spec']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['cache']
                                          $right: #ApplyExpr[
                                             $recv: #NameExpr['spec']
                                             $recv: #NameExpr['cache_file']
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          $base: #NameExpr['FileUtils']
                                          $recv: #NameExpr['mv']
                                          $param: #List[
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['File']
                                                $recv: #NameExpr['basename']
                                                $param: #List[
                                                   $expression: #NameExpr['cache']
                                                ]
                                             ]
                                             $expression: #NameExpr['cache']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['util_remove_gem']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['spec']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['rm_rf']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['spec']
                                 $recv: #NameExpr['cache_file']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['rm_rf']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['spec']
                                 $recv: #NameExpr['spec_file']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['util_clear_gems']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['rm_rf']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@gemhome']
                                    $expression: #StringExpr['gems']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@gemhome']
                                    $expression: #StringExpr['gems']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['rm_rf']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@gemhome']
                                    $expression: #StringExpr['specifications']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@gemhome']
                                    $expression: #StringExpr['specifications']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #Field[
                              $recv: #NameExpr['Gem']
                              $name: #NameExpr['Specification']
                           ]
                           $recv: #NameExpr['reset']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['install_specs']
                  $param: #List[
                     $param: #VariadicParam[
                        $name: #NameExpr['specs']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['specs']
                           $recv: #NameExpr['each']
                           $body: #Block[
                              $param: #NameExpr['spec']
                              $body: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['Installer']
                                    ]
                                    $recv: #NameExpr['for_spec']
                                    $param: #List[
                                       $expression: #NameExpr['spec']
                                    ]
                                 ]
                                 $recv: #NameExpr['install']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['Gem']
                              $name: #NameExpr['searcher']
                           ]
                           $right: #Nil['nil']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['install_default_gems']
                  $param: #List[
                     $param: #VariadicParam[
                        $name: #NameExpr['specs']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['install_default_specs']
                           $param: #List[
                              $variadic: #Variadic[
                                 $base: #NameExpr['specs']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['specs']
                           $recv: #NameExpr['each']
                           $body: #Block[
                              $param: #NameExpr['spec']
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['open']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['spec']
                                       $recv: #NameExpr['loaded_from']
                                    ]
                                    $expression: #StringExpr['w']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['io']
                                    $body: #ApplyExpr[
                                       $base: #NameExpr['io']
                                       $recv: #NameExpr['write']
                                       $param: #List[
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['spec']
                                             $recv: #NameExpr['to_ruby_for_cache']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['install_default_specs']
                  $param: #List[
                     $param: #VariadicParam[
                        $name: #NameExpr['specs']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        $recv: #NameExpr['specs']
                        $recv: #NameExpr['each']
                        $body: #Block[
                           $param: #NameExpr['spec']
                           $body: #List[
                              $statement: #AssignExpr[
                                 $left: #NameExpr['installer']
                                 $right: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['Installer']
                                    ]
                                    $recv: #NameExpr['for_spec']
                                    $param: #List[
                                       $expression: #NameExpr['spec']
                                       $hash: #Hash[
                                          $key: #NameExpr['install_as_default']
                                          $value: #TrueExpr['true']
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #NameExpr['installer']
                                 $recv: #NameExpr['install']
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #NameExpr['Gem']
                                 $recv: #NameExpr['register_default_spec']
                                 $param: #List[
                                    $expression: #NameExpr['spec']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['loaded_spec_names']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        $recv: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #NameExpr['Gem']
                                 $recv: #NameExpr['loaded_specs']
                              ]
                              $recv: #NameExpr['values']
                           ]
                           $recv: #NameExpr['map']
                           $param: #List[
                              $procedure: #Procedure[
                                 $base: #NameExpr['full_name']
                              ]
                           ]
                        ]
                        $recv: #NameExpr['sort']
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['unresolved_names']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        $recv: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #NameExpr['Gem']
                                    $name: #NameExpr['Specification']
                                 ]
                                 $recv: #NameExpr['unresolved_deps']
                              ]
                              $recv: #NameExpr['values']
                           ]
                           $recv: #NameExpr['map']
                           $param: #List[
                              $procedure: #Procedure[
                                 $base: #NameExpr['to_s']
                              ]
                           ]
                        ]
                        $recv: #NameExpr['sort']
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['save_loaded_features']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['old_loaded_features']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['$LOADED_FEATURES']
                              $recv: #NameExpr['dup']
                           ]
                        ]
                        $statement: #Yield['yield']
                     ]
                     $ensure: #ApplyExpr[
                        $base: #NameExpr['$LOADED_FEATURES']
                        $recv: #NameExpr['replace']
                        $param: #List[
                           $expression: #NameExpr['old_loaded_features']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['new_spec']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['name']
                     ]
                     $param: #Param[
                        $param: #NameExpr['version']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['deps']
                        $default: #Nil['nil']
                     ]
                     $param: #VariadicParam[
                        $name: #NameExpr['files']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['require']
                           $param: #List[
                              $expression: #StringExpr['rubygems/specification']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Specification']
                              ]
                              $recv: #NameExpr['new']
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['platform']
                                       ]
                                       $right: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['Gem']
                                             $name: #NameExpr['Platform']
                                          ]
                                          $name: #NameExpr['RUBY']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['name']
                                       ]
                                       $right: #NameExpr['name']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['version']
                                       ]
                                       $right: #NameExpr['version']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['author']
                                       ]
                                       $right: #StringExpr['A User']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['email']
                                       ]
                                       $right: #StringExpr['example@example.com']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['homepage']
                                       ]
                                       $right: #StringExpr['http://example.com']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['summary']
                                       ]
                                       $right: #StringExpr['this is a summary']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['description']
                                       ]
                                       $right: #StringExpr['This is a test description']
                                    ]
                                    $statement: #ApplyExpr[
                                       $recv: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['Array']
                                          $param: #List[
                                             $expression: #NameExpr['deps']
                                          ]
                                       ]
                                       $recv: #NameExpr['each']
                                       $body: #Block[
                                          $param: #MultipleLeftHandSideExpression[
                                             $item: #NameExpr['n']
                                             $item: #NameExpr['req']
                                          ]
                                          $body: #ApplyExpr[
                                             $base: #NameExpr['s']
                                             $recv: #NameExpr['add_dependency']
                                             $param: #List[
                                                $expression: #NameExpr['n']
                                                $expression: #LOr[
                                                   $left: #NameExpr['req']
                                                   $right: #StringExpr['>= 0']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                    $statement: #Unless[
                                       $then: #ApplyExpr[
                                          $recv: #ApplyExpr[
                                             $recv: #NameExpr['s']
                                             $recv: #NameExpr['files']
                                          ]
                                          $recv: #NameExpr['push']
                                          $param: #List[
                                             $variadic: #Variadic[
                                                $base: #NameExpr['files']
                                             ]
                                          ]
                                       ]
                                       $cond: #ApplyExpr[
                                          $recv: #NameExpr['files']
                                          $recv: #NameExpr['empty?']
                                       ]
                                    ]
                                    $statement: #IfExpr[
                                       $then: #Yield[
                                          $param: #List[
                                             $expression: #NameExpr['s']
                                          ]
                                       ]
                                       $cond: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['block_given?']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['spec']
                              $name: #NameExpr['loaded_from']
                           ]
                           $right: #ApplyExpr[
                              $recv: #NameExpr['spec']
                              $recv: #NameExpr['spec_file']
                           ]
                        ]
                        $statement: #Unless[
                           $cond: #ApplyExpr[
                              $recv: #NameExpr['files']
                              $recv: #NameExpr['empty?']
                           ]
                           $then: #List[
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['write_file']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['spec']
                                       $recv: #NameExpr['spec_file']
                                       $body: #Block[
                                          $param: #NameExpr['io']
                                          $body: #ApplyExpr[
                                             $base: #NameExpr['io']
                                             $recv: #NameExpr['write']
                                             $param: #List[
                                                $expression: #ApplyExpr[
                                                   $recv: #NameExpr['spec']
                                                   $recv: #NameExpr['to_ruby_for_cache']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['util_build_gem']
                                 $param: #List[
                                    $expression: #NameExpr['spec']
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['cache_file']
                                 $right: #ApplyExpr[
                                    $base: #NameExpr['File']
                                    $recv: #NameExpr['join']
                                    $param: #List[
                                       $expression: #NameExpr['@tempdir']
                                       $expression: #StringExpr['gems']
                                       $expression: #StringExpr[
                                          $inner: #ApplyExpr[
                                             $recv: #NameExpr['spec']
                                             $recv: #NameExpr['full_name']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['FileUtils']
                                 $recv: #NameExpr['mkdir_p']
                                 $param: #List[
                                    $command: #ApplyExpr[
                                       $base: #NameExpr['File']
                                       $recv: #NameExpr['dirname']
                                       $param: #List[
                                          $expression: #NameExpr['cache_file']
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['FileUtils']
                                 $recv: #NameExpr['mv']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['spec']
                                       $recv: #NameExpr['cache_file']
                                    ]
                                    $expression: #NameExpr['cache_file']
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['FileUtils']
                                 $recv: #NameExpr['rm']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['spec']
                                       $recv: #NameExpr['spec_file']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #NameExpr['spec']
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['new_default_spec']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['name']
                     ]
                     $param: #Param[
                        $param: #NameExpr['version']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['deps']
                        $default: #Nil['nil']
                     ]
                     $param: #VariadicParam[
                        $name: #NameExpr['files']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_spec']
                              $param: #List[
                                 $expression: #NameExpr['name']
                                 $expression: #NameExpr['version']
                                 $expression: #NameExpr['deps']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['spec']
                              $name: #NameExpr['loaded_from']
                           ]
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@default_spec_dir']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['spec']
                                    $recv: #NameExpr['spec_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['spec']
                              $name: #NameExpr['files']
                           ]
                           $right: #NameExpr['files']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['lib_dir']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@tempdir']
                                 $expression: #StringExpr['default_gems']
                                 $expression: #StringExpr['lib']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['$LOAD_PATH']
                           $recv: #NameExpr['unshift']
                           $param: #List[
                              $expression: #NameExpr['lib_dir']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['files']
                           $recv: #NameExpr['each']
                           $body: #Block[
                              $param: #NameExpr['file']
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['rb_path']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['File']
                                       $recv: #NameExpr['join']
                                       $param: #List[
                                          $expression: #NameExpr['lib_dir']
                                          $expression: #NameExpr['file']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['FileUtils']
                                    $recv: #NameExpr['mkdir_p']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['File']
                                          $recv: #NameExpr['dirname']
                                          $param: #List[
                                             $expression: #NameExpr['rb_path']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['File']
                                    $recv: #NameExpr['open']
                                    $param: #List[
                                       $expression: #NameExpr['rb_path']
                                       $expression: #StringExpr['w']
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['rb']
                                       $body: #LShiftExpr[
                                          $left: #NameExpr['rb']
                                          $right: #StringExpr[
                                             $inner: #NameExpr['file']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #NameExpr['spec']
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['util_spec']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['name']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['version']
                        $default: #IntExpr['2']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['deps']
                        $default: #Nil['nil']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['raise']
                              $param: #List[
                                 $expression: #StringExpr['deps or block, not both']
                              ]
                           ]
                           $cond: #AndExpr[
                              $left: #NameExpr['deps']
                              $right: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['block_given?']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Specification']
                              ]
                              $recv: #NameExpr['new']
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['platform']
                                       ]
                                       $right: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['Gem']
                                             $name: #NameExpr['Platform']
                                          ]
                                          $name: #NameExpr['RUBY']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['name']
                                       ]
                                       $right: #NameExpr['name']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['version']
                                       ]
                                       $right: #NameExpr['version']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['author']
                                       ]
                                       $right: #StringExpr['A User']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['email']
                                       ]
                                       $right: #StringExpr['example@example.com']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['homepage']
                                       ]
                                       $right: #StringExpr['http://example.com']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['summary']
                                       ]
                                       $right: #StringExpr['this is a summary']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['description']
                                       ]
                                       $right: #StringExpr['This is a test description']
                                    ]
                                    $statement: #IfExpr[
                                       $then: #Yield[
                                          $param: #List[
                                             $expression: #NameExpr['s']
                                          ]
                                       ]
                                       $cond: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['block_given?']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #IfExpr[
                           $cond: #NameExpr['deps']
                           $then: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['deps']
                                    $recv: #NameExpr['keys']
                                 ]
                                 $recv: #NameExpr['sort']
                              ]
                              $recv: #NameExpr['each']
                              $body: #Block[
                                 $param: #NameExpr['n']
                                 $body: #ApplyExpr[
                                    $base: #NameExpr['spec']
                                    $recv: #NameExpr['add_dependency']
                                    $param: #List[
                                       $expression: #NameExpr['n']
                                       $expression: #LOr[
                                          $left: #Indexer[
                                             $recv: #NameExpr['deps']
                                             $index: #List[
                                                $expression: #NameExpr['n']
                                             ]
                                          ]
                                          $right: #StringExpr['>= 0']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #Field[
                              $recv: #NameExpr['Gem']
                              $name: #NameExpr['Specification']
                           ]
                           $recv: #NameExpr['reset']
                        ]
                        $statement: #RReturnStmt[
                           $expr: #List[
                              $expression: #NameExpr['spec']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['util_gem']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['name']
                     ]
                     $param: #Param[
                        $param: #NameExpr['version']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['deps']
                        $default: #Nil['nil']
                     ]
                     $param: #ProcedureParam[
                        $name: #NameExpr['block']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['raise']
                              $param: #List[
                                 $expression: #StringExpr['deps or block, not both']
                              ]
                           ]
                           $cond: #AndExpr[
                              $left: #NameExpr['deps']
                              $right: #NameExpr['block']
                           ]
                        ]
                        $statement: #IfExpr[
                           $cond: #NameExpr['deps']
                           $then: #AssignExpr[
                              $left: #NameExpr['block']
                              $right: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['proc']
                                 $body: #Block[
                                    $param: #NameExpr['s']
                                    $body: #ApplyExpr[
                                       $recv: #ApplyExpr[
                                          $recv: #ApplyExpr[
                                             $recv: #NameExpr['deps']
                                             $recv: #NameExpr['keys']
                                          ]
                                          $recv: #NameExpr['sort']
                                       ]
                                       $recv: #NameExpr['each']
                                       $body: #Block[
                                          $param: #NameExpr['n']
                                          $body: #ApplyExpr[
                                             $base: #NameExpr['s']
                                             $recv: #NameExpr['add_dependency']
                                             $param: #List[
                                                $expression: #NameExpr['n']
                                                $expression: #LOr[
                                                   $left: #Indexer[
                                                      $recv: #NameExpr['deps']
                                                      $index: #List[
                                                         $expression: #NameExpr['n']
                                                      ]
                                                   ]
                                                   $right: #StringExpr['>= 0']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['quick_gem']
                              $param: #List[
                                 $expression: #NameExpr['name']
                                 $expression: #NameExpr['version']
                                 $procedure: #Procedure[
                                    $base: #NameExpr['block']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_build_gem']
                           $param: #List[
                              $expression: #NameExpr['spec']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['cache_file']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@tempdir']
                                 $expression: #StringExpr['gems']
                                 $expression: #StringExpr[
                                    $inner: #ApplyExpr[
                                       $recv: #NameExpr['spec']
                                       $recv: #NameExpr['original_name']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir_p']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['dirname']
                                 $param: #List[
                                    $expression: #NameExpr['cache_file']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mv']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['spec']
                                 $recv: #NameExpr['cache_file']
                              ]
                              $expression: #NameExpr['cache_file']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['rm']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['spec']
                                 $recv: #NameExpr['spec_file']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['spec']
                              $name: #NameExpr['loaded_from']
                           ]
                           $right: #Nil['nil']
                        ]
                        $statement: #Array[
                           $index: #List[
                              $expression: #NameExpr['spec']
                              $expression: #NameExpr['cache_file']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['util_gzip']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['data']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['out']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['StringIO']
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #Field[
                              $recv: #NameExpr['Zlib']
                              $name: #NameExpr['GzipWriter']
                           ]
                           $recv: #NameExpr['wrap']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['out']
                                 $body: #Block[
                                    $param: #NameExpr['io']
                                    $body: #ApplyExpr[
                                       $base: #NameExpr['io']
                                       $recv: #NameExpr['write']
                                       $param: #List[
                                          $expression: #NameExpr['data']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['out']
                           $recv: #NameExpr['string']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['util_make_gems']
                  $param: #List[
                     $param: #OptionalParam[
                        $name: #NameExpr['prerelease']
                        $default: #FalseExpr['false']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['@a1']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['quick_gem']
                              $param: #List[
                                 $expression: #StringExpr['a']
                                 $expression: #StringExpr['1']
                              ]
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['files']
                                       ]
                                       $right: #ParcentNotation['%w[lib/code.rb]']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['require_paths']
                                       ]
                                       $right: #ParcentNotation['%w[lib]']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['date']
                                       ]
                                       $right: #SubExpr[
                                          $left: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['Gem']
                                                $name: #NameExpr['Specification']
                                             ]
                                             $name: #NameExpr['TODAY']
                                          ]
                                          $right: #IntExpr['86400']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['homepage']
                                       ]
                                       $right: #StringExpr['http://a.example.com']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['email']
                                       ]
                                       $right: #ParcentNotation['%w[example@example.com example2@example.com]']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['authors']
                                       ]
                                       $right: #ParcentNotation['%w[Example Example2]']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['description']
                                       ]
                                       $right: #HereDocument['This line is really, really long.  So long, in fact, that it is more than eighty characters long!  The purpose of this line is for testing wrapping behavior because sometimes people don\'t wrap their text to eighty characters.  Without the wrapping, the text might not look good in the RSS feed.\n\nAlso, a list:\n  * An entry that\\\'s actually kind of sort\n  * an entry that\\\'s really long, which will probably get wrapped funny.  That\'s ok, somebody wasn\'t thinking straight when they made it more than eighty characters.\n']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['init']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['proc']
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['files']
                                       ]
                                       $right: #ParcentNotation['%w[lib/code.rb]']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['require_paths']
                                       ]
                                       $right: #ParcentNotation['%w[lib]']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@a2']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['quick_gem']
                              $param: #List[
                                 $expression: #StringExpr['a']
                                 $expression: #StringExpr['2']
                                 $procedure: #Procedure[
                                    $base: #NameExpr['init']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@a3a']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['quick_gem']
                              $param: #List[
                                 $expression: #StringExpr['a']
                                 $expression: #StringExpr['3.a']
                                 $procedure: #Procedure[
                                    $base: #NameExpr['init']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@a_evil9']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['quick_gem']
                              $param: #List[
                                 $expression: #StringExpr['a_evil']
                                 $expression: #StringExpr['9']
                                 $procedure: #Procedure[
                                    $base: #NameExpr['init']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@b2']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['quick_gem']
                              $param: #List[
                                 $expression: #StringExpr['b']
                                 $expression: #StringExpr['2']
                                 $procedure: #Procedure[
                                    $base: #NameExpr['init']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@c1_2']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['quick_gem']
                              $param: #List[
                                 $expression: #StringExpr['c']
                                 $expression: #StringExpr['1.2']
                                 $procedure: #Procedure[
                                    $base: #NameExpr['init']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@x']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['quick_gem']
                              $param: #List[
                                 $expression: #StringExpr['x']
                                 $expression: #StringExpr['1']
                                 $procedure: #Procedure[
                                    $base: #NameExpr['init']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@dep_x']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['quick_gem']
                              $param: #List[
                                 $expression: #StringExpr['dep_x']
                                 $expression: #StringExpr['1']
                              ]
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['files']
                                       ]
                                       $right: #ParcentNotation['%w[lib/code.rb]']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['require_paths']
                                       ]
                                       $right: #ParcentNotation['%w[lib]']
                                    ]
                                    $statement: #ApplyExpr[
                                       $base: #NameExpr['s']
                                       $recv: #NameExpr['add_dependency']
                                       $param: #List[
                                          $expression: #StringExpr['x']
                                          $expression: #StringExpr['>= 1']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@pl1']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['quick_gem']
                              $param: #List[
                                 $expression: #StringExpr['pl']
                                 $expression: #StringExpr['1']
                              ]
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['files']
                                       ]
                                       $right: #ParcentNotation['%w[lib/code.rb]']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['require_paths']
                                       ]
                                       $right: #ParcentNotation['%w[lib]']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['platform']
                                       ]
                                       $right: #ApplyExpr[
                                          $base: #Field[
                                             $recv: #NameExpr['Gem']
                                             $name: #NameExpr['Platform']
                                          ]
                                          $recv: #NameExpr['new']
                                          $param: #List[
                                             $expression: #StringExpr['i386-linux']
                                          ]
                                       ]
                                    ]
                                    $statement: #ApplyExpr[
                                       $base: #NameExpr['s']
                                       $recv: #NameExpr['instance_variable_set']
                                       $param: #List[
                                          $expression: #NameExpr['@original_platform']
                                          $expression: #StringExpr['i386-linux']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #IfExpr[
                           $cond: #NameExpr['prerelease']
                           $then: #List[
                              $statement: #AssignExpr[
                                 $left: #NameExpr['@a2_pre']
                                 $right: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['quick_gem']
                                    $param: #List[
                                       $expression: #StringExpr['a']
                                       $expression: #StringExpr['2.a']
                                       $procedure: #Procedure[
                                          $base: #NameExpr['init']
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['write_file']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['File']
                                       $recv: #NameExpr['join']
                                       $param: #List[
                                          $variadic: #Variadic[
                                             $base: #ParcentNotation['%W[gems #{@a2_pre.original_name} lib code.rb]']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['util_build_gem']
                                 $param: #List[
                                    $expression: #NameExpr['@a2_pre']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['write_file']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $variadic: #Variadic[
                                       $base: #ParcentNotation['%W[gems #{@a1.original_name}      lib code.rb]']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['write_file']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $variadic: #Variadic[
                                       $base: #ParcentNotation['%W[gems #{@a2.original_name}      lib code.rb]']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['write_file']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $variadic: #Variadic[
                                       $base: #ParcentNotation['%W[gems #{@a3a.original_name}     lib code.rb]']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['write_file']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $variadic: #Variadic[
                                       $base: #ParcentNotation['%W[gems #{@a_evil9.original_name} lib code.rb]']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['write_file']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $variadic: #Variadic[
                                       $base: #ParcentNotation['%W[gems #{@b2.original_name}      lib code.rb]']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['write_file']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $variadic: #Variadic[
                                       $base: #ParcentNotation['%W[gems #{@c1_2.original_name}    lib code.rb]']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['write_file']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $variadic: #Variadic[
                                       $base: #ParcentNotation['%W[gems #{@pl1.original_name}     lib code.rb]']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['write_file']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $variadic: #Variadic[
                                       $base: #ParcentNotation['%W[gems #{@x.original_name}       lib code.rb]']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['write_file']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $variadic: #Variadic[
                                       $base: #ParcentNotation['%W[gems #{@dep_x.original_name}   lib code.rb]']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #Array[
                              $index: #List[
                                 $expression: #NameExpr['@a1']
                                 $expression: #NameExpr['@a2']
                                 $expression: #NameExpr['@a3a']
                                 $expression: #NameExpr['@a_evil9']
                                 $expression: #NameExpr['@b2']
                                 $expression: #NameExpr['@c1_2']
                                 $expression: #NameExpr['@pl1']
                                 $expression: #NameExpr['@x']
                                 $expression: #NameExpr['@dep_x']
                              ]
                           ]
                           $recv: #NameExpr['each']
                           $body: #Block[
                              $param: #NameExpr['spec']
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['util_build_gem']
                                 $param: #List[
                                    $expression: #NameExpr['spec']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['rm_r']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@gemhome']
                                    $expression: #StringExpr['gems']
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@pl1']
                                       $recv: #NameExpr['original_name']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['util_set_arch']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['arch']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #Field[
                                 $recv: #NameExpr['RbConfig']
                                 $name: #NameExpr['CONFIG']
                              ]
                              $index: #List[
                                 $expression: #StringExpr['arch']
                              ]
                           ]
                           $right: #NameExpr['arch']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['platform']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Platform']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #NameExpr['arch']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Gem']
                           $recv: #NameExpr['instance_variable_set']
                           $param: #List[
                              $expression: #NameExpr['@platforms']
                              $expression: #Nil['nil']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #Field[
                              $recv: #NameExpr['Gem']
                              $name: #NameExpr['Platform']
                           ]
                           $recv: #NameExpr['instance_variable_set']
                           $param: #List[
                              $expression: #NameExpr['@local']
                              $expression: #Nil['nil']
                           ]
                        ]
                        $statement: #NameExpr['platform']
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['util_setup_fake_fetcher']
                  $param: #List[
                     $param: #OptionalParam[
                        $name: #NameExpr['prerelease']
                        $default: #FalseExpr['false']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['require']
                           $param: #List[
                              $expression: #StringExpr['zlib']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['require']
                           $param: #List[
                              $expression: #StringExpr['socket']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['require']
                           $param: #List[
                              $expression: #StringExpr['rubygems/remote_fetcher']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['FakeFetcher']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_make_gems']
                           $param: #List[
                              $expression: #NameExpr['prerelease']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #Field[
                              $recv: #NameExpr['Gem']
                              $name: #NameExpr['Specification']
                           ]
                           $recv: #NameExpr['reset']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@all_gems']
                           $right: #ApplyExpr[
                              $recv: #Array[
                                 $index: #List[
                                    $expression: #NameExpr['@a1']
                                    $expression: #NameExpr['@a2']
                                    $expression: #NameExpr['@a3a']
                                    $expression: #NameExpr['@a_evil9']
                                    $expression: #NameExpr['@b2']
                                    $expression: #NameExpr['@c1_2']
                                 ]
                              ]
                              $recv: #NameExpr['sort']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@all_gem_names']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['@all_gems']
                              $recv: #NameExpr['map']
                              $body: #Block[
                                 $param: #NameExpr['gem']
                                 $body: #ApplyExpr[
                                    $recv: #NameExpr['gem']
                                    $recv: #NameExpr['full_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gem_names']
                           $right: #Array[
                              $index: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@a1']
                                    $recv: #NameExpr['full_name']
                                 ]
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@a2']
                                    $recv: #NameExpr['full_name']
                                 ]
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@a3a']
                                    $recv: #NameExpr['full_name']
                                 ]
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@b2']
                                    $recv: #NameExpr['full_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@gem_names']
                           $right: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #NameExpr['gem_names']
                                 $recv: #NameExpr['sort']
                              ]
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #StringExpr['\\n']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $name: #NameExpr['fetcher']
                           ]
                           $right: #NameExpr['@fetcher']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['add_to_fetcher']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['spec']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['path']
                        $default: #Nil['nil']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['repo']
                        $default: #NameExpr['@gem_repo']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #LOrAssign[
                           $left: #NameExpr['path']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['spec']
                              $recv: #NameExpr['cache_file']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #ApplyExpr[
                                 $recv: #NameExpr['@fetcher']
                                 $recv: #NameExpr['data']
                              ]
                              $index: #List[
                                 $expression: #StringExpr[
                                    $inner: #NameExpr['@gem_repo']
                                    $inner: #ApplyExpr[
                                       $recv: #NameExpr['spec']
                                       $recv: #NameExpr['file_name']
                                    ]
                                 ]
                              ]
                           ]
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['read_binary']
                              $param: #List[
                                 $expression: #NameExpr['path']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['util_setup_spec_fetcher']
                  $param: #List[
                     $param: #VariadicParam[
                        $name: #NameExpr['specs']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['all_specs']
                           $right: #AddExpr[
                              $left: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #NameExpr['Gem']
                                    $name: #NameExpr['Specification']
                                 ]
                                 $recv: #NameExpr['to_a']
                              ]
                              $right: #NameExpr['specs']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #Field[
                              $recv: #NameExpr['Gem']
                              $name: #NameExpr['Specification']
                           ]
                           $recv: #NameExpr['_resort!']
                           $param: #List[
                              $expression: #NameExpr['all_specs']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec_fetcher']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['SpecFetcher']
                              ]
                              $recv: #NameExpr['fetcher']
                           ]
                        ]
                        $statement: #MultipleAssign[
                           $left: #MultipleLeftHandSideExpression[
                              $item: #NameExpr['prerelease']
                              $item: #NameExpr['all']
                           ]
                           $right: #ApplyExpr[
                              $recv: #NameExpr['all_specs']
                              $recv: #NameExpr['partition']
                              $body: #Block[
                                 $param: #NameExpr['spec']
                                 $body: #ApplyExpr[
                                    $recv: #ApplyExpr[
                                       $recv: #NameExpr['spec']
                                       $recv: #NameExpr['version']
                                    ]
                                    $recv: #NameExpr['prerelease?']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['latest']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Specification']
                              ]
                              $recv: #NameExpr['_latest_specs']
                              $param: #List[
                                 $expression: #NameExpr['all_specs']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #ApplyExpr[
                                 $recv: #NameExpr['spec_fetcher']
                                 $recv: #NameExpr['specs']
                              ]
                              $index: #List[
                                 $expression: #NameExpr['@uri']
                              ]
                           ]
                           $right: #Array['[]']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['all']
                           $recv: #NameExpr['each']
                           $body: #Block[
                              $param: #NameExpr['spec']
                              $body: #LShiftExpr[
                                 $left: #Indexer[
                                    $recv: #ApplyExpr[
                                       $recv: #NameExpr['spec_fetcher']
                                       $recv: #NameExpr['specs']
                                    ]
                                    $index: #List[
                                       $expression: #NameExpr['@uri']
                                    ]
                                 ]
                                 $right: #ApplyExpr[
                                    $recv: #NameExpr['spec']
                                    $recv: #NameExpr['name_tuple']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #ApplyExpr[
                                 $recv: #NameExpr['spec_fetcher']
                                 $recv: #NameExpr['latest_specs']
                              ]
                              $index: #List[
                                 $expression: #NameExpr['@uri']
                              ]
                           ]
                           $right: #Array['[]']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['latest']
                           $recv: #NameExpr['each']
                           $body: #Block[
                              $param: #NameExpr['spec']
                              $body: #LShiftExpr[
                                 $left: #Indexer[
                                    $recv: #ApplyExpr[
                                       $recv: #NameExpr['spec_fetcher']
                                       $recv: #NameExpr['latest_specs']
                                    ]
                                    $index: #List[
                                       $expression: #NameExpr['@uri']
                                    ]
                                 ]
                                 $right: #ApplyExpr[
                                    $recv: #NameExpr['spec']
                                    $recv: #NameExpr['name_tuple']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #ApplyExpr[
                                 $recv: #NameExpr['spec_fetcher']
                                 $recv: #NameExpr['prerelease_specs']
                              ]
                              $index: #List[
                                 $expression: #NameExpr['@uri']
                              ]
                           ]
                           $right: #Array['[]']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['prerelease']
                           $recv: #NameExpr['each']
                           $body: #Block[
                              $param: #NameExpr['spec']
                              $body: #LShiftExpr[
                                 $left: #Indexer[
                                    $recv: #ApplyExpr[
                                       $recv: #NameExpr['spec_fetcher']
                                       $recv: #NameExpr['prerelease_specs']
                                    ]
                                    $index: #List[
                                       $expression: #NameExpr['@uri']
                                    ]
                                 ]
                                 $right: #ApplyExpr[
                                    $recv: #NameExpr['spec']
                                    $recv: #NameExpr['name_tuple']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #Unless[
                           $cond: #StrictEquals[
                              $left: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $right: #NameExpr['@fetcher']
                           ]
                           $then: #List[
                              $statement: #AssignExpr[
                                 $left: #NameExpr['v']
                                 $right: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['marshal_version']
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['specs']
                                 $right: #ApplyExpr[
                                    $recv: #NameExpr['all']
                                    $recv: #NameExpr['map']
                                    $body: #Block[
                                       $param: #NameExpr['spec']
                                       $body: #ApplyExpr[
                                          $recv: #NameExpr['spec']
                                          $recv: #NameExpr['name_tuple']
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['s_zip']
                                 $right: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['util_gzip']
                                    $param: #List[
                                       $command: #ApplyExpr[
                                          $base: #NameExpr['Marshal']
                                          $recv: #NameExpr['dump']
                                          $param: #List[
                                             $command: #ApplyExpr[
                                                $base: #Field[
                                                   $recv: #NameExpr['Gem']
                                                   $name: #NameExpr['NameTuple']
                                                ]
                                                $recv: #NameExpr['to_basic']
                                                $param: #List[
                                                   $expression: #NameExpr['specs']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['latest_specs']
                                 $right: #ApplyExpr[
                                    $recv: #NameExpr['latest']
                                    $recv: #NameExpr['map']
                                    $body: #Block[
                                       $param: #NameExpr['spec']
                                       $body: #ApplyExpr[
                                          $recv: #NameExpr['spec']
                                          $recv: #NameExpr['name_tuple']
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['l_zip']
                                 $right: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['util_gzip']
                                    $param: #List[
                                       $command: #ApplyExpr[
                                          $base: #NameExpr['Marshal']
                                          $recv: #NameExpr['dump']
                                          $param: #List[
                                             $command: #ApplyExpr[
                                                $base: #Field[
                                                   $recv: #NameExpr['Gem']
                                                   $name: #NameExpr['NameTuple']
                                                ]
                                                $recv: #NameExpr['to_basic']
                                                $param: #List[
                                                   $expression: #NameExpr['latest_specs']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['prerelease_specs']
                                 $right: #ApplyExpr[
                                    $recv: #NameExpr['prerelease']
                                    $recv: #NameExpr['map']
                                    $body: #Block[
                                       $param: #NameExpr['spec']
                                       $body: #ApplyExpr[
                                          $recv: #NameExpr['spec']
                                          $recv: #NameExpr['name_tuple']
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['p_zip']
                                 $right: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['util_gzip']
                                    $param: #List[
                                       $command: #ApplyExpr[
                                          $base: #NameExpr['Marshal']
                                          $recv: #NameExpr['dump']
                                          $param: #List[
                                             $command: #ApplyExpr[
                                                $base: #Field[
                                                   $recv: #NameExpr['Gem']
                                                   $name: #NameExpr['NameTuple']
                                                ]
                                                $recv: #NameExpr['to_basic']
                                                $param: #List[
                                                   $expression: #NameExpr['prerelease_specs']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #ApplyExpr[
                                       $recv: #NameExpr['@fetcher']
                                       $recv: #NameExpr['data']
                                    ]
                                    $index: #List[
                                       $expression: #StringExpr[
                                          $inner: #NameExpr['@gem_repo']
                                          $inner: #NameExpr['v']
                                       ]
                                    ]
                                 ]
                                 $right: #NameExpr['s_zip']
                              ]
                              $statement: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #ApplyExpr[
                                       $recv: #NameExpr['@fetcher']
                                       $recv: #NameExpr['data']
                                    ]
                                    $index: #List[
                                       $expression: #StringExpr[
                                          $inner: #NameExpr['@gem_repo']
                                          $inner: #NameExpr['v']
                                       ]
                                    ]
                                 ]
                                 $right: #NameExpr['l_zip']
                              ]
                              $statement: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #ApplyExpr[
                                       $recv: #NameExpr['@fetcher']
                                       $recv: #NameExpr['data']
                                    ]
                                    $index: #List[
                                       $expression: #StringExpr[
                                          $inner: #NameExpr['@gem_repo']
                                          $inner: #NameExpr['v']
                                       ]
                                    ]
                                 ]
                                 $right: #NameExpr['p_zip']
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['v']
                                 $right: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['marshal_version']
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #NameExpr['all_specs']
                                 $recv: #NameExpr['each']
                                 $body: #Block[
                                    $param: #NameExpr['spec']
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['path']
                                          $right: #StringExpr[
                                             $inner: #NameExpr['@gem_repo']
                                             $inner: #NameExpr['v']
                                             $inner: #ApplyExpr[
                                                $recv: #NameExpr['spec']
                                                $recv: #NameExpr['original_name']
                                             ]
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['data']
                                          $right: #ApplyExpr[
                                             $base: #NameExpr['Marshal']
                                             $recv: #NameExpr['dump']
                                             $param: #List[
                                                $expression: #NameExpr['spec']
                                             ]
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['data_deflate']
                                          $right: #ApplyExpr[
                                             $base: #Field[
                                                $recv: #NameExpr['Zlib']
                                                $name: #NameExpr['Deflate']
                                             ]
                                             $recv: #NameExpr['deflate']
                                             $param: #List[
                                                $expression: #NameExpr['data']
                                             ]
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Indexer[
                                             $base: #ApplyExpr[
                                                $recv: #NameExpr['@fetcher']
                                                $recv: #NameExpr['data']
                                             ]
                                             $index: #List[
                                                $expression: #NameExpr['path']
                                             ]
                                          ]
                                          $right: #NameExpr['data_deflate']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #Nil['nil']
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['util_zip']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['data']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        $base: #Field[
                           $recv: #NameExpr['Zlib']
                           $name: #NameExpr['Deflate']
                        ]
                        $recv: #NameExpr['deflate']
                        $param: #List[
                           $expression: #NameExpr['data']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['util_set_RUBY_VERSION']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['version']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['patchlevel']
                        $default: #Nil['nil']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['revision']
                        $default: #Nil['nil']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $cond: #OrExpr[
                              $left: #ApplyExpr[
                                 $base: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['instance_variables']
                                 ]
                                 $recv: #NameExpr['include?']
                                 $param: #List[
                                    $expression: #NameExpr['@ruby_version']
                                 ]
                              ]
                              $right: #ApplyExpr[
                                 $base: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['instance_variables']
                                 ]
                                 $recv: #NameExpr['include?']
                                 $param: #List[
                                    $expression: #StringExpr['@ruby_version']
                                 ]
                              ]
                           ]
                           $then: #ApplyExpr[
                              $base: #NameExpr['Gem']
                              $recv: #NameExpr['send']
                              $param: #List[
                                 $expression: #NameExpr['remove_instance_variable']
                                 $expression: #NameExpr['@ruby_version']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@RUBY_VERSION']
                           $right: #NameExpr['RUBY_VERSION']
                        ]
                        $statement: #IfExpr[
                           $then: #AssignExpr[
                              $left: #NameExpr['@RUBY_PATCHLEVEL']
                              $right: #NameExpr['RUBY_PATCHLEVEL']
                           ]
                           $cond: #Defined[
                              $base: #NameExpr['RUBY_PATCHLEVEL']
                           ]
                        ]
                        $statement: #IfExpr[
                           $then: #AssignExpr[
                              $left: #NameExpr['@RUBY_REVISION']
                              $right: #NameExpr['RUBY_REVISION']
                           ]
                           $cond: #Defined[
                              $base: #NameExpr['RUBY_REVISION']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Object']
                           $recv: #NameExpr['send']
                           $param: #List[
                              $expression: #NameExpr['remove_const']
                              $expression: #NameExpr['RUBY_VERSION']
                           ]
                        ]
                        $statement: #IfExpr[
                           $then: #ApplyExpr[
                              $base: #NameExpr['Object']
                              $recv: #NameExpr['send']
                              $param: #List[
                                 $expression: #NameExpr['remove_const']
                                 $expression: #NameExpr['RUBY_PATCHLEVEL']
                              ]
                           ]
                           $cond: #Defined[
                              $base: #NameExpr['RUBY_PATCHLEVEL']
                           ]
                        ]
                        $statement: #IfExpr[
                           $then: #ApplyExpr[
                              $base: #NameExpr['Object']
                              $recv: #NameExpr['send']
                              $param: #List[
                                 $expression: #NameExpr['remove_const']
                                 $expression: #NameExpr['RUBY_REVISION']
                              ]
                           ]
                           $cond: #Defined[
                              $base: #NameExpr['RUBY_REVISION']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Object']
                           $recv: #NameExpr['const_set']
                           $param: #List[
                              $expression: #NameExpr['RUBY_VERSION']
                              $expression: #NameExpr['version']
                           ]
                        ]
                        $statement: #IfExpr[
                           $then: #ApplyExpr[
                              $base: #NameExpr['Object']
                              $recv: #NameExpr['const_set']
                              $param: #List[
                                 $expression: #NameExpr['RUBY_PATCHLEVEL']
                                 $expression: #NameExpr['patchlevel']
                              ]
                           ]
                           $cond: #NameExpr['patchlevel']
                        ]
                        $statement: #IfExpr[
                           $then: #ApplyExpr[
                              $base: #NameExpr['Object']
                              $recv: #NameExpr['const_set']
                              $param: #List[
                                 $expression: #NameExpr['RUBY_REVISION']
                                 $expression: #NameExpr['revision']
                              ]
                           ]
                           $cond: #NameExpr['revision']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['util_restore_RUBY_VERSION']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Object']
                           $recv: #NameExpr['send']
                           $param: #List[
                              $expression: #NameExpr['remove_const']
                              $expression: #NameExpr['RUBY_VERSION']
                           ]
                        ]
                        $statement: #IfExpr[
                           $then: #ApplyExpr[
                              $base: #NameExpr['Object']
                              $recv: #NameExpr['send']
                              $param: #List[
                                 $expression: #NameExpr['remove_const']
                                 $expression: #NameExpr['RUBY_PATCHLEVEL']
                              ]
                           ]
                           $cond: #Defined[
                              $base: #NameExpr['RUBY_PATCHLEVEL']
                           ]
                        ]
                        $statement: #IfExpr[
                           $then: #ApplyExpr[
                              $base: #NameExpr['Object']
                              $recv: #NameExpr['send']
                              $param: #List[
                                 $expression: #NameExpr['remove_const']
                                 $expression: #NameExpr['RUBY_REVISION']
                              ]
                           ]
                           $cond: #Defined[
                              $base: #NameExpr['RUBY_REVISION']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Object']
                           $recv: #NameExpr['const_set']
                           $param: #List[
                              $expression: #NameExpr['RUBY_VERSION']
                              $expression: #NameExpr['@RUBY_VERSION']
                           ]
                        ]
                        $statement: #IfExpr[
                           $then: #ApplyExpr[
                              $base: #NameExpr['Object']
                              $recv: #NameExpr['const_set']
                              $param: #List[
                                 $expression: #NameExpr['RUBY_PATCHLEVEL']
                                 $expression: #NameExpr['@RUBY_PATCHLEVEL']
                              ]
                           ]
                           $cond: #Defined[
                              $base: #NameExpr['@RUBY_PATCHLEVEL']
                           ]
                        ]
                        $statement: #IfExpr[
                           $then: #ApplyExpr[
                              $base: #NameExpr['Object']
                              $recv: #NameExpr['const_set']
                              $param: #List[
                                 $expression: #NameExpr['RUBY_REVISION']
                                 $expression: #NameExpr['@RUBY_REVISION']
                              ]
                           ]
                           $cond: #Defined[
                              $base: #NameExpr['@RUBY_REVISION']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #SFuncDecl[
                  $path: #Self['self']
                  $name: #NameExpr['win_platform?']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        $recv: #NameExpr['Gem']
                        $recv: #NameExpr['win_platform?']
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['win_platform?']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        $recv: #NameExpr['Gem']
                        $recv: #NameExpr['win_platform?']
                     ]
                  ]
               ]
               $statement: #SFuncDecl[
                  $path: #Self['self']
                  $name: #NameExpr['vc_windows?']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        $recv: #NameExpr['RUBY_PLATFORM']
                        $recv: #NameExpr['match']
                        $param: #List[
                           $expression: #StringExpr['mswin']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['vc_windows?']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        $recv: #NameExpr['RUBY_PLATFORM']
                        $recv: #NameExpr['match']
                        $param: #List[
                           $expression: #StringExpr['mswin']
                        ]
                     ]
                  ]
               ]
               $statement: #SFuncDecl[
                  $path: #Self['self']
                  $name: #NameExpr['make_command']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #LOr[
                        $left: #LOr[
                           $left: #Indexer[
                              $recv: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['make']
                              ]
                           ]
                           $right: #Indexer[
                              $recv: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['MAKE']
                              ]
                           ]
                        ]
                        $right: #Conditional[
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['vc_windows?']
                           ]
                           $then: #StringExpr['nmake']
                           $else: #StringExpr['make']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['make_command']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #LOr[
                        $left: #LOr[
                           $left: #Indexer[
                              $recv: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['make']
                              ]
                           ]
                           $right: #Indexer[
                              $recv: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['MAKE']
                              ]
                           ]
                        ]
                        $right: #Conditional[
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['vc_windows?']
                           ]
                           $then: #StringExpr['nmake']
                           $else: #StringExpr['make']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['nmake_found?']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['system']
                        $param: #List[
                           $expression: #StringExpr['nmake /? 1>NUL 2>&1']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['wait_for_child_process_to_exit']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #IfExpr[
                        $then: #ApplyExpr[
                           $recv: #NameExpr['Process']
                           $recv: #NameExpr['wait']
                        ]
                        $cond: #ApplyExpr[
                           $recv: #NameExpr['Process']
                           $recv: #NameExpr['respond_to?']
                           $param: #List[
                              $expression: #NameExpr['fork']
                           ]
                        ]
                     ]
                     $rescue: #List[
                        $rescue: #Rescue[
                           $class: #Field[
                              $recv: #NameExpr['Errno']
                              $name: #NameExpr['ECHILD']
                           ]
                           $then: #Empty['']
                        ]
                     ]
                  ]
               ]
               $statement: #SFuncDecl[
                  $path: #Self['self']
                  $name: #NameExpr['process_based_port']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #LOrAssign[
                        $left: #NameExpr['@@process_based_port']
                        $right: #AddExpr[
                           $left: #IntExpr['8000']
                           $right: #ModExpr[
                              $left: #BuiltInVariable['$$']
                              $right: #IntExpr['1000']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['process_based_port']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        $recv: #ApplyExpr[
                           $recv: #Self['self']
                           $recv: #NameExpr['class']
                        ]
                        $recv: #NameExpr['process_based_port']
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['build_rake_in']
                  $param: #List[
                     $param: #OptionalParam[
                        $name: #NameExpr['good']
                        $default: #TrueExpr['true']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['gem_ruby']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['ruby']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['Gem']
                              $name: #NameExpr['ruby']
                           ]
                           $right: #NameExpr['@@ruby']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['env_rake']
                           $right: #Indexer[
                              $recv: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['rake']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['rake']
                           $right: #Conditional[
                              $cond: #NameExpr['good']
                              $then: #NameExpr['@@good_rake']
                              $else: #NameExpr['@@bad_rake']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['rake']
                              ]
                           ]
                           $right: #NameExpr['rake']
                        ]
                        $statement: #Yield[
                           $param: #List[
                              $expression: #NameExpr['rake']
                           ]
                        ]
                     ]
                     $ensure: #List[
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['Gem']
                              $name: #NameExpr['ruby']
                           ]
                           $right: #NameExpr['gem_ruby']
                        ]
                        $statement: #IfExpr[
                           $cond: #NameExpr['env_rake']
                           $then: #AssignExpr[
                              $left: #Indexer[
                                 $base: #NameExpr['ENV']
                                 $index: #List[
                                    $expression: #StringExpr['rake']
                                 ]
                              ]
                              $right: #NameExpr['env_rake']
                           ]
                           $else: #ApplyExpr[
                              $recv: #NameExpr['ENV']
                              $recv: #NameExpr['delete']
                              $param: #List[
                                 $expression: #StringExpr['rake']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #SFuncDecl[
                  $path: #Self['self']
                  $name: #NameExpr['rubybin']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['ruby']
                           $right: #Indexer[
                              $recv: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['RUBY']
                              ]
                           ]
                        ]
                        $statement: #IfExpr[
                           $then: #RReturnStmt[
                              $expr: #List[
                                 $expression: #NameExpr['ruby']
                              ]
                           ]
                           $cond: #NameExpr['ruby']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['ruby']
                           $right: #StringExpr['ruby']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['rubyexe']
                           $right: #StringExpr[
                              $inner: #NameExpr['ruby']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #IntExpr['3']
                           $recv: #NameExpr['times']
                           $body: #Block[
                              $body: #List[
                                 $statement: #IfExpr[
                                    $cond: #AndExpr[
                                       $left: #AndExpr[
                                          $left: #ApplyExpr[
                                             $base: #NameExpr['File']
                                             $recv: #NameExpr['exist?']
                                             $param: #List[
                                                $expression: #NameExpr['ruby']
                                             ]
                                          ]
                                          $right: #ApplyExpr[
                                             $base: #NameExpr['File']
                                             $recv: #NameExpr['executable?']
                                             $param: #List[
                                                $expression: #NameExpr['ruby']
                                             ]
                                          ]
                                       ]
                                       $right: #[
                                          $base: #ApplyExpr[
                                             $base: #NameExpr['File']
                                             $recv: #NameExpr['directory?']
                                             $param: #List[
                                                $expression: #NameExpr['ruby']
                                             ]
                                          ]
                                       ]
                                    ]
                                    $then: #RReturnStmt[
                                       $expr: #List[
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['File']
                                             $recv: #NameExpr['expand_path']
                                             $param: #List[
                                                $expression: #NameExpr['ruby']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #IfExpr[
                                    $cond: #AndExpr[
                                       $left: #ApplyExpr[
                                          $base: #NameExpr['File']
                                          $recv: #NameExpr['exist?']
                                          $param: #List[
                                             $expression: #NameExpr['rubyexe']
                                          ]
                                       ]
                                       $right: #ApplyExpr[
                                          $base: #NameExpr['File']
                                          $recv: #NameExpr['executable?']
                                          $param: #List[
                                             $expression: #NameExpr['rubyexe']
                                          ]
                                       ]
                                    ]
                                    $then: #RReturnStmt[
                                       $expr: #List[
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['File']
                                             $recv: #NameExpr['expand_path']
                                             $param: #List[
                                                $expression: #NameExpr['rubyexe']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ruby']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['File']
                                       $recv: #NameExpr['join']
                                       $param: #List[
                                          $expression: #StringExpr['..']
                                          $expression: #NameExpr['ruby']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ExceptionBlock[
                           $main: #List[
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['require']
                                 $param: #List[
                                    $expression: #StringExpr['rbconfig']
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #Indexer[
                                       $recv: #Field[
                                          $recv: #NameExpr['RbConfig']
                                          $name: #NameExpr['CONFIG']
                                       ]
                                       $index: #List[
                                          $expression: #StringExpr['bindir']
                                       ]
                                    ]
                                    $expression: #AddExpr[
                                       $left: #Indexer[
                                          $recv: #Field[
                                             $recv: #NameExpr['RbConfig']
                                             $name: #NameExpr['CONFIG']
                                          ]
                                          $index: #List[
                                             $expression: #StringExpr['ruby_install_name']
                                          ]
                                       ]
                                       $right: #Indexer[
                                          $recv: #Field[
                                             $recv: #NameExpr['RbConfig']
                                             $name: #NameExpr['CONFIG']
                                          ]
                                          $index: #List[
                                             $expression: #StringExpr['EXEEXT']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $rescue: #List[
                              $rescue: #Rescue[
                                 $class: #NameExpr['LoadError']
                                 $then: #StringExpr['ruby']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #AssignExpr[
                  $left: #NameExpr['@@ruby']
                  $right: #NameExpr['rubybin']
               ]
               $statement: #AssignExpr[
                  $left: #NameExpr['@@good_rake']
                  $right: #StringExpr[
                     $inner: #NameExpr['rubybin']
                     $inner: #ApplyExpr[
                        $recv: #NameExpr['File']
                        $recv: #NameExpr['expand_path']
                        $param: #List[
                           $expression: #StringExpr['../../../test/rubygems/good_rake.rb']
                           $expression: #File['__FILE__']
                        ]
                     ]
                  ]
               ]
               $statement: #AssignExpr[
                  $left: #NameExpr['@@bad_rake']
                  $right: #StringExpr[
                     $inner: #NameExpr['rubybin']
                     $inner: #ApplyExpr[
                        $recv: #NameExpr['File']
                        $recv: #NameExpr['expand_path']
                        $param: #List[
                           $expression: #StringExpr['../../../test/rubygems/bad_rake.rb']
                           $expression: #File['__FILE__']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['dep']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['name']
                     ]
                     $param: #VariadicParam[
                        $name: #NameExpr['requirements']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        $base: #Field[
                           $recv: #NameExpr['Gem']
                           $name: #NameExpr['Dependency']
                        ]
                        $recv: #NameExpr['new']
                        $param: #List[
                           $expression: #NameExpr['name']
                           $variadic: #Variadic[
                              $base: #NameExpr['requirements']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['dependency_request']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['dep']
                     ]
                     $param: #Param[
                        $param: #NameExpr['from_name']
                     ]
                     $param: #Param[
                        $param: #NameExpr['from_version']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['parent']
                        $default: #Nil['nil']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['remote']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Source']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #NameExpr['@uri']
                              ]
                           ]
                        ]
                        $statement: #Unless[
                           $cond: #NameExpr['parent']
                           $then: #List[
                              $statement: #AssignExpr[
                                 $left: #NameExpr['parent_dep']
                                 $right: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['dep']
                                    $param: #List[
                                       $expression: #NameExpr['from_name']
                                       $expression: #NameExpr['from_version']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['parent']
                                 $right: #ApplyExpr[
                                    $base: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Resolver']
                                       ]
                                       $name: #NameExpr['DependencyRequest']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #NameExpr['parent_dep']
                                       $expression: #Nil['nil']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #Field[
                                    $recv: #NameExpr['Gem']
                                    $name: #NameExpr['Resolver']
                                 ]
                                 $name: #NameExpr['IndexSpecification']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #NameExpr['from_name']
                                 $expression: #NameExpr['from_version']
                                 $expression: #NameExpr['remote']
                                 $expression: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['Platform']
                                    ]
                                    $name: #NameExpr['RUBY']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['activation']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #Field[
                                    $recv: #NameExpr['Gem']
                                    $name: #NameExpr['Resolver']
                                 ]
                                 $name: #NameExpr['ActivationRequest']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #NameExpr['spec']
                                 $expression: #NameExpr['parent']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #Field[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Resolver']
                              ]
                              $name: #NameExpr['DependencyRequest']
                           ]
                           $recv: #NameExpr['new']
                           $param: #List[
                              $expression: #NameExpr['dep']
                              $expression: #NameExpr['activation']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['req']
                  $param: #List[
                     $param: #VariadicParam[
                        $name: #NameExpr['requirements']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $then: #RReturnStmt[
                              $expr: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['requirements']
                                    $recv: #NameExpr['first']
                                 ]
                              ]
                           ]
                           $cond: #StrictEquals[
                              $left: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Requirement']
                              ]
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['requirements']
                                 $recv: #NameExpr['first']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #Field[
                              $recv: #NameExpr['Gem']
                              $name: #NameExpr['Requirement']
                           ]
                           $recv: #NameExpr['create']
                           $param: #List[
                              $expression: #NameExpr['requirements']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['spec']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['name']
                     ]
                     $param: #Param[
                        $param: #NameExpr['version']
                     ]
                     $param: #ProcedureParam[
                        $name: #NameExpr['block']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        $base: #Field[
                           $recv: #NameExpr['Gem']
                           $name: #NameExpr['Specification']
                        ]
                        $recv: #NameExpr['new']
                        $param: #List[
                           $expression: #NameExpr['name']
                           $expression: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['v']
                              $param: #List[
                                 $expression: #NameExpr['version']
                              ]
                           ]
                           $procedure: #Procedure[
                              $base: #NameExpr['block']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['spec_fetcher']
                  $param: #List[
                     $param: #OptionalParam[
                        $name: #NameExpr['repository']
                        $default: #NameExpr['@gem_repo']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        $base: #Field[
                           $recv: #Field[
                              $recv: #NameExpr['Gem']
                              $name: #NameExpr['TestCase']
                           ]
                           $name: #NameExpr['SpecFetcherSetup']
                        ]
                        $recv: #NameExpr['declare']
                        $param: #List[
                           $expression: #Self['self']
                           $expression: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['repository']
                              $body: #Block[
                                 $param: #NameExpr['spec_fetcher_setup']
                                 $body: #IfExpr[
                                    $then: #Yield[
                                       $param: #List[
                                          $expression: #NameExpr['spec_fetcher_setup']
                                       ]
                                    ]
                                    $cond: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['block_given?']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['v']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['string']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        $base: #Field[
                           $recv: #NameExpr['Gem']
                           $name: #NameExpr['Version']
                        ]
                        $recv: #NameExpr['create']
                        $param: #List[
                           $expression: #NameExpr['string']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['vendor_gem']
                  $param: #List[
                     $param: #OptionalParam[
                        $name: #NameExpr['name']
                        $default: #StringExpr['a']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['version']
                        $default: #IntExpr['1']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['directory']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #StringExpr['vendor']
                                 $expression: #NameExpr['name']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir_p']
                           $param: #List[
                              $expression: #NameExpr['directory']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['save_gemspec']
                           $param: #List[
                              $expression: #NameExpr['name']
                              $expression: #NameExpr['version']
                              $expression: #NameExpr['directory']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['save_gemspec']
                  $param: #List[
                     $param: #OptionalParam[
                        $name: #NameExpr['name']
                        $default: #StringExpr['a']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['version']
                        $default: #IntExpr['1']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['directory']
                        $default: #StringExpr['.']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['vendor_spec']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Specification']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #NameExpr['name']
                                 $expression: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['version']
                                    $body: #Block[
                                       $param: #NameExpr['specification']
                                       $body: #IfExpr[
                                          $then: #Yield[
                                             $param: #List[
                                                $expression: #NameExpr['specification']
                                             ]
                                          ]
                                          $cond: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['block_given?']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['open']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['directory']
                                    $expression: #StringExpr[
                                       $inner: #NameExpr['name']
                                    ]
                                 ]
                              ]
                              $expression: #StringExpr['w']
                           ]
                           $body: #Block[
                              $param: #NameExpr['io']
                              $body: #ApplyExpr[
                                 $base: #NameExpr['io']
                                 $recv: #NameExpr['write']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['vendor_spec']
                                       $recv: #NameExpr['to_ruby']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #RReturnStmt[
                           $expr: #List[
                              $expression: #NameExpr['name']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['vendor_spec']
                                 $recv: #NameExpr['version']
                              ]
                              $expression: #NameExpr['directory']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #Class[
                  $name: #NameExpr['StaticSet']
                  $super: #Field[
                     $recv: #Field[
                        $recv: #NameExpr['Gem']
                        $name: #NameExpr['Resolver']
                     ]
                     $name: #NameExpr['Set']
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['attr_accessor']
                           $param: #List[
                              $expression: #NameExpr['remote']
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['initialize']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['specs']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #Super['super']
                                    $param: #Empty['']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@specs']
                                    $right: #NameExpr['specs']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@remote']
                                    $right: #TrueExpr['true']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['add']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['spec']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #LShiftExpr[
                                 $left: #NameExpr['@specs']
                                 $right: #NameExpr['spec']
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['find_spec']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['dep']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 $recv: #NameExpr['@specs']
                                 $recv: #NameExpr['reverse_each']
                                 $body: #Block[
                                    $param: #NameExpr['s']
                                    $body: #IfExpr[
                                       $then: #RReturnStmt[
                                          $expr: #List[
                                             $expression: #NameExpr['s']
                                          ]
                                       ]
                                       $cond: #ApplyExpr[
                                          $base: #NameExpr['dep']
                                          $recv: #NameExpr['matches_spec?']
                                          $param: #List[
                                             $expression: #NameExpr['s']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['find_all']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['dep']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 $recv: #NameExpr['@specs']
                                 $recv: #NameExpr['find_all']
                                 $body: #Block[
                                    $param: #NameExpr['s']
                                    $body: #ApplyExpr[
                                       $base: #NameExpr['dep']
                                       $recv: #NameExpr['match?']
                                       $param: #List[
                                          $expression: #NameExpr['s']
                                          $expression: #NameExpr['@prerelease']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['load_spec']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['name']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['ver']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['platform']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['source']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['dep']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Dependency']
                                       ]
                                       $recv: #NameExpr['new']
                                       $param: #List[
                                          $expression: #NameExpr['name']
                                          $expression: #NameExpr['ver']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['spec']
                                    $right: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['find_spec']
                                       $param: #List[
                                          $expression: #NameExpr['dep']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $base: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['Specification']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['spec']
                                          $recv: #NameExpr['name']
                                       ]
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['spec']
                                          $recv: #NameExpr['version']
                                          $body: #Block[
                                             $param: #NameExpr['s']
                                             $body: #AssignExpr[
                                                $left: #Field[
                                                   $base: #NameExpr['s']
                                                   $name: #NameExpr['platform']
                                                ]
                                                $right: #ApplyExpr[
                                                   $recv: #NameExpr['spec']
                                                   $recv: #NameExpr['platform']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['prefetch']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['reqs']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #Empty['']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #SFuncDecl[
                  $path: #Self['self']
                  $name: #NameExpr['load_cert']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['cert_name']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['cert_file']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['cert_path']
                              $param: #List[
                                 $expression: #NameExpr['cert_name']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['cert']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['read']
                              $param: #List[
                                 $expression: #NameExpr['cert_file']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #Field[
                              $recv: #Field[
                                 $recv: #NameExpr['OpenSSL']
                                 $name: #NameExpr['X509']
                              ]
                              $name: #NameExpr['Certificate']
                           ]
                           $recv: #NameExpr['new']
                           $param: #List[
                              $expression: #NameExpr['cert']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #SFuncDecl[
                  $path: #Self['self']
                  $name: #NameExpr['cert_path']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['cert_name']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $cond: #EqExpr[
                              $left: #IntExpr['32']
                              $right: #Rescue[
                                 $body: #ApplyExpr[
                                    $recv: #NameExpr['Time']
                                    $recv: #NameExpr['at']
                                    $param: #List[
                                       $expression: #PowerExpr[
                                          $left: #IntExpr['2']
                                          $right: #IntExpr['32']
                                       ]
                                    ]
                                 ]
                                 $rescue: #IntExpr['32']
                              ]
                           ]
                           $then: #List[
                              $statement: #AssignExpr[
                                 $left: #NameExpr['cert_file']
                                 $right: #ApplyExpr[
                                    $base: #NameExpr['File']
                                    $recv: #NameExpr['expand_path']
                                    $param: #List[
                                       $expression: #StringExpr[
                                          $inner: #NameExpr['cert_name']
                                       ]
                                       $expression: #File['__FILE__']
                                    ]
                                 ]
                              ]
                              $statement: #IfExpr[
                                 $then: #RReturnStmt[
                                    $expr: #List[
                                       $expression: #NameExpr['cert_file']
                                    ]
                                 ]
                                 $cond: #ApplyExpr[
                                    $base: #NameExpr['File']
                                    $recv: #NameExpr['exist?']
                                    $param: #List[
                                       $expression: #NameExpr['cert_file']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['File']
                           $recv: #NameExpr['expand_path']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #NameExpr['cert_name']
                              ]
                              $expression: #File['__FILE__']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #SFuncDecl[
                  $path: #Self['self']
                  $name: #NameExpr['load_key']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['key_name']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['passphrase']
                        $default: #Nil['nil']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['key_file']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['key_path']
                              $param: #List[
                                 $expression: #NameExpr['key_name']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['key']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['read']
                              $param: #List[
                                 $expression: #NameExpr['key_file']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #Field[
                              $recv: #Field[
                                 $recv: #NameExpr['OpenSSL']
                                 $name: #NameExpr['PKey']
                              ]
                              $name: #NameExpr['RSA']
                           ]
                           $recv: #NameExpr['new']
                           $param: #List[
                              $expression: #NameExpr['key']
                              $expression: #NameExpr['passphrase']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #SFuncDecl[
                  $path: #Self['self']
                  $name: #NameExpr['key_path']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['key_name']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        $base: #NameExpr['File']
                        $recv: #NameExpr['expand_path']
                        $param: #List[
                           $expression: #StringExpr[
                              $inner: #NameExpr['key_name']
                           ]
                           $expression: #File['__FILE__']
                        ]
                     ]
                  ]
               ]
               $statement: #AssignExpr[
                  $left: #NameExpr['PRIVATE_KEY_PASSPHRASE']
                  $right: #StringExpr['Foo bar']
               ]
               $statement: #IfExpr[
                  $then: #ExceptionBlock[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['PRIVATE_KEY']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['load_key']
                              $param: #List[
                                 $expression: #StringExpr['private']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['PRIVATE_KEY_PATH']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['key_path']
                              $param: #List[
                                 $expression: #StringExpr['private']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['ENCRYPTED_PRIVATE_KEY']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['load_key']
                              $param: #List[
                                 $expression: #StringExpr['encrypted_private']
                                 $expression: #NameExpr['PRIVATE_KEY_PASSPHRASE']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['ENCRYPTED_PRIVATE_KEY_PATH']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['key_path']
                              $param: #List[
                                 $expression: #StringExpr['encrypted_private']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['PUBLIC_KEY']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['PRIVATE_KEY']
                              $recv: #NameExpr['public_key']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['PUBLIC_CERT']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['load_cert']
                              $param: #List[
                                 $expression: #StringExpr['public']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['PUBLIC_CERT_PATH']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['cert_path']
                              $param: #List[
                                 $expression: #StringExpr['public']
                              ]
                           ]
                        ]
                     ]
                     $rescue: #List[
                        $rescue: #Rescue[
                           $class: #Field[
                              $recv: #NameExpr['Errno']
                              $name: #NameExpr['ENOENT']
                           ]
                           $then: #List[
                              $statement: #AssignExpr[
                                 $left: #NameExpr['PRIVATE_KEY']
                                 $right: #Nil['nil']
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['PUBLIC_KEY']
                                 $right: #Nil['nil']
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['PUBLIC_CERT']
                                 $right: #Nil['nil']
                              ]
                           ]
                        ]
                     ]
                  ]
                  $cond: #Defined[
                     $base: #Field[
                        $recv: #NameExpr['OpenSSL']
                        $name: #NameExpr['SSL']
                     ]
                  ]
               ]
            ]
         ]
      ]
      $statement: #ExceptionBlock[
         $main: #ApplyExpr[
            #Self['self']
            $recv: #NameExpr['gem']
            $param: #List[
               $expression: #StringExpr['rake']
            ]
         ]
         $rescue: #List[
            $rescue: #Rescue[
               $class: #Field[
                  $recv: #NameExpr['Gem']
                  $name: #NameExpr['LoadError']
               ]
               $then: #Empty['']
            ]
         ]
      ]
      $statement: #ExceptionBlock[
         $main: #ApplyExpr[
            #Self['self']
            $recv: #NameExpr['require']
            $param: #List[
               $expression: #StringExpr['rake/packagetask']
            ]
         ]
         $rescue: #List[
            $rescue: #Rescue[
               $class: #NameExpr['LoadError']
               $then: #Empty['']
            ]
         ]
      ]
      $statement: #ExceptionBlock[
         $main: #List[
            $statement: #ApplyExpr[
               #Self['self']
               $recv: #NameExpr['gem']
               $param: #List[
                  $expression: #StringExpr['rdoc']
               ]
            ]
            $statement: #ApplyExpr[
               #Self['self']
               $recv: #NameExpr['require']
               $param: #List[
                  $expression: #StringExpr['rdoc']
               ]
            ]
         ]
         $rescue: #List[
            $rescue: #Rescue[
               $class: #MultipleRightHandSideExpression[
                  $expression: #NameExpr['LoadError']
                  $expression: #Field[
                     $recv: #NameExpr['Gem']
                     $name: #NameExpr['LoadError']
                  ]
               ]
               $then: #Empty['']
            ]
         ]
      ]
      $statement: #ExceptionBlock[
         $main: #List[
            $statement: #ApplyExpr[
               #Self['self']
               $recv: #NameExpr['gem']
               $param: #List[
                  $expression: #StringExpr['builder']
               ]
            ]
            $statement: #ApplyExpr[
               #Self['self']
               $recv: #NameExpr['require']
               $param: #List[
                  $expression: #StringExpr['builder/xchar']
               ]
            ]
         ]
         $rescue: #List[
            $rescue: #Rescue[
               $class: #MultipleRightHandSideExpression[
                  $expression: #NameExpr['LoadError']
                  $expression: #Field[
                     $recv: #NameExpr['Gem']
                     $name: #NameExpr['LoadError']
                  ]
               ]
               $then: #Empty['']
            ]
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['rubygems/test_utilities']
         ]
      ]
      $statement: #AssignExpr[
         $left: #NameExpr['tmpdirs']
         $right: #Array['[]']
      ]
      $statement: #LShiftExpr[
         $left: #NameExpr['tmpdirs']
         $right: #AssignExpr[
            $left: #Indexer[
               $base: #NameExpr['ENV']
               $index: #List[
                  $expression: #StringExpr['GEM_HOME']
               ]
            ]
            $right: #ApplyExpr[
               $recv: #NameExpr['Dir']
               $recv: #NameExpr['mktmpdir']
               $param: #List[
                  $expression: #StringExpr['home']
               ]
            ]
         ]
      ]
      $statement: #LShiftExpr[
         $left: #NameExpr['tmpdirs']
         $right: #AssignExpr[
            $left: #Indexer[
               $base: #NameExpr['ENV']
               $index: #List[
                  $expression: #StringExpr['GEM_PATH']
               ]
            ]
            $right: #ApplyExpr[
               $recv: #NameExpr['Dir']
               $recv: #NameExpr['mktmpdir']
               $param: #List[
                  $expression: #StringExpr['path']
               ]
            ]
         ]
      ]
      $statement: #AssignExpr[
         $left: #NameExpr['pid']
         $right: #BuiltInVariable['$$']
      ]
      $statement: #Finalizer[
         $body: #IfExpr[
            $then: #ApplyExpr[
               $recv: #NameExpr['tmpdirs']
               $recv: #NameExpr['each']
               $body: #Block[
                  $param: #NameExpr['dir']
                  $body: #ApplyExpr[
                     $recv: #NameExpr['Dir']
                     $recv: #NameExpr['rmdir']
                     $param: #List[
                        $expression: #NameExpr['dir']
                     ]
                  ]
               ]
            ]
            $cond: #EqExpr[
               $left: #BuiltInVariable['$$']
               $right: #NameExpr['pid']
            ]
         ]
      ]
      $statement: #ApplyExpr[
         $recv: #NameExpr['Gem']
         $recv: #NameExpr['clear_paths']
      ]
   ]
   #Comsumed['comsumed']
]
