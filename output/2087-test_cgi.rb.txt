#Source[
   #List[
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require_relative']
         $param: #List[
            $expression: #StringExpr['utils']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['webrick']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['test/unit']
         ]
      ]
      $statement: #Class[
         $name: #NameExpr['TestWEBrickCGI']
         $super: #Field[
            $recv: #Field[
               $recv: #NameExpr['Test']
               $name: #NameExpr['Unit']
            ]
            $name: #NameExpr['TestCase']
         ]
         $body: #BlockExpr[
            $main: #List[
               $statement: #AssignExpr[
                  $left: #NameExpr['CRLF']
                  $right: #StringExpr['\\r\\n']
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['teardown']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $recv: #Field[
                              $recv: #Field[
                                 $recv: #NameExpr['WEBrick']
                                 $name: #NameExpr['Utils']
                              ]
                              $name: #NameExpr['TimeoutHandler']
                           ]
                           $recv: #NameExpr['terminate']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #Super['super']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['start_cgi_server']
                  $param: #List[
                     $param: #OptionalParam[
                        $name: #NameExpr['log_tester']
                        $default: #Field[
                           $recv: #NameExpr['TestWEBrick']
                           $name: #NameExpr['DefaultLogTester']
                        ]
                     ]
                     $param: #ProcedureParam[
                        $name: #NameExpr['block']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['config']
                           $right: #List[
                              $hash: #Hash[
                                 $key: #NameExpr['CGIInterpreter']
                                 $value: #Field[
                                    $recv: #NameExpr['TestWEBrick']
                                    $name: #NameExpr['RubyBin']
                                 ]
                              ]
                              $hash: #Hash[
                                 $key: #NameExpr['DocumentRoot']
                                 $value: #ApplyExpr[
                                    $recv: #NameExpr['File']
                                    $recv: #NameExpr['dirname']
                                    $param: #List[
                                       $expression: #File['__FILE__']
                                    ]
                                 ]
                              ]
                              $hash: #Hash[
                                 $key: #NameExpr['DirectoryIndex']
                                 $value: #Array[
                                    $index: #List[
                                       $expression: #StringExpr['webrick.cgi']
                                    ]
                                 ]
                              ]
                              $hash: #Hash[
                                 $key: #NameExpr['RequestCallback']
                                 $value: #ApplyExpr[
                                    $recv: #NameExpr['Proc']
                                    $recv: #NameExpr['new']
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['req']
                                          $item: #NameExpr['res']
                                       ]
                                       $body: #SFuncDecl[
                                          $path: #NameExpr['req']
                                          $name: #NameExpr['meta_vars']
                                          $param: #List['']
                                          $body: #BlockExpr[
                                             $main: #List[
                                                $statement: #AssignExpr[
                                                   $left: #NameExpr['meta']
                                                   $right: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #Super['super']
                                                   ]
                                                ]
                                                $statement: #AssignExpr[
                                                   $left: #Indexer[
                                                      $base: #NameExpr['meta']
                                                      $index: #List[
                                                         $expression: #StringExpr['RUBYLIB']
                                                      ]
                                                   ]
                                                   $right: #ApplyExpr[
                                                      $recv: #BuiltInVariable['$:']
                                                      $recv: #NameExpr['join']
                                                      $param: #List[
                                                         $expression: #Field[
                                                            $recv: #NameExpr['File']
                                                            $name: #NameExpr['PATH_SEPARATOR']
                                                         ]
                                                      ]
                                                   ]
                                                ]
                                                $statement: #IfExpr[
                                                   $then: #AssignExpr[
                                                      $left: #Indexer[
                                                         $base: #NameExpr['meta']
                                                         $index: #List[
                                                            $expression: #Indexer[
                                                               $recv: #Field[
                                                                  $recv: #NameExpr['RbConfig']
                                                                  $name: #NameExpr['CONFIG']
                                                               ]
                                                               $index: #List[
                                                                  $expression: #StringExpr['LIBPATHENV']
                                                               ]
                                                            ]
                                                         ]
                                                      ]
                                                      $right: #Indexer[
                                                         $recv: #NameExpr['ENV']
                                                         $index: #List[
                                                            $expression: #Indexer[
                                                               $recv: #Field[
                                                                  $recv: #NameExpr['RbConfig']
                                                                  $name: #NameExpr['CONFIG']
                                                               ]
                                                               $index: #List[
                                                                  $expression: #StringExpr['LIBPATHENV']
                                                               ]
                                                            ]
                                                         ]
                                                      ]
                                                   ]
                                                   $cond: #Indexer[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['RbConfig']
                                                         $name: #NameExpr['CONFIG']
                                                      ]
                                                      $index: #List[
                                                         $expression: #StringExpr['LIBPATHENV']
                                                      ]
                                                   ]
                                                ]
                                                $statement: #RReturnStmt[
                                                   $expr: #List[
                                                      $expression: #NameExpr['meta']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #IfExpr[
                           $cond: #AssignExpr[
                              $left: #NameExpr['RUBY_PLATFORM']
                              $right: #ComplExpr[
                                 $expr: #Regex['/mswin|mingw|cygwin|bccwin32/']
                              ]
                           ]
                           $then: #AssignExpr[
                              $left: #Indexer[
                                 $base: #NameExpr['config']
                                 $index: #List[
                                    $expression: #NameExpr['CGIPathEnv']
                                 ]
                              ]
                              $right: #Indexer[
                                 $recv: #NameExpr['ENV']
                                 $index: #List[
                                    $expression: #StringExpr['PATH']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['TestWEBrick']
                           $recv: #NameExpr['start_httpserver']
                           $param: #List[
                              $expression: #NameExpr['config']
                              $expression: #NameExpr['log_tester']
                           ]
                           $body: #Block[
                              $param: #MultipleLeftHandSideExpression[
                                 $item: #NameExpr['server']
                                 $item: #NameExpr['addr']
                                 $item: #NameExpr['port']
                                 $item: #NameExpr['log']
                              ]
                              $body: #ApplyExpr[
                                 $recv: #NameExpr['block']
                                 $recv: #NameExpr['call']
                                 $param: #List[
                                    $expression: #NameExpr['server']
                                    $expression: #NameExpr['addr']
                                    $expression: #NameExpr['port']
                                    $expression: #NameExpr['log']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_cgi']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['start_cgi_server']
                        $body: #Block[
                           $param: #MultipleLeftHandSideExpression[
                              $item: #NameExpr['server']
                              $item: #NameExpr['addr']
                              $item: #NameExpr['port']
                              $item: #NameExpr['log']
                           ]
                           $body: #List[
                              $statement: #AssignExpr[
                                 $left: #NameExpr['http']
                                 $right: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['Net']
                                       $name: #NameExpr['HTTP']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #NameExpr['addr']
                                       $expression: #NameExpr['port']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['req']
                                 $right: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['Net']
                                          $name: #NameExpr['HTTP']
                                       ]
                                       $name: #NameExpr['Get']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #StringExpr['/webrick.cgi']
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #NameExpr['http']
                                 $recv: #NameExpr['request']
                                 $param: #List[
                                    $expression: #NameExpr['req']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['res']
                                    $body: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_equal']
                                       $param: #List[
                                          $expression: #StringExpr['/webrick.cgi']
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['res']
                                             $recv: #NameExpr['body']
                                          ]
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['log']
                                             $recv: #NameExpr['call']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['req']
                                 $right: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['Net']
                                          $name: #NameExpr['HTTP']
                                       ]
                                       $name: #NameExpr['Get']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #StringExpr['/webrick.cgi/path/info']
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #NameExpr['http']
                                 $recv: #NameExpr['request']
                                 $param: #List[
                                    $expression: #NameExpr['req']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['res']
                                    $body: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_equal']
                                       $param: #List[
                                          $expression: #StringExpr['/path/info']
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['res']
                                             $recv: #NameExpr['body']
                                          ]
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['log']
                                             $recv: #NameExpr['call']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['req']
                                 $right: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['Net']
                                          $name: #NameExpr['HTTP']
                                       ]
                                       $name: #NameExpr['Get']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #StringExpr['/webrick.cgi/%3F%3F%3F?foo=bar']
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #NameExpr['http']
                                 $recv: #NameExpr['request']
                                 $param: #List[
                                    $expression: #NameExpr['req']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['res']
                                    $body: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_equal']
                                       $param: #List[
                                          $expression: #StringExpr['/???']
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['res']
                                             $recv: #NameExpr['body']
                                          ]
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['log']
                                             $recv: #NameExpr['call']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #Unless[
                                 $cond: #AssignExpr[
                                    $left: #NameExpr['RUBY_PLATFORM']
                                    $right: #ComplExpr[
                                       $expr: #Regex['/mswin|mingw|cygwin|bccwin32/']
                                    ]
                                 ]
                                 $then: #List[
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['req']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['Net']
                                                $name: #NameExpr['HTTP']
                                             ]
                                             $name: #NameExpr['Get']
                                          ]
                                          $recv: #NameExpr['new']
                                          $param: #List[
                                             $expression: #StringExpr['/webrick.cgi/%A4%DB%A4%B2/%A4%DB%A4%B2']
                                          ]
                                       ]
                                    ]
                                    $statement: #ApplyExpr[
                                       $recv: #NameExpr['http']
                                       $recv: #NameExpr['request']
                                       $param: #List[
                                          $expression: #NameExpr['req']
                                       ]
                                       $body: #Block[
                                          $param: #NameExpr['res']
                                          $body: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_equal']
                                             $param: #List[
                                                $expression: #StringExpr['/\\xA4\\xDB\\xA4\\xB2/\\xA4\\xDB\\xA4\\xB2']
                                                $expression: #ApplyExpr[
                                                   $recv: #NameExpr['res']
                                                   $recv: #NameExpr['body']
                                                ]
                                                $expression: #ApplyExpr[
                                                   $recv: #NameExpr['log']
                                                   $recv: #NameExpr['call']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['req']
                                 $right: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['Net']
                                          $name: #NameExpr['HTTP']
                                       ]
                                       $name: #NameExpr['Get']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #StringExpr['/webrick.cgi?a=1;a=2;b=x']
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #NameExpr['http']
                                 $recv: #NameExpr['request']
                                 $param: #List[
                                    $expression: #NameExpr['req']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['res']
                                    $body: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_equal']
                                       $param: #List[
                                          $expression: #StringExpr['a=1, a=2, b=x']
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['res']
                                             $recv: #NameExpr['body']
                                          ]
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['log']
                                             $recv: #NameExpr['call']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['req']
                                 $right: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['Net']
                                          $name: #NameExpr['HTTP']
                                       ]
                                       $name: #NameExpr['Get']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #StringExpr['/webrick.cgi?a=1&a=2&b=x']
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #NameExpr['http']
                                 $recv: #NameExpr['request']
                                 $param: #List[
                                    $expression: #NameExpr['req']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['res']
                                    $body: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_equal']
                                       $param: #List[
                                          $expression: #StringExpr['a=1, a=2, b=x']
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['res']
                                             $recv: #NameExpr['body']
                                          ]
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['log']
                                             $recv: #NameExpr['call']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['req']
                                 $right: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['Net']
                                          $name: #NameExpr['HTTP']
                                       ]
                                       $name: #NameExpr['Post']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #StringExpr['/webrick.cgi?a=x;a=y;b=1']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #NameExpr['req']
                                    $index: #List[
                                       $expression: #StringExpr['Content-Type']
                                    ]
                                 ]
                                 $right: #StringExpr['application/x-www-form-urlencoded']
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #NameExpr['http']
                                 $recv: #NameExpr['request']
                                 $param: #List[
                                    $expression: #NameExpr['req']
                                    $expression: #StringExpr['a=1;a=2;b=x']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['res']
                                    $body: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_equal']
                                       $param: #List[
                                          $expression: #StringExpr['a=1, a=2, b=x']
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['res']
                                             $recv: #NameExpr['body']
                                          ]
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['log']
                                             $recv: #NameExpr['call']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['req']
                                 $right: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['Net']
                                          $name: #NameExpr['HTTP']
                                       ]
                                       $name: #NameExpr['Post']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #StringExpr['/webrick.cgi?a=x&a=y&b=1']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #NameExpr['req']
                                    $index: #List[
                                       $expression: #StringExpr['Content-Type']
                                    ]
                                 ]
                                 $right: #StringExpr['application/x-www-form-urlencoded']
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #NameExpr['http']
                                 $recv: #NameExpr['request']
                                 $param: #List[
                                    $expression: #NameExpr['req']
                                    $expression: #StringExpr['a=1&a=2&b=x']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['res']
                                    $body: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_equal']
                                       $param: #List[
                                          $expression: #StringExpr['a=1, a=2, b=x']
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['res']
                                             $recv: #NameExpr['body']
                                          ]
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['log']
                                             $recv: #NameExpr['call']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['req']
                                 $right: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['Net']
                                          $name: #NameExpr['HTTP']
                                       ]
                                       $name: #NameExpr['Get']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #StringExpr['/']
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #NameExpr['http']
                                 $recv: #NameExpr['request']
                                 $param: #List[
                                    $expression: #NameExpr['req']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['res']
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['ary']
                                          $right: #ApplyExpr[
                                             $recv: #ApplyExpr[
                                                $recv: #ApplyExpr[
                                                   $recv: #NameExpr['res']
                                                   $recv: #NameExpr['body']
                                                ]
                                                $recv: #NameExpr['lines']
                                             ]
                                             $recv: #NameExpr['to_a']
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_match']
                                          $param: #List[
                                             $expression: #Regex['%r{/$}']
                                             $expression: #Indexer[
                                                $recv: #NameExpr['ary']
                                                $index: #List[
                                                   $expression: #IntExpr['0']
                                                ]
                                             ]
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['log']
                                                $recv: #NameExpr['call']
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_match']
                                          $param: #List[
                                             $expression: #Regex['%r{/webrick.cgi$}']
                                             $expression: #Indexer[
                                                $recv: #NameExpr['ary']
                                                $index: #List[
                                                   $expression: #IntExpr['1']
                                                ]
                                             ]
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['log']
                                                $recv: #NameExpr['call']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['req']
                                 $right: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['Net']
                                          $name: #NameExpr['HTTP']
                                       ]
                                       $name: #NameExpr['Get']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #StringExpr['/webrick.cgi']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #NameExpr['req']
                                    $index: #List[
                                       $expression: #StringExpr['Cookie']
                                    ]
                                 ]
                                 $right: #StringExpr['CUSTOMER=WILE_E_COYOTE; PART_NUMBER=ROCKET_LAUNCHER_0001']
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #NameExpr['http']
                                 $recv: #NameExpr['request']
                                 $param: #List[
                                    $expression: #NameExpr['req']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['res']
                                    $body: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_equal']
                                       $param: #List[
                                          $expression: #StringExpr['CUSTOMER=WILE_E_COYOTE\\nPART_NUMBER=ROCKET_LAUNCHER_0001\\n']
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['res']
                                             $recv: #NameExpr['body']
                                          ]
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['log']
                                             $recv: #NameExpr['call']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['req']
                                 $right: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['Net']
                                          $name: #NameExpr['HTTP']
                                       ]
                                       $name: #NameExpr['Get']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #StringExpr['/webrick.cgi']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['cookie']
                                 $right: #ParcentNotation['%{$Version="1"; }']
                              ]
                              $statement: #LShiftExpr[
                                 $left: #NameExpr['cookie']
                                 $right: #ParcentNotation['%{Customer="WILE_E_COYOTE"; $Path="/acme"; }']
                              ]
                              $statement: #LShiftExpr[
                                 $left: #NameExpr['cookie']
                                 $right: #ParcentNotation['%{Part_Number="Rocket_Launcher_0001"; $Path="/acme"; }']
                              ]
                              $statement: #LShiftExpr[
                                 $left: #NameExpr['cookie']
                                 $right: #ParcentNotation['%{Shipping="FedEx"; $Path="/acme"}']
                              ]
                              $statement: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #NameExpr['req']
                                    $index: #List[
                                       $expression: #StringExpr['Cookie']
                                    ]
                                 ]
                                 $right: #NameExpr['cookie']
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #NameExpr['http']
                                 $recv: #NameExpr['request']
                                 $param: #List[
                                    $expression: #NameExpr['req']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['res']
                                    $body: #List[
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #StringExpr['Customer=WILE_E_COYOTE, Shipping=FedEx']
                                             $expression: #Indexer[
                                                $recv: #NameExpr['res']
                                                $index: #List[
                                                   $expression: #StringExpr['Set-Cookie']
                                                ]
                                             ]
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['log']
                                                $recv: #NameExpr['call']
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #AddExpr[
                                                $left: #AddExpr[
                                                   $left: #StringExpr['Customer=WILE_E_COYOTE\\n']
                                                   $right: #StringExpr['Part_Number=Rocket_Launcher_0001\\n']
                                                ]
                                                $right: #StringExpr['Shipping=FedEx\\n']
                                             ]
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['res']
                                                $recv: #NameExpr['body']
                                             ]
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['log']
                                                $recv: #NameExpr['call']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_bad_request']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['log_tester']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['lambda']
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['log']
                                    $item: #NameExpr['access_log']
                                 ]
                                 $body: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_match']
                                    $param: #List[
                                       $expression: #Regex['/BadRequest/']
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['log']
                                          $recv: #NameExpr['join']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['start_cgi_server']
                           $param: #List[
                              $expression: #NameExpr['log_tester']
                           ]
                           $body: #Block[
                              $param: #MultipleLeftHandSideExpression[
                                 $item: #NameExpr['server']
                                 $item: #NameExpr['addr']
                                 $item: #NameExpr['port']
                                 $item: #NameExpr['log']
                              ]
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['sock']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['TCPSocket']
                                       $recv: #NameExpr['new']
                                       $param: #List[
                                          $expression: #NameExpr['addr']
                                          $expression: #NameExpr['port']
                                       ]
                                    ]
                                 ]
                                 $statement: #ExceptionBlock[
                                    $main: #List[
                                       $statement: #LShiftExpr[
                                          $left: #LShiftExpr[
                                             $left: #NameExpr['sock']
                                             $right: #StringExpr['POST /webrick.cgi HTTP/1.0']
                                          ]
                                          $right: #NameExpr['CRLF']
                                       ]
                                       $statement: #LShiftExpr[
                                          $left: #LShiftExpr[
                                             $left: #NameExpr['sock']
                                             $right: #StringExpr['Content-Type: application/x-www-form-urlencoded']
                                          ]
                                          $right: #NameExpr['CRLF']
                                       ]
                                       $statement: #LShiftExpr[
                                          $left: #LShiftExpr[
                                             $left: #NameExpr['sock']
                                             $right: #StringExpr['Content-Length: 1024']
                                          ]
                                          $right: #NameExpr['CRLF']
                                       ]
                                       $statement: #LShiftExpr[
                                          $left: #NameExpr['sock']
                                          $right: #NameExpr['CRLF']
                                       ]
                                       $statement: #LShiftExpr[
                                          $left: #NameExpr['sock']
                                          $right: #StringExpr['a=1&a=2&b=x']
                                       ]
                                       $statement: #ApplyExpr[
                                          $recv: #NameExpr['sock']
                                          $recv: #NameExpr['close_write']
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_match']
                                          $param: #List[
                                             $expression: #Regex['%r{\\AHTTP/\\d.\\d 400 Bad Request}']
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['sock']
                                                $recv: #NameExpr['read']
                                             ]
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['log']
                                                $recv: #NameExpr['call']
                                             ]
                                          ]
                                       ]
                                    ]
                                    $ensure: #ApplyExpr[
                                       $recv: #NameExpr['sock']
                                       $recv: #NameExpr['close']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_cgi_env']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['start_cgi_server']
                        $body: #Block[
                           $param: #MultipleLeftHandSideExpression[
                              $item: #NameExpr['server']
                              $item: #NameExpr['addr']
                              $item: #NameExpr['port']
                              $item: #NameExpr['log']
                           ]
                           $body: #List[
                              $statement: #AssignExpr[
                                 $left: #NameExpr['http']
                                 $right: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['Net']
                                       $name: #NameExpr['HTTP']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #NameExpr['addr']
                                       $expression: #NameExpr['port']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['req']
                                 $right: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['Net']
                                          $name: #NameExpr['HTTP']
                                       ]
                                       $name: #NameExpr['Get']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #StringExpr['/webrick.cgi/dumpenv']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #NameExpr['req']
                                    $index: #List[
                                       $expression: #StringExpr['proxy']
                                    ]
                                 ]
                                 $right: #StringExpr['http://example.com/']
                              ]
                              $statement: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #NameExpr['req']
                                    $index: #List[
                                       $expression: #StringExpr['hello']
                                    ]
                                 ]
                                 $right: #StringExpr['world']
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #NameExpr['http']
                                 $recv: #NameExpr['request']
                                 $param: #List[
                                    $expression: #NameExpr['req']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['res']
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['env']
                                          $right: #ApplyExpr[
                                             $recv: #NameExpr['Marshal']
                                             $recv: #NameExpr['load']
                                             $param: #List[
                                                $expression: #ApplyExpr[
                                                   $recv: #NameExpr['res']
                                                   $recv: #NameExpr['body']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #StringExpr['world']
                                             $expression: #Indexer[
                                                $recv: #NameExpr['env']
                                                $index: #List[
                                                   $expression: #StringExpr['HTTP_HELLO']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_not_operator']
                                          $param: #List[
                                             $expression: #NameExpr['env']
                                             $expression: #NameExpr['include?']
                                             $expression: #StringExpr['HTTP_PROXY']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #AssignExpr[
                  $left: #NameExpr['CtrlSeq']
                  $right: #ApplyExpr[
                     $recv: #ApplyExpr[
                        $recv: #Array[
                           $index: #List[
                              $expression: #HexInteger['0x7f']
                              $variadic: #Variadic[
                                 $base: #ClosedRange[
                                    #IntExpr['1']
                                    #IntExpr['31']
                                 ]
                              ]
                           ]
                        ]
                        $recv: #NameExpr['pack']
                        $param: #List[
                           $expression: #StringExpr['C*']
                        ]
                     ]
                     $recv: #NameExpr['gsub']
                     $param: #List[
                        $expression: #Regex['/\\s+/']
                        $expression: #StringExpr['']
                     ]
                  ]
               ]
               $statement: #AssignExpr[
                  $left: #NameExpr['CtrlPat']
                  $right: #Regex['/#{Regexp.quote(CtrlSeq)}/o']
               ]
               $statement: #AssignExpr[
                  $left: #NameExpr['DumpPat']
                  $right: #Regex['/#{Regexp.quote(CtrlSeq.dump[1...-1])}/o']
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_bad_uri']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['log_tester']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['lambda']
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['log']
                                    $item: #NameExpr['access_log']
                                 ]
                                 $body: #List[
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_equal']
                                       $param: #List[
                                          $expression: #IntExpr['1']
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['log']
                                             $recv: #NameExpr['length']
                                          ]
                                       ]
                                    ]
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_match']
                                       $param: #List[
                                          $expression: #Regex['/ERROR bad URI/']
                                          $expression: #Indexer[
                                             $recv: #NameExpr['log']
                                             $index: #List[
                                                $expression: #IntExpr['0']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['start_cgi_server']
                           $param: #List[
                              $expression: #NameExpr['log_tester']
                           ]
                           $body: #Block[
                              $param: #MultipleLeftHandSideExpression[
                                 $item: #NameExpr['server']
                                 $item: #NameExpr['addr']
                                 $item: #NameExpr['port']
                                 $item: #NameExpr['log']
                              ]
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['res']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['TCPSocket']
                                       $recv: #NameExpr['open']
                                       $param: #List[
                                          $expression: #NameExpr['addr']
                                          $expression: #NameExpr['port']
                                       ]
                                       $body: #Block[
                                          $param: #NameExpr['sock']
                                          $body: #List[
                                             $statement: #LShiftExpr[
                                                $left: #NameExpr['sock']
                                                $right: #StringExpr[
                                                   $inner: #NameExpr['CtrlSeq']
                                                   $inner: #NameExpr['CRLF']
                                                   $inner: #NameExpr['CRLF']
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['sock']
                                                $recv: #NameExpr['close_write']
                                             ]
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['sock']
                                                $recv: #NameExpr['read']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_match']
                                    $param: #List[
                                       $expression: #Regex['%r{\\AHTTP/\\d.\\d 400 Bad Request}']
                                       $expression: #NameExpr['res']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['s']
                                    $right: #Indexer[
                                       $recv: #ApplyExpr[
                                          $recv: #ApplyExpr[
                                             $recv: #ApplyExpr[
                                                $recv: #NameExpr['log']
                                                $recv: #NameExpr['call']
                                             ]
                                             $recv: #NameExpr['each_line']
                                          ]
                                          $recv: #NameExpr['grep']
                                          $param: #List[
                                             $expression: #Regex['/ERROR bad URI/']
                                          ]
                                       ]
                                       $index: #List[
                                          $expression: #IntExpr['0']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_match']
                                    $param: #List[
                                       $expression: #NameExpr['DumpPat']
                                       $expression: #NameExpr['s']
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_not_match']
                                    $param: #List[
                                       $expression: #NameExpr['CtrlPat']
                                       $expression: #NameExpr['s']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_bad_header']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['log_tester']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['lambda']
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['log']
                                    $item: #NameExpr['access_log']
                                 ]
                                 $body: #List[
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_equal']
                                       $param: #List[
                                          $expression: #IntExpr['1']
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['log']
                                             $recv: #NameExpr['length']
                                          ]
                                       ]
                                    ]
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_match']
                                       $param: #List[
                                          $expression: #Regex['/ERROR bad header/']
                                          $expression: #Indexer[
                                             $recv: #NameExpr['log']
                                             $index: #List[
                                                $expression: #IntExpr['0']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['start_cgi_server']
                           $param: #List[
                              $expression: #NameExpr['log_tester']
                           ]
                           $body: #Block[
                              $param: #MultipleLeftHandSideExpression[
                                 $item: #NameExpr['server']
                                 $item: #NameExpr['addr']
                                 $item: #NameExpr['port']
                                 $item: #NameExpr['log']
                              ]
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['res']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['TCPSocket']
                                       $recv: #NameExpr['open']
                                       $param: #List[
                                          $expression: #NameExpr['addr']
                                          $expression: #NameExpr['port']
                                       ]
                                       $body: #Block[
                                          $param: #NameExpr['sock']
                                          $body: #List[
                                             $statement: #LShiftExpr[
                                                $left: #NameExpr['sock']
                                                $right: #StringExpr[
                                                   $inner: #NameExpr['CRLF']
                                                   $inner: #NameExpr['CtrlSeq']
                                                   $inner: #NameExpr['CRLF']
                                                   $inner: #NameExpr['CRLF']
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['sock']
                                                $recv: #NameExpr['close_write']
                                             ]
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['sock']
                                                $recv: #NameExpr['read']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_match']
                                    $param: #List[
                                       $expression: #Regex['%r{\\AHTTP/\\d.\\d 400 Bad Request}']
                                       $expression: #NameExpr['res']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['s']
                                    $right: #Indexer[
                                       $recv: #ApplyExpr[
                                          $recv: #ApplyExpr[
                                             $recv: #ApplyExpr[
                                                $recv: #NameExpr['log']
                                                $recv: #NameExpr['call']
                                             ]
                                             $recv: #NameExpr['each_line']
                                          ]
                                          $recv: #NameExpr['grep']
                                          $param: #List[
                                             $expression: #Regex['/ERROR bad header/']
                                          ]
                                       ]
                                       $index: #List[
                                          $expression: #IntExpr['0']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_match']
                                    $param: #List[
                                       $expression: #NameExpr['DumpPat']
                                       $expression: #NameExpr['s']
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_not_match']
                                    $param: #List[
                                       $expression: #NameExpr['CtrlPat']
                                       $expression: #NameExpr['s']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
            ]
         ]
      ]
   ]
   #Comsumed['comsumed']
]
