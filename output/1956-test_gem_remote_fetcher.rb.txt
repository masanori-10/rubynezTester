#Source[
   #List[
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['rubygems/test_case']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['webrick']
         ]
      ]
      $statement: #ExceptionBlock[
         $main: #ApplyExpr[
            #Self['self']
            $recv: #NameExpr['require']
            $param: #List[
               $expression: #StringExpr['webrick/https']
            ]
         ]
         $rescue: #List[
            $rescue: #Rescue[
               $class: #NameExpr['LoadError']
               $target: #NameExpr['e']
               $then: #Unless[
                  $then: #NameExpr['raise']
                  $cond: #LOr[
                     $left: #ApplyExpr[
                        $base: #ApplyExpr[
                           $recv: #NameExpr['e']
                           $recv: #NameExpr['respond_to?']
                           $param: #List[
                              $expression: #NameExpr['path']
                           ]
                        ]
                        $recv: #NameExpr['&']
                        $param: #List[
                           $expression: #EqExpr[
                              $left: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['path']
                              ]
                              $right: #StringExpr['openssl']
                           ]
                        ]
                     ]
                     $right: #Match[
                        $left: #ApplyExpr[
                           $recv: #NameExpr['e']
                           $recv: #NameExpr['message']
                        ]
                        $right: #Regex['/ -- openssl$/']
                     ]
                  ]
               ]
            ]
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['rubygems/remote_fetcher']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['rubygems/package']
         ]
      ]
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['minitest/mock']
         ]
      ]
      $statement: #Class[
         $name: #NameExpr['TestGemRemoteFetcher']
         $super: #Field[
            $recv: #NameExpr['Gem']
            $name: #NameExpr['TestCase']
         ]
         $body: #BlockExpr[
            $main: #List[
               $statement: #ApplyExpr[
                  #Self['self']
                  $recv: #NameExpr['include']
                  $param: #List[
                     $expression: #Field[
                        $recv: #NameExpr['Gem']
                        $name: #NameExpr['DefaultUserInteraction']
                     ]
                  ]
               ]
               $statement: #AssignExpr[
                  $left: #NameExpr['SERVER_DATA']
                  $right: #HereDocument['--- !ruby/object:Gem::Cache\ngems:\n  rake-0.4.11: !ruby/object:Gem::Specification\n    rubygems_version: "0.7"\n    specification_version: 1\n    name: rake\n    version: !ruby/object:Gem::Version\n      version: 0.4.11\n    date: 2004-11-12\n    summary: Ruby based make-like utility.\n    require_paths:\n      - lib\n    author: Jim Weirich\n    email: jim@weirichhouse.org\n    homepage: http://rake.rubyforge.org\n    rubyforge_project: rake\n    description: Rake is a Make-like program implemented in Ruby. Tasks and dependencies are specified in standard Ruby syntax.\n    autorequire:\n    default_executable: rake\n    bindir: bin\n    has_rdoc: true\n    required_ruby_version: !ruby/object:Gem::Version::Requirement\n      requirements:\n        -\n          - ">"\n          - !ruby/object:Gem::Version\n            version: 0.0.0\n      version:\n    platform: ruby\n    files:\n      - README\n    test_files: []\n    library_stubs:\n    rdoc_options:\n    extra_rdoc_files:\n    executables:\n      - rake\n    extensions: []\n    requirements: []\n    dependencies: []\n']
               ]
               $statement: #AssignExpr[
                  $left: #NameExpr['PROXY_DATA']
                  $right: #ApplyExpr[
                     $recv: #NameExpr['SERVER_DATA']
                     $recv: #NameExpr['gsub']
                     $param: #List[
                        $expression: #Regex['/0.4.11/']
                        $expression: #StringExpr['0.4.2']
                     ]
                  ]
               ]
               $statement: #AssignExpr[
                  $left: #NameExpr['DIR']
                  $right: #ApplyExpr[
                     $recv: #NameExpr['File']
                     $recv: #NameExpr['expand_path']
                     $param: #List[
                        $expression: #ApplyExpr[
                           $recv: #NameExpr['File']
                           $recv: #NameExpr['dirname']
                           $param: #List[
                              $expression: #File['__FILE__']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #AssignExpr[
                  $left: #NameExpr['TEST_KEY_DH2048']
                  $right: #ApplyExpr[
                     $base: #Field[
                        $recv: #Field[
                           $recv: #NameExpr['OpenSSL']
                           $name: #NameExpr['PKey']
                        ]
                        $name: #NameExpr['DH']
                     ]
                     $recv: #NameExpr['new']
                     $param: #List[
                        $expression: #HereDocument['-----BEGIN DH PARAMETERS-----\nMIIBCAKCAQEA3Ze2EHSfYkZLUn557torAmjBgPsqzbodaRaGZtgK1gEU+9nNJaFV\nG1JKhmGUiEDyIW7idsBpe4sX/Wqjnp48Lr8IeI/SlEzLdoGpf05iRYXC8Cm9o8aM\ncfmVgoSEAo9YLBpzoji2jHkO7Q5IPt4zxbTdlmmGFLc/GO9q7LGHhC+rcMcNTGsM\n49AnILNn49pq4Y72jSwdmvq4psHZwwFBbPwLdw6bLUDDCN90jfqvYt18muwUxDiN\nNP0fuvVAIB158VnQ0liHSwcl6+9vE1mL0Jo/qEXQxl0+UdKDjaGfTsn6HIrwTnmJ\nPeIQQkFng2VVot/WAQbv3ePqWq07g1BBcwIBAg==\n-----END DH PARAMETERS-----\n']
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['setup']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['@proxies']
                           $right: #ParcentNotation['%w[https_proxy http_proxy HTTP_PROXY http_proxy_user HTTP_PROXY_USER http_proxy_pass HTTP_PROXY_PASS no_proxy NO_PROXY]']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@old_proxies']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['@proxies']
                              $recv: #NameExpr['map']
                              $body: #Block[
                                 $param: #NameExpr['k']
                                 $body: #Indexer[
                                    $recv: #NameExpr['ENV']
                                    $index: #List[
                                       $expression: #NameExpr['k']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@proxies']
                           $recv: #NameExpr['each']
                           $body: #Block[
                              $param: #NameExpr['k']
                              $body: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #NameExpr['ENV']
                                    $index: #List[
                                       $expression: #NameExpr['k']
                                    ]
                                 ]
                                 $right: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #Super['super']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #Self['self']
                              $recv: #NameExpr['class']
                           ]
                           $recv: #NameExpr['start_servers']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #ApplyExpr[
                                 $recv: #Self['self']
                                 $recv: #NameExpr['class']
                              ]
                              $name: #NameExpr['enable_yaml']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #ApplyExpr[
                                 $recv: #Self['self']
                                 $recv: #NameExpr['class']
                              ]
                              $name: #NameExpr['enable_zip']
                           ]
                           $right: #FalseExpr['false']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['base_server_uri']
                           $right: #StringExpr[
                              $inner: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #Self['self']
                                    $recv: #NameExpr['class']
                                 ]
                                 $recv: #NameExpr['normal_server_port']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@proxy_uri']
                           $right: #StringExpr[
                              $inner: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #Self['self']
                                    $recv: #NameExpr['class']
                                 ]
                                 $recv: #NameExpr['proxy_server_port']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@server_uri']
                           $right: #AddExpr[
                              $left: #NameExpr['base_server_uri']
                              $right: #StringExpr['/yaml']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@server_z_uri']
                           $right: #AddExpr[
                              $left: #NameExpr['base_server_uri']
                              $right: #StringExpr['/yaml.Z']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@gems_dir']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@tempdir']
                                 $expression: #StringExpr['gems']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@cache_dir']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['cache']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir']
                           $param: #List[
                              $expression: #NameExpr['@gems_dir']
                           ]
                        ]
                        $statement: #MultipleAssign[
                           $left: #MultipleLeftHandSideExpression[
                              $item: #NameExpr['@a1']
                              $item: #NameExpr['@a1_gem']
                           ]
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_gem']
                              $param: #List[
                                 $expression: #StringExpr['a']
                                 $expression: #StringExpr['1']
                              ]
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #LShiftExpr[
                                    $left: #ApplyExpr[
                                       $recv: #NameExpr['s']
                                       $recv: #NameExpr['executables']
                                    ]
                                    $right: #StringExpr['a_bin']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@a1']
                              $name: #NameExpr['loaded_from']
                           ]
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['specifications']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@a1']
                                    $recv: #NameExpr['full_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $name: #NameExpr['fetcher']
                           ]
                           $right: #Nil['nil']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['fetcher']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['teardown']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@fetcher']
                           $recv: #NameExpr['close_all']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #Self['self']
                              $recv: #NameExpr['class']
                           ]
                           $recv: #NameExpr['stop_servers']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #Super['super']
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #ApplyExpr[
                                 $recv: #NameExpr['Gem']
                                 $recv: #NameExpr['configuration']
                              ]
                              $index: #List[
                                 $expression: #NameExpr['http_proxy']
                              ]
                           ]
                           $right: #Nil['nil']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@proxies']
                           $recv: #NameExpr['each_with_index']
                           $body: #Block[
                              $param: #MultipleLeftHandSideExpression[
                                 $item: #NameExpr['k']
                                 $item: #NameExpr['i']
                              ]
                              $body: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #NameExpr['ENV']
                                    $index: #List[
                                       $expression: #NameExpr['k']
                                    ]
                                 ]
                                 $right: #Indexer[
                                    $recv: #NameExpr['@old_proxies']
                                    $index: #List[
                                       $expression: #NameExpr['i']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_self_fetcher']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['fetcher']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_nil']
                           $param: #List[
                              $expression: #NameExpr['fetcher']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_kind_of']
                           $param: #List[
                              $expression: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $expression: #NameExpr['fetcher']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_self_fetcher_with_proxy']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['proxy_uri']
                           $right: #StringExpr['http://proxy.example.com']
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #ApplyExpr[
                                 $recv: #NameExpr['Gem']
                                 $recv: #NameExpr['configuration']
                              ]
                              $index: #List[
                                 $expression: #NameExpr['http_proxy']
                              ]
                           ]
                           $right: #NameExpr['proxy_uri']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $name: #NameExpr['fetcher']
                           ]
                           $right: #Nil['nil']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['fetcher']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_nil']
                           $param: #List[
                              $expression: #NameExpr['fetcher']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_kind_of']
                           $param: #List[
                              $expression: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $expression: #NameExpr['fetcher']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['proxy_uri']
                              $expression: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['fetcher']
                                    $recv: #NameExpr['instance_variable_get']
                                    $param: #List[
                                       $expression: #NameExpr['@proxy']
                                    ]
                                 ]
                                 $recv: #NameExpr['to_s']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_fetch_size_bad_uri']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #NameExpr['fetcher']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['e']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_raises']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['ArgumentError']
                                    $body: #Block[
                                       $body: #ApplyExpr[
                                          $base: #NameExpr['fetcher']
                                          $recv: #NameExpr['fetch_size']
                                          $param: #List[
                                             $expression: #StringExpr['gems.example.com/yaml']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['uri scheme is invalid: nil']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['message']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_fetch_size_socket_error']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #NameExpr['fetcher']
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['fetcher']
                           $name: #NameExpr['request']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['uri']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['request_class']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['last_modified']
                                 $default: #Nil['nil']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['raise']
                                 $param: #List[
                                    $expression: #NameExpr['SocketError']
                                    $expression: #StringExpr['tarded']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['uri']
                           $right: #StringExpr['http://gems.example.com/yaml']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['e']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_raises']
                              $param: #List[
                                 $expression: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['RemoteFetcher']
                                    ]
                                    $name: #NameExpr['FetchError']
                                 ]
                              ]
                              $body: #Block[
                                 $body: #ApplyExpr[
                                    $base: #NameExpr['fetcher']
                                    $recv: #NameExpr['fetch_size']
                                    $param: #List[
                                       $expression: #NameExpr['uri']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #NameExpr['uri']
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['message']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_no_proxy']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['use_ui']
                        $param: #List[
                           $expression: #NameExpr['@ui']
                        ]
                        $body: #Block[
                           $body: #List[
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_data_from_server']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@fetcher']
                                       $recv: #NameExpr['fetch_path']
                                       $param: #List[
                                          $expression: #NameExpr['@server_uri']
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_equal']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['SERVER_DATA']
                                       $recv: #NameExpr['size']
                                    ]
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@fetcher']
                                       $recv: #NameExpr['fetch_size']
                                       $param: #List[
                                          $expression: #NameExpr['@server_uri']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_api_endpoint']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['uri']
                           $right: #ApplyExpr[
                              $base: #NameExpr['URI']
                              $recv: #NameExpr['parse']
                              $param: #List[
                                 $expression: #StringExpr['http://example.com/foo']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['target']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['MiniTest']
                                 $name: #NameExpr['Mock']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['target']
                           $recv: #NameExpr['expect']
                           $param: #List[
                              $expression: #NameExpr['target']
                              $expression: #StringExpr['gems.example.com']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['dns']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['MiniTest']
                                 $name: #NameExpr['Mock']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['dns']
                           $recv: #NameExpr['expect']
                           $param: #List[
                              $expression: #NameExpr['getresource']
                              $expression: #NameExpr['target']
                              $expression: #Array[
                                 $index: #List[
                                    $expression: #NameExpr['String']
                                    $expression: #NameExpr['Object']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetch']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #NameExpr['dns']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['URI']
                                 $recv: #NameExpr['parse']
                                 $param: #List[
                                    $expression: #StringExpr['http://gems.example.com/foo']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['fetch']
                                 $recv: #NameExpr['api_endpoint']
                                 $param: #List[
                                    $expression: #NameExpr['uri']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['target']
                           $recv: #NameExpr['verify']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['dns']
                           $recv: #NameExpr['verify']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_api_endpoint_ignores_trans_domain_values']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['uri']
                           $right: #ApplyExpr[
                              $base: #NameExpr['URI']
                              $recv: #NameExpr['parse']
                              $param: #List[
                                 $expression: #StringExpr['http://gems.example.com/foo']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['target']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['MiniTest']
                                 $name: #NameExpr['Mock']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['target']
                           $recv: #NameExpr['expect']
                           $param: #List[
                              $expression: #NameExpr['target']
                              $expression: #StringExpr['blah.com']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['dns']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['MiniTest']
                                 $name: #NameExpr['Mock']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['dns']
                           $recv: #NameExpr['expect']
                           $param: #List[
                              $expression: #NameExpr['getresource']
                              $expression: #NameExpr['target']
                              $expression: #Array[
                                 $index: #List[
                                    $expression: #NameExpr['String']
                                    $expression: #NameExpr['Object']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetch']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #NameExpr['dns']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['URI']
                                 $recv: #NameExpr['parse']
                                 $param: #List[
                                    $expression: #StringExpr['http://gems.example.com/foo']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['fetch']
                                 $recv: #NameExpr['api_endpoint']
                                 $param: #List[
                                    $expression: #NameExpr['uri']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['target']
                           $recv: #NameExpr['verify']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['dns']
                           $recv: #NameExpr['verify']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_api_endpoint_ignores_trans_domain_values_that_starts_with_original']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['uri']
                           $right: #ApplyExpr[
                              $base: #NameExpr['URI']
                              $recv: #NameExpr['parse']
                              $param: #List[
                                 $expression: #StringExpr['http://example.com/foo']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['target']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['MiniTest']
                                 $name: #NameExpr['Mock']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['target']
                           $recv: #NameExpr['expect']
                           $param: #List[
                              $expression: #NameExpr['target']
                              $expression: #StringExpr['example.combadguy.com']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['dns']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['MiniTest']
                                 $name: #NameExpr['Mock']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['dns']
                           $recv: #NameExpr['expect']
                           $param: #List[
                              $expression: #NameExpr['getresource']
                              $expression: #NameExpr['target']
                              $expression: #Array[
                                 $index: #List[
                                    $expression: #NameExpr['String']
                                    $expression: #NameExpr['Object']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetch']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #NameExpr['dns']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['URI']
                                 $recv: #NameExpr['parse']
                                 $param: #List[
                                    $expression: #StringExpr['http://example.com/foo']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['fetch']
                                 $recv: #NameExpr['api_endpoint']
                                 $param: #List[
                                    $expression: #NameExpr['uri']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['target']
                           $recv: #NameExpr['verify']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['dns']
                           $recv: #NameExpr['verify']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_api_endpoint_ignores_trans_domain_values_that_end_with_original']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['uri']
                           $right: #ApplyExpr[
                              $base: #NameExpr['URI']
                              $recv: #NameExpr['parse']
                              $param: #List[
                                 $expression: #StringExpr['http://example.com/foo']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['target']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['MiniTest']
                                 $name: #NameExpr['Mock']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['target']
                           $recv: #NameExpr['expect']
                           $param: #List[
                              $expression: #NameExpr['target']
                              $expression: #StringExpr['badexample.com']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['dns']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['MiniTest']
                                 $name: #NameExpr['Mock']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['dns']
                           $recv: #NameExpr['expect']
                           $param: #List[
                              $expression: #NameExpr['getresource']
                              $expression: #NameExpr['target']
                              $expression: #Array[
                                 $index: #List[
                                    $expression: #NameExpr['String']
                                    $expression: #NameExpr['Object']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetch']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #NameExpr['dns']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['URI']
                                 $recv: #NameExpr['parse']
                                 $param: #List[
                                    $expression: #StringExpr['http://example.com/foo']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['fetch']
                                 $recv: #NameExpr['api_endpoint']
                                 $param: #List[
                                    $expression: #NameExpr['uri']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['target']
                           $recv: #NameExpr['verify']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['dns']
                           $recv: #NameExpr['verify']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_api_endpoint_timeout_warning']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['uri']
                           $right: #ApplyExpr[
                              $base: #NameExpr['URI']
                              $recv: #NameExpr['parse']
                              $param: #List[
                                 $expression: #StringExpr['http://gems.example.com/foo']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['dns']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['MiniTest']
                                 $name: #NameExpr['Mock']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['dns']
                           $name: #NameExpr['getresource']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['arg']
                              ]
                              $param: #VariadicParam[
                                 $name: #NameExpr['rest']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['raise']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #Field[
                                          $recv: #NameExpr['Resolv']
                                          $name: #NameExpr['ResolvError']
                                       ]
                                       $recv: #NameExpr['new']
                                       $param: #List[
                                          $expression: #StringExpr['timeout!']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetch']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #NameExpr['dns']
                              ]
                           ]
                        ]
                        $statement: #ExceptionBlock[
                           $main: #List[
                              $statement: #MultipleAssign[
                                 $left: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['old_verbose']
                                    $item: #Field[
                                       $base: #ApplyExpr[
                                          $recv: #NameExpr['Gem']
                                          $recv: #NameExpr['configuration']
                                       ]
                                       $name: #NameExpr['verbose']
                                    ]
                                 ]
                                 $right: #MultipleRightHandSideExpression[
                                    $expression: #ApplyExpr[
                                       $recv: #ApplyExpr[
                                          $recv: #NameExpr['Gem']
                                          $recv: #NameExpr['configuration']
                                       ]
                                       $recv: #NameExpr['verbose']
                                    ]
                                    $expression: #IntExpr['1']
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['endpoint']
                                 $right: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['use_ui']
                                    $param: #List[
                                       $expression: #NameExpr['@ui']
                                    ]
                                    $body: #Block[
                                       $body: #ApplyExpr[
                                          $recv: #NameExpr['fetch']
                                          $recv: #NameExpr['api_endpoint']
                                          $param: #List[
                                             $expression: #NameExpr['uri']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $ensure: #AssignExpr[
                              $left: #Field[
                                 $base: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['configuration']
                                 ]
                                 $name: #NameExpr['verbose']
                              ]
                              $right: #NameExpr['old_verbose']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['uri']
                              $expression: #NameExpr['endpoint']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['Getting SRV record failed: timeout!\\n']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@ui']
                                 $recv: #NameExpr['output']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['dns']
                           $recv: #NameExpr['verify']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_cache_update_path']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['uri']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['URI']
                              $param: #List[
                                 $expression: #StringExpr['http://example/file']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['path']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@tempdir']
                                 $expression: #StringExpr['file']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_fuck_with_fetcher']
                              $param: #List[
                                 $expression: #StringExpr['hello']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['data']
                           $right: #ApplyExpr[
                              $base: #NameExpr['fetcher']
                              $recv: #NameExpr['cache_update_path']
                              $param: #List[
                                 $expression: #NameExpr['uri']
                                 $expression: #NameExpr['path']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['hello']
                              $expression: #NameExpr['data']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['hello']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['read']
                                 $param: #List[
                                    $expression: #NameExpr['path']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_cache_update_path_no_update']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['uri']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['URI']
                              $param: #List[
                                 $expression: #StringExpr['http://example/file']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['path']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@tempdir']
                                 $expression: #StringExpr['file']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_fuck_with_fetcher']
                              $param: #List[
                                 $expression: #StringExpr['hello']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['data']
                           $right: #ApplyExpr[
                              $base: #NameExpr['fetcher']
                              $recv: #NameExpr['cache_update_path']
                              $param: #List[
                                 $expression: #NameExpr['uri']
                                 $expression: #NameExpr['path']
                                 $expression: #FalseExpr['false']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['hello']
                              $expression: #NameExpr['data']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $expression: #NameExpr['path']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['util_fuck_with_fetcher']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['data']
                     ]
                     $param: #OptionalParam[
                        $name: #NameExpr['blow']
                        $default: #FalseExpr['false']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['fetcher']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['fetcher']
                           $recv: #NameExpr['instance_variable_set']
                           $param: #List[
                              $expression: #NameExpr['@test_data']
                              $expression: #NameExpr['data']
                           ]
                        ]
                        $statement: #Unless[
                           $cond: #NameExpr['blow']
                           $then: #SFuncDecl[
                              $path: #NameExpr['fetcher']
                              $name: #NameExpr['fetch_path']
                              $param: #List[
                                 $param: #Param[
                                    $param: #NameExpr['arg']
                                 ]
                                 $param: #VariadicParam[
                                    $name: #NameExpr['rest']
                                 ]
                              ]
                              $body: #BlockExpr[
                                 $main: #List[
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['@test_arg']
                                       $right: #NameExpr['arg']
                                    ]
                                    $statement: #NameExpr['@test_data']
                                 ]
                              ]
                           ]
                           $else: #SFuncDecl[
                              $path: #NameExpr['fetcher']
                              $name: #NameExpr['fetch_path']
                              $param: #List[
                                 $param: #Param[
                                    $param: #NameExpr['arg']
                                 ]
                                 $param: #VariadicParam[
                                    $name: #NameExpr['rest']
                                 ]
                              ]
                              $body: #BlockExpr[
                                 $main: #List[
                                    $statement: #SClass[
                                       $path: #Self['self']
                                       $body: #BlockExpr[
                                          $main: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['remove_method']
                                             $param: #List[
                                                $expression: #NameExpr['fetch_path']
                                             ]
                                          ]
                                       ]
                                    ]
                                    $statement: #SFuncDecl[
                                       $path: #Self['self']
                                       $name: #NameExpr['fetch_path']
                                       $param: #List[
                                          $param: #Param[
                                             $param: #NameExpr['arg']
                                          ]
                                          $param: #VariadicParam[
                                             $name: #NameExpr['rest']
                                          ]
                                       ]
                                       $body: #BlockExpr[
                                          $main: #List[
                                             $statement: #AssignExpr[
                                                $left: #NameExpr['@test_arg']
                                                $right: #NameExpr['arg']
                                             ]
                                             $statement: #NameExpr['@test_data']
                                          ]
                                       ]
                                    ]
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #ApplyExpr[
                                             $recv: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['Gem']
                                                   $name: #NameExpr['RemoteFetcher']
                                                ]
                                                $name: #NameExpr['FetchError']
                                             ]
                                             $recv: #NameExpr['new']
                                             $param: #List[
                                                $expression: #StringExpr['haha!']
                                                $expression: #Nil['nil']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #NameExpr['fetcher']
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_download']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['a1_data']
                           $right: #Nil['nil']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['File']
                           $recv: #NameExpr['open']
                           $param: #List[
                              $expression: #NameExpr['@a1_gem']
                              $expression: #StringExpr['rb']
                           ]
                           $body: #Block[
                              $param: #NameExpr['fp']
                              $body: #AssignExpr[
                                 $left: #NameExpr['a1_data']
                                 $right: #ApplyExpr[
                                    $recv: #NameExpr['fp']
                                    $recv: #NameExpr['read']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_fuck_with_fetcher']
                              $param: #List[
                                 $expression: #NameExpr['a1_data']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['a1_cache_gem']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['@a1']
                              $recv: #NameExpr['cache_file']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['a1_cache_gem']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['fetcher']
                                 $recv: #NameExpr['download']
                                 $param: #List[
                                    $expression: #NameExpr['@a1']
                                    $expression: #StringExpr['http://gems.example.com']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['http://gems.example.com/gems/a-1.gem']
                              $expression: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['fetcher']
                                    $recv: #NameExpr['instance_variable_get']
                                    $param: #List[
                                       $expression: #NameExpr['@test_arg']
                                    ]
                                 ]
                                 $recv: #NameExpr['to_s']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['exist?']
                                 $param: #List[
                                    $expression: #NameExpr['a1_cache_gem']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_download_with_auth']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['a1_data']
                           $right: #Nil['nil']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['File']
                           $recv: #NameExpr['open']
                           $param: #List[
                              $expression: #NameExpr['@a1_gem']
                              $expression: #StringExpr['rb']
                           ]
                           $body: #Block[
                              $param: #NameExpr['fp']
                              $body: #AssignExpr[
                                 $left: #NameExpr['a1_data']
                                 $right: #ApplyExpr[
                                    $recv: #NameExpr['fp']
                                    $recv: #NameExpr['read']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_fuck_with_fetcher']
                              $param: #List[
                                 $expression: #NameExpr['a1_data']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['a1_cache_gem']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['@a1']
                              $recv: #NameExpr['cache_file']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['a1_cache_gem']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['fetcher']
                                 $recv: #NameExpr['download']
                                 $param: #List[
                                    $expression: #NameExpr['@a1']
                                    $expression: #StringExpr['http://user:password@gems.example.com']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['http://user:password@gems.example.com/gems/a-1.gem']
                              $expression: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['fetcher']
                                    $recv: #NameExpr['instance_variable_get']
                                    $param: #List[
                                       $expression: #NameExpr['@test_arg']
                                    ]
                                 ]
                                 $recv: #NameExpr['to_s']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['exist?']
                                 $param: #List[
                                    $expression: #NameExpr['a1_cache_gem']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_download_with_encoded_auth']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['a1_data']
                           $right: #Nil['nil']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['File']
                           $recv: #NameExpr['open']
                           $param: #List[
                              $expression: #NameExpr['@a1_gem']
                              $expression: #StringExpr['rb']
                           ]
                           $body: #Block[
                              $param: #NameExpr['fp']
                              $body: #AssignExpr[
                                 $left: #NameExpr['a1_data']
                                 $right: #ApplyExpr[
                                    $recv: #NameExpr['fp']
                                    $recv: #NameExpr['read']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_fuck_with_fetcher']
                              $param: #List[
                                 $expression: #NameExpr['a1_data']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['a1_cache_gem']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['@a1']
                              $recv: #NameExpr['cache_file']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['a1_cache_gem']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['fetcher']
                                 $recv: #NameExpr['download']
                                 $param: #List[
                                    $expression: #NameExpr['@a1']
                                    $expression: #StringExpr['http://user:%25pas%25sword@gems.example.com']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['http://user:%25pas%25sword@gems.example.com/gems/a-1.gem']
                              $expression: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['fetcher']
                                    $recv: #NameExpr['instance_variable_get']
                                    $param: #List[
                                       $expression: #NameExpr['@test_arg']
                                    ]
                                 ]
                                 $recv: #NameExpr['to_s']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['exist?']
                                 $param: #List[
                                    $expression: #NameExpr['a1_cache_gem']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_download_cached']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mv']
                           $param: #List[
                              $expression: #NameExpr['@a1_gem']
                              $expression: #NameExpr['@cache_dir']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['inst']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['fetcher']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@a1']
                                 $recv: #NameExpr['cache_file']
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['inst']
                                 $recv: #NameExpr['download']
                                 $param: #List[
                                    $expression: #NameExpr['@a1']
                                    $expression: #StringExpr['http://gems.example.com']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_download_local']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mv']
                           $param: #List[
                              $expression: #NameExpr['@a1_gem']
                              $expression: #NameExpr['@tempdir']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['local_path']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@tempdir']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@a1']
                                    $recv: #NameExpr['file_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['inst']
                           $right: #Nil['nil']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['chdir']
                           $param: #List[
                              $expression: #NameExpr['@tempdir']
                           ]
                           $body: #Block[
                              $body: #AssignExpr[
                                 $left: #NameExpr['inst']
                                 $right: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['RemoteFetcher']
                                    ]
                                    $recv: #NameExpr['fetcher']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@a1']
                                 $recv: #NameExpr['cache_file']
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['inst']
                                 $recv: #NameExpr['download']
                                 $param: #List[
                                    $expression: #NameExpr['@a1']
                                    $expression: #NameExpr['local_path']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_download_local_space']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['space_path']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@tempdir']
                                 $expression: #StringExpr['space path']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir']
                           $param: #List[
                              $expression: #NameExpr['space_path']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mv']
                           $param: #List[
                              $expression: #NameExpr['@a1_gem']
                              $expression: #NameExpr['space_path']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['local_path']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['space_path']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@a1']
                                    $recv: #NameExpr['file_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['inst']
                           $right: #Nil['nil']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['chdir']
                           $param: #List[
                              $expression: #NameExpr['@tempdir']
                           ]
                           $body: #Block[
                              $body: #AssignExpr[
                                 $left: #NameExpr['inst']
                                 $right: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['RemoteFetcher']
                                    ]
                                    $recv: #NameExpr['fetcher']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@a1']
                                 $recv: #NameExpr['cache_file']
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['inst']
                                 $recv: #NameExpr['download']
                                 $param: #List[
                                    $expression: #NameExpr['@a1']
                                    $expression: #NameExpr['local_path']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_download_install_dir']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['a1_data']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['open']
                              $param: #List[
                                 $expression: #NameExpr['@a1_gem']
                                 $expression: #StringExpr['rb']
                              ]
                              $body: #Block[
                                 $param: #NameExpr['fp']
                                 $body: #ApplyExpr[
                                    $recv: #NameExpr['fp']
                                    $recv: #NameExpr['read']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_fuck_with_fetcher']
                              $param: #List[
                                 $expression: #NameExpr['a1_data']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['install_dir']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@tempdir']
                                 $expression: #StringExpr['more_gems']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['a1_cache_gem']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['install_dir']
                                 $expression: #StringExpr['cache']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@a1']
                                    $recv: #NameExpr['file_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir_p']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['dirname']
                                 $param: #List[
                                    $expression: #NameExpr['a1_cache_gem']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['actual']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['fetcher']
                              $recv: #NameExpr['download']
                              $param: #List[
                                 $expression: #NameExpr['@a1']
                                 $expression: #StringExpr['http://gems.example.com']
                                 $expression: #NameExpr['install_dir']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['a1_cache_gem']
                              $expression: #NameExpr['actual']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['http://gems.example.com/gems/a-1.gem']
                              $expression: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['fetcher']
                                    $recv: #NameExpr['instance_variable_get']
                                    $param: #List[
                                       $expression: #NameExpr['@test_arg']
                                    ]
                                 ]
                                 $recv: #NameExpr['to_s']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['exist?']
                                 $param: #List[
                                    $expression: #NameExpr['a1_cache_gem']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #Unless[
                  $cond: #ApplyExpr[
                     #Self['self']
                     $recv: #NameExpr['win_platform?']
                  ]
                  $then: #List[
                     $statement: #FuncDecl[
                        $name: #NameExpr['test_download_local_read_only']
                        $param: #List['']
                        $body: #BlockExpr[
                           $main: #List[
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['FileUtils']
                                 $recv: #NameExpr['mv']
                                 $param: #List[
                                    $expression: #NameExpr['@a1_gem']
                                    $expression: #NameExpr['@tempdir']
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['local_path']
                                 $right: #ApplyExpr[
                                    $base: #NameExpr['File']
                                    $recv: #NameExpr['join']
                                    $param: #List[
                                       $expression: #NameExpr['@tempdir']
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['@a1']
                                          $recv: #NameExpr['file_name']
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['inst']
                                 $right: #Nil['nil']
                              ]
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['FileUtils']
                                 $recv: #NameExpr['chmod']
                                 $param: #List[
                                    $expression: #OctalInteger['0555']
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@a1']
                                       $recv: #NameExpr['cache_dir']
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['Dir']
                                 $recv: #NameExpr['chdir']
                                 $param: #List[
                                    $expression: #NameExpr['@tempdir']
                                 ]
                                 $body: #Block[
                                    $body: #AssignExpr[
                                       $left: #NameExpr['inst']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #NameExpr['Gem']
                                             $name: #NameExpr['RemoteFetcher']
                                          ]
                                          $recv: #NameExpr['fetcher']
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_equal']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['File']
                                       $recv: #NameExpr['join']
                                       $param: #List[
                                          $expression: #NameExpr['@tempdir']
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['@a1']
                                             $recv: #NameExpr['file_name']
                                          ]
                                       ]
                                    ]
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['inst']
                                       $recv: #NameExpr['download']
                                       $param: #List[
                                          $expression: #NameExpr['@a1']
                                          $expression: #NameExpr['local_path']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $ensure: #ApplyExpr[
                              $base: #NameExpr['FileUtils']
                              $recv: #NameExpr['chmod']
                              $param: #List[
                                 $expression: #OctalInteger['0755']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@a1']
                                    $recv: #NameExpr['cache_dir']
                                 ]
                              ]
                           ]
                        ]
                     ]
                     $statement: #FuncDecl[
                        $name: #NameExpr['test_download_read_only']
                        $param: #List['']
                        $body: #BlockExpr[
                           $main: #List[
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['FileUtils']
                                 $recv: #NameExpr['chmod']
                                 $param: #List[
                                    $expression: #OctalInteger['0555']
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@a1']
                                       $recv: #NameExpr['cache_dir']
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['FileUtils']
                                 $recv: #NameExpr['chmod']
                                 $param: #List[
                                    $expression: #OctalInteger['0555']
                                    $expression: #NameExpr['@gemhome']
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['fetcher']
                                 $right: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['util_fuck_with_fetcher']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['File']
                                          $recv: #NameExpr['read']
                                          $param: #List[
                                             $expression: #NameExpr['@a1_gem']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $recv: #NameExpr['fetcher']
                                 $recv: #NameExpr['download']
                                 $param: #List[
                                    $expression: #NameExpr['@a1']
                                    $expression: #StringExpr['http://gems.example.com']
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['a1_cache_gem']
                                 $right: #ApplyExpr[
                                    $base: #NameExpr['File']
                                    $recv: #NameExpr['join']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['Gem']
                                          $recv: #NameExpr['user_dir']
                                       ]
                                       $expression: #StringExpr['cache']
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['@a1']
                                          $recv: #NameExpr['file_name']
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert']
                                 $param: #List[
                                    $command: #ApplyExpr[
                                       $base: #NameExpr['File']
                                       $recv: #NameExpr['exist?']
                                       $param: #List[
                                          $expression: #NameExpr['a1_cache_gem']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $ensure: #List[
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['FileUtils']
                                 $recv: #NameExpr['chmod']
                                 $param: #List[
                                    $expression: #OctalInteger['0755']
                                    $expression: #NameExpr['@gemhome']
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['FileUtils']
                                 $recv: #NameExpr['chmod']
                                 $param: #List[
                                    $expression: #OctalInteger['0755']
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@a1']
                                       $recv: #NameExpr['cache_dir']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_download_platform_legacy']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['original_platform']
                           $right: #StringExpr['old-platform']
                        ]
                        $statement: #MultipleAssign[
                           $left: #MultipleLeftHandSideExpression[
                              $item: #NameExpr['e1']
                              $item: #NameExpr['e1_gem']
                           ]
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_gem']
                              $param: #List[
                                 $expression: #StringExpr['e']
                                 $expression: #StringExpr['1']
                              ]
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['platform']
                                       ]
                                       $right: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['Gem']
                                             $name: #NameExpr['Platform']
                                          ]
                                          $name: #NameExpr['CURRENT']
                                       ]
                                    ]
                                    $statement: #ApplyExpr[
                                       $base: #NameExpr['s']
                                       $recv: #NameExpr['instance_variable_set']
                                       $param: #List[
                                          $expression: #NameExpr['@original_platform']
                                          $expression: #NameExpr['original_platform']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['e1']
                              $name: #NameExpr['loaded_from']
                           ]
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['specifications']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['e1']
                                    $recv: #NameExpr['full_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['e1_data']
                           $right: #Nil['nil']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['File']
                           $recv: #NameExpr['open']
                           $param: #List[
                              $expression: #NameExpr['e1_gem']
                              $expression: #StringExpr['rb']
                           ]
                           $body: #Block[
                              $param: #NameExpr['fp']
                              $body: #AssignExpr[
                                 $left: #NameExpr['e1_data']
                                 $right: #ApplyExpr[
                                    $recv: #NameExpr['fp']
                                    $recv: #NameExpr['read']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_fuck_with_fetcher']
                              $param: #List[
                                 $expression: #NameExpr['e1_data']
                                 $expression: #NameExpr['blow_chunks']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['e1_cache_gem']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['e1']
                              $recv: #NameExpr['cache_file']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['e1_cache_gem']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['fetcher']
                                 $recv: #NameExpr['download']
                                 $param: #List[
                                    $expression: #NameExpr['e1']
                                    $expression: #StringExpr['http://gems.example.com']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #ApplyExpr[
                                    $recv: #NameExpr['e1']
                                    $recv: #NameExpr['original_name']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['fetcher']
                                    $recv: #NameExpr['instance_variable_get']
                                    $param: #List[
                                       $expression: #NameExpr['@test_arg']
                                    ]
                                 ]
                                 $recv: #NameExpr['to_s']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['exist?']
                                 $param: #List[
                                    $expression: #NameExpr['e1_cache_gem']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_download_same_file']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mv']
                           $param: #List[
                              $expression: #NameExpr['@a1_gem']
                              $expression: #NameExpr['@tempdir']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['local_path']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@tempdir']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@a1']
                                    $recv: #NameExpr['file_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['inst']
                           $right: #Nil['nil']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['chdir']
                           $param: #List[
                              $expression: #NameExpr['@tempdir']
                           ]
                           $body: #Block[
                              $body: #AssignExpr[
                                 $left: #NameExpr['inst']
                                 $right: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['RemoteFetcher']
                                    ]
                                    $recv: #NameExpr['fetcher']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['cache_path']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['@a1']
                              $recv: #NameExpr['cache_file']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mv']
                           $param: #List[
                              $expression: #NameExpr['local_path']
                              $expression: #NameExpr['cache_path']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gem']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Package']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #NameExpr['cache_path']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['cache_path']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['inst']
                                 $recv: #NameExpr['download']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['gem']
                                       $recv: #NameExpr['spec']
                                    ]
                                    $expression: #NameExpr['cache_path']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_download_unsupported']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['inst']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['fetcher']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['e']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_raises']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['ArgumentError']
                                    $body: #Block[
                                       $body: #ApplyExpr[
                                          $base: #NameExpr['inst']
                                          $recv: #NameExpr['download']
                                          $param: #List[
                                             $expression: #NameExpr['@a1']
                                             $expression: #StringExpr['ftp://gems.rubyforge.org']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['unsupported URI scheme ftp']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['message']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_download_to_cache']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #MultipleAssign[
                           $left: #MultipleLeftHandSideExpression[
                              $item: #NameExpr['@a2']
                              $item: #NameExpr['@a2_gem']
                           ]
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_gem']
                              $param: #List[
                                 $expression: #StringExpr['a']
                                 $expression: #StringExpr['2']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_setup_spec_fetcher']
                           $param: #List[
                              $expression: #NameExpr['@a1']
                              $expression: #NameExpr['@a2']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@fetcher']
                           $recv: #NameExpr['instance_variable_set']
                           $param: #List[
                              $expression: #NameExpr['@a1']
                              $expression: #NameExpr['@a1']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@fetcher']
                           $recv: #NameExpr['instance_variable_set']
                           $param: #List[
                              $expression: #NameExpr['@a2']
                              $expression: #NameExpr['@a2']
                           ]
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['@fetcher']
                           $name: #NameExpr['fetch_path']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['uri']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['mtime']
                                 $default: #Nil['nil']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['head']
                                 $default: #FalseExpr['false']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #Case[
                                 $cond: #ApplyExpr[
                                    $recv: #NameExpr['uri']
                                    $recv: #NameExpr['request_uri']
                                 ]
                                 $body: #List[
                                    $when: #When[
                                       $cond: #List[
                                          $expression: #Regex['/#{@a1.spec_name}/']
                                       ]
                                       $then: #ApplyExpr[
                                          $base: #NameExpr['Gem']
                                          $recv: #NameExpr['deflate']
                                          $param: #List[
                                             $command: #ApplyExpr[
                                                $base: #NameExpr['Marshal']
                                                $recv: #NameExpr['dump']
                                                $param: #List[
                                                   $expression: #NameExpr['@a1']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                    $when: #When[
                                       $cond: #List[
                                          $expression: #Regex['/#{@a2.spec_name}/']
                                       ]
                                       $then: #ApplyExpr[
                                          $base: #NameExpr['Gem']
                                          $recv: #NameExpr['deflate']
                                          $param: #List[
                                             $command: #ApplyExpr[
                                                $base: #NameExpr['Marshal']
                                                $recv: #NameExpr['dump']
                                                $param: #List[
                                                   $expression: #NameExpr['@a2']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $else: #ApplyExpr[
                                    $recv: #NameExpr['uri']
                                    $recv: #NameExpr['to_s']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gem']
                           $right: #ApplyExpr[
                              $base: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #NameExpr['Gem']
                                    $name: #NameExpr['RemoteFetcher']
                                 ]
                                 $recv: #NameExpr['fetcher']
                              ]
                              $recv: #NameExpr['download_to_cache']
                              $param: #List[
                                 $command: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['dep']
                                    $param: #List[
                                       $expression: #StringExpr['a']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@a2']
                                 $recv: #NameExpr['file_name']
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['basename']
                                 $param: #List[
                                    $expression: #NameExpr['gem']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_fetch_path_gzip']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #NameExpr['fetcher']
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['fetcher']
                           $name: #NameExpr['fetch_http']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['uri']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['mtime']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['head']
                                 $default: #Nil['nil']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 $base: #NameExpr['Gem']
                                 $recv: #NameExpr['gzip']
                                 $param: #List[
                                    $expression: #StringExpr['foo']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['foo']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['fetcher']
                                 $recv: #NameExpr['fetch_path']
                                 $param: #List[
                                    $expression: #AddExpr[
                                       $left: #NameExpr['@uri']
                                       $right: #StringExpr['foo.gz']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_fetch_path_gzip_unmodified']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #NameExpr['fetcher']
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['fetcher']
                           $name: #NameExpr['fetch_http']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['uri']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['mtime']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['head']
                                 $default: #Nil['nil']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #Nil['nil']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #Nil['nil']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['fetcher']
                                 $recv: #NameExpr['fetch_path']
                                 $param: #List[
                                    $expression: #AddExpr[
                                       $left: #NameExpr['@uri']
                                       $right: #StringExpr['foo.gz']
                                    ]
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['Time']
                                       $recv: #NameExpr['at']
                                       $param: #List[
                                          $expression: #IntExpr['0']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_fetch_path_io_error']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #NameExpr['fetcher']
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['fetcher']
                           $name: #NameExpr['fetch_http']
                           $param: #List[
                              $param: #VariadicParam['*']
                           ]
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['raise']
                                 $param: #List[
                                    $expression: #NameExpr['EOFError']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['url']
                           $right: #StringExpr['http://example.com/uri']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['e']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_raises']
                              $param: #List[
                                 $expression: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['RemoteFetcher']
                                    ]
                                    $name: #NameExpr['FetchError']
                                 ]
                              ]
                              $body: #Block[
                                 $body: #ApplyExpr[
                                    $base: #NameExpr['fetcher']
                                    $recv: #NameExpr['fetch_path']
                                    $param: #List[
                                       $expression: #NameExpr['url']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #NameExpr['url']
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['message']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['url']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['uri']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_fetch_path_socket_error']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #NameExpr['fetcher']
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['fetcher']
                           $name: #NameExpr['fetch_http']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['uri']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['mtime']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['head']
                                 $default: #Nil['nil']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['raise']
                                 $param: #List[
                                    $expression: #NameExpr['SocketError']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['url']
                           $right: #StringExpr['http://example.com/uri']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['e']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_raises']
                              $param: #List[
                                 $expression: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['RemoteFetcher']
                                    ]
                                    $name: #NameExpr['FetchError']
                                 ]
                              ]
                              $body: #Block[
                                 $body: #ApplyExpr[
                                    $base: #NameExpr['fetcher']
                                    $recv: #NameExpr['fetch_path']
                                    $param: #List[
                                       $expression: #NameExpr['url']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #NameExpr['url']
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['message']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['url']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['uri']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_fetch_path_system_call_error']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #NameExpr['fetcher']
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['fetcher']
                           $name: #NameExpr['fetch_http']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['uri']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['mtime']
                                 $default: #Nil['nil']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['head']
                                 $default: #Nil['nil']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['raise']
                                 $param: #List[
                                    $expression: #Field[
                                       $recv: #NameExpr['Errno']
                                       $name: #NameExpr['ECONNREFUSED']
                                    ]
                                    $expression: #StringExpr['connect(2)']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['url']
                           $right: #StringExpr['http://example.com/uri']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['e']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_raises']
                              $param: #List[
                                 $expression: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['RemoteFetcher']
                                    ]
                                    $name: #NameExpr['FetchError']
                                 ]
                              ]
                              $body: #Block[
                                 $body: #ApplyExpr[
                                    $base: #NameExpr['fetcher']
                                    $recv: #NameExpr['fetch_path']
                                    $param: #List[
                                       $expression: #NameExpr['url']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #Regex['%r|ECONNREFUSED:.*connect\\(2\\) \\(#{Regexp.escape url}\\)\\z|']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['message']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['url']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['uri']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_fetch_path_unmodified']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #NameExpr['fetcher']
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['fetcher']
                           $name: #NameExpr['fetch_http']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['uri']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['mtime']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['head']
                                 $default: #Nil['nil']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #Nil['nil']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #Nil['nil']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['fetcher']
                                 $recv: #NameExpr['fetch_path']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['URI']
                                       $recv: #NameExpr['parse']
                                       $param: #List[
                                          $expression: #NameExpr['@gem_repo']
                                       ]
                                    ]
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['Time']
                                       $recv: #NameExpr['at']
                                       $param: #List[
                                          $expression: #IntExpr['0']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_implicit_no_proxy']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['use_ui']
                        $param: #List[
                           $expression: #NameExpr['@ui']
                        ]
                        $body: #Block[
                           $body: #List[
                              $statement: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #NameExpr['ENV']
                                    $index: #List[
                                       $expression: #StringExpr['http_proxy']
                                    ]
                                 ]
                                 $right: #StringExpr['http://fakeurl:12345']
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['fetcher']
                                 $right: #ApplyExpr[
                                    $base: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['RemoteFetcher']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #NameExpr['no_proxy']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['@fetcher']
                                 $right: #NameExpr['fetcher']
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_data_from_server']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['fetcher']
                                       $recv: #NameExpr['fetch_path']
                                       $param: #List[
                                          $expression: #NameExpr['@server_uri']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_implicit_proxy']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['use_ui']
                        $param: #List[
                           $expression: #NameExpr['@ui']
                        ]
                        $body: #Block[
                           $body: #List[
                              $statement: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #NameExpr['ENV']
                                    $index: #List[
                                       $expression: #StringExpr['http_proxy']
                                    ]
                                 ]
                                 $right: #NameExpr['@proxy_uri']
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['fetcher']
                                 $right: #ApplyExpr[
                                    $base: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['RemoteFetcher']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #Nil['nil']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['@fetcher']
                                 $right: #NameExpr['fetcher']
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_data_from_proxy']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['fetcher']
                                       $recv: #NameExpr['fetch_path']
                                       $param: #List[
                                          $expression: #NameExpr['@server_uri']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_implicit_upper_case_proxy']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['use_ui']
                        $param: #List[
                           $expression: #NameExpr['@ui']
                        ]
                        $body: #Block[
                           $body: #List[
                              $statement: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #NameExpr['ENV']
                                    $index: #List[
                                       $expression: #StringExpr['HTTP_PROXY']
                                    ]
                                 ]
                                 $right: #NameExpr['@proxy_uri']
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['fetcher']
                                 $right: #ApplyExpr[
                                    $base: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['RemoteFetcher']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #Nil['nil']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['@fetcher']
                                 $right: #NameExpr['fetcher']
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_data_from_proxy']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['fetcher']
                                       $recv: #NameExpr['fetch_path']
                                       $param: #List[
                                          $expression: #NameExpr['@server_uri']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_implicit_proxy_no_env']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['use_ui']
                        $param: #List[
                           $expression: #NameExpr['@ui']
                        ]
                        $body: #Block[
                           $body: #List[
                              $statement: #AssignExpr[
                                 $left: #NameExpr['fetcher']
                                 $right: #ApplyExpr[
                                    $base: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['RemoteFetcher']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #Nil['nil']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['@fetcher']
                                 $right: #NameExpr['fetcher']
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_data_from_server']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['fetcher']
                                       $recv: #NameExpr['fetch_path']
                                       $param: #List[
                                          $expression: #NameExpr['@server_uri']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_fetch_http']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #NameExpr['fetcher']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['url']
                           $right: #StringExpr['http://gems.example.com/redirect']
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['fetcher']
                           $name: #NameExpr['request']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['uri']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['request_class']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['last_modified']
                                 $default: #Nil['nil']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['url']
                                    $right: #StringExpr['http://gems.example.com/redirect']
                                 ]
                                 $statement: #Unless[
                                    $cond: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['defined?']
                                       $param: #List[
                                          $expression: #NameExpr['@requested']
                                       ]
                                    ]
                                    $then: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['@requested']
                                          $right: #TrueExpr['true']
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['res']
                                          $right: #ApplyExpr[
                                             $base: #Field[
                                                $recv: #NameExpr['Net']
                                                $name: #NameExpr['HTTPMovedPermanently']
                                             ]
                                             $recv: #NameExpr['new']
                                             $param: #List[
                                                $expression: #Nil['nil']
                                                $expression: #IntExpr['301']
                                                $expression: #Nil['nil']
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          $base: #NameExpr['res']
                                          $recv: #NameExpr['add_field']
                                          $param: #List[
                                             $expression: #StringExpr['Location']
                                             $expression: #NameExpr['url']
                                          ]
                                       ]
                                       $statement: #NameExpr['res']
                                    ]
                                    $else: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['res']
                                          $right: #ApplyExpr[
                                             $base: #Field[
                                                $recv: #NameExpr['Net']
                                                $name: #NameExpr['HTTPOK']
                                             ]
                                             $recv: #NameExpr['new']
                                             $param: #List[
                                                $expression: #Nil['nil']
                                                $expression: #IntExpr['200']
                                                $expression: #Nil['nil']
                                             ]
                                          ]
                                       ]
                                       $statement: #SFuncDecl[
                                          $path: #NameExpr['res']
                                          $name: #NameExpr['body']
                                          $param: #List['']
                                          $body: #BlockExpr[
                                             $main: #StringExpr['real_path']
                                          ]
                                       ]
                                       $statement: #NameExpr['res']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['data']
                           $right: #ApplyExpr[
                              $base: #NameExpr['fetcher']
                              $recv: #NameExpr['fetch_http']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['URI']
                                    $recv: #NameExpr['parse']
                                    $param: #List[
                                       $expression: #NameExpr['url']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['real_path']
                              $expression: #NameExpr['data']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_fetch_http_redirects']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #NameExpr['fetcher']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['url']
                           $right: #StringExpr['http://gems.example.com/redirect']
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['fetcher']
                           $name: #NameExpr['request']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['uri']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['request_class']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['last_modified']
                                 $default: #Nil['nil']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['url']
                                    $right: #StringExpr['http://gems.example.com/redirect']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['res']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Net']
                                          $name: #NameExpr['HTTPMovedPermanently']
                                       ]
                                       $recv: #NameExpr['new']
                                       $param: #List[
                                          $expression: #Nil['nil']
                                          $expression: #IntExpr['301']
                                          $expression: #Nil['nil']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $base: #NameExpr['res']
                                    $recv: #NameExpr['add_field']
                                    $param: #List[
                                       $expression: #StringExpr['Location']
                                       $expression: #NameExpr['url']
                                    ]
                                 ]
                                 $statement: #NameExpr['res']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['e']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_raises']
                              $param: #List[
                                 $expression: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['RemoteFetcher']
                                    ]
                                    $name: #NameExpr['FetchError']
                                 ]
                              ]
                              $body: #Block[
                                 $body: #ApplyExpr[
                                    $base: #NameExpr['fetcher']
                                    $recv: #NameExpr['fetch_http']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['URI']
                                          $recv: #NameExpr['parse']
                                          $param: #List[
                                             $expression: #NameExpr['url']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #NameExpr['url']
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['message']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_fetch_http_redirects_without_location']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #NameExpr['fetcher']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['url']
                           $right: #StringExpr['http://gems.example.com/redirect']
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['fetcher']
                           $name: #NameExpr['request']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['uri']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['request_class']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['last_modified']
                                 $default: #Nil['nil']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['res']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Net']
                                          $name: #NameExpr['HTTPMovedPermanently']
                                       ]
                                       $recv: #NameExpr['new']
                                       $param: #List[
                                          $expression: #Nil['nil']
                                          $expression: #IntExpr['301']
                                          $expression: #Nil['nil']
                                       ]
                                    ]
                                 ]
                                 $statement: #NameExpr['res']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['e']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_raises']
                              $param: #List[
                                 $expression: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['RemoteFetcher']
                                    ]
                                    $name: #NameExpr['FetchError']
                                 ]
                              ]
                              $body: #Block[
                                 $body: #ApplyExpr[
                                    $base: #NameExpr['fetcher']
                                    $recv: #NameExpr['fetch_http']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['URI']
                                          $recv: #NameExpr['parse']
                                          $param: #List[
                                             $expression: #NameExpr['url']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #NameExpr['url']
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['message']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_fetch_http_with_additional_headers']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['http_proxy']
                              ]
                           ]
                           $right: #NameExpr['@proxy_uri']
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['no_proxy']
                              ]
                           ]
                           $right: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #NameExpr['URI']
                                 $recv: #NameExpr['parse']
                                 $param: #List[
                                    $expression: #NameExpr['@server_uri']
                                 ]
                              ]
                              $recv: #NameExpr['host']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #Nil['nil']
                                 $expression: #List[
                                    $hash: #Hash[
                                       $key: #StringExpr['X-Captain']
                                       $value: #StringExpr['murphy']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #NameExpr['fetcher']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['murphy']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['fetcher']
                                 $recv: #NameExpr['fetch_path']
                                 $param: #List[
                                    $expression: #NameExpr['@server_uri']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_fetch_s3']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #NameExpr['fetcher']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['url']
                           $right: #StringExpr['s3://testuser:testpass@my-bucket/gems/specs.4.8.gz']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['$fetched_uri']
                           $right: #Nil['nil']
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['fetcher']
                           $name: #NameExpr['request']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['uri']
                              ]
                              $param: #Param[
                                 $param: #NameExpr['request_class']
                              ]
                              $param: #OptionalParam[
                                 $name: #NameExpr['last_modified']
                                 $default: #Nil['nil']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['$fetched_uri']
                                    $right: #NameExpr['uri']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['res']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Net']
                                          $name: #NameExpr['HTTPOK']
                                       ]
                                       $recv: #NameExpr['new']
                                       $param: #List[
                                          $expression: #Nil['nil']
                                          $expression: #IntExpr['200']
                                          $expression: #Nil['nil']
                                       ]
                                    ]
                                 ]
                                 $statement: #SFuncDecl[
                                    $path: #NameExpr['res']
                                    $name: #NameExpr['body']
                                    $param: #List['']
                                    $body: #BlockExpr[
                                       $main: #StringExpr['success']
                                    ]
                                 ]
                                 $statement: #NameExpr['res']
                              ]
                           ]
                        ]
                        $statement: #SFuncDecl[
                           $path: #NameExpr['fetcher']
                           $name: #NameExpr['s3_expiration']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #IntExpr['1395098371']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['data']
                           $right: #ApplyExpr[
                              $base: #NameExpr['fetcher']
                              $recv: #NameExpr['fetch_s3']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['URI']
                                    $recv: #NameExpr['parse']
                                    $param: #List[
                                       $expression: #NameExpr['url']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['https://my-bucket.s3.amazonaws.com/gems/specs.4.8.gz?AWSAccessKeyId=testuser&Expires=1395098371&Signature=eUTr7NkpZEet%2BJySE%2BfH6qukroI%3D']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['$fetched_uri']
                                 $recv: #NameExpr['to_s']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['success']
                              $expression: #NameExpr['data']
                           ]
                        ]
                     ]
                     $ensure: #AssignExpr[
                        $left: #NameExpr['$fetched_uri']
                        $right: #Nil['nil']
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_fetch_s3_no_creds']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #NameExpr['fetcher']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['url']
                           $right: #StringExpr['s3://my-bucket/gems/specs.4.8.gz']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['e']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_raises']
                              $param: #List[
                                 $expression: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['RemoteFetcher']
                                    ]
                                    $name: #NameExpr['FetchError']
                                 ]
                              ]
                              $body: #Block[
                                 $body: #ApplyExpr[
                                    $base: #NameExpr['fetcher']
                                    $recv: #NameExpr['fetch_s3']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['URI']
                                          $recv: #NameExpr['parse']
                                          $param: #List[
                                             $expression: #NameExpr['url']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #StringExpr['credentials needed']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['message']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_observe_no_proxy_env_single_host']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['use_ui']
                        $param: #List[
                           $expression: #NameExpr['@ui']
                        ]
                        $body: #Block[
                           $body: #List[
                              $statement: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #NameExpr['ENV']
                                    $index: #List[
                                       $expression: #StringExpr['http_proxy']
                                    ]
                                 ]
                                 $right: #NameExpr['@proxy_uri']
                              ]
                              $statement: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #NameExpr['ENV']
                                    $index: #List[
                                       $expression: #StringExpr['no_proxy']
                                    ]
                                 ]
                                 $right: #ApplyExpr[
                                    $recv: #ApplyExpr[
                                       $recv: #NameExpr['URI']
                                       $recv: #NameExpr['parse']
                                       $param: #List[
                                          $expression: #NameExpr['@server_uri']
                                       ]
                                    ]
                                    $recv: #NameExpr['host']
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['fetcher']
                                 $right: #ApplyExpr[
                                    $base: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['RemoteFetcher']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #Nil['nil']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['@fetcher']
                                 $right: #NameExpr['fetcher']
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_data_from_server']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['fetcher']
                                       $recv: #NameExpr['fetch_path']
                                       $param: #List[
                                          $expression: #NameExpr['@server_uri']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_observe_no_proxy_env_list']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['use_ui']
                        $param: #List[
                           $expression: #NameExpr['@ui']
                        ]
                        $body: #Block[
                           $body: #List[
                              $statement: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #NameExpr['ENV']
                                    $index: #List[
                                       $expression: #StringExpr['http_proxy']
                                    ]
                                 ]
                                 $right: #NameExpr['@proxy_uri']
                              ]
                              $statement: #AssignExpr[
                                 $left: #Indexer[
                                    $base: #NameExpr['ENV']
                                    $index: #List[
                                       $expression: #StringExpr['no_proxy']
                                    ]
                                 ]
                                 $right: #StringExpr[
                                    $inner: #ApplyExpr[
                                       $recv: #ApplyExpr[
                                          $recv: #NameExpr['URI']
                                          $recv: #NameExpr['parse']
                                          $param: #List[
                                             $expression: #NameExpr['@server_uri']
                                          ]
                                       ]
                                       $recv: #NameExpr['host']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['fetcher']
                                 $right: #ApplyExpr[
                                    $base: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['RemoteFetcher']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #Nil['nil']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['@fetcher']
                                 $right: #NameExpr['fetcher']
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_data_from_server']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['fetcher']
                                       $recv: #NameExpr['fetch_path']
                                       $param: #List[
                                          $expression: #NameExpr['@server_uri']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_request_block']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@fetcher']
                           $right: #NameExpr['fetcher']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_throws']
                           $param: #List[
                              $expression: #NameExpr['block_called']
                           ]
                           $body: #Block[
                              $body: #ApplyExpr[
                                 $base: #NameExpr['fetcher']
                                 $recv: #NameExpr['request']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['URI']
                                       $param: #List[
                                          $expression: #StringExpr['http://example']
                                       ]
                                    ]
                                    $expression: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['Net']
                                          $name: #NameExpr['HTTP']
                                       ]
                                       $name: #NameExpr['Get']
                                    ]
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['req']
                                    $body: #List[
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_kind_of']
                                          $param: #List[
                                             $expression: #Field[
                                                $recv: #NameExpr['Net']
                                                $name: #NameExpr['HTTPGenericRequest']
                                             ]
                                             $expression: #NameExpr['req']
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['throw']
                                          $param: #List[
                                             $expression: #NameExpr['block_called']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_yaml_error_on_size']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['use_ui']
                        $param: #List[
                           $expression: #NameExpr['@ui']
                        ]
                        $body: #Block[
                           $body: #List[
                              $statement: #AssignExpr[
                                 $left: #Field[
                                    $base: #ApplyExpr[
                                       $recv: #Self['self']
                                       $recv: #NameExpr['class']
                                    ]
                                    $name: #NameExpr['enable_yaml']
                                 ]
                                 $right: #FalseExpr['false']
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['fetcher']
                                 $right: #ApplyExpr[
                                    $base: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['RemoteFetcher']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #Nil['nil']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['@fetcher']
                                 $right: #NameExpr['fetcher']
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_error']
                                 $body: #Block[
                                    $body: #ApplyExpr[
                                       $recv: #NameExpr['fetcher']
                                       $recv: #NameExpr['size']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_ssl_connection']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['ssl_server']
                           $right: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #Self['self']
                                 $recv: #NameExpr['class']
                              ]
                              $recv: #NameExpr['start_ssl_server']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['temp_ca_cert']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['DIR']
                                 $expression: #StringExpr['ca_cert.pem']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['with_configured_fetcher']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #NameExpr['temp_ca_cert']
                              ]
                           ]
                           $body: #Block[
                              $param: #NameExpr['fetcher']
                              $body: #ApplyExpr[
                                 $recv: #NameExpr['fetcher']
                                 $recv: #NameExpr['fetch_path']
                                 $param: #List[
                                    $expression: #StringExpr[
                                       $inner: #Indexer[
                                          $recv: #ApplyExpr[
                                             $recv: #NameExpr['ssl_server']
                                             $recv: #NameExpr['config']
                                          ]
                                          $index: #List[
                                             $expression: #NameExpr['Port']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_ssl_client_cert_auth_connection']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #Unless[
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['skip']
                              $param: #List[
                                 $expression: #StringExpr['openssl is missing']
                              ]
                           ]
                           $cond: #Defined[
                              $base: #Field[
                                 $recv: #NameExpr['OpenSSL']
                                 $name: #NameExpr['SSL']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['ssl_server']
                           $right: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #Self['self']
                                 $recv: #NameExpr['class']
                              ]
                              $recv: #NameExpr['start_ssl_server']
                              $param: #List[
                                 $expression: #List[
                                    $hash: #Hash[
                                       $key: #NameExpr['SSLVerifyClient']
                                       $value: #OrExpr[
                                          $left: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['VERIFY_PEER']
                                          ]
                                          $right: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['VERIFY_FAIL_IF_NO_PEER_CERT']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['temp_ca_cert']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['DIR']
                                 $expression: #StringExpr['ca_cert.pem']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['temp_client_cert']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['DIR']
                                 $expression: #StringExpr['client.pem']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['with_configured_fetcher']
                           $param: #List[
                              $expression: #AddExpr[
                                 $left: #StringExpr[
                                    $inner: #NameExpr['temp_ca_cert']
                                 ]
                                 $right: #StringExpr[
                                    $inner: #NameExpr['temp_client_cert']
                                 ]
                              ]
                           ]
                           $body: #Block[
                              $param: #NameExpr['fetcher']
                              $body: #ApplyExpr[
                                 $recv: #NameExpr['fetcher']
                                 $recv: #NameExpr['fetch_path']
                                 $param: #List[
                                    $expression: #StringExpr[
                                       $inner: #Indexer[
                                          $recv: #ApplyExpr[
                                             $recv: #NameExpr['ssl_server']
                                             $recv: #NameExpr['config']
                                          ]
                                          $index: #List[
                                             $expression: #NameExpr['Port']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_do_not_allow_invalid_client_cert_auth_connection']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #Unless[
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['skip']
                              $param: #List[
                                 $expression: #StringExpr['openssl is missing']
                              ]
                           ]
                           $cond: #Defined[
                              $base: #Field[
                                 $recv: #NameExpr['OpenSSL']
                                 $name: #NameExpr['SSL']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['ssl_server']
                           $right: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #Self['self']
                                 $recv: #NameExpr['class']
                              ]
                              $recv: #NameExpr['start_ssl_server']
                              $param: #List[
                                 $expression: #List[
                                    $hash: #Hash[
                                       $key: #NameExpr['SSLVerifyClient']
                                       $value: #OrExpr[
                                          $left: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['VERIFY_PEER']
                                          ]
                                          $right: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['VERIFY_FAIL_IF_NO_PEER_CERT']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['temp_ca_cert']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['DIR']
                                 $expression: #StringExpr['ca_cert.pem']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['temp_client_cert']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['DIR']
                                 $expression: #StringExpr['invalid_client.pem']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['with_configured_fetcher']
                           $param: #List[
                              $expression: #AddExpr[
                                 $left: #StringExpr[
                                    $inner: #NameExpr['temp_ca_cert']
                                 ]
                                 $right: #StringExpr[
                                    $inner: #NameExpr['temp_client_cert']
                                 ]
                              ]
                           ]
                           $body: #Block[
                              $param: #NameExpr['fetcher']
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_raises']
                                 $param: #List[
                                    $expression: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['RemoteFetcher']
                                       ]
                                       $name: #NameExpr['FetchError']
                                    ]
                                 ]
                                 $body: #Block[
                                    $body: #ApplyExpr[
                                       $recv: #NameExpr['fetcher']
                                       $recv: #NameExpr['fetch_path']
                                       $param: #List[
                                          $expression: #StringExpr[
                                             $inner: #Indexer[
                                                $recv: #ApplyExpr[
                                                   $recv: #NameExpr['ssl_server']
                                                   $recv: #NameExpr['config']
                                                ]
                                                $index: #List[
                                                   $expression: #NameExpr['Port']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_do_not_allow_insecure_ssl_connection_by_default']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['ssl_server']
                           $right: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #Self['self']
                                 $recv: #NameExpr['class']
                              ]
                              $recv: #NameExpr['start_ssl_server']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['with_configured_fetcher']
                           $body: #Block[
                              $param: #NameExpr['fetcher']
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_raises']
                                 $param: #List[
                                    $expression: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['RemoteFetcher']
                                       ]
                                       $name: #NameExpr['FetchError']
                                    ]
                                 ]
                                 $body: #Block[
                                    $body: #ApplyExpr[
                                       $recv: #NameExpr['fetcher']
                                       $recv: #NameExpr['fetch_path']
                                       $param: #List[
                                          $expression: #StringExpr[
                                             $inner: #Indexer[
                                                $recv: #ApplyExpr[
                                                   $recv: #NameExpr['ssl_server']
                                                   $recv: #NameExpr['config']
                                                ]
                                                $index: #List[
                                                   $expression: #NameExpr['Port']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_ssl_connection_allow_verify_none']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['ssl_server']
                           $right: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #Self['self']
                                 $recv: #NameExpr['class']
                              ]
                              $recv: #NameExpr['start_ssl_server']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['with_configured_fetcher']
                           $param: #List[
                              $expression: #StringExpr[':ssl_verify_mode: 0']
                           ]
                           $body: #Block[
                              $param: #NameExpr['fetcher']
                              $body: #ApplyExpr[
                                 $recv: #NameExpr['fetcher']
                                 $recv: #NameExpr['fetch_path']
                                 $param: #List[
                                    $expression: #StringExpr[
                                       $inner: #Indexer[
                                          $recv: #ApplyExpr[
                                             $recv: #NameExpr['ssl_server']
                                             $recv: #NameExpr['config']
                                          ]
                                          $index: #List[
                                             $expression: #NameExpr['Port']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_do_not_follow_insecure_redirect']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['ssl_server']
                           $right: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #Self['self']
                                 $recv: #NameExpr['class']
                              ]
                              $recv: #NameExpr['start_ssl_server']
                           ]
                        ]
                        $statement: #MultipleAssign[
                           $left: #NameExpr['temp_ca_cert']
                           $right: #MultipleRightHandSideExpression[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['DIR']
                                    $expression: #StringExpr['ca_cert.pem']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['with_configured_fetcher']
                                 $param: #List[
                                    $expression: #StringExpr[
                                       $inner: #NameExpr['temp_ca_cert']
                                    ]
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['fetcher']
                                    $body: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_raises']
                                       $param: #List[
                                          $expression: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['Gem']
                                                $name: #NameExpr['RemoteFetcher']
                                             ]
                                             $name: #NameExpr['FetchError']
                                          ]
                                       ]
                                       $body: #Block[
                                          $body: #ApplyExpr[
                                             $recv: #NameExpr['fetcher']
                                             $recv: #NameExpr['fetch_path']
                                             $param: #List[
                                                $expression: #StringExpr[
                                                   $inner: #Indexer[
                                                      $recv: #ApplyExpr[
                                                         $recv: #NameExpr['ssl_server']
                                                         $recv: #NameExpr['config']
                                                      ]
                                                      $index: #List[
                                                         $expression: #NameExpr['Port']
                                                      ]
                                                   ]
                                                   $inner: #NameExpr['@server_uri']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['with_configured_fetcher']
                  $param: #List[
                     $param: #OptionalParam[
                        $name: #NameExpr['config_str']
                        $default: #Nil['nil']
                     ]
                     $param: #ProcedureParam[
                        $name: #NameExpr['block']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $cond: #NameExpr['config_str']
                           $then: #List[
                              $statement: #AssignExpr[
                                 $left: #NameExpr['temp_conf']
                                 $right: #ApplyExpr[
                                    $base: #NameExpr['File']
                                    $recv: #NameExpr['join']
                                    $param: #List[
                                       $expression: #NameExpr['@tempdir']
                                       $expression: #StringExpr['.gemrc']
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['open']
                                 $param: #List[
                                    $expression: #NameExpr['temp_conf']
                                    $expression: #StringExpr['w']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['fp']
                                    $body: #ApplyExpr[
                                       $base: #NameExpr['fp']
                                       $recv: #NameExpr['puts']
                                       $param: #List[
                                          $expression: #NameExpr['config_str']
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #Field[
                                    $base: #NameExpr['Gem']
                                    $name: #NameExpr['configuration']
                                 ]
                                 $right: #ApplyExpr[
                                    $base: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['ConfigFile']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #ParcentNotation['%W[--config-file #{temp_conf}]']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['fetcher']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['RemoteFetcher']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #Yield[
                           $param: #List[
                              $expression: #NameExpr['fetcher']
                           ]
                        ]
                     ]
                     $ensure: #List[
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['fetcher']
                           $recv: #NameExpr['close_all']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['Gem']
                              $name: #NameExpr['configuration']
                           ]
                           $right: #Nil['nil']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['assert_error']
                  $param: #List[
                     $param: #OptionalParam[
                        $name: #NameExpr['exception_class']
                        $default: #NameExpr['Exception']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['got_exception']
                           $right: #FalseExpr['false']
                        ]
                        $statement: #ExceptionBlock[
                           $main: #Yield['yield']
                           $rescue: #List[
                              $rescue: #Rescue[
                                 $class: #NameExpr['exception_class']
                                 $then: #AssignExpr[
                                    $left: #NameExpr['got_exception']
                                    $right: #TrueExpr['true']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #NameExpr['got_exception']
                              $expression: #StringExpr[
                                 $inner: #NameExpr['exception_class']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['assert_data_from_server']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['data']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['assert_match']
                        $param: #List[
                           $expression: #Regex['/0\\.4\\.11/']
                           $expression: #NameExpr['data']
                           $expression: #StringExpr['Data is not from server']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['assert_data_from_proxy']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['data']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['assert_match']
                        $param: #List[
                           $expression: #Regex['/0\\.4\\.2/']
                           $expression: #NameExpr['data']
                           $expression: #StringExpr['Data is not from proxy']
                        ]
                     ]
                  ]
               ]
               $statement: #Class[
                  $name: #NameExpr['NilLog']
                  $super: #Field[
                     $recv: #NameExpr['WEBrick']
                     $name: #NameExpr['Log']
                  ]
                  $body: #BlockExpr[
                     $main: #FuncDecl[
                        $name: #NameExpr['log']
                        $param: #List[
                           $param: #Param[
                              $param: #NameExpr['level']
                           ]
                           $param: #Param[
                              $param: #NameExpr['data']
                           ]
                        ]
                        $body: #BlockExpr[
                           $main: #Empty['']
                        ]
                     ]
                  ]
               ]
               $statement: #SClass[
                  $path: #Self['self']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['attr_reader']
                           $param: #List[
                              $expression: #NameExpr['normal_server']
                              $expression: #NameExpr['proxy_server']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['attr_accessor']
                           $param: #List[
                              $expression: #NameExpr['enable_zip']
                              $expression: #NameExpr['enable_yaml']
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['start_servers']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #LOrAssign[
                                    $left: #NameExpr['@normal_server']
                                    $right: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['start_server']
                                       $param: #List[
                                          $expression: #NameExpr['SERVER_DATA']
                                       ]
                                    ]
                                 ]
                                 $statement: #LOrAssign[
                                    $left: #NameExpr['@proxy_server']
                                    $right: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['start_server']
                                       $param: #List[
                                          $expression: #NameExpr['PROXY_DATA']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@enable_yaml']
                                    $right: #TrueExpr['true']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@enable_zip']
                                    $right: #FalseExpr['false']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@ssl_server']
                                    $right: #Nil['nil']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@ssl_server_thread']
                                    $right: #Nil['nil']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['stop_servers']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #IfExpr[
                                    $cond: #NameExpr['@normal_server']
                                    $then: #List[
                                       $statement: #ApplyExpr[
                                          $recv: #ApplyExpr[
                                             $recv: #NameExpr['@normal_server']
                                             $recv: #NameExpr['kill']
                                          ]
                                          $recv: #NameExpr['join']
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['@normal_server']
                                          $right: #Nil['nil']
                                       ]
                                    ]
                                 ]
                                 $statement: #IfExpr[
                                    $cond: #NameExpr['@proxy_server']
                                    $then: #List[
                                       $statement: #ApplyExpr[
                                          $recv: #ApplyExpr[
                                             $recv: #NameExpr['@proxy_server']
                                             $recv: #NameExpr['kill']
                                          ]
                                          $recv: #NameExpr['join']
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['@proxy_server']
                                          $right: #Nil['nil']
                                       ]
                                    ]
                                 ]
                                 $statement: #IfExpr[
                                    $cond: #NameExpr['@ssl_server']
                                    $then: #List[
                                       $statement: #ApplyExpr[
                                          $recv: #NameExpr['@ssl_server']
                                          $recv: #NameExpr['stop']
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['@ssl_server']
                                          $right: #Nil['nil']
                                       ]
                                    ]
                                 ]
                                 $statement: #IfExpr[
                                    $cond: #NameExpr['@ssl_server_thread']
                                    $then: #List[
                                       $statement: #ApplyExpr[
                                          $recv: #ApplyExpr[
                                             $recv: #NameExpr['@ssl_server_thread']
                                             $recv: #NameExpr['kill']
                                          ]
                                          $recv: #NameExpr['join']
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['@ssl_server_thread']
                                          $right: #Nil['nil']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['utils']
                                    $right: #Field[
                                       $recv: #NameExpr['WEBrick']
                                       $name: #NameExpr['Utils']
                                    ]
                                 ]
                                 $statement: #IfExpr[
                                    $then: #ApplyExpr[
                                       $recv: #Field[
                                          $recv: #NameExpr['utils']
                                          $name: #NameExpr['TimeoutHandler']
                                       ]
                                       $recv: #NameExpr['terminate']
                                    ]
                                    $cond: #Defined[
                                       $base: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #NameExpr['utils']
                                             $name: #NameExpr['TimeoutHandler']
                                          ]
                                          $recv: #NameExpr['terminate']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['normal_server_port']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #Indexer[
                                 $recv: #ApplyExpr[
                                    $recv: #Indexer[
                                       $recv: #NameExpr['@normal_server']
                                       $index: #List[
                                          $expression: #NameExpr['server']
                                       ]
                                    ]
                                    $recv: #NameExpr['config']
                                 ]
                                 $index: #List[
                                    $expression: #NameExpr['Port']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['proxy_server_port']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #Indexer[
                                 $recv: #ApplyExpr[
                                    $recv: #Indexer[
                                       $recv: #NameExpr['@proxy_server']
                                       $index: #List[
                                          $expression: #NameExpr['server']
                                       ]
                                    ]
                                    $recv: #NameExpr['config']
                                 ]
                                 $index: #List[
                                    $expression: #NameExpr['Port']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['DIR']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['expand_path']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['File']
                                    $recv: #NameExpr['dirname']
                                    $param: #List[
                                       $expression: #File['__FILE__']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['start_ssl_server']
                           $param: #List[
                              $param: #OptionalParam[
                                 $name: #NameExpr['config']
                                 $default: #List['{}']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #Unless[
                                    $then: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['raise']
                                       $param: #List[
                                          $expression: #Field[
                                             $recv: #NameExpr['MiniTest']
                                             $name: #NameExpr['Skip']
                                          ]
                                          $expression: #StringExpr['openssl not installed']
                                       ]
                                    ]
                                    $cond: #Defined[
                                       $base: #Field[
                                          $recv: #NameExpr['OpenSSL']
                                          $name: #NameExpr['SSL']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['null_logger']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['NilLog']
                                       $recv: #NameExpr['new']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['server']
                                    $right: #ApplyExpr[
                                       $recv: #Field[
                                          $recv: #NameExpr['WEBrick']
                                          $name: #NameExpr['HTTPServer']
                                       ]
                                       $recv: #NameExpr['new']
                                       $param: #List[
                                          $expression: #ApplyExpr[
                                             $recv: #List[
                                                $hash: #Hash[
                                                   $key: #NameExpr['Port']
                                                   $value: #IntExpr['0']
                                                ]
                                                $hash: #Hash[
                                                   $key: #NameExpr['Logger']
                                                   $value: #NameExpr['null_logger']
                                                ]
                                                $hash: #Hash[
                                                   $key: #NameExpr['AccessLog']
                                                   $value: #Array['[]']
                                                ]
                                                $hash: #Hash[
                                                   $key: #NameExpr['SSLEnable']
                                                   $value: #TrueExpr['true']
                                                ]
                                                $hash: #Hash[
                                                   $key: #NameExpr['SSLCACertificateFile']
                                                   $value: #ApplyExpr[
                                                      $recv: #NameExpr['File']
                                                      $recv: #NameExpr['join']
                                                      $param: #List[
                                                         $expression: #NameExpr['DIR']
                                                         $expression: #StringExpr['ca_cert.pem']
                                                      ]
                                                   ]
                                                ]
                                                $hash: #Hash[
                                                   $key: #NameExpr['SSLCertificate']
                                                   $value: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #NameExpr['cert']
                                                      $param: #List[
                                                         $expression: #StringExpr['ssl_cert.pem']
                                                      ]
                                                   ]
                                                ]
                                                $hash: #Hash[
                                                   $key: #NameExpr['SSLPrivateKey']
                                                   $value: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #NameExpr['key']
                                                      $param: #List[
                                                         $expression: #StringExpr['ssl_key.pem']
                                                      ]
                                                   ]
                                                ]
                                                $hash: #Hash[
                                                   $key: #NameExpr['SSLVerifyClient']
                                                   $value: #Nil['nil']
                                                ]
                                                $hash: #Hash[
                                                   $key: #NameExpr['SSLCertName']
                                                   $value: #Nil['nil']
                                                ]
                                             ]
                                             $recv: #NameExpr['merge']
                                             $param: #List[
                                                $expression: #NameExpr['config']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['server']
                                    $recv: #NameExpr['mount_proc']
                                    $param: #List[
                                       $expression: #StringExpr['/yaml']
                                    ]
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['req']
                                          $item: #NameExpr['res']
                                       ]
                                       $body: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['res']
                                             $name: #NameExpr['body']
                                          ]
                                          $right: #StringExpr['--- true\\n']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['server']
                                    $recv: #NameExpr['mount_proc']
                                    $param: #List[
                                       $expression: #StringExpr['/insecure_redirect']
                                    ]
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['req']
                                          $item: #NameExpr['res']
                                       ]
                                       $body: #ApplyExpr[
                                          $recv: #NameExpr['res']
                                          $recv: #NameExpr['set_redirect']
                                          $param: #List[
                                             $expression: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['WEBrick']
                                                   $name: #NameExpr['HTTPStatus']
                                                ]
                                                $name: #NameExpr['MovedPermanently']
                                             ]
                                             $expression: #Indexer[
                                                $recv: #ApplyExpr[
                                                   $recv: #NameExpr['req']
                                                   $recv: #NameExpr['query']
                                                ]
                                                $index: #List[
                                                   $expression: #StringExpr['to']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Field[
                                       $base: #ApplyExpr[
                                          $recv: #NameExpr['server']
                                          $recv: #NameExpr['ssl_context']
                                       ]
                                       $name: #NameExpr['tmp_dh_callback']
                                    ]
                                    $right: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['proc']
                                       $body: #Block[
                                          $body: #NameExpr['TEST_KEY_DH2048']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['t']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['Thread']
                                       $recv: #NameExpr['new']
                                       $body: #Block[
                                          $body: #ExceptionBlock[
                                             $main: #ApplyExpr[
                                                $recv: #NameExpr['server']
                                                $recv: #NameExpr['start']
                                             ]
                                             $rescue: #List[
                                                $rescue: #Rescue[
                                                   $class: #NameExpr['Exception']
                                                   $target: #NameExpr['ex']
                                                   $then: #List[
                                                      $statement: #ApplyExpr[
                                                         #Self['self']
                                                         $recv: #NameExpr['abort']
                                                         $param: #List[
                                                            $expression: #ApplyExpr[
                                                               $recv: #NameExpr['ex']
                                                               $recv: #NameExpr['message']
                                                            ]
                                                         ]
                                                      ]
                                                      $statement: #ApplyExpr[
                                                         #Self['self']
                                                         $recv: #NameExpr['puts']
                                                         $param: #List[
                                                            $expression: #StringExpr[
                                                               $inner: #ApplyExpr[
                                                                  $recv: #NameExpr['ex']
                                                                  $recv: #NameExpr['message']
                                                               ]
                                                            ]
                                                         ]
                                                      ]
                                                   ]
                                                ]
                                             ]
                                             $ensure: #ApplyExpr[
                                                $recv: #NameExpr['server']
                                                $recv: #NameExpr['shutdown']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #While[
                                    $cond: #NeExpr[
                                       $left: #ApplyExpr[
                                          $recv: #NameExpr['server']
                                          $recv: #NameExpr['status']
                                       ]
                                       $right: #NameExpr['Running']
                                    ]
                                    $body: #List[
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['sleep']
                                          $param: #List[
                                             $expression: #FloatExpr['0.1']
                                          ]
                                       ]
                                       $statement: #Unless[
                                          $cond: #ApplyExpr[
                                             $recv: #NameExpr['t']
                                             $recv: #NameExpr['alive?']
                                          ]
                                          $then: #List[
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['t']
                                                $recv: #NameExpr['join']
                                             ]
                                             $statement: #NameExpr['raise']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@ssl_server']
                                    $right: #NameExpr['server']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@ssl_server_thread']
                                    $right: #NameExpr['t']
                                 ]
                                 $statement: #NameExpr['server']
                              ]
                           ]
                        ]
                        $statement: #NameExpr['private']
                        $statement: #FuncDecl[
                           $name: #NameExpr['start_server']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['data']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['null_logger']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['NilLog']
                                       $recv: #NameExpr['new']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['s']
                                    $right: #ApplyExpr[
                                       $recv: #Field[
                                          $recv: #NameExpr['WEBrick']
                                          $name: #NameExpr['HTTPServer']
                                       ]
                                       $recv: #NameExpr['new']
                                       $param: #List[
                                          $hash: #Hash[
                                             $key: #NameExpr['Port']
                                             $value: #IntExpr['0']
                                          ]
                                          $hash: #Hash[
                                             $key: #NameExpr['DocumentRoot']
                                             $value: #Nil['nil']
                                          ]
                                          $hash: #Hash[
                                             $key: #NameExpr['Logger']
                                             $value: #NameExpr['null_logger']
                                          ]
                                          $hash: #Hash[
                                             $key: #NameExpr['AccessLog']
                                             $value: #NameExpr['null_logger']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['s']
                                    $recv: #NameExpr['mount_proc']
                                    $param: #List[
                                       $expression: #StringExpr['/kill']
                                    ]
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['req']
                                          $item: #NameExpr['res']
                                       ]
                                       $body: #ApplyExpr[
                                          $recv: #NameExpr['s']
                                          $recv: #NameExpr['shutdown']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['s']
                                    $recv: #NameExpr['mount_proc']
                                    $param: #List[
                                       $expression: #StringExpr['/yaml']
                                    ]
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['req']
                                          $item: #NameExpr['res']
                                       ]
                                       $body: #IfExpr[
                                          $cond: #Indexer[
                                             $recv: #NameExpr['req']
                                             $index: #List[
                                                $expression: #StringExpr['X-Captain']
                                             ]
                                          ]
                                          $then: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['res']
                                                $name: #NameExpr['body']
                                             ]
                                             $right: #Indexer[
                                                $recv: #NameExpr['req']
                                                $index: #List[
                                                   $expression: #StringExpr['X-Captain']
                                                ]
                                             ]
                                          ]
                                          $else: #IfExpr[
                                             $cond: #NameExpr['@enable_yaml']
                                             $then: #List[
                                                $statement: #AssignExpr[
                                                   $left: #Field[
                                                      $base: #NameExpr['res']
                                                      $name: #NameExpr['body']
                                                   ]
                                                   $right: #NameExpr['data']
                                                ]
                                                $statement: #AssignExpr[
                                                   $left: #Indexer[
                                                      $base: #NameExpr['res']
                                                      $index: #List[
                                                         $expression: #StringExpr['Content-Type']
                                                      ]
                                                   ]
                                                   $right: #StringExpr['text/plain']
                                                ]
                                                $statement: #AssignExpr[
                                                   $left: #Indexer[
                                                      $base: #NameExpr['res']
                                                      $index: #List[
                                                         $expression: #StringExpr['content-length']
                                                      ]
                                                   ]
                                                   $right: #ApplyExpr[
                                                      $recv: #NameExpr['data']
                                                      $recv: #NameExpr['size']
                                                   ]
                                                ]
                                             ]
                                             $else: #List[
                                                $statement: #AssignExpr[
                                                   $left: #Field[
                                                      $base: #NameExpr['res']
                                                      $name: #NameExpr['status']
                                                   ]
                                                   $right: #StringExpr['404']
                                                ]
                                                $statement: #AssignExpr[
                                                   $left: #Field[
                                                      $base: #NameExpr['res']
                                                      $name: #NameExpr['body']
                                                   ]
                                                   $right: #StringExpr['<h1>NOT FOUND</h1>']
                                                ]
                                                $statement: #AssignExpr[
                                                   $left: #Indexer[
                                                      $base: #NameExpr['res']
                                                      $index: #List[
                                                         $expression: #StringExpr['Content-Type']
                                                      ]
                                                   ]
                                                   $right: #StringExpr['text/html']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['s']
                                    $recv: #NameExpr['mount_proc']
                                    $param: #List[
                                       $expression: #StringExpr['/yaml.Z']
                                    ]
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['req']
                                          $item: #NameExpr['res']
                                       ]
                                       $body: #IfExpr[
                                          $cond: #NameExpr['@enable_zip']
                                          $then: #List[
                                             $statement: #AssignExpr[
                                                $left: #Field[
                                                   $base: #NameExpr['res']
                                                   $name: #NameExpr['body']
                                                ]
                                                $right: #ApplyExpr[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['Zlib']
                                                      $name: #NameExpr['Deflate']
                                                   ]
                                                   $recv: #NameExpr['deflate']
                                                   $param: #List[
                                                      $expression: #NameExpr['data']
                                                   ]
                                                ]
                                             ]
                                             $statement: #AssignExpr[
                                                $left: #Indexer[
                                                   $base: #NameExpr['res']
                                                   $index: #List[
                                                      $expression: #StringExpr['Content-Type']
                                                   ]
                                                ]
                                                $right: #StringExpr['text/plain']
                                             ]
                                          ]
                                          $else: #List[
                                             $statement: #AssignExpr[
                                                $left: #Field[
                                                   $base: #NameExpr['res']
                                                   $name: #NameExpr['status']
                                                ]
                                                $right: #StringExpr['404']
                                             ]
                                             $statement: #AssignExpr[
                                                $left: #Field[
                                                   $base: #NameExpr['res']
                                                   $name: #NameExpr['body']
                                                ]
                                                $right: #StringExpr['<h1>NOT FOUND</h1>']
                                             ]
                                             $statement: #AssignExpr[
                                                $left: #Indexer[
                                                   $base: #NameExpr['res']
                                                   $index: #List[
                                                      $expression: #StringExpr['Content-Type']
                                                   ]
                                                ]
                                                $right: #StringExpr['text/html']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['th']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['Thread']
                                       $recv: #NameExpr['new']
                                       $body: #Block[
                                          $body: #ExceptionBlock[
                                             $main: #ApplyExpr[
                                                $recv: #NameExpr['s']
                                                $recv: #NameExpr['start']
                                             ]
                                             $rescue: #List[
                                                $rescue: #Rescue[
                                                   $class: #NameExpr['Exception']
                                                   $target: #NameExpr['ex']
                                                   $then: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #NameExpr['abort']
                                                      $param: #List[
                                                         $expression: #StringExpr[
                                                            $inner: #ApplyExpr[
                                                               $recv: #NameExpr['ex']
                                                               $recv: #NameExpr['message']
                                                            ]
                                                         ]
                                                      ]
                                                   ]
                                                ]
                                             ]
                                             $ensure: #ApplyExpr[
                                                $recv: #NameExpr['s']
                                                $recv: #NameExpr['shutdown']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Indexer[
                                       $base: #NameExpr['th']
                                       $index: #List[
                                          $expression: #NameExpr['server']
                                       ]
                                    ]
                                    $right: #NameExpr['s']
                                 ]
                                 $statement: #NameExpr['th']
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['cert']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['filename']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['X509']
                                    ]
                                    $name: #NameExpr['Certificate']
                                 ]
                                 $recv: #NameExpr['new']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['File']
                                       $recv: #NameExpr['read']
                                       $param: #List[
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['File']
                                             $recv: #NameExpr['join']
                                             $param: #List[
                                                $expression: #NameExpr['DIR']
                                                $expression: #NameExpr['filename']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['key']
                           $param: #List[
                              $param: #Param[
                                 $param: #NameExpr['filename']
                              ]
                           ]
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['PKey']
                                    ]
                                    $name: #NameExpr['RSA']
                                 ]
                                 $recv: #NameExpr['new']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['File']
                                       $recv: #NameExpr['read']
                                       $param: #List[
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['File']
                                             $recv: #NameExpr['join']
                                             $param: #List[
                                                $expression: #NameExpr['DIR']
                                                $expression: #NameExpr['filename']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_correct_for_windows_path']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['path']
                           $right: #StringExpr['/C:/WINDOWS/Temp/gems']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['C:/WINDOWS/Temp/gems']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@fetcher']
                                 $recv: #NameExpr['correct_for_windows_path']
                                 $param: #List[
                                    $expression: #NameExpr['path']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['path']
                           $right: #StringExpr['/home/skillet']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['/home/skillet']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@fetcher']
                                 $recv: #NameExpr['correct_for_windows_path']
                                 $param: #List[
                                    $expression: #NameExpr['path']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
            ]
         ]
      ]
   ]
   #Comsumed['comsumed']
]
