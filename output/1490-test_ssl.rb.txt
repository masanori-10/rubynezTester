#Source[
   #List[
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require_relative']
         $param: #List[
            $expression: #StringExpr['utils']
         ]
      ]
      $statement: #IfExpr[
         $cond: #Defined[
            $base: #Field[
               $recv: #NameExpr['OpenSSL']
               $name: #NameExpr['TestUtils']
            ]
         ]
         $then: #Class[
            $name: #NestedName[
               $path: #NameExpr['OpenSSL']
               $name: #NameExpr['TestSSL']
            ]
            $super: #Field[
               $recv: #NameExpr['OpenSSL']
               $name: #NameExpr['SSLTestCase']
            ]
            $body: #BlockExpr[
               $main: #List[
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_ctx_options']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['SSLContext']
                                 ]
                                 $recv: #NameExpr['new']
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert']
                              $param: #List[
                                 $expression: #EqExpr[
                                    $left: #AndExpr[
                                       $left: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $name: #NameExpr['OP_ALL']
                                       ]
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['ctx']
                                          $recv: #NameExpr['options']
                                       ]
                                    ]
                                    $right: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['OpenSSL']
                                          $name: #NameExpr['SSL']
                                       ]
                                       $name: #NameExpr['OP_ALL']
                                    ]
                                 ]
                                 $expression: #StringExpr['OP_ALL is set by default']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['ctx']
                                 $name: #NameExpr['options']
                              ]
                              $right: #IntExpr['4']
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #IntExpr['4']
                                 $expression: #AndExpr[
                                    $left: #ApplyExpr[
                                       $recv: #NameExpr['ctx']
                                       $recv: #NameExpr['options']
                                    ]
                                    $right: #IntExpr['4']
                                 ]
                              ]
                           ]
                           $statement: #IfExpr[
                              $cond: #NeExpr[
                                 $left: #ApplyExpr[
                                    $recv: #NameExpr['ctx']
                                    $recv: #NameExpr['options']
                                 ]
                                 $right: #IntExpr['4']
                              ]
                              $then: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['pend']
                                 $param: #List[
                                    $expression: #StringExpr['SSL_CTX_set_options() seems to be modified by distributor']
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['ctx']
                                 $name: #NameExpr['options']
                              ]
                              $right: #Nil['nil']
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['OP_ALL']
                                 ]
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['ctx']
                                    $recv: #NameExpr['options']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['ctx']
                                    $recv: #NameExpr['setup']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_predicate']
                              $param: #List[
                                 $expression: #NameExpr['ctx']
                                 $expression: #NameExpr['frozen?']
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['ctx']
                                    $recv: #NameExpr['setup']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_ssl_with_server_cert']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx_proc']
                              $right: #Lambda[
                                 $param: #List[
                                    $param: #Param[
                                       $param: #NameExpr['ctx']
                                    ]
                                 ]
                                 $body: #Block[
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx']
                                             $name: #NameExpr['cert']
                                          ]
                                          $right: #NameExpr['@svr_cert']
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx']
                                             $name: #NameExpr['key']
                                          ]
                                          $right: #NameExpr['@svr_key']
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx']
                                             $name: #NameExpr['extra_chain_cert']
                                          ]
                                          $right: #Array[
                                             $index: #List[
                                                $expression: #NameExpr['@ca_cert']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['server_proc']
                              $right: #Lambda[
                                 $param: #List[
                                    $param: #Param[
                                       $param: #NameExpr['ctx']
                                    ]
                                    $param: #Param[
                                       $param: #NameExpr['ssl']
                                    ]
                                 ]
                                 $body: #Block[
                                    $body: #List[
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['@svr_cert']
                                                $recv: #NameExpr['to_der']
                                             ]
                                             $expression: #ApplyExpr[
                                                $recv: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['cert']
                                                ]
                                                $recv: #NameExpr['to_der']
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #Nil['nil']
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['peer_cert']
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['readwrite_loop']
                                          $param: #List[
                                             $expression: #NameExpr['ctx']
                                             $expression: #NameExpr['ssl']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $param: #List[
                                 $hash: #Hash[
                                    $key: #NameExpr['ctx_proc']
                                    $value: #NameExpr['ctx_proc']
                                 ]
                                 $hash: #Hash[
                                    $key: #NameExpr['server_proc']
                                    $value: #NameExpr['server_proc']
                                 ]
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #ExceptionBlock[
                                    $main: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['sock']
                                          $right: #ApplyExpr[
                                             $recv: #NameExpr['TCPSocket']
                                             $recv: #NameExpr['new']
                                             $param: #List[
                                                $expression: #StringExpr['127.0.0.1']
                                                $expression: #NameExpr['port']
                                             ]
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['ctx']
                                          $right: #ApplyExpr[
                                             $recv: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['SSL']
                                                ]
                                                $name: #NameExpr['SSLContext']
                                             ]
                                             $recv: #NameExpr['new']
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['ssl']
                                          $right: #ApplyExpr[
                                             $recv: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['SSL']
                                                ]
                                                $name: #NameExpr['SSLSocket']
                                             ]
                                             $recv: #NameExpr['new']
                                             $param: #List[
                                                $expression: #NameExpr['sock']
                                                $expression: #NameExpr['ctx']
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          $recv: #NameExpr['ssl']
                                          $recv: #NameExpr['connect']
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #NameExpr['sock']
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['io']
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #Nil['nil']
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['cert']
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['@svr_cert']
                                                $recv: #NameExpr['to_der']
                                             ]
                                             $expression: #ApplyExpr[
                                                $recv: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['peer_cert']
                                                ]
                                                $recv: #NameExpr['to_der']
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #IntExpr['2']
                                             $expression: #ApplyExpr[
                                                $recv: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['peer_cert_chain']
                                                ]
                                                $recv: #NameExpr['size']
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['@svr_cert']
                                                $recv: #NameExpr['to_der']
                                             ]
                                             $expression: #ApplyExpr[
                                                $recv: #Indexer[
                                                   $recv: #ApplyExpr[
                                                      $recv: #NameExpr['ssl']
                                                      $recv: #NameExpr['peer_cert_chain']
                                                   ]
                                                   $index: #List[
                                                      $expression: #IntExpr['0']
                                                   ]
                                                ]
                                                $recv: #NameExpr['to_der']
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['@ca_cert']
                                                $recv: #NameExpr['to_der']
                                             ]
                                             $expression: #ApplyExpr[
                                                $recv: #Indexer[
                                                   $recv: #ApplyExpr[
                                                      $recv: #NameExpr['ssl']
                                                      $recv: #NameExpr['peer_cert_chain']
                                                   ]
                                                   $index: #List[
                                                      $expression: #IntExpr['1']
                                                   ]
                                                ]
                                                $recv: #NameExpr['to_der']
                                             ]
                                          ]
                                       ]
                                    ]
                                    $ensure: #List[
                                       $statement: #ApplyExpr[
                                          $recv: #NameExpr['ssl']
                                          $recv: #NameExpr['close']
                                       ]
                                       $statement: #ApplyExpr[
                                          $recv: #NameExpr['sock']
                                          $recv: #NameExpr['close']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_sysread_and_syswrite']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['start_server']
                           $body: #Block[
                              $param: #MultipleLeftHandSideExpression[
                                 $item: #NameExpr['server']
                                 $item: #NameExpr['port']
                              ]
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['server_connect']
                                 $param: #List[
                                    $expression: #NameExpr['port']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['ssl']
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['str']
                                          $right: #AddExpr[
                                             $left: #MulExpr[
                                                $left: #StringExpr['x']
                                                $right: #IntExpr['100']
                                             ]
                                             $right: #StringExpr['\\n']
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          $recv: #NameExpr['ssl']
                                          $recv: #NameExpr['syswrite']
                                          $param: #List[
                                             $expression: #NameExpr['str']
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['newstr']
                                          $right: #ApplyExpr[
                                             $recv: #NameExpr['ssl']
                                             $recv: #NameExpr['sysread']
                                             $param: #List[
                                                $expression: #ApplyExpr[
                                                   $recv: #NameExpr['str']
                                                   $recv: #NameExpr['bytesize']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #NameExpr['str']
                                             $expression: #NameExpr['newstr']
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['buf']
                                          $right: #StringExpr['']
                                       ]
                                       $statement: #ApplyExpr[
                                          $recv: #NameExpr['ssl']
                                          $recv: #NameExpr['syswrite']
                                          $param: #List[
                                             $expression: #NameExpr['str']
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_same']
                                          $param: #List[
                                             $expression: #NameExpr['buf']
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['sysread']
                                                $param: #List[
                                                   $expression: #ApplyExpr[
                                                      $recv: #NameExpr['str']
                                                      $recv: #NameExpr['size']
                                                   ]
                                                   $expression: #NameExpr['buf']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #NameExpr['str']
                                             $expression: #NameExpr['newstr']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_sync_close']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['start_server']
                           $body: #Block[
                              $param: #MultipleLeftHandSideExpression[
                                 $item: #NameExpr['server']
                                 $item: #NameExpr['port']
                              ]
                              $body: #List[
                                 $statement: #ExceptionBlock[
                                    $main: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['sock']
                                          $right: #ApplyExpr[
                                             $recv: #NameExpr['TCPSocket']
                                             $recv: #NameExpr['new']
                                             $param: #List[
                                                $expression: #StringExpr['127.0.0.1']
                                                $expression: #NameExpr['port']
                                             ]
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['ssl']
                                          $right: #ApplyExpr[
                                             $recv: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['SSL']
                                                ]
                                                $name: #NameExpr['SSLSocket']
                                             ]
                                             $recv: #NameExpr['new']
                                             $param: #List[
                                                $expression: #NameExpr['sock']
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          $recv: #NameExpr['ssl']
                                          $recv: #NameExpr['connect']
                                       ]
                                       $statement: #ApplyExpr[
                                          $recv: #NameExpr['ssl']
                                          $recv: #NameExpr['close']
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_not_predicate']
                                          $param: #List[
                                             $expression: #NameExpr['sock']
                                             $expression: #NameExpr['closed?']
                                          ]
                                       ]
                                    ]
                                    $ensure: #ApplyExpr[
                                       $recv: #NameExpr['sock']
                                       $recv: #NameExpr['close']
                                    ]
                                 ]
                                 $statement: #ExceptionBlock[
                                    $main: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['sock']
                                          $right: #ApplyExpr[
                                             $recv: #NameExpr['TCPSocket']
                                             $recv: #NameExpr['new']
                                             $param: #List[
                                                $expression: #StringExpr['127.0.0.1']
                                                $expression: #NameExpr['port']
                                             ]
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['ssl']
                                          $right: #ApplyExpr[
                                             $recv: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['SSL']
                                                ]
                                                $name: #NameExpr['SSLSocket']
                                             ]
                                             $recv: #NameExpr['new']
                                             $param: #List[
                                                $expression: #NameExpr['sock']
                                             ]
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ssl']
                                             $name: #NameExpr['sync_close']
                                          ]
                                          $right: #TrueExpr['true']
                                       ]
                                       $statement: #ApplyExpr[
                                          $recv: #NameExpr['ssl']
                                          $recv: #NameExpr['connect']
                                       ]
                                       $statement: #ApplyExpr[
                                          $recv: #NameExpr['ssl']
                                          $recv: #NameExpr['close']
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_predicate']
                                          $param: #List[
                                             $expression: #NameExpr['sock']
                                             $expression: #NameExpr['closed?']
                                          ]
                                       ]
                                    ]
                                    $ensure: #ApplyExpr[
                                       $recv: #NameExpr['sock']
                                       $recv: #NameExpr['close']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_copy_stream']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['start_server']
                           $body: #Block[
                              $param: #MultipleLeftHandSideExpression[
                                 $item: #NameExpr['server']
                                 $item: #NameExpr['port']
                              ]
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['server_connect']
                                 $param: #List[
                                    $expression: #NameExpr['port']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['ssl']
                                    $body: #ApplyExpr[
                                       $recv: #NameExpr['IO']
                                       $recv: #NameExpr['pipe']
                                       $body: #Block[
                                          $param: #MultipleLeftHandSideExpression[
                                             $item: #NameExpr['r']
                                             $item: #NameExpr['w']
                                          ]
                                          $body: #List[
                                             $statement: #AssignExpr[
                                                $left: #NameExpr['str']
                                                $right: #StringExpr['hello world\\n']
                                             ]
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['w']
                                                $recv: #NameExpr['write']
                                                $param: #List[
                                                   $expression: #NameExpr['str']
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['IO']
                                                $recv: #NameExpr['copy_stream']
                                                $param: #List[
                                                   $expression: #NameExpr['r']
                                                   $expression: #NameExpr['ssl']
                                                   $expression: #ApplyExpr[
                                                      $recv: #NameExpr['str']
                                                      $recv: #NameExpr['bytesize']
                                                   ]
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['IO']
                                                $recv: #NameExpr['copy_stream']
                                                $param: #List[
                                                   $expression: #NameExpr['ssl']
                                                   $expression: #NameExpr['w']
                                                   $expression: #ApplyExpr[
                                                      $recv: #NameExpr['str']
                                                      $recv: #NameExpr['bytesize']
                                                   ]
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['assert_equal']
                                                $param: #List[
                                                   $expression: #NameExpr['str']
                                                   $expression: #ApplyExpr[
                                                      $recv: #NameExpr['r']
                                                      $recv: #NameExpr['read']
                                                      $param: #List[
                                                         $expression: #ApplyExpr[
                                                            $recv: #NameExpr['str']
                                                            $recv: #NameExpr['bytesize']
                                                         ]
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_client_auth_failure']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['vflag']
                              $right: #OrExpr[
                                 $left: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['VERIFY_PEER']
                                 ]
                                 $right: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['VERIFY_FAIL_IF_NO_PEER_CERT']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $param: #List[
                                 $hash: #Hash[
                                    $key: #NameExpr['verify_mode']
                                    $value: #NameExpr['vflag']
                                 ]
                                 $hash: #Hash[
                                    $key: #NameExpr['ignore_listener_error']
                                    $value: #TrueExpr['true']
                                 ]
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['sock']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['TCPSocket']
                                          $recv: #NameExpr['new']
                                          $param: #List[
                                             $expression: #StringExpr['127.0.0.1']
                                             $expression: #NameExpr['port']
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['ssl']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['SSLSocket']
                                          ]
                                          $recv: #NameExpr['new']
                                          $param: #List[
                                             $expression: #NameExpr['sock']
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ssl']
                                          $name: #NameExpr['sync_close']
                                       ]
                                       $right: #TrueExpr['true']
                                    ]
                                    $statement: #ExceptionBlock[
                                       $main: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_handshake_error']
                                          $body: #Block[
                                             $body: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['connect']
                                             ]
                                          ]
                                       ]
                                       $ensure: #ApplyExpr[
                                          $recv: #NameExpr['ssl']
                                          $recv: #NameExpr['close']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_client_auth_success']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['vflag']
                              $right: #OrExpr[
                                 $left: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['VERIFY_PEER']
                                 ]
                                 $right: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['VERIFY_FAIL_IF_NO_PEER_CERT']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $param: #List[
                                 $hash: #Hash[
                                    $key: #NameExpr['verify_mode']
                                    $value: #NameExpr['vflag']
                                 ]
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['ctx']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['SSLContext']
                                          ]
                                          $recv: #NameExpr['new']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['key']
                                       ]
                                       $right: #NameExpr['@cli_key']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['cert']
                                       ]
                                       $right: #NameExpr['@cli_cert']
                                    ]
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['server_connect']
                                       $param: #List[
                                          $expression: #NameExpr['port']
                                          $expression: #NameExpr['ctx']
                                       ]
                                       $body: #Block[
                                          $param: #NameExpr['ssl']
                                          $body: #List[
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['puts']
                                                $param: #List[
                                                   $expression: #StringExpr['foo']
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['assert_equal']
                                                $param: #List[
                                                   $expression: #StringExpr['foo\\n']
                                                   $expression: #ApplyExpr[
                                                      $recv: #NameExpr['ssl']
                                                      $recv: #NameExpr['gets']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['called']
                                       $right: #Nil['nil']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['ctx']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['SSLContext']
                                          ]
                                          $recv: #NameExpr['new']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['client_cert_cb']
                                       ]
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['Proc']
                                          $recv: #NameExpr['new']
                                          $body: #Block[
                                             $param: #NameExpr['sslconn']
                                             $body: #List[
                                                $statement: #AssignExpr[
                                                   $left: #NameExpr['called']
                                                   $right: #TrueExpr['true']
                                                ]
                                                $statement: #Array[
                                                   $index: #List[
                                                      $expression: #NameExpr['@cli_cert']
                                                      $expression: #NameExpr['@cli_key']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['server_connect']
                                       $param: #List[
                                          $expression: #NameExpr['port']
                                          $expression: #NameExpr['ctx']
                                       ]
                                       $body: #Block[
                                          $param: #NameExpr['ssl']
                                          $body: #List[
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['assert']
                                                $param: #List[
                                                   $expression: #NameExpr['called']
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['puts']
                                                $param: #List[
                                                   $expression: #StringExpr['foo']
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['assert_equal']
                                                $param: #List[
                                                   $expression: #StringExpr['foo\\n']
                                                   $expression: #ApplyExpr[
                                                      $recv: #NameExpr['ssl']
                                                      $recv: #NameExpr['gets']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_client_auth_public_key']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['vflag']
                              $right: #OrExpr[
                                 $left: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['VERIFY_PEER']
                                 ]
                                 $right: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['VERIFY_FAIL_IF_NO_PEER_CERT']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $param: #List[
                                 $hash: #Hash[
                                    $key: #NameExpr['verify_mode']
                                    $value: #NameExpr['vflag']
                                 ]
                                 $hash: #Hash[
                                    $key: #NameExpr['ignore_listener_error']
                                    $value: #TrueExpr['true']
                                 ]
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #List[
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_raise']
                                       $param: #List[
                                          $expression: #NameExpr['ArgumentError']
                                       ]
                                       $body: #Block[
                                          $body: #List[
                                             $statement: #AssignExpr[
                                                $left: #NameExpr['ctx']
                                                $right: #ApplyExpr[
                                                   $recv: #Field[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $name: #NameExpr['SSLContext']
                                                   ]
                                                   $recv: #NameExpr['new']
                                                ]
                                             ]
                                             $statement: #AssignExpr[
                                                $left: #Field[
                                                   $base: #NameExpr['ctx']
                                                   $name: #NameExpr['key']
                                                ]
                                                $right: #ApplyExpr[
                                                   $recv: #NameExpr['@cli_key']
                                                   $recv: #NameExpr['public_key']
                                                ]
                                             ]
                                             $statement: #AssignExpr[
                                                $left: #Field[
                                                   $base: #NameExpr['ctx']
                                                   $name: #NameExpr['cert']
                                                ]
                                                $right: #NameExpr['@cli_cert']
                                             ]
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['server_connect']
                                                $param: #List[
                                                   $expression: #NameExpr['port']
                                                   $expression: #NameExpr['ctx']
                                                ]
                                                $body: #Block[
                                                   $body: #Empty['']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['ctx']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['SSLContext']
                                          ]
                                          $recv: #NameExpr['new']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['client_cert_cb']
                                       ]
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['Proc']
                                          $recv: #NameExpr['new']
                                          $body: #Block[
                                             $param: #NameExpr['ssl']
                                             $body: #Array[
                                                $index: #List[
                                                   $expression: #NameExpr['@cli_cert']
                                                   $expression: #ApplyExpr[
                                                      $recv: #NameExpr['@cli_key']
                                                      $recv: #NameExpr['public_key']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_handshake_error']
                                       $body: #Block[
                                          $body: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['server_connect']
                                             $param: #List[
                                                $expression: #NameExpr['port']
                                                $expression: #NameExpr['ctx']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_client_ca']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx_proc']
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['Proc']
                                 $recv: #NameExpr['new']
                                 $body: #Block[
                                    $param: #NameExpr['ctx']
                                    $body: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['client_ca']
                                       ]
                                       $right: #Array[
                                          $index: #List[
                                             $expression: #NameExpr['@ca_cert']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['vflag']
                              $right: #OrExpr[
                                 $left: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['VERIFY_PEER']
                                 ]
                                 $right: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['VERIFY_FAIL_IF_NO_PEER_CERT']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $param: #List[
                                 $hash: #Hash[
                                    $key: #NameExpr['verify_mode']
                                    $value: #NameExpr['vflag']
                                 ]
                                 $hash: #Hash[
                                    $key: #NameExpr['ctx_proc']
                                    $value: #NameExpr['ctx_proc']
                                 ]
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['ctx']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['SSLContext']
                                          ]
                                          $recv: #NameExpr['new']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['client_ca_from_server']
                                       $right: #Nil['nil']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['client_cert_cb']
                                       ]
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['Proc']
                                          $recv: #NameExpr['new']
                                          $body: #Block[
                                             $param: #NameExpr['sslconn']
                                             $body: #List[
                                                $statement: #AssignExpr[
                                                   $left: #NameExpr['client_ca_from_server']
                                                   $right: #ApplyExpr[
                                                      $recv: #NameExpr['sslconn']
                                                      $recv: #NameExpr['client_ca']
                                                   ]
                                                ]
                                                $statement: #Array[
                                                   $index: #List[
                                                      $expression: #NameExpr['@cli_cert']
                                                      $expression: #NameExpr['@cli_key']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['server_connect']
                                       $param: #List[
                                          $expression: #NameExpr['port']
                                          $expression: #NameExpr['ctx']
                                       ]
                                       $body: #Block[
                                          $param: #NameExpr['ssl']
                                          $body: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_equal']
                                             $param: #List[
                                                $expression: #Array[
                                                   $index: #List[
                                                      $expression: #NameExpr['@ca']
                                                   ]
                                                ]
                                                $expression: #NameExpr['client_ca_from_server']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_read_nonblock_without_session']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #ApplyExpr[
                           $recv: #Field[
                              $recv: #NameExpr['OpenSSL']
                              $name: #NameExpr['TestUtils']
                           ]
                           $recv: #NameExpr['silent']
                           $body: #Block[
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['start_server']
                                 $param: #List[
                                    $hash: #Hash[
                                       $key: #NameExpr['start_immediately']
                                       $value: #FalseExpr['false']
                                    ]
                                 ]
                                 $body: #Block[
                                    $param: #MultipleLeftHandSideExpression[
                                       $item: #NameExpr['server']
                                       $item: #NameExpr['port']
                                    ]
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['sock']
                                          $right: #ApplyExpr[
                                             $recv: #NameExpr['TCPSocket']
                                             $recv: #NameExpr['new']
                                             $param: #List[
                                                $expression: #StringExpr['127.0.0.1']
                                                $expression: #NameExpr['port']
                                             ]
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['ssl']
                                          $right: #ApplyExpr[
                                             $recv: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['SSL']
                                                ]
                                                $name: #NameExpr['SSLSocket']
                                             ]
                                             $recv: #NameExpr['new']
                                             $param: #List[
                                                $expression: #NameExpr['sock']
                                             ]
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ssl']
                                             $name: #NameExpr['sync_close']
                                          ]
                                          $right: #TrueExpr['true']
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #NameExpr['wait_readable']
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['read_nonblock']
                                                $param: #List[
                                                   $expression: #IntExpr['100']
                                                   $hash: #Hash[
                                                      $key: #NameExpr['exception']
                                                      $value: #FalseExpr['false']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          $recv: #NameExpr['ssl']
                                          $recv: #NameExpr['write']
                                          $param: #List[
                                             $expression: #StringExpr['abc\\n']
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          $base: #NameExpr['IO']
                                          $recv: #NameExpr['select']
                                          $param: #List[
                                             $expression: #Array[
                                                $index: #List[
                                                   $expression: #NameExpr['ssl']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #StringExpr['a']
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['read_nonblock']
                                                $param: #List[
                                                   $expression: #IntExpr['1']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #StringExpr['bc\\n']
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['read_nonblock']
                                                $param: #List[
                                                   $expression: #IntExpr['100']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #NameExpr['wait_readable']
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['read_nonblock']
                                                $param: #List[
                                                   $expression: #IntExpr['100']
                                                   $hash: #Hash[
                                                      $key: #NameExpr['exception']
                                                      $value: #FalseExpr['false']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          $recv: #NameExpr['ssl']
                                          $recv: #NameExpr['close']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_starttls']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['server_proc']
                              $right: #Lambda[
                                 $param: #List[
                                    $param: #Param[
                                       $param: #NameExpr['ctx']
                                    ]
                                    $param: #Param[
                                       $param: #NameExpr['ssl']
                                    ]
                                 ]
                                 $body: #Block[
                                    $body: #ExceptionBlock[
                                       $main: #While[
                                          $cond: #AssignExpr[
                                             $left: #NameExpr['line']
                                             $right: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['gets']
                                             ]
                                          ]
                                          $body: #List[
                                             $statement: #IfExpr[
                                                $cond: #AssignExpr[
                                                   $left: #NameExpr['line']
                                                   $right: #ComplExpr[
                                                      $expr: #Regex['/^STARTTLS$/']
                                                   ]
                                                ]
                                                $then: #List[
                                                   $statement: #ApplyExpr[
                                                      $recv: #NameExpr['ssl']
                                                      $recv: #NameExpr['write']
                                                      $param: #List[
                                                         $expression: #StringExpr['x']
                                                      ]
                                                   ]
                                                   $statement: #ApplyExpr[
                                                      $recv: #NameExpr['ssl']
                                                      $recv: #NameExpr['flush']
                                                   ]
                                                   $statement: #ApplyExpr[
                                                      $recv: #NameExpr['ssl']
                                                      $recv: #NameExpr['accept']
                                                   ]
                                                   $statement: #Next['next']
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['write']
                                                $param: #List[
                                                   $expression: #NameExpr['line']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $rescue: #List[
                                          $rescue: #Rescue[
                                             $class: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['SSL']
                                                ]
                                                $name: #NameExpr['SSLError']
                                             ]
                                             $then: #Empty['']
                                          ]
                                          $rescue: #Rescue[
                                             $class: #NameExpr['IOError']
                                             $then: #Empty['']
                                          ]
                                       ]
                                       $ensure: #Rescue[
                                          $body: #ApplyExpr[
                                             $recv: #NameExpr['ssl']
                                             $recv: #NameExpr['close']
                                          ]
                                          $rescue: #Nil['nil']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              $recv: #NameExpr['EnvUtil']
                              $recv: #NameExpr['suppress_warning']
                              $body: #Block[
                                 $body: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['start_server']
                                    $param: #List[
                                       $hash: #Hash[
                                          $key: #NameExpr['start_immediately']
                                          $value: #FalseExpr['false']
                                       ]
                                       $hash: #Hash[
                                          $key: #NameExpr['server_proc']
                                          $value: #NameExpr['server_proc']
                                       ]
                                    ]
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['server']
                                          $item: #NameExpr['port']
                                       ]
                                       $body: #ExceptionBlock[
                                          $main: #List[
                                             $statement: #AssignExpr[
                                                $left: #NameExpr['sock']
                                                $right: #ApplyExpr[
                                                   $recv: #NameExpr['TCPSocket']
                                                   $recv: #NameExpr['new']
                                                   $param: #List[
                                                      $expression: #StringExpr['127.0.0.1']
                                                      $expression: #NameExpr['port']
                                                   ]
                                                ]
                                             ]
                                             $statement: #AssignExpr[
                                                $left: #NameExpr['ssl']
                                                $right: #ApplyExpr[
                                                   $recv: #Field[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $name: #NameExpr['SSLSocket']
                                                   ]
                                                   $recv: #NameExpr['new']
                                                   $param: #List[
                                                      $expression: #NameExpr['sock']
                                                   ]
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                $base: #NameExpr['ssl']
                                                $recv: #NameExpr['puts']
                                                $param: #List[
                                                   $expression: #StringExpr['plaintext']
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['assert_equal']
                                                $param: #List[
                                                   $expression: #StringExpr['plaintext\\n']
                                                   $expression: #ApplyExpr[
                                                      $recv: #NameExpr['ssl']
                                                      $recv: #NameExpr['gets']
                                                   ]
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['puts']
                                                $param: #List[
                                                   $expression: #StringExpr['STARTTLS']
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['read']
                                                $param: #List[
                                                   $expression: #IntExpr['1']
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['connect']
                                             ]
                                             $statement: #ApplyExpr[
                                                $base: #NameExpr['ssl']
                                                $recv: #NameExpr['puts']
                                                $param: #List[
                                                   $expression: #StringExpr['over-tls']
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['assert_equal']
                                                $param: #List[
                                                   $expression: #StringExpr['over-tls\\n']
                                                   $expression: #ApplyExpr[
                                                      $recv: #NameExpr['ssl']
                                                      $recv: #NameExpr['gets']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $ensure: #List[
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['close']
                                             ]
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['sock']
                                                $recv: #NameExpr['close']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_parallel']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['start_server']
                           $body: #Block[
                              $param: #MultipleLeftHandSideExpression[
                                 $item: #NameExpr['server']
                                 $item: #NameExpr['port']
                              ]
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ssls']
                                    $right: #Array['[]']
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #IntExpr['10']
                                    $recv: #NameExpr['times']
                                    $body: #Block[
                                       $body: #List[
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['sock']
                                             $right: #ApplyExpr[
                                                $recv: #NameExpr['TCPSocket']
                                                $recv: #NameExpr['new']
                                                $param: #List[
                                                   $expression: #StringExpr['127.0.0.1']
                                                   $expression: #NameExpr['port']
                                                ]
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['ssl']
                                             $right: #ApplyExpr[
                                                $recv: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLSocket']
                                                ]
                                                $recv: #NameExpr['new']
                                                $param: #List[
                                                   $expression: #NameExpr['sock']
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             $recv: #NameExpr['ssl']
                                             $recv: #NameExpr['connect']
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ssl']
                                                $name: #NameExpr['sync_close']
                                             ]
                                             $right: #TrueExpr['true']
                                          ]
                                          $statement: #LShiftExpr[
                                             $left: #NameExpr['ssls']
                                             $right: #NameExpr['ssl']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['str']
                                    $right: #AddExpr[
                                       $left: #MulExpr[
                                          $left: #StringExpr['x']
                                          $right: #IntExpr['1000']
                                       ]
                                       $right: #StringExpr['\\n']
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['ITERATIONS']
                                    $recv: #NameExpr['times']
                                    $body: #Block[
                                       $body: #ApplyExpr[
                                          $recv: #NameExpr['ssls']
                                          $recv: #NameExpr['each']
                                          $body: #Block[
                                             $param: #NameExpr['ssl']
                                             $body: #List[
                                                $statement: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['puts']
                                                   $param: #List[
                                                      $expression: #NameExpr['str']
                                                   ]
                                                ]
                                                $statement: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['assert_equal']
                                                   $param: #List[
                                                      $expression: #NameExpr['str']
                                                      $expression: #ApplyExpr[
                                                         $recv: #NameExpr['ssl']
                                                         $recv: #NameExpr['gets']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['ssls']
                                    $recv: #NameExpr['each']
                                    $body: #Block[
                                       $param: #NameExpr['ssl']
                                       $body: #ApplyExpr[
                                          $recv: #NameExpr['ssl']
                                          $recv: #NameExpr['close']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_verify_result']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $param: #List[
                                 $hash: #Hash[
                                    $key: #NameExpr['ignore_listener_error']
                                    $value: #TrueExpr['true']
                                 ]
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['sock']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['TCPSocket']
                                          $recv: #NameExpr['new']
                                          $param: #List[
                                             $expression: #StringExpr['127.0.0.1']
                                             $expression: #NameExpr['port']
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['ctx']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['SSLContext']
                                          ]
                                          $recv: #NameExpr['new']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['verify_mode']
                                       ]
                                       $right: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $name: #NameExpr['VERIFY_PEER']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['ssl']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['SSLSocket']
                                          ]
                                          $recv: #NameExpr['new']
                                          $param: #List[
                                             $expression: #NameExpr['sock']
                                             $expression: #NameExpr['ctx']
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ssl']
                                          $name: #NameExpr['sync_close']
                                       ]
                                       $right: #TrueExpr['true']
                                    ]
                                    $statement: #ExceptionBlock[
                                       $main: #List[
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_raise']
                                             $param: #List[
                                                $expression: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLError']
                                                ]
                                             ]
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['connect']
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_equal']
                                             $param: #List[
                                                $expression: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['X509']
                                                   ]
                                                   $name: #NameExpr['V_ERR_SELF_SIGNED_CERT_IN_CHAIN']
                                                ]
                                                $expression: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['verify_result']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $ensure: #ApplyExpr[
                                          $recv: #NameExpr['ssl']
                                          $recv: #NameExpr['close']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['sock']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['TCPSocket']
                                          $recv: #NameExpr['new']
                                          $param: #List[
                                             $expression: #StringExpr['127.0.0.1']
                                             $expression: #NameExpr['port']
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['ctx']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['SSLContext']
                                          ]
                                          $recv: #NameExpr['new']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['verify_mode']
                                       ]
                                       $right: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $name: #NameExpr['VERIFY_PEER']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['verify_callback']
                                       ]
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['Proc']
                                          $recv: #NameExpr['new']
                                          $body: #Block[
                                             $param: #MultipleLeftHandSideExpression[
                                                $item: #NameExpr['preverify_ok']
                                                $item: #NameExpr['store_ctx']
                                             ]
                                             $body: #List[
                                                $statement: #AssignExpr[
                                                   $left: #Field[
                                                      $base: #NameExpr['store_ctx']
                                                      $name: #NameExpr['error']
                                                   ]
                                                   $right: #Field[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['X509']
                                                      ]
                                                      $name: #NameExpr['V_OK']
                                                   ]
                                                ]
                                                $statement: #TrueExpr['true']
                                             ]
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['ssl']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['SSLSocket']
                                          ]
                                          $recv: #NameExpr['new']
                                          $param: #List[
                                             $expression: #NameExpr['sock']
                                             $expression: #NameExpr['ctx']
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ssl']
                                          $name: #NameExpr['sync_close']
                                       ]
                                       $right: #TrueExpr['true']
                                    ]
                                    $statement: #ExceptionBlock[
                                       $main: #List[
                                          $statement: #ApplyExpr[
                                             $recv: #NameExpr['ssl']
                                             $recv: #NameExpr['connect']
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_equal']
                                             $param: #List[
                                                $expression: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['X509']
                                                   ]
                                                   $name: #NameExpr['V_OK']
                                                ]
                                                $expression: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['verify_result']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $ensure: #ApplyExpr[
                                          $recv: #NameExpr['ssl']
                                          $recv: #NameExpr['close']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $param: #List[
                                 $hash: #Hash[
                                    $key: #NameExpr['ignore_listener_error']
                                    $value: #TrueExpr['true']
                                 ]
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['sock']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['TCPSocket']
                                          $recv: #NameExpr['new']
                                          $param: #List[
                                             $expression: #StringExpr['127.0.0.1']
                                             $expression: #NameExpr['port']
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['ctx']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['SSLContext']
                                          ]
                                          $recv: #NameExpr['new']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['verify_mode']
                                       ]
                                       $right: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $name: #NameExpr['VERIFY_PEER']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['verify_callback']
                                       ]
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['Proc']
                                          $recv: #NameExpr['new']
                                          $body: #Block[
                                             $param: #MultipleLeftHandSideExpression[
                                                $item: #NameExpr['preverify_ok']
                                                $item: #NameExpr['store_ctx']
                                             ]
                                             $body: #List[
                                                $statement: #AssignExpr[
                                                   $left: #Field[
                                                      $base: #NameExpr['store_ctx']
                                                      $name: #NameExpr['error']
                                                   ]
                                                   $right: #Field[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['X509']
                                                      ]
                                                      $name: #NameExpr['V_ERR_APPLICATION_VERIFICATION']
                                                   ]
                                                ]
                                                $statement: #FalseExpr['false']
                                             ]
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['ssl']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['SSLSocket']
                                          ]
                                          $recv: #NameExpr['new']
                                          $param: #List[
                                             $expression: #NameExpr['sock']
                                             $expression: #NameExpr['ctx']
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ssl']
                                          $name: #NameExpr['sync_close']
                                       ]
                                       $right: #TrueExpr['true']
                                    ]
                                    $statement: #ExceptionBlock[
                                       $main: #List[
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_raise']
                                             $param: #List[
                                                $expression: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLError']
                                                ]
                                             ]
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['connect']
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_equal']
                                             $param: #List[
                                                $expression: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['X509']
                                                   ]
                                                   $name: #NameExpr['V_ERR_APPLICATION_VERIFICATION']
                                                ]
                                                $expression: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['verify_result']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $ensure: #ApplyExpr[
                                          $recv: #NameExpr['ssl']
                                          $recv: #NameExpr['close']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_exception_in_verify_callback_is_ignored']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['start_server']
                           $param: #List[
                              $hash: #Hash[
                                 $key: #NameExpr['ignore_listener_error']
                                 $value: #TrueExpr['true']
                              ]
                           ]
                           $body: #Block[
                              $param: #MultipleLeftHandSideExpression[
                                 $item: #NameExpr['server']
                                 $item: #NameExpr['port']
                              ]
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['sock']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['TCPSocket']
                                       $recv: #NameExpr['new']
                                       $param: #List[
                                          $expression: #StringExpr['127.0.0.1']
                                          $expression: #NameExpr['port']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ctx']
                                    $right: #ApplyExpr[
                                       $recv: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $name: #NameExpr['SSLContext']
                                       ]
                                       $recv: #NameExpr['new']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['ctx']
                                       $name: #NameExpr['verify_mode']
                                    ]
                                    $right: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['OpenSSL']
                                          $name: #NameExpr['SSL']
                                       ]
                                       $name: #NameExpr['VERIFY_PEER']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['ctx']
                                       $name: #NameExpr['verify_callback']
                                    ]
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['Proc']
                                       $recv: #NameExpr['new']
                                       $body: #Block[
                                          $param: #MultipleLeftHandSideExpression[
                                             $item: #NameExpr['preverify_ok']
                                             $item: #NameExpr['store_ctx']
                                          ]
                                          $body: #List[
                                             $statement: #AssignExpr[
                                                $left: #Field[
                                                   $base: #NameExpr['store_ctx']
                                                   $name: #NameExpr['error']
                                                ]
                                                $right: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['X509']
                                                   ]
                                                   $name: #NameExpr['V_OK']
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['raise']
                                                $param: #List[
                                                   $expression: #NameExpr['RuntimeError']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ssl']
                                    $right: #ApplyExpr[
                                       $recv: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $name: #NameExpr['SSLSocket']
                                       ]
                                       $recv: #NameExpr['new']
                                       $param: #List[
                                          $expression: #NameExpr['sock']
                                          $expression: #NameExpr['ctx']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['ssl']
                                       $name: #NameExpr['sync_close']
                                    ]
                                    $right: #TrueExpr['true']
                                 ]
                                 $statement: #ExceptionBlock[
                                    $main: #List[
                                       $statement: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['TestUtils']
                                          ]
                                          $recv: #NameExpr['silent']
                                          $body: #Block[
                                             $body: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['assert_raise']
                                                $param: #List[
                                                   $expression: #Field[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $name: #NameExpr['SSLError']
                                                   ]
                                                ]
                                                $body: #Block[
                                                   $body: #ApplyExpr[
                                                      $recv: #NameExpr['ssl']
                                                      $recv: #NameExpr['connect']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['X509']
                                                ]
                                                $name: #NameExpr['V_ERR_CERT_REJECTED']
                                             ]
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['verify_result']
                                             ]
                                          ]
                                       ]
                                    ]
                                    $ensure: #ApplyExpr[
                                       $recv: #NameExpr['ssl']
                                       $recv: #NameExpr['close']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_sslctx_set_params']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['SSLContext']
                                 ]
                                 $recv: #NameExpr['new']
                              ]
                           ]
                           $statement: #ApplyExpr[
                              $recv: #NameExpr['ctx']
                              $recv: #NameExpr['set_params']
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['VERIFY_PEER']
                                 ]
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['ctx']
                                    $recv: #NameExpr['verify_mode']
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['ciphers_names']
                              $right: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['ctx']
                                    $recv: #NameExpr['ciphers']
                                 ]
                                 $recv: #NameExpr['collect']
                                 $body: #Block[
                                    $param: #MultipleLeftHandSideExpression[
                                       $item: #NameExpr['v']
                                       $item: #NameExpr['_']
                                       $item: #NameExpr['_']
                                       $item: #NameExpr['_']
                                    ]
                                    $body: #NameExpr['v']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['ciphers_names']
                                    $recv: #NameExpr['all?']
                                    $body: #Block[
                                       $param: #NameExpr['v']
                                       $body: #NotMatch[
                                          $left: #Regex['/A(EC)?DH/']
                                          $right: #NameExpr['v']
                                       ]
                                    ]
                                 ]
                                 $expression: #StringExpr['anon ciphers are disabled']
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['ciphers_names']
                                    $recv: #NameExpr['all?']
                                    $body: #Block[
                                       $param: #NameExpr['v']
                                       $body: #NotMatch[
                                          $left: #Regex['/(RC4|MD5|EXP|DES)/']
                                          $right: #NameExpr['v']
                                       ]
                                    ]
                                 ]
                                 $expression: #StringExpr['weak ciphers are disabled']
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #IntExpr['0']
                                 $expression: #AndExpr[
                                    $left: #ApplyExpr[
                                       $recv: #NameExpr['ctx']
                                       $recv: #NameExpr['options']
                                    ]
                                    $right: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['OpenSSL']
                                          $name: #NameExpr['SSL']
                                       ]
                                       $name: #NameExpr['OP_DONT_INSERT_EMPTY_FRAGMENTS']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #IfExpr[
                              $cond: #Defined[
                                 $base: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['OP_NO_COMPRESSION']
                                 ]
                              ]
                              $then: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_equal']
                                 $param: #List[
                                    $expression: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['OpenSSL']
                                          $name: #NameExpr['SSL']
                                       ]
                                       $name: #NameExpr['OP_NO_COMPRESSION']
                                    ]
                                    $expression: #AndExpr[
                                       $left: #ApplyExpr[
                                          $recv: #NameExpr['ctx']
                                          $recv: #NameExpr['options']
                                       ]
                                       $right: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $name: #NameExpr['OP_NO_COMPRESSION']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_post_connect_check_with_anon_ciphers']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx_proc']
                              $right: #Lambda[
                                 $param: #List[
                                    $param: #Param[
                                       $param: #NameExpr['ctx']
                                    ]
                                 ]
                                 $body: #Block[
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx']
                                             $name: #NameExpr['ciphers']
                                          ]
                                          $right: #StringExpr['aNULL']
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx']
                                             $name: #NameExpr['security_level']
                                          ]
                                          $right: #IntExpr['0']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $param: #List[
                                 $hash: #Hash[
                                    $key: #NameExpr['ctx_proc']
                                    $value: #NameExpr['ctx_proc']
                                 ]
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['ctx']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['SSLContext']
                                          ]
                                          $recv: #NameExpr['new']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['ciphers']
                                       ]
                                       $right: #StringExpr['aNULL']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['security_level']
                                       ]
                                       $right: #IntExpr['0']
                                    ]
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['server_connect']
                                       $param: #List[
                                          $expression: #NameExpr['port']
                                          $expression: #NameExpr['ctx']
                                       ]
                                       $body: #Block[
                                          $param: #NameExpr['ssl']
                                          $body: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_raise_with_message']
                                             $param: #List[
                                                $expression: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLError']
                                                ]
                                                $expression: #Regex['/anonymous cipher suite/i']
                                             ]
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['post_connection_check']
                                                   $param: #List[
                                                      $expression: #StringExpr['localhost.localdomain']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_post_connection_check']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['sslerr']
                              $right: #Field[
                                 $recv: #Field[
                                    $recv: #NameExpr['OpenSSL']
                                    $name: #NameExpr['SSL']
                                 ]
                                 $name: #NameExpr['SSLError']
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['server_connect']
                                    $param: #List[
                                       $expression: #NameExpr['port']
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['ssl']
                                       $body: #List[
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_raise']
                                             $param: #List[
                                                $expression: #NameExpr['sslerr']
                                             ]
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['post_connection_check']
                                                   $param: #List[
                                                      $expression: #StringExpr['localhost.localdomain']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_raise']
                                             $param: #List[
                                                $expression: #NameExpr['sslerr']
                                             ]
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['post_connection_check']
                                                   $param: #List[
                                                      $expression: #StringExpr['127.0.0.1']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert']
                                             $param: #List[
                                                $expression: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['post_connection_check']
                                                   $param: #List[
                                                      $expression: #StringExpr['localhost']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_raise']
                                             $param: #List[
                                                $expression: #NameExpr['sslerr']
                                             ]
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['post_connection_check']
                                                   $param: #List[
                                                      $expression: #StringExpr['foo.example.com']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['cert']
                                             $right: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['peer_cert']
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert']
                                             $param: #List[
                                                $expression: #NotExpr[
                                                   $expr: #ApplyExpr[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $recv: #NameExpr['verify_certificate_identity']
                                                      $param: #List[
                                                         $expression: #NameExpr['cert']
                                                         $expression: #StringExpr['localhost.localdomain']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert']
                                             $param: #List[
                                                $expression: #NotExpr[
                                                   $expr: #ApplyExpr[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $recv: #NameExpr['verify_certificate_identity']
                                                      $param: #List[
                                                         $expression: #NameExpr['cert']
                                                         $expression: #StringExpr['127.0.0.1']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert']
                                             $param: #List[
                                                $expression: #ApplyExpr[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $recv: #NameExpr['verify_certificate_identity']
                                                   $param: #List[
                                                      $expression: #NameExpr['cert']
                                                      $expression: #StringExpr['localhost']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert']
                                             $param: #List[
                                                $expression: #NotExpr[
                                                   $expr: #ApplyExpr[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $recv: #NameExpr['verify_certificate_identity']
                                                      $param: #List[
                                                         $expression: #NameExpr['cert']
                                                         $expression: #StringExpr['foo.example.com']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['now']
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['Time']
                                 $recv: #NameExpr['now']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['exts']
                              $right: #Array[
                                 $index: #List[
                                    $expression: #Array[
                                       $index: #List[
                                          $expression: #StringExpr['keyUsage']
                                          $expression: #StringExpr['keyEncipherment,digitalSignature']
                                          $expression: #TrueExpr['true']
                                       ]
                                    ]
                                    $expression: #Array[
                                       $index: #List[
                                          $expression: #StringExpr['subjectAltName']
                                          $expression: #StringExpr['DNS:localhost.localdomain']
                                          $expression: #FalseExpr['false']
                                       ]
                                    ]
                                    $expression: #Array[
                                       $index: #List[
                                          $expression: #StringExpr['subjectAltName']
                                          $expression: #StringExpr['IP:127.0.0.1']
                                          $expression: #FalseExpr['false']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['@svr_cert']
                              $right: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['issue_cert']
                                 $param: #List[
                                    $expression: #NameExpr['@svr']
                                    $expression: #NameExpr['@svr_key']
                                    $expression: #IntExpr['4']
                                    $expression: #NameExpr['now']
                                    $expression: #AddExpr[
                                       $left: #NameExpr['now']
                                       $right: #IntExpr['1800']
                                    ]
                                    $expression: #NameExpr['exts']
                                    $expression: #NameExpr['@ca_cert']
                                    $expression: #NameExpr['@ca_key']
                                    $expression: #ApplyExpr[
                                       $recv: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['Digest']
                                          ]
                                          $name: #NameExpr['SHA1']
                                       ]
                                       $recv: #NameExpr['new']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['server_connect']
                                    $param: #List[
                                       $expression: #NameExpr['port']
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['ssl']
                                       $body: #List[
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert']
                                             $param: #List[
                                                $expression: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['post_connection_check']
                                                   $param: #List[
                                                      $expression: #StringExpr['localhost.localdomain']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert']
                                             $param: #List[
                                                $expression: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['post_connection_check']
                                                   $param: #List[
                                                      $expression: #StringExpr['127.0.0.1']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_raise']
                                             $param: #List[
                                                $expression: #NameExpr['sslerr']
                                             ]
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['post_connection_check']
                                                   $param: #List[
                                                      $expression: #StringExpr['localhost']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_raise']
                                             $param: #List[
                                                $expression: #NameExpr['sslerr']
                                             ]
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['post_connection_check']
                                                   $param: #List[
                                                      $expression: #StringExpr['foo.example.com']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['cert']
                                             $right: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['peer_cert']
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert']
                                             $param: #List[
                                                $expression: #ApplyExpr[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $recv: #NameExpr['verify_certificate_identity']
                                                   $param: #List[
                                                      $expression: #NameExpr['cert']
                                                      $expression: #StringExpr['localhost.localdomain']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert']
                                             $param: #List[
                                                $expression: #ApplyExpr[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $recv: #NameExpr['verify_certificate_identity']
                                                   $param: #List[
                                                      $expression: #NameExpr['cert']
                                                      $expression: #StringExpr['127.0.0.1']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert']
                                             $param: #List[
                                                $expression: #NotExpr[
                                                   $expr: #ApplyExpr[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $recv: #NameExpr['verify_certificate_identity']
                                                      $param: #List[
                                                         $expression: #NameExpr['cert']
                                                         $expression: #StringExpr['localhost']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert']
                                             $param: #List[
                                                $expression: #NotExpr[
                                                   $expr: #ApplyExpr[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $recv: #NameExpr['verify_certificate_identity']
                                                      $param: #List[
                                                         $expression: #NameExpr['cert']
                                                         $expression: #StringExpr['foo.example.com']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['now']
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['Time']
                                 $recv: #NameExpr['now']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['exts']
                              $right: #Array[
                                 $index: #List[
                                    $expression: #Array[
                                       $index: #List[
                                          $expression: #StringExpr['keyUsage']
                                          $expression: #StringExpr['keyEncipherment,digitalSignature']
                                          $expression: #TrueExpr['true']
                                       ]
                                    ]
                                    $expression: #Array[
                                       $index: #List[
                                          $expression: #StringExpr['subjectAltName']
                                          $expression: #StringExpr['DNS:*.localdomain']
                                          $expression: #FalseExpr['false']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['@svr_cert']
                              $right: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['issue_cert']
                                 $param: #List[
                                    $expression: #NameExpr['@svr']
                                    $expression: #NameExpr['@svr_key']
                                    $expression: #IntExpr['5']
                                    $expression: #NameExpr['now']
                                    $expression: #AddExpr[
                                       $left: #NameExpr['now']
                                       $right: #IntExpr['1800']
                                    ]
                                    $expression: #NameExpr['exts']
                                    $expression: #NameExpr['@ca_cert']
                                    $expression: #NameExpr['@ca_key']
                                    $expression: #ApplyExpr[
                                       $recv: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['Digest']
                                          ]
                                          $name: #NameExpr['SHA1']
                                       ]
                                       $recv: #NameExpr['new']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['server_connect']
                                    $param: #List[
                                       $expression: #NameExpr['port']
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['ssl']
                                       $body: #List[
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert']
                                             $param: #List[
                                                $expression: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['post_connection_check']
                                                   $param: #List[
                                                      $expression: #StringExpr['localhost.localdomain']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_raise']
                                             $param: #List[
                                                $expression: #NameExpr['sslerr']
                                             ]
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['post_connection_check']
                                                   $param: #List[
                                                      $expression: #StringExpr['127.0.0.1']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_raise']
                                             $param: #List[
                                                $expression: #NameExpr['sslerr']
                                             ]
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['post_connection_check']
                                                   $param: #List[
                                                      $expression: #StringExpr['localhost']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_raise']
                                             $param: #List[
                                                $expression: #NameExpr['sslerr']
                                             ]
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['post_connection_check']
                                                   $param: #List[
                                                      $expression: #StringExpr['foo.example.com']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['cert']
                                             $right: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['peer_cert']
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert']
                                             $param: #List[
                                                $expression: #ApplyExpr[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $recv: #NameExpr['verify_certificate_identity']
                                                   $param: #List[
                                                      $expression: #NameExpr['cert']
                                                      $expression: #StringExpr['localhost.localdomain']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert']
                                             $param: #List[
                                                $expression: #NotExpr[
                                                   $expr: #ApplyExpr[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $recv: #NameExpr['verify_certificate_identity']
                                                      $param: #List[
                                                         $expression: #NameExpr['cert']
                                                         $expression: #StringExpr['127.0.0.1']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert']
                                             $param: #List[
                                                $expression: #NotExpr[
                                                   $expr: #ApplyExpr[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $recv: #NameExpr['verify_certificate_identity']
                                                      $param: #List[
                                                         $expression: #NameExpr['cert']
                                                         $expression: #StringExpr['localhost']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert']
                                             $param: #List[
                                                $expression: #NotExpr[
                                                   $expr: #ApplyExpr[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $recv: #NameExpr['verify_certificate_identity']
                                                      $param: #List[
                                                         $expression: #NameExpr['cert']
                                                         $expression: #StringExpr['foo.example.com']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_verify_certificate_identity']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #ApplyExpr[
                           $recv: #Array[
                              $index: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #FalseExpr['false']
                              ]
                           ]
                           $recv: #NameExpr['each']
                           $body: #Block[
                              $param: #NameExpr['criticality']
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['cert']
                                    $right: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['create_null_byte_SAN_certificate']
                                       $param: #List[
                                          $expression: #NameExpr['criticality']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_equal']
                                    $param: #List[
                                       $expression: #FalseExpr['false']
                                       $expression: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $recv: #NameExpr['verify_certificate_identity']
                                          $param: #List[
                                             $expression: #NameExpr['cert']
                                             $expression: #StringExpr['www.example.com']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_equal']
                                    $param: #List[
                                       $expression: #TrueExpr['true']
                                       $expression: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $recv: #NameExpr['verify_certificate_identity']
                                          $param: #List[
                                             $expression: #NameExpr['cert']
                                             $expression: #StringExpr['www.example.com\\0.evil.com']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_equal']
                                    $param: #List[
                                       $expression: #FalseExpr['false']
                                       $expression: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $recv: #NameExpr['verify_certificate_identity']
                                          $param: #List[
                                             $expression: #NameExpr['cert']
                                             $expression: #StringExpr['192.168.7.255']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_equal']
                                    $param: #List[
                                       $expression: #TrueExpr['true']
                                       $expression: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $recv: #NameExpr['verify_certificate_identity']
                                          $param: #List[
                                             $expression: #NameExpr['cert']
                                             $expression: #StringExpr['192.168.7.1']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_equal']
                                    $param: #List[
                                       $expression: #FalseExpr['false']
                                       $expression: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $recv: #NameExpr['verify_certificate_identity']
                                          $param: #List[
                                             $expression: #NameExpr['cert']
                                             $expression: #StringExpr['13::17']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_equal']
                                    $param: #List[
                                       $expression: #TrueExpr['true']
                                       $expression: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $recv: #NameExpr['verify_certificate_identity']
                                          $param: #List[
                                             $expression: #NameExpr['cert']
                                             $expression: #StringExpr['13:0:0:0:0:0:0:17']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_verify_hostname']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_hostname']
                                    $param: #List[
                                       $expression: #StringExpr['www.example.com']
                                       $expression: #StringExpr['*.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_hostname']
                                    $param: #List[
                                       $expression: #StringExpr['www.subdomain.example.com']
                                       $expression: #StringExpr['*.example.com']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_verify_wildcard']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_wildcard']
                                    $param: #List[
                                       $expression: #StringExpr['foo']
                                       $expression: #StringExpr['x*']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_wildcard']
                                    $param: #List[
                                       $expression: #StringExpr['foo']
                                       $expression: #StringExpr['foo']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_wildcard']
                                    $param: #List[
                                       $expression: #StringExpr['foo']
                                       $expression: #StringExpr['f*']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_wildcard']
                                    $param: #List[
                                       $expression: #StringExpr['foo']
                                       $expression: #StringExpr['*']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_wildcard']
                                    $param: #List[
                                       $expression: #StringExpr['abc*bcd']
                                       $expression: #StringExpr['abcd']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_wildcard']
                                    $param: #List[
                                       $expression: #StringExpr['xn--qdk4b9b']
                                       $expression: #StringExpr['x*']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_wildcard']
                                    $param: #List[
                                       $expression: #StringExpr['xn--qdk4b9b']
                                       $expression: #StringExpr['*--qdk4b9b']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_wildcard']
                                    $param: #List[
                                       $expression: #StringExpr['xn--qdk4b9b']
                                       $expression: #StringExpr['xn--qdk4b9b']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_post_connection_check_wildcard_san']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_san']
                                          $param: #List[
                                             $expression: #StringExpr['DNS:*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['www.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_san']
                                          $param: #List[
                                             $expression: #StringExpr['DNS:*.Example.COM']
                                          ]
                                       ]
                                       $expression: #StringExpr['www.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_san']
                                          $param: #List[
                                             $expression: #StringExpr['DNS:*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['WWW.Example.COM']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_san']
                                          $param: #List[
                                             $expression: #StringExpr['DNS:www.*.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['www.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_san']
                                          $param: #List[
                                             $expression: #StringExpr['DNS:*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['foo.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_san']
                                          $param: #List[
                                             $expression: #StringExpr['DNS:*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['bar.foo.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_san']
                                          $param: #List[
                                             $expression: #StringExpr['DNS:baz*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['baz1.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_san']
                                          $param: #List[
                                             $expression: #StringExpr['DNS:*baz.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['foobaz.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_san']
                                          $param: #List[
                                             $expression: #StringExpr['DNS:b*z.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['buzz.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_san']
                                          $param: #List[
                                             $expression: #StringExpr['DNS:*b*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['abc.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_san']
                                          $param: #List[
                                             $expression: #StringExpr['DNS:*b*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['ab.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_san']
                                          $param: #List[
                                             $expression: #StringExpr['DNS:*b*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['bc.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_san']
                                          $param: #List[
                                             $expression: #StringExpr['DNS:xn*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['xn1ca.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_san']
                                          $param: #List[
                                             $expression: #StringExpr['DNS:xn--*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['xn--1ca.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_san']
                                          $param: #List[
                                             $expression: #StringExpr['DNS:á*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['á1.example.com']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_post_connection_check_wildcard_cn']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_name']
                                          $param: #List[
                                             $expression: #StringExpr['*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['www.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_name']
                                          $param: #List[
                                             $expression: #StringExpr['*.Example.COM']
                                          ]
                                       ]
                                       $expression: #StringExpr['www.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_name']
                                          $param: #List[
                                             $expression: #StringExpr['*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['WWW.Example.COM']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_name']
                                          $param: #List[
                                             $expression: #StringExpr['www.*.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['www.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_name']
                                          $param: #List[
                                             $expression: #StringExpr['*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['foo.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_name']
                                          $param: #List[
                                             $expression: #StringExpr['*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['bar.foo.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_name']
                                          $param: #List[
                                             $expression: #StringExpr['baz*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['baz1.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_name']
                                          $param: #List[
                                             $expression: #StringExpr['*baz.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['foobaz.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_name']
                                          $param: #List[
                                             $expression: #StringExpr['b*z.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['buzz.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_name']
                                          $param: #List[
                                             $expression: #StringExpr['*b*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['abc.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_name']
                                          $param: #List[
                                             $expression: #StringExpr['*b*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['ab.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_name']
                                          $param: #List[
                                             $expression: #StringExpr['*b*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['bc.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #TrueExpr['true']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_name']
                                          $param: #List[
                                             $expression: #StringExpr['xn*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['xn1ca.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_name']
                                          $param: #List[
                                             $expression: #StringExpr['xn--*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['xn--1ca.example.com']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                                 $expression: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $recv: #NameExpr['verify_certificate_identity']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['create_cert_with_name']
                                          $param: #List[
                                             $expression: #StringExpr['á*.example.com']
                                          ]
                                       ]
                                       $expression: #StringExpr['á1.example.com']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['create_cert_with_san']
                     $param: #List[
                        $param: #Param[
                           $param: #NameExpr['san']
                        ]
                     ]
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['ef']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['X509']
                                    ]
                                    $name: #NameExpr['ExtensionFactory']
                                 ]
                                 $recv: #NameExpr['new']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['cert']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['X509']
                                    ]
                                    $name: #NameExpr['Certificate']
                                 ]
                                 $recv: #NameExpr['new']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['cert']
                                 $name: #NameExpr['subject']
                              ]
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['X509']
                                    ]
                                    $name: #NameExpr['Name']
                                 ]
                                 $recv: #NameExpr['parse']
                                 $param: #List[
                                    $expression: #StringExpr['/DC=some/DC=site/CN=Some Site']
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['ext']
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['ef']
                                 $recv: #NameExpr['create_ext']
                                 $param: #List[
                                    $expression: #StringExpr['subjectAltName']
                                    $expression: #NameExpr['san']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              $recv: #NameExpr['cert']
                              $recv: #NameExpr['add_extension']
                              $param: #List[
                                 $expression: #NameExpr['ext']
                              ]
                           ]
                           $statement: #NameExpr['cert']
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['create_cert_with_name']
                     $param: #List[
                        $param: #Param[
                           $param: #NameExpr['name']
                        ]
                     ]
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['cert']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['X509']
                                    ]
                                    $name: #NameExpr['Certificate']
                                 ]
                                 $recv: #NameExpr['new']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['cert']
                                 $name: #NameExpr['subject']
                              ]
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['X509']
                                    ]
                                    $name: #NameExpr['Name']
                                 ]
                                 $recv: #NameExpr['new']
                                 $param: #List[
                                    $expression: #Array[
                                       $index: #List[
                                          $expression: #Array[
                                             $index: #List[
                                                $expression: #StringExpr['DC']
                                                $expression: #StringExpr['some']
                                             ]
                                          ]
                                          $expression: #Array[
                                             $index: #List[
                                                $expression: #StringExpr['DC']
                                                $expression: #StringExpr['site']
                                             ]
                                          ]
                                          $expression: #Array[
                                             $index: #List[
                                                $expression: #StringExpr['CN']
                                                $expression: #NameExpr['name']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #NameExpr['cert']
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['create_null_byte_SAN_certificate']
                     $param: #List[
                        $param: #OptionalParam[
                           $name: #NameExpr['critical']
                           $default: #FalseExpr['false']
                        ]
                     ]
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['ef']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['X509']
                                    ]
                                    $name: #NameExpr['ExtensionFactory']
                                 ]
                                 $recv: #NameExpr['new']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['cert']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['X509']
                                    ]
                                    $name: #NameExpr['Certificate']
                                 ]
                                 $recv: #NameExpr['new']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['cert']
                                 $name: #NameExpr['subject']
                              ]
                              $right: #ApplyExpr[
                                 $base: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['X509']
                                    ]
                                    $name: #NameExpr['Name']
                                 ]
                                 $recv: #NameExpr['parse']
                                 $param: #List[
                                    $expression: #StringExpr['/DC=some/DC=site/CN=Some Site']
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['ext']
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['ef']
                                 $recv: #NameExpr['create_ext']
                                 $param: #List[
                                    $expression: #StringExpr['subjectAltName']
                                    $expression: #StringExpr['DNS:placeholder,IP:192.168.7.1,IP:13::17']
                                    $expression: #NameExpr['critical']
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['ext_asn1']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #NameExpr['OpenSSL']
                                    $name: #NameExpr['ASN1']
                                 ]
                                 $recv: #NameExpr['decode']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['ext']
                                       $recv: #NameExpr['to_der']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['san_list_der']
                              $right: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['ext_asn1']
                                    $recv: #NameExpr['value']
                                 ]
                                 $recv: #NameExpr['reduce']
                                 $param: #List[
                                    $expression: #Nil['nil']
                                 ]
                                 $body: #Block[
                                    $param: #MultipleLeftHandSideExpression[
                                       $item: #NameExpr['memo']
                                       $item: #NameExpr['val']
                                    ]
                                    $body: #Conditional[
                                       $cond: #EqExpr[
                                          $left: #ApplyExpr[
                                             $recv: #NameExpr['val']
                                             $recv: #NameExpr['tag']
                                          ]
                                          $right: #IntExpr['4']
                                       ]
                                       $then: #ApplyExpr[
                                          $recv: #NameExpr['val']
                                          $recv: #NameExpr['value']
                                       ]
                                       $else: #NameExpr['memo']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['san_list_asn1']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #NameExpr['OpenSSL']
                                    $name: #NameExpr['ASN1']
                                 ]
                                 $recv: #NameExpr['decode']
                                 $param: #List[
                                    $expression: #NameExpr['san_list_der']
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #Indexer[
                                    $recv: #ApplyExpr[
                                       $recv: #NameExpr['san_list_asn1']
                                       $recv: #NameExpr['value']
                                    ]
                                    $index: #List[
                                       $expression: #IntExpr['0']
                                    ]
                                 ]
                                 $name: #NameExpr['value']
                              ]
                              $right: #StringExpr['www.example.com\\0.evil.com']
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['pos']
                              $right: #Conditional[
                                 $cond: #NameExpr['critical']
                                 $then: #IntExpr['2']
                                 $else: #IntExpr['1']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #Indexer[
                                    $recv: #ApplyExpr[
                                       $recv: #NameExpr['ext_asn1']
                                       $recv: #NameExpr['value']
                                    ]
                                    $index: #List[
                                       $expression: #NameExpr['pos']
                                    ]
                                 ]
                                 $name: #NameExpr['value']
                              ]
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['san_list_asn1']
                                 $recv: #NameExpr['to_der']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['real_ext']
                              $right: #ApplyExpr[
                                 $base: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['X509']
                                    ]
                                    $name: #NameExpr['Extension']
                                 ]
                                 $recv: #NameExpr['new']
                                 $param: #List[
                                    $expression: #NameExpr['ext_asn1']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              $recv: #NameExpr['cert']
                              $recv: #NameExpr['add_extension']
                              $param: #List[
                                 $expression: #NameExpr['real_ext']
                              ]
                           ]
                           $statement: #NameExpr['cert']
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['socketpair']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #IfExpr[
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['defined?']
                              $param: #List[
                                 $expression: #NameExpr['UNIXSocket']
                              ]
                           ]
                           $then: #ApplyExpr[
                              $recv: #NameExpr['UNIXSocket']
                              $recv: #NameExpr['pair']
                           ]
                           $else: #ApplyExpr[
                              $recv: #NameExpr['Socket']
                              $recv: #NameExpr['pair']
                              $param: #List[
                                 $expression: #Field[
                                    $recv: #NameExpr['Socket']
                                    $name: #NameExpr['AF_INET']
                                 ]
                                 $expression: #Field[
                                    $recv: #NameExpr['Socket']
                                    $name: #NameExpr['SOCK_STREAM']
                                 ]
                                 $expression: #IntExpr['0']
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_tlsext_hostname']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx3']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['SSLContext']
                                 ]
                                 $recv: #NameExpr['new']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['ctx3']
                                 $name: #NameExpr['ciphers']
                              ]
                              $right: #StringExpr['ADH']
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['ctx3']
                                 $name: #NameExpr['tmp_dh_callback']
                              ]
                              $right: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['proc']
                                 $body: #Block[
                                    $body: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['OpenSSL']
                                          $name: #NameExpr['TestUtils']
                                       ]
                                       $name: #NameExpr['TEST_KEY_DH1024']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['ctx3']
                                 $name: #NameExpr['security_level']
                              ]
                              $right: #IntExpr['0']
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_not_predicate']
                              $param: #List[
                                 $expression: #NameExpr['ctx3']
                                 $expression: #NameExpr['frozen?']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx_proc']
                              $right: #Lambda[
                                 $param: #List[
                                    $param: #Param[
                                       $param: #NameExpr['ctx']
                                    ]
                                 ]
                                 $body: #Block[
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx']
                                             $name: #NameExpr['ciphers']
                                          ]
                                          $right: #StringExpr['ALL:!aNULL']
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx']
                                             $name: #NameExpr['servername_cb']
                                          ]
                                          $right: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['proc']
                                             $body: #Block[
                                                $param: #MultipleLeftHandSideExpression[
                                                   $item: #NameExpr['ssl']
                                                   $item: #NameExpr['servername']
                                                ]
                                                $body: #Case[
                                                   $cond: #NameExpr['servername']
                                                   $body: #List[
                                                      $when: #When[
                                                         $cond: #List[
                                                            $expression: #StringExpr['foo.example.com']
                                                         ]
                                                         $then: #NameExpr['ctx3']
                                                      ]
                                                      $when: #When[
                                                         $cond: #List[
                                                            $expression: #StringExpr['bar.example.com']
                                                         ]
                                                         $then: #Nil['nil']
                                                      ]
                                                   ]
                                                   $else: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #NameExpr['raise']
                                                      $param: #List[
                                                         $expression: #StringExpr['unknown hostname']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $param: #List[
                                 $hash: #Hash[
                                    $key: #NameExpr['ctx_proc']
                                    $value: #NameExpr['ctx_proc']
                                 ]
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['ctx']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['SSLContext']
                                          ]
                                          $recv: #NameExpr['new']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['ciphers']
                                       ]
                                       $right: #StringExpr['ALL']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['security_level']
                                       ]
                                       $right: #IntExpr['0']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['sock']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['TCPSocket']
                                          $recv: #NameExpr['new']
                                          $param: #List[
                                             $expression: #StringExpr['127.0.0.1']
                                             $expression: #NameExpr['port']
                                          ]
                                       ]
                                    ]
                                    $statement: #ExceptionBlock[
                                       $main: #List[
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['ssl']
                                             $right: #ApplyExpr[
                                                $recv: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLSocket']
                                                ]
                                                $recv: #NameExpr['new']
                                                $param: #List[
                                                   $expression: #NameExpr['sock']
                                                   $expression: #NameExpr['ctx']
                                                ]
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ssl']
                                                $name: #NameExpr['hostname']
                                             ]
                                             $right: #StringExpr['foo.example.com']
                                          ]
                                          $statement: #ApplyExpr[
                                             $recv: #NameExpr['ssl']
                                             $recv: #NameExpr['connect']
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_match']
                                             $param: #List[
                                                $expression: #Regex['/^ADH-/']
                                                $expression: #Indexer[
                                                   $recv: #ApplyExpr[
                                                      $recv: #NameExpr['ssl']
                                                      $recv: #NameExpr['cipher']
                                                   ]
                                                   $index: #List[
                                                      $expression: #IntExpr['0']
                                                   ]
                                                ]
                                                $expression: #StringExpr['the context returned by servername_cb is used']
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_predicate']
                                             $param: #List[
                                                $expression: #NameExpr['ctx3']
                                                $expression: #NameExpr['frozen?']
                                             ]
                                          ]
                                       ]
                                       $ensure: #ApplyExpr[
                                          $recv: #NameExpr['sock']
                                          $recv: #NameExpr['close']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['sock']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['TCPSocket']
                                          $recv: #NameExpr['new']
                                          $param: #List[
                                             $expression: #StringExpr['127.0.0.1']
                                             $expression: #NameExpr['port']
                                          ]
                                       ]
                                    ]
                                    $statement: #ExceptionBlock[
                                       $main: #List[
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['ssl']
                                             $right: #ApplyExpr[
                                                $recv: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLSocket']
                                                ]
                                                $recv: #NameExpr['new']
                                                $param: #List[
                                                   $expression: #NameExpr['sock']
                                                   $expression: #NameExpr['ctx']
                                                ]
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ssl']
                                                $name: #NameExpr['hostname']
                                             ]
                                             $right: #StringExpr['bar.example.com']
                                          ]
                                          $statement: #ApplyExpr[
                                             $recv: #NameExpr['ssl']
                                             $recv: #NameExpr['connect']
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_not_match']
                                             $param: #List[
                                                $expression: #Regex['/^A(EC)?DH-/']
                                                $expression: #Indexer[
                                                   $recv: #ApplyExpr[
                                                      $recv: #NameExpr['ssl']
                                                      $recv: #NameExpr['cipher']
                                                   ]
                                                   $index: #List[
                                                      $expression: #IntExpr['0']
                                                   ]
                                                ]
                                                $expression: #StringExpr['the original context is used']
                                             ]
                                          ]
                                       ]
                                       $ensure: #ApplyExpr[
                                          $recv: #NameExpr['sock']
                                          $recv: #NameExpr['close']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_servername_cb_raises_an_exception_on_unknown_objects']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['hostname']
                              $right: #StringExpr['example.org']
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx2']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['SSLContext']
                                 ]
                                 $recv: #NameExpr['new']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['ctx2']
                                 $name: #NameExpr['ciphers']
                              ]
                              $right: #StringExpr['aNULL']
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['ctx2']
                                 $name: #NameExpr['tmp_dh_callback']
                              ]
                              $right: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['proc']
                                 $body: #Block[
                                    $body: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['OpenSSL']
                                          $name: #NameExpr['TestUtils']
                                       ]
                                       $name: #NameExpr['TEST_KEY_DH1024']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['ctx2']
                                 $name: #NameExpr['security_level']
                              ]
                              $right: #IntExpr['0']
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['ctx2']
                                 $name: #NameExpr['servername_cb']
                              ]
                              $right: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['lambda']
                                 $body: #Block[
                                    $param: #NameExpr['args']
                                    $body: #ApplyExpr[
                                       $recv: #NameExpr['Object']
                                       $recv: #NameExpr['new']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #MultipleAssign[
                              $left: #MultipleLeftHandSideExpression[
                                 $item: #NameExpr['sock1']
                                 $item: #NameExpr['sock2']
                              ]
                              $right: #NameExpr['socketpair']
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['s2']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['SSLSocket']
                                 ]
                                 $recv: #NameExpr['new']
                                 $param: #List[
                                    $expression: #NameExpr['sock2']
                                    $expression: #NameExpr['ctx2']
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx1']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['SSLContext']
                                 ]
                                 $recv: #NameExpr['new']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['ctx1']
                                 $name: #NameExpr['ciphers']
                              ]
                              $right: #StringExpr['aNULL']
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['ctx1']
                                 $name: #NameExpr['security_level']
                              ]
                              $right: #IntExpr['0']
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['s1']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['SSLSocket']
                                 ]
                                 $recv: #NameExpr['new']
                                 $param: #List[
                                    $expression: #NameExpr['sock1']
                                    $expression: #NameExpr['ctx1']
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['s1']
                                 $name: #NameExpr['hostname']
                              ]
                              $right: #NameExpr['hostname']
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['t']
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['Thread']
                                 $recv: #NameExpr['new']
                                 $body: #Block[
                                    $body: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_raise']
                                       $param: #List[
                                          $expression: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['SSLError']
                                          ]
                                       ]
                                       $body: #Block[
                                          $body: #ApplyExpr[
                                             $recv: #NameExpr['s1']
                                             $recv: #NameExpr['connect']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_raise']
                              $param: #List[
                                 $expression: #NameExpr['ArgumentError']
                              ]
                              $body: #Block[
                                 $body: #ApplyExpr[
                                    $recv: #NameExpr['s2']
                                    $recv: #NameExpr['accept']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['t']
                                    $recv: #NameExpr['join']
                                 ]
                              ]
                           ]
                        ]
                        $ensure: #List[
                           $statement: #IfExpr[
                              $then: #ApplyExpr[
                                 $recv: #NameExpr['sock1']
                                 $recv: #NameExpr['close']
                              ]
                              $cond: #NameExpr['sock1']
                           ]
                           $statement: #IfExpr[
                              $then: #ApplyExpr[
                                 $recv: #NameExpr['sock2']
                                 $recv: #NameExpr['close']
                              ]
                              $cond: #NameExpr['sock2']
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_verify_hostname_on_connect']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx_proc']
                              $right: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['proc']
                                 $body: #Block[
                                    $param: #NameExpr['ctx']
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['now']
                                          $right: #ApplyExpr[
                                             $recv: #NameExpr['Time']
                                             $recv: #NameExpr['now']
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['exts']
                                          $right: #Array[
                                             $index: #List[
                                                $expression: #Array[
                                                   $index: #List[
                                                      $expression: #StringExpr['keyUsage']
                                                      $expression: #StringExpr['keyEncipherment,digitalSignature']
                                                      $expression: #TrueExpr['true']
                                                   ]
                                                ]
                                                $expression: #Array[
                                                   $index: #List[
                                                      $expression: #StringExpr['subjectAltName']
                                                      $expression: #ConnectString[
                                                         $String: #StringExpr['DNS:a.example.com,DNS:*.b.example.com,']
                                                         $String: #StringExpr['DNS:c*.example.com,DNS:d.*.example.com']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx']
                                             $name: #NameExpr['cert']
                                          ]
                                          $right: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['issue_cert']
                                             $param: #List[
                                                $expression: #NameExpr['@svr']
                                                $expression: #NameExpr['@svr_key']
                                                $expression: #IntExpr['4']
                                                $expression: #NameExpr['now']
                                                $expression: #AddExpr[
                                                   $left: #NameExpr['now']
                                                   $right: #IntExpr['1800']
                                                ]
                                                $expression: #NameExpr['exts']
                                                $expression: #NameExpr['@ca_cert']
                                                $expression: #NameExpr['@ca_key']
                                                $expression: #ApplyExpr[
                                                   $recv: #Field[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['Digest']
                                                      ]
                                                      $name: #NameExpr['SHA1']
                                                   ]
                                                   $recv: #NameExpr['new']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx']
                                             $name: #NameExpr['key']
                                          ]
                                          $right: #NameExpr['@svr_key']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $param: #List[
                                 $hash: #Hash[
                                    $key: #NameExpr['ctx_proc']
                                    $value: #NameExpr['ctx_proc']
                                 ]
                                 $hash: #Hash[
                                    $key: #NameExpr['ignore_listener_error']
                                    $value: #TrueExpr['true']
                                 ]
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['ctx']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['SSLContext']
                                          ]
                                          $recv: #NameExpr['new']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['verify_hostname']
                                       ]
                                       $right: #TrueExpr['true']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['cert_store']
                                       ]
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['X509']
                                             ]
                                             $name: #NameExpr['Store']
                                          ]
                                          $recv: #NameExpr['new']
                                       ]
                                    ]
                                    $statement: #ApplyExpr[
                                       $recv: #ApplyExpr[
                                          $recv: #NameExpr['ctx']
                                          $recv: #NameExpr['cert_store']
                                       ]
                                       $recv: #NameExpr['add_cert']
                                       $param: #List[
                                          $expression: #NameExpr['@ca_cert']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['verify_mode']
                                       ]
                                       $right: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $name: #NameExpr['VERIFY_PEER']
                                       ]
                                    ]
                                    $statement: #ApplyExpr[
                                       $recv: #Array[
                                          $index: #List[
                                             $expression: #Array[
                                                $index: #List[
                                                   $expression: #StringExpr['a.example.com']
                                                   $expression: #TrueExpr['true']
                                                ]
                                             ]
                                             $expression: #Array[
                                                $index: #List[
                                                   $expression: #StringExpr['A.Example.Com']
                                                   $expression: #TrueExpr['true']
                                                ]
                                             ]
                                             $expression: #Array[
                                                $index: #List[
                                                   $expression: #StringExpr['x.example.com']
                                                   $expression: #FalseExpr['false']
                                                ]
                                             ]
                                             $expression: #Array[
                                                $index: #List[
                                                   $expression: #StringExpr['b.example.com']
                                                   $expression: #FalseExpr['false']
                                                ]
                                             ]
                                             $expression: #Array[
                                                $index: #List[
                                                   $expression: #StringExpr['x.b.example.com']
                                                   $expression: #TrueExpr['true']
                                                ]
                                             ]
                                             $expression: #Array[
                                                $index: #List[
                                                   $expression: #StringExpr['cx.example.com']
                                                   $expression: #TrueExpr['true']
                                                ]
                                             ]
                                             $expression: #Array[
                                                $index: #List[
                                                   $expression: #StringExpr['d.x.example.com']
                                                   $expression: #FalseExpr['false']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $recv: #NameExpr['each']
                                       $body: #Block[
                                          $param: #MultipleLeftHandSideExpression[
                                             $item: #NameExpr['name']
                                             $item: #NameExpr['expected_ok']
                                          ]
                                          $body: #ExceptionBlock[
                                             $main: #List[
                                                $statement: #AssignExpr[
                                                   $left: #NameExpr['sock']
                                                   $right: #ApplyExpr[
                                                      $recv: #NameExpr['TCPSocket']
                                                      $recv: #NameExpr['new']
                                                      $param: #List[
                                                         $expression: #StringExpr['127.0.0.1']
                                                         $expression: #NameExpr['port']
                                                      ]
                                                   ]
                                                ]
                                                $statement: #AssignExpr[
                                                   $left: #NameExpr['ssl']
                                                   $right: #ApplyExpr[
                                                      $recv: #Field[
                                                         $recv: #Field[
                                                            $recv: #NameExpr['OpenSSL']
                                                            $name: #NameExpr['SSL']
                                                         ]
                                                         $name: #NameExpr['SSLSocket']
                                                      ]
                                                      $recv: #NameExpr['new']
                                                      $param: #List[
                                                         $expression: #NameExpr['sock']
                                                         $expression: #NameExpr['ctx']
                                                      ]
                                                   ]
                                                ]
                                                $statement: #AssignExpr[
                                                   $left: #Field[
                                                      $base: #NameExpr['ssl']
                                                      $name: #NameExpr['hostname']
                                                   ]
                                                   $right: #NameExpr['name']
                                                ]
                                                $statement: #IfExpr[
                                                   $cond: #NameExpr['expected_ok']
                                                   $then: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #NameExpr['assert_nothing_raised']
                                                      $body: #Block[
                                                         $body: #ApplyExpr[
                                                            $recv: #NameExpr['ssl']
                                                            $recv: #NameExpr['connect']
                                                         ]
                                                      ]
                                                   ]
                                                   $else: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #NameExpr['assert_handshake_error']
                                                      $body: #Block[
                                                         $body: #ApplyExpr[
                                                            $recv: #NameExpr['ssl']
                                                            $recv: #NameExpr['connect']
                                                         ]
                                                      ]
                                                   ]
                                                ]
                                             ]
                                             $ensure: #List[
                                                $statement: #IfExpr[
                                                   $then: #ApplyExpr[
                                                      $recv: #NameExpr['ssl']
                                                      $recv: #NameExpr['close']
                                                   ]
                                                   $cond: #NameExpr['ssl']
                                                ]
                                                $statement: #IfExpr[
                                                   $then: #ApplyExpr[
                                                      $recv: #NameExpr['sock']
                                                      $recv: #NameExpr['close']
                                                   ]
                                                   $cond: #NameExpr['sock']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_multibyte_read_write']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['auml']
                              $right: #ApplyExpr[
                                 $recv: #Array[
                                    $index: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #ParcentNotation['%w{ C3 A4 }']
                                          $recv: #NameExpr['join']
                                          $param: #List[
                                             $expression: #StringExpr['']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $recv: #NameExpr['pack']
                                 $param: #List[
                                    $expression: #StringExpr['H*']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              $recv: #NameExpr['auml']
                              $recv: #NameExpr['force_encoding']
                              $param: #List[
                                 $expression: #Field[
                                    $recv: #NameExpr['Encoding']
                                    $name: #NameExpr['UTF_8']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              $recv: #Array[
                                 $index: #List[
                                    $expression: #IntExpr['10']
                                    $expression: #IntExpr['1000']
                                    $expression: #IntExpr['100000']
                                 ]
                              ]
                              $recv: #NameExpr['each']
                              $body: #Block[
                                 $param: #NameExpr['i']
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['str']
                                       $right: #Nil['nil']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['num_written']
                                       $right: #Nil['nil']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['server_proc']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['Proc']
                                          $recv: #NameExpr['new']
                                          $body: #Block[
                                             $param: #MultipleLeftHandSideExpression[
                                                $item: #NameExpr['ctx']
                                                $item: #NameExpr['ssl']
                                             ]
                                             $body: #List[
                                                $statement: #AssignExpr[
                                                   $left: #NameExpr['cmp']
                                                   $right: #ApplyExpr[
                                                      $recv: #NameExpr['ssl']
                                                      $recv: #NameExpr['read']
                                                   ]
                                                ]
                                                $statement: #AssignExpr[
                                                   $left: #NameExpr['raw_size']
                                                   $right: #ApplyExpr[
                                                      $recv: #NameExpr['cmp']
                                                      $recv: #NameExpr['size']
                                                   ]
                                                ]
                                                $statement: #ApplyExpr[
                                                   $recv: #NameExpr['cmp']
                                                   $recv: #NameExpr['force_encoding']
                                                   $param: #List[
                                                      $expression: #Field[
                                                         $recv: #NameExpr['Encoding']
                                                         $name: #NameExpr['UTF_8']
                                                      ]
                                                   ]
                                                ]
                                                $statement: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['assert_equal']
                                                   $param: #List[
                                                      $expression: #NameExpr['str']
                                                      $expression: #NameExpr['cmp']
                                                   ]
                                                ]
                                                $statement: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['assert_equal']
                                                   $param: #List[
                                                      $expression: #NameExpr['num_written']
                                                      $expression: #NameExpr['raw_size']
                                                   ]
                                                ]
                                                $statement: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['close']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['start_server']
                                       $param: #List[
                                          $hash: #Hash[
                                             $key: #NameExpr['server_proc']
                                             $value: #NameExpr['server_proc']
                                          ]
                                       ]
                                       $body: #Block[
                                          $param: #MultipleLeftHandSideExpression[
                                             $item: #NameExpr['server']
                                             $item: #NameExpr['port']
                                          ]
                                          $body: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['server_connect']
                                             $param: #List[
                                                $expression: #NameExpr['port']
                                             ]
                                             $body: #Block[
                                                $param: #NameExpr['ssl']
                                                $body: #List[
                                                   $statement: #AssignExpr[
                                                      $left: #NameExpr['str']
                                                      $right: #MulExpr[
                                                         $left: #NameExpr['auml']
                                                         $right: #NameExpr['i']
                                                      ]
                                                   ]
                                                   $statement: #AssignExpr[
                                                      $left: #NameExpr['num_written']
                                                      $right: #ApplyExpr[
                                                         $recv: #NameExpr['ssl']
                                                         $recv: #NameExpr['write']
                                                         $param: #List[
                                                            $expression: #NameExpr['str']
                                                         ]
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_unset_OP_ALL']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx_proc']
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['Proc']
                                 $recv: #NameExpr['new']
                                 $body: #Block[
                                    $param: #NameExpr['ctx']
                                    $body: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['options']
                                       ]
                                       $right: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $name: #NameExpr['OP_ALL']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $param: #List[
                                 $hash: #Hash[
                                    $key: #NameExpr['ctx_proc']
                                    $value: #NameExpr['ctx_proc']
                                 ]
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['server_connect']
                                    $param: #List[
                                       $expression: #NameExpr['port']
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['ssl']
                                       $body: #List[
                                          $statement: #ApplyExpr[
                                             $recv: #NameExpr['ssl']
                                             $recv: #NameExpr['puts']
                                             $param: #List[
                                                $expression: #StringExpr['hello']
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_equal']
                                             $param: #List[
                                                $expression: #StringExpr['hello\\n']
                                                $expression: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['gets']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #IfExpr[
                     $cond: #ApplyExpr[
                        $base: #ApplyExpr[
                           $recv: #Field[
                              $recv: #Field[
                                 $recv: #Field[
                                    $recv: #NameExpr['OpenSSL']
                                    $name: #NameExpr['SSL']
                                 ]
                                 $name: #NameExpr['SSLContext']
                              ]
                              $name: #NameExpr['METHODS']
                           ]
                           $recv: #NameExpr['include?']
                           $param: #List[
                              $expression: #NameExpr['TLSv1']
                           ]
                        ]
                        $recv: #NameExpr['&']
                        $param: #List[
                           $expression: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['SSLContext']
                                 ]
                                 $name: #NameExpr['METHODS']
                              ]
                              $recv: #NameExpr['include?']
                              $param: #List[
                                 $expression: #NameExpr['SSLv3']
                              ]
                           ]
                        ]
                     ]
                     $then: #List[
                        $statement: #FuncDecl[
                           $name: #NameExpr['test_forbid_ssl_v3_for_client']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ctx_proc']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['Proc']
                                       $recv: #NameExpr['new']
                                       $body: #Block[
                                          $param: #NameExpr['ctx']
                                          $body: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['options']
                                             ]
                                             $right: #OrExpr[
                                                $left: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['OP_ALL']
                                                ]
                                                $right: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['OP_NO_SSLv3']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['start_server_version']
                                    $param: #List[
                                       $expression: #NameExpr['SSLv23']
                                       $expression: #NameExpr['ctx_proc']
                                    ]
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['server']
                                          $item: #NameExpr['port']
                                       ]
                                       $body: #List[
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['ctx']
                                             $right: #ApplyExpr[
                                                $recv: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLContext']
                                                ]
                                                $recv: #NameExpr['new']
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['ssl_version']
                                             ]
                                             $right: #NameExpr['SSLv3']
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_handshake_error']
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['server_connect']
                                                   $param: #List[
                                                      $expression: #NameExpr['port']
                                                      $expression: #NameExpr['ctx']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['test_forbid_ssl_v3_from_server']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['start_server_version']
                                 $param: #List[
                                    $expression: #NameExpr['SSLv3']
                                 ]
                                 $body: #Block[
                                    $param: #MultipleLeftHandSideExpression[
                                       $item: #NameExpr['server']
                                       $item: #NameExpr['port']
                                    ]
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['ctx']
                                          $right: #ApplyExpr[
                                             $recv: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['SSL']
                                                ]
                                                $name: #NameExpr['SSLContext']
                                             ]
                                             $recv: #NameExpr['new']
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx']
                                             $name: #NameExpr['options']
                                          ]
                                          $right: #OrExpr[
                                             $left: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['SSL']
                                                ]
                                                $name: #NameExpr['OP_ALL']
                                             ]
                                             $right: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['SSL']
                                                ]
                                                $name: #NameExpr['OP_NO_SSLv3']
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_handshake_error']
                                          $body: #Block[
                                             $body: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['server_connect']
                                                $param: #List[
                                                   $expression: #NameExpr['port']
                                                   $expression: #NameExpr['ctx']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #IfExpr[
                     $cond: #ApplyExpr[
                        $base: #Field[
                           $recv: #Field[
                              $recv: #Field[
                                 $recv: #NameExpr['OpenSSL']
                                 $name: #NameExpr['SSL']
                              ]
                              $name: #NameExpr['SSLContext']
                           ]
                           $name: #NameExpr['METHODS']
                        ]
                        $recv: #NameExpr['include?']
                        $param: #List[
                           $expression: #NameExpr['TLSv1_1']
                        ]
                     ]
                     $then: #List[
                        $statement: #FuncDecl[
                           $name: #NameExpr['test_tls_v1_1']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['start_server_version']
                                 $param: #List[
                                    $expression: #NameExpr['TLSv1_1']
                                 ]
                                 $body: #Block[
                                    $param: #MultipleLeftHandSideExpression[
                                       $item: #NameExpr['server']
                                       $item: #NameExpr['port']
                                    ]
                                    $body: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['server_connect']
                                       $param: #List[
                                          $expression: #NameExpr['port']
                                       ]
                                       $body: #Block[
                                          $param: #NameExpr['ssl']
                                          $body: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_equal']
                                             $param: #List[
                                                $expression: #StringExpr['TLSv1.1']
                                                $expression: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['ssl_version']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['test_forbid_tls_v1_for_client']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ctx_proc']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['Proc']
                                       $recv: #NameExpr['new']
                                       $body: #Block[
                                          $param: #NameExpr['ctx']
                                          $body: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['options']
                                             ]
                                             $right: #OrExpr[
                                                $left: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['OP_ALL']
                                                ]
                                                $right: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['OP_NO_TLSv1']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['start_server_version']
                                    $param: #List[
                                       $expression: #NameExpr['SSLv23']
                                       $expression: #NameExpr['ctx_proc']
                                    ]
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['server']
                                          $item: #NameExpr['port']
                                       ]
                                       $body: #List[
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['ctx']
                                             $right: #ApplyExpr[
                                                $recv: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLContext']
                                                ]
                                                $recv: #NameExpr['new']
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['ssl_version']
                                             ]
                                             $right: #NameExpr['TLSv1']
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_handshake_error']
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['server_connect']
                                                   $param: #List[
                                                      $expression: #NameExpr['port']
                                                      $expression: #NameExpr['ctx']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['test_forbid_tls_v1_from_server']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['start_server_version']
                                 $param: #List[
                                    $expression: #NameExpr['TLSv1']
                                 ]
                                 $body: #Block[
                                    $param: #MultipleLeftHandSideExpression[
                                       $item: #NameExpr['server']
                                       $item: #NameExpr['port']
                                    ]
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['ctx']
                                          $right: #ApplyExpr[
                                             $recv: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['SSL']
                                                ]
                                                $name: #NameExpr['SSLContext']
                                             ]
                                             $recv: #NameExpr['new']
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx']
                                             $name: #NameExpr['options']
                                          ]
                                          $right: #OrExpr[
                                             $left: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['SSL']
                                                ]
                                                $name: #NameExpr['OP_ALL']
                                             ]
                                             $right: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['SSL']
                                                ]
                                                $name: #NameExpr['OP_NO_TLSv1']
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_handshake_error']
                                          $body: #Block[
                                             $body: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['server_connect']
                                                $param: #List[
                                                   $expression: #NameExpr['port']
                                                   $expression: #NameExpr['ctx']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #IfExpr[
                     $cond: #ApplyExpr[
                        $base: #Field[
                           $recv: #Field[
                              $recv: #Field[
                                 $recv: #NameExpr['OpenSSL']
                                 $name: #NameExpr['SSL']
                              ]
                              $name: #NameExpr['SSLContext']
                           ]
                           $name: #NameExpr['METHODS']
                        ]
                        $recv: #NameExpr['include?']
                        $param: #List[
                           $expression: #NameExpr['TLSv1_2']
                        ]
                     ]
                     $then: #List[
                        $statement: #IfExpr[
                           $then: #FuncDecl[
                              $name: #NameExpr['test_tls_v1_2']
                              $param: #List['']
                              $body: #BlockExpr[
                                 $main: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['start_server_version']
                                    $param: #List[
                                       $expression: #NameExpr['TLSv1_2']
                                    ]
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['server']
                                          $item: #NameExpr['port']
                                       ]
                                       $body: #List[
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['ctx']
                                             $right: #ApplyExpr[
                                                $recv: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLContext']
                                                ]
                                                $recv: #NameExpr['new']
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['ssl_version']
                                             ]
                                             $right: #NameExpr['TLSv1_2_client']
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['server_connect']
                                             $param: #List[
                                                $expression: #NameExpr['port']
                                                $expression: #NameExpr['ctx']
                                             ]
                                             $body: #Block[
                                                $param: #NameExpr['ssl']
                                                $body: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['assert_equal']
                                                   $param: #List[
                                                      $expression: #StringExpr['TLSv1.2']
                                                      $expression: #ApplyExpr[
                                                         $recv: #NameExpr['ssl']
                                                         $recv: #NameExpr['ssl_version']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $cond: #GtExpr[
                              $left: #Field[
                                 $recv: #NameExpr['OpenSSL']
                                 $name: #NameExpr['OPENSSL_VERSION_NUMBER']
                              ]
                              $right: #HexInteger['0x10001000']
                           ]
                        ]
                        $statement: #IfExpr[
                           $then: #FuncDecl[
                              $name: #NameExpr['test_forbid_tls_v1_1_for_client']
                              $param: #List['']
                              $body: #BlockExpr[
                                 $main: #List[
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['ctx_proc']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['Proc']
                                          $recv: #NameExpr['new']
                                          $body: #Block[
                                             $param: #NameExpr['ctx']
                                             $body: #AssignExpr[
                                                $left: #Field[
                                                   $base: #NameExpr['ctx']
                                                   $name: #NameExpr['options']
                                                ]
                                                $right: #OrExpr[
                                                   $left: #Field[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $name: #NameExpr['OP_ALL']
                                                   ]
                                                   $right: #Field[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $name: #NameExpr['OP_NO_TLSv1_1']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['start_server_version']
                                       $param: #List[
                                          $expression: #NameExpr['SSLv23']
                                          $expression: #NameExpr['ctx_proc']
                                       ]
                                       $body: #Block[
                                          $param: #MultipleLeftHandSideExpression[
                                             $item: #NameExpr['server']
                                             $item: #NameExpr['port']
                                          ]
                                          $body: #List[
                                             $statement: #AssignExpr[
                                                $left: #NameExpr['ctx']
                                                $right: #ApplyExpr[
                                                   $recv: #Field[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $name: #NameExpr['SSLContext']
                                                   ]
                                                   $recv: #NameExpr['new']
                                                ]
                                             ]
                                             $statement: #AssignExpr[
                                                $left: #Field[
                                                   $base: #NameExpr['ctx']
                                                   $name: #NameExpr['ssl_version']
                                                ]
                                                $right: #NameExpr['TLSv1_1']
                                             ]
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['assert_handshake_error']
                                                $body: #Block[
                                                   $body: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #NameExpr['server_connect']
                                                      $param: #List[
                                                         $expression: #NameExpr['port']
                                                         $expression: #NameExpr['ctx']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $cond: #Defined[
                              $base: #Field[
                                 $recv: #Field[
                                    $recv: #NameExpr['OpenSSL']
                                    $name: #NameExpr['SSL']
                                 ]
                                 $name: #NameExpr['OP_NO_TLSv1_1']
                              ]
                           ]
                        ]
                        $statement: #IfExpr[
                           $then: #FuncDecl[
                              $name: #NameExpr['test_forbid_tls_v1_1_from_server']
                              $param: #List['']
                              $body: #BlockExpr[
                                 $main: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['start_server_version']
                                    $param: #List[
                                       $expression: #NameExpr['TLSv1_1']
                                    ]
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['server']
                                          $item: #NameExpr['port']
                                       ]
                                       $body: #List[
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['ctx']
                                             $right: #ApplyExpr[
                                                $recv: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLContext']
                                                ]
                                                $recv: #NameExpr['new']
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['options']
                                             ]
                                             $right: #OrExpr[
                                                $left: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['OP_ALL']
                                                ]
                                                $right: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['OP_NO_TLSv1_1']
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_handshake_error']
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['server_connect']
                                                   $param: #List[
                                                      $expression: #NameExpr['port']
                                                      $expression: #NameExpr['ctx']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $cond: #Defined[
                              $base: #Field[
                                 $recv: #Field[
                                    $recv: #NameExpr['OpenSSL']
                                    $name: #NameExpr['SSL']
                                 ]
                                 $name: #NameExpr['OP_NO_TLSv1_1']
                              ]
                           ]
                        ]
                        $statement: #IfExpr[
                           $then: #FuncDecl[
                              $name: #NameExpr['test_forbid_tls_v1_2_for_client']
                              $param: #List['']
                              $body: #BlockExpr[
                                 $main: #List[
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['ctx_proc']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['Proc']
                                          $recv: #NameExpr['new']
                                          $body: #Block[
                                             $param: #NameExpr['ctx']
                                             $body: #AssignExpr[
                                                $left: #Field[
                                                   $base: #NameExpr['ctx']
                                                   $name: #NameExpr['options']
                                                ]
                                                $right: #OrExpr[
                                                   $left: #Field[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $name: #NameExpr['OP_ALL']
                                                   ]
                                                   $right: #Field[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $name: #NameExpr['OP_NO_TLSv1_2']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['start_server_version']
                                       $param: #List[
                                          $expression: #NameExpr['SSLv23']
                                          $expression: #NameExpr['ctx_proc']
                                       ]
                                       $body: #Block[
                                          $param: #MultipleLeftHandSideExpression[
                                             $item: #NameExpr['server']
                                             $item: #NameExpr['port']
                                          ]
                                          $body: #List[
                                             $statement: #AssignExpr[
                                                $left: #NameExpr['ctx']
                                                $right: #ApplyExpr[
                                                   $recv: #Field[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $name: #NameExpr['SSLContext']
                                                   ]
                                                   $recv: #NameExpr['new']
                                                ]
                                             ]
                                             $statement: #AssignExpr[
                                                $left: #Field[
                                                   $base: #NameExpr['ctx']
                                                   $name: #NameExpr['ssl_version']
                                                ]
                                                $right: #NameExpr['TLSv1_2']
                                             ]
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['assert_handshake_error']
                                                $body: #Block[
                                                   $body: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #NameExpr['server_connect']
                                                      $param: #List[
                                                         $expression: #NameExpr['port']
                                                         $expression: #NameExpr['ctx']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $cond: #Defined[
                              $base: #Field[
                                 $recv: #Field[
                                    $recv: #NameExpr['OpenSSL']
                                    $name: #NameExpr['SSL']
                                 ]
                                 $name: #NameExpr['OP_NO_TLSv1_2']
                              ]
                           ]
                        ]
                        $statement: #IfExpr[
                           $then: #FuncDecl[
                              $name: #NameExpr['test_forbid_tls_v1_2_from_server']
                              $param: #List['']
                              $body: #BlockExpr[
                                 $main: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['start_server_version']
                                    $param: #List[
                                       $expression: #NameExpr['TLSv1_2']
                                    ]
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['server']
                                          $item: #NameExpr['port']
                                       ]
                                       $body: #List[
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['ctx']
                                             $right: #ApplyExpr[
                                                $recv: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLContext']
                                                ]
                                                $recv: #NameExpr['new']
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['options']
                                             ]
                                             $right: #OrExpr[
                                                $left: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['OP_ALL']
                                                ]
                                                $right: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['OP_NO_TLSv1_2']
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_handshake_error']
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['server_connect']
                                                   $param: #List[
                                                      $expression: #NameExpr['port']
                                                      $expression: #NameExpr['ctx']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $cond: #Defined[
                              $base: #Field[
                                 $recv: #Field[
                                    $recv: #NameExpr['OpenSSL']
                                    $name: #NameExpr['SSL']
                                 ]
                                 $name: #NameExpr['OP_NO_TLSv1_2']
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_renegotiation_cb']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['num_handshakes']
                              $right: #IntExpr['0']
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['renegotiation_cb']
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['Proc']
                                 $recv: #NameExpr['new']
                                 $body: #Block[
                                    $param: #NameExpr['ssl']
                                    $body: #AddAssign[
                                       $left: #NameExpr['num_handshakes']
                                       $right: #IntExpr['1']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx_proc']
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['Proc']
                                 $recv: #NameExpr['new']
                                 $body: #Block[
                                    $param: #NameExpr['ctx']
                                    $body: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['renegotiation_cb']
                                       ]
                                       $right: #NameExpr['renegotiation_cb']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server_version']
                              $param: #List[
                                 $expression: #NameExpr['SSLv23']
                                 $expression: #NameExpr['ctx_proc']
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['server_connect']
                                    $param: #List[
                                       $expression: #NameExpr['port']
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['ssl']
                                       $body: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #IntExpr['1']
                                             $expression: #NameExpr['num_handshakes']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #IfExpr[
                     $cond: #GteExpt[
                        $left: #Field[
                           $recv: #NameExpr['OpenSSL']
                           $name: #NameExpr['OPENSSL_VERSION_NUMBER']
                        ]
                        $right: #HexInteger['0x10002000']
                     ]
                     $then: #List[
                        $statement: #FuncDecl[
                           $name: #NameExpr['test_alpn_protocol_selection_ary']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['advertised']
                                    $right: #Array[
                                       $index: #List[
                                          $expression: #StringExpr['http/1.1']
                                          $expression: #StringExpr['spdy/2']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ctx_proc']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['Proc']
                                       $recv: #NameExpr['new']
                                       $body: #Block[
                                          $param: #NameExpr['ctx']
                                          $body: #List[
                                             $statement: #AssignExpr[
                                                $left: #Field[
                                                   $base: #NameExpr['ctx']
                                                   $name: #NameExpr['alpn_select_cb']
                                                ]
                                                $right: #Lambda[
                                                   $param: #List[
                                                      $param: #Param[
                                                         $param: #NameExpr['protocols']
                                                      ]
                                                   ]
                                                   $body: #Block[
                                                      $body: #ApplyExpr[
                                                         $recv: #NameExpr['protocols']
                                                         $recv: #NameExpr['first']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                             $statement: #AssignExpr[
                                                $left: #Field[
                                                   $base: #NameExpr['ctx']
                                                   $name: #NameExpr['alpn_protocols']
                                                ]
                                                $right: #NameExpr['advertised']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['start_server_version']
                                    $param: #List[
                                       $expression: #NameExpr['SSLv23']
                                       $expression: #NameExpr['ctx_proc']
                                    ]
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['server']
                                          $item: #NameExpr['port']
                                       ]
                                       $body: #List[
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['ctx']
                                             $right: #ApplyExpr[
                                                $recv: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLContext']
                                                ]
                                                $recv: #NameExpr['new']
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['alpn_protocols']
                                             ]
                                             $right: #NameExpr['advertised']
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['server_connect']
                                             $param: #List[
                                                $expression: #NameExpr['port']
                                                $expression: #NameExpr['ctx']
                                             ]
                                             $body: #Block[
                                                $param: #NameExpr['ssl']
                                                $body: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['assert_equal']
                                                   $param: #List[
                                                      $expression: #ApplyExpr[
                                                         $recv: #NameExpr['advertised']
                                                         $recv: #NameExpr['first']
                                                      ]
                                                      $expression: #ApplyExpr[
                                                         $recv: #NameExpr['ssl']
                                                         $recv: #NameExpr['alpn_protocol']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['test_alpn_protocol_selection_cancel']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #MultipleAssign[
                                    $left: #MultipleLeftHandSideExpression[
                                       $item: #NameExpr['sock1']
                                       $item: #NameExpr['sock2']
                                    ]
                                    $right: #NameExpr['socketpair']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ctx1']
                                    $right: #ApplyExpr[
                                       $recv: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $name: #NameExpr['SSLContext']
                                       ]
                                       $recv: #NameExpr['new']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['ctx1']
                                       $name: #NameExpr['ciphers']
                                    ]
                                    $right: #StringExpr['aNULL']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['ctx1']
                                       $name: #NameExpr['security_level']
                                    ]
                                    $right: #IntExpr['0']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['ctx1']
                                       $name: #NameExpr['alpn_select_cb']
                                    ]
                                    $right: #Lambda[
                                       $param: #List[
                                          $param: #Param[
                                             $param: #NameExpr['protocols']
                                          ]
                                       ]
                                       $body: #Block[
                                          $body: #Nil['nil']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ssl1']
                                    $right: #ApplyExpr[
                                       $recv: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $name: #NameExpr['SSLSocket']
                                       ]
                                       $recv: #NameExpr['new']
                                       $param: #List[
                                          $expression: #NameExpr['sock1']
                                          $expression: #NameExpr['ctx1']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ctx2']
                                    $right: #ApplyExpr[
                                       $recv: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $name: #NameExpr['SSLContext']
                                       ]
                                       $recv: #NameExpr['new']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['ctx2']
                                       $name: #NameExpr['ciphers']
                                    ]
                                    $right: #StringExpr['aNULL']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['ctx2']
                                       $name: #NameExpr['security_level']
                                    ]
                                    $right: #IntExpr['0']
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['ctx2']
                                       $name: #NameExpr['alpn_protocols']
                                    ]
                                    $right: #Array[
                                       $index: #List[
                                          $expression: #StringExpr['http/1.1']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ssl2']
                                    $right: #ApplyExpr[
                                       $recv: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $name: #NameExpr['SSLSocket']
                                       ]
                                       $recv: #NameExpr['new']
                                       $param: #List[
                                          $expression: #NameExpr['sock2']
                                          $expression: #NameExpr['ctx2']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['t']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['Thread']
                                       $recv: #NameExpr['new']
                                       $body: #Block[
                                          $body: #ApplyExpr[
                                             $recv: #NameExpr['ssl2']
                                             $recv: #NameExpr['connect_nonblock']
                                             $param: #List[
                                                $hash: #Hash[
                                                   $key: #NameExpr['exception']
                                                   $value: #FalseExpr['false']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_raise_with_message']
                                    $param: #List[
                                       $expression: #NameExpr['TypeError']
                                       $expression: #Regex['/nil/']
                                    ]
                                    $body: #Block[
                                       $body: #ApplyExpr[
                                          $recv: #NameExpr['ssl1']
                                          $recv: #NameExpr['accept']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['t']
                                    $recv: #NameExpr['join']
                                 ]
                              ]
                              $ensure: #List[
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['sock1']
                                    $recv: #NameExpr['close']
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['sock2']
                                    $recv: #NameExpr['close']
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['ssl1']
                                    $recv: #NameExpr['close']
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['ssl2']
                                    $recv: #NameExpr['close']
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['t']
                                    $recv: #NameExpr['kill']
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['t']
                                    $recv: #NameExpr['join']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #IfExpr[
                     $cond: #LAnd[
                        $left: #GtExpr[
                           $left: #Field[
                              $recv: #NameExpr['OpenSSL']
                              $name: #NameExpr['OPENSSL_VERSION_NUMBER']
                           ]
                           $right: #HexInteger['0x10001000']
                        ]
                        $right: #ApplyExpr[
                           $recv: #Field[
                              $recv: #Field[
                                 $recv: #NameExpr['OpenSSL']
                                 $name: #NameExpr['SSL']
                              ]
                              $name: #NameExpr['SSLContext']
                           ]
                           $recv: #NameExpr['method_defined?']
                           $param: #List[
                              $expression: #NameExpr['npn_select_cb']
                           ]
                        ]
                     ]
                     $then: #List[
                        $statement: #FuncDecl[
                           $name: #NameExpr['test_npn_protocol_selection_ary']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['advertised']
                                    $right: #Array[
                                       $index: #List[
                                          $expression: #StringExpr['http/1.1']
                                          $expression: #StringExpr['spdy/2']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ctx_proc']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['Proc']
                                       $recv: #NameExpr['new']
                                       $body: #Block[
                                          $param: #NameExpr['ctx']
                                          $body: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['npn_protocols']
                                             ]
                                             $right: #NameExpr['advertised']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['start_server_version']
                                    $param: #List[
                                       $expression: #NameExpr['SSLv23']
                                       $expression: #NameExpr['ctx_proc']
                                    ]
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['server']
                                          $item: #NameExpr['port']
                                       ]
                                       $body: #List[
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['selector']
                                             $right: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['lambda']
                                                $body: #Block[
                                                   $param: #NameExpr['which']
                                                   $body: #List[
                                                      $statement: #AssignExpr[
                                                         $left: #NameExpr['ctx']
                                                         $right: #ApplyExpr[
                                                            $recv: #Field[
                                                               $recv: #Field[
                                                                  $recv: #NameExpr['OpenSSL']
                                                                  $name: #NameExpr['SSL']
                                                               ]
                                                               $name: #NameExpr['SSLContext']
                                                            ]
                                                            $recv: #NameExpr['new']
                                                         ]
                                                      ]
                                                      $statement: #AssignExpr[
                                                         $left: #Field[
                                                            $base: #NameExpr['ctx']
                                                            $name: #NameExpr['npn_select_cb']
                                                         ]
                                                         $right: #Lambda[
                                                            $param: #List[
                                                               $param: #Param[
                                                                  $param: #NameExpr['protocols']
                                                               ]
                                                            ]
                                                            $body: #Block[
                                                               $body: #ApplyExpr[
                                                                  $recv: #NameExpr['protocols']
                                                                  $recv: #NameExpr['send']
                                                                  $param: #List[
                                                                     $expression: #NameExpr['which']
                                                                  ]
                                                               ]
                                                            ]
                                                         ]
                                                      ]
                                                      $statement: #ApplyExpr[
                                                         #Self['self']
                                                         $recv: #NameExpr['server_connect']
                                                         $param: #List[
                                                            $expression: #NameExpr['port']
                                                            $expression: #NameExpr['ctx']
                                                         ]
                                                         $body: #Block[
                                                            $param: #NameExpr['ssl']
                                                            $body: #ApplyExpr[
                                                               #Self['self']
                                                               $recv: #NameExpr['assert_equal']
                                                               $param: #List[
                                                                  $expression: #ApplyExpr[
                                                                     $recv: #NameExpr['advertised']
                                                                     $recv: #NameExpr['send']
                                                                     $param: #List[
                                                                        $expression: #NameExpr['which']
                                                                     ]
                                                                  ]
                                                                  $expression: #ApplyExpr[
                                                                     $recv: #NameExpr['ssl']
                                                                     $recv: #NameExpr['npn_protocol']
                                                                  ]
                                                               ]
                                                            ]
                                                         ]
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             $recv: #NameExpr['selector']
                                             $recv: #NameExpr['call']
                                             $param: #List[
                                                $expression: #NameExpr['first']
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             $recv: #NameExpr['selector']
                                             $recv: #NameExpr['call']
                                             $param: #List[
                                                $expression: #NameExpr['last']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['test_npn_protocol_selection_enum']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['advertised']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['Object']
                                       $recv: #NameExpr['new']
                                    ]
                                 ]
                                 $statement: #SFuncDecl[
                                    $path: #NameExpr['advertised']
                                    $name: #NameExpr['each']
                                    $param: #List['']
                                    $body: #BlockExpr[
                                       $main: #List[
                                          $statement: #Yield[
                                             $param: #List[
                                                $expression: #StringExpr['http/1.1']
                                             ]
                                          ]
                                          $statement: #Yield[
                                             $param: #List[
                                                $expression: #StringExpr['spdy/2']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ctx_proc']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['Proc']
                                       $recv: #NameExpr['new']
                                       $body: #Block[
                                          $param: #NameExpr['ctx']
                                          $body: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['npn_protocols']
                                             ]
                                             $right: #NameExpr['advertised']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['start_server_version']
                                    $param: #List[
                                       $expression: #NameExpr['SSLv23']
                                       $expression: #NameExpr['ctx_proc']
                                    ]
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['server']
                                          $item: #NameExpr['port']
                                       ]
                                       $body: #List[
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['selector']
                                             $right: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['lambda']
                                                $body: #Block[
                                                   $param: #MultipleLeftHandSideExpression[
                                                      $item: #NameExpr['selected']
                                                      $item: #NameExpr['which']
                                                   ]
                                                   $body: #List[
                                                      $statement: #AssignExpr[
                                                         $left: #NameExpr['ctx']
                                                         $right: #ApplyExpr[
                                                            $recv: #Field[
                                                               $recv: #Field[
                                                                  $recv: #NameExpr['OpenSSL']
                                                                  $name: #NameExpr['SSL']
                                                               ]
                                                               $name: #NameExpr['SSLContext']
                                                            ]
                                                            $recv: #NameExpr['new']
                                                         ]
                                                      ]
                                                      $statement: #AssignExpr[
                                                         $left: #Field[
                                                            $base: #NameExpr['ctx']
                                                            $name: #NameExpr['npn_select_cb']
                                                         ]
                                                         $right: #Lambda[
                                                            $param: #List[
                                                               $param: #Param[
                                                                  $param: #NameExpr['protocols']
                                                               ]
                                                            ]
                                                            $body: #Block[
                                                               $body: #ApplyExpr[
                                                                  $recv: #ApplyExpr[
                                                                     $recv: #NameExpr['protocols']
                                                                     $recv: #NameExpr['to_a']
                                                                  ]
                                                                  $recv: #NameExpr['send']
                                                                  $param: #List[
                                                                     $expression: #NameExpr['which']
                                                                  ]
                                                               ]
                                                            ]
                                                         ]
                                                      ]
                                                      $statement: #ApplyExpr[
                                                         #Self['self']
                                                         $recv: #NameExpr['server_connect']
                                                         $param: #List[
                                                            $expression: #NameExpr['port']
                                                            $expression: #NameExpr['ctx']
                                                         ]
                                                         $body: #Block[
                                                            $param: #NameExpr['ssl']
                                                            $body: #ApplyExpr[
                                                               #Self['self']
                                                               $recv: #NameExpr['assert_equal']
                                                               $param: #List[
                                                                  $expression: #NameExpr['selected']
                                                                  $expression: #ApplyExpr[
                                                                     $recv: #NameExpr['ssl']
                                                                     $recv: #NameExpr['npn_protocol']
                                                                  ]
                                                               ]
                                                            ]
                                                         ]
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             $recv: #NameExpr['selector']
                                             $recv: #NameExpr['call']
                                             $param: #List[
                                                $expression: #StringExpr['http/1.1']
                                                $expression: #NameExpr['first']
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             $recv: #NameExpr['selector']
                                             $recv: #NameExpr['call']
                                             $param: #List[
                                                $expression: #StringExpr['spdy/2']
                                                $expression: #NameExpr['last']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['test_npn_protocol_selection_cancel']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ctx_proc']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['Proc']
                                       $recv: #NameExpr['new']
                                       $body: #Block[
                                          $param: #NameExpr['ctx']
                                          $body: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['npn_protocols']
                                             ]
                                             $right: #Array[
                                                $index: #List[
                                                   $expression: #StringExpr['http/1.1']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['start_server_version']
                                    $param: #List[
                                       $expression: #NameExpr['SSLv23']
                                       $expression: #NameExpr['ctx_proc']
                                    ]
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['server']
                                          $item: #NameExpr['port']
                                       ]
                                       $body: #List[
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['ctx']
                                             $right: #ApplyExpr[
                                                $recv: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLContext']
                                                ]
                                                $recv: #NameExpr['new']
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['npn_select_cb']
                                             ]
                                             $right: #Lambda[
                                                $param: #List[
                                                   $param: #Param[
                                                      $param: #NameExpr['protocols']
                                                   ]
                                                ]
                                                $body: #Block[
                                                   $body: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #NameExpr['raise']
                                                      $param: #List[
                                                         $expression: #ApplyExpr[
                                                            $recv: #NameExpr['RuntimeError']
                                                            $recv: #NameExpr['new']
                                                         ]
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_raise']
                                             $param: #List[
                                                $expression: #NameExpr['RuntimeError']
                                             ]
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['server_connect']
                                                   $param: #List[
                                                      $expression: #NameExpr['port']
                                                      $expression: #NameExpr['ctx']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['test_npn_advertised_protocol_too_long']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ctx_proc']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['Proc']
                                       $recv: #NameExpr['new']
                                       $body: #Block[
                                          $param: #NameExpr['ctx']
                                          $body: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['npn_protocols']
                                             ]
                                             $right: #Array[
                                                $index: #List[
                                                   $expression: #MulExpr[
                                                      $left: #StringExpr['a']
                                                      $right: #IntExpr['256']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['start_server_version']
                                    $param: #List[
                                       $expression: #NameExpr['SSLv23']
                                       $expression: #NameExpr['ctx_proc']
                                    ]
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['server']
                                          $item: #NameExpr['port']
                                       ]
                                       $body: #List[
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['ctx']
                                             $right: #ApplyExpr[
                                                $recv: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLContext']
                                                ]
                                                $recv: #NameExpr['new']
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['npn_select_cb']
                                             ]
                                             $right: #Lambda[
                                                $param: #List[
                                                   $param: #Param[
                                                      $param: #NameExpr['protocols']
                                                   ]
                                                ]
                                                $body: #Block[
                                                   $body: #ApplyExpr[
                                                      $recv: #NameExpr['protocols']
                                                      $recv: #NameExpr['first']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_handshake_error']
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['server_connect']
                                                   $param: #List[
                                                      $expression: #NameExpr['port']
                                                      $expression: #NameExpr['ctx']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #FuncDecl[
                           $name: #NameExpr['test_npn_selected_protocol_too_long']
                           $param: #List['']
                           $body: #BlockExpr[
                              $main: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ctx_proc']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['Proc']
                                       $recv: #NameExpr['new']
                                       $body: #Block[
                                          $param: #NameExpr['ctx']
                                          $body: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['npn_protocols']
                                             ]
                                             $right: #Array[
                                                $index: #List[
                                                   $expression: #StringExpr['http/1.1']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['start_server_version']
                                    $param: #List[
                                       $expression: #NameExpr['SSLv23']
                                       $expression: #NameExpr['ctx_proc']
                                    ]
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['server']
                                          $item: #NameExpr['port']
                                       ]
                                       $body: #List[
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['ctx']
                                             $right: #ApplyExpr[
                                                $recv: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLContext']
                                                ]
                                                $recv: #NameExpr['new']
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['npn_select_cb']
                                             ]
                                             $right: #Lambda[
                                                $param: #List[
                                                   $param: #Param[
                                                      $param: #NameExpr['protocols']
                                                   ]
                                                ]
                                                $body: #Block[
                                                   $body: #MulExpr[
                                                      $left: #StringExpr['a']
                                                      $right: #IntExpr['256']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_handshake_error']
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['server_connect']
                                                   $param: #List[
                                                      $expression: #NameExpr['port']
                                                      $expression: #NameExpr['ctx']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_invalid_shutdown_by_gc']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_nothing_raised']
                           $body: #Block[
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['start_server']
                                 $body: #Block[
                                    $param: #MultipleLeftHandSideExpression[
                                       $item: #NameExpr['server']
                                       $item: #NameExpr['port']
                                    ]
                                    $body: #ApplyExpr[
                                       $recv: #IntExpr['10']
                                       $recv: #NameExpr['times']
                                       $body: #Block[
                                          $body: #List[
                                             $statement: #AssignExpr[
                                                $left: #NameExpr['sock']
                                                $right: #ApplyExpr[
                                                   $recv: #NameExpr['TCPSocket']
                                                   $recv: #NameExpr['new']
                                                   $param: #List[
                                                      $expression: #StringExpr['127.0.0.1']
                                                      $expression: #NameExpr['port']
                                                   ]
                                                ]
                                             ]
                                             $statement: #AssignExpr[
                                                $left: #NameExpr['ssl']
                                                $right: #ApplyExpr[
                                                   $recv: #Field[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $name: #NameExpr['SSLSocket']
                                                   ]
                                                   $recv: #NameExpr['new']
                                                   $param: #List[
                                                      $expression: #NameExpr['sock']
                                                   ]
                                                ]
                                             ]
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['GC']
                                                $recv: #NameExpr['start']
                                             ]
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['connect']
                                             ]
                                             $statement: #ApplyExpr[
                                                $recv: #NameExpr['sock']
                                                $recv: #NameExpr['close']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_close_after_socket_close']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['start_server']
                           $body: #Block[
                              $param: #MultipleLeftHandSideExpression[
                                 $item: #NameExpr['server']
                                 $item: #NameExpr['port']
                              ]
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['sock']
                                    $right: #ApplyExpr[
                                       $recv: #NameExpr['TCPSocket']
                                       $recv: #NameExpr['new']
                                       $param: #List[
                                          $expression: #StringExpr['127.0.0.1']
                                          $expression: #NameExpr['port']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ssl']
                                    $right: #ApplyExpr[
                                       $recv: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $name: #NameExpr['SSLSocket']
                                       ]
                                       $recv: #NameExpr['new']
                                       $param: #List[
                                          $expression: #NameExpr['sock']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['ssl']
                                       $name: #NameExpr['sync_close']
                                    ]
                                    $right: #TrueExpr['true']
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['ssl']
                                    $recv: #NameExpr['connect']
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['sock']
                                    $recv: #NameExpr['close']
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_nothing_raised']
                                    $body: #Block[
                                       $body: #ApplyExpr[
                                          $recv: #NameExpr['ssl']
                                          $recv: #NameExpr['close']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_sync_close_without_connect']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #ApplyExpr[
                           $recv: #NameExpr['Socket']
                           $recv: #NameExpr['open']
                           $param: #List[
                              $expression: #NameExpr['INET']
                              $expression: #NameExpr['STREAM']
                           ]
                           $body: #Block[
                              $param: #NameExpr['s']
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['ssl']
                                    $right: #ApplyExpr[
                                       $recv: #Field[
                                          $recv: #Field[
                                             $recv: #NameExpr['OpenSSL']
                                             $name: #NameExpr['SSL']
                                          ]
                                          $name: #NameExpr['SSLSocket']
                                       ]
                                       $recv: #NameExpr['new']
                                       $param: #List[
                                          $expression: #NameExpr['s']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['ssl']
                                       $name: #NameExpr['sync_close']
                                    ]
                                    $right: #TrueExpr['true']
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['ssl']
                                    $recv: #NameExpr['close']
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['s']
                                          $recv: #NameExpr['closed?']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_close_and_socket_close_while_connecting']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['SSLContext']
                                 ]
                                 $recv: #NameExpr['new']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['ctx']
                                 $name: #NameExpr['ciphers']
                              ]
                              $right: #StringExpr['aNULL']
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['ctx']
                                 $name: #NameExpr['tmp_dh_callback']
                              ]
                              $right: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['proc']
                                 $body: #Block[
                                    $body: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['OpenSSL']
                                          $name: #NameExpr['TestUtils']
                                       ]
                                       $name: #NameExpr['TEST_KEY_DH1024']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['ctx']
                                 $name: #NameExpr['security_level']
                              ]
                              $right: #IntExpr['0']
                           ]
                           $statement: #MultipleAssign[
                              $left: #MultipleLeftHandSideExpression[
                                 $item: #NameExpr['sock1']
                                 $item: #NameExpr['sock2']
                              ]
                              $right: #NameExpr['socketpair']
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['ssl1']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['SSLSocket']
                                 ]
                                 $recv: #NameExpr['new']
                                 $param: #List[
                                    $expression: #NameExpr['sock1']
                                    $expression: #NameExpr['ctx']
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['ssl2']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['SSLSocket']
                                 ]
                                 $recv: #NameExpr['new']
                                 $param: #List[
                                    $expression: #NameExpr['sock2']
                                    $expression: #NameExpr['ctx']
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['t']
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['Thread']
                                 $recv: #NameExpr['new']
                                 $body: #Block[
                                    $body: #ApplyExpr[
                                       $recv: #NameExpr['ssl1']
                                       $recv: #NameExpr['connect']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              $recv: #NameExpr['ssl2']
                              $recv: #NameExpr['accept']
                           ]
                           $statement: #ApplyExpr[
                              $recv: #NameExpr['ssl1']
                              $recv: #NameExpr['close']
                           ]
                           $statement: #ApplyExpr[
                              $recv: #NameExpr['sock1']
                              $recv: #NameExpr['close']
                           ]
                           $statement: #Rescue[
                              $body: #ApplyExpr[
                                 $recv: #NameExpr['t']
                                 $recv: #NameExpr['value']
                              ]
                              $rescue: #Nil['nil']
                           ]
                        ]
                        $ensure: #List[
                           $statement: #IfExpr[
                              $then: #ApplyExpr[
                                 $recv: #NameExpr['ssl1']
                                 $recv: #NameExpr['close']
                              ]
                              $cond: #NameExpr['ssl1']
                           ]
                           $statement: #IfExpr[
                              $then: #ApplyExpr[
                                 $recv: #NameExpr['ssl2']
                                 $recv: #NameExpr['close']
                              ]
                              $cond: #NameExpr['ssl2']
                           ]
                           $statement: #IfExpr[
                              $then: #ApplyExpr[
                                 $recv: #NameExpr['sock1']
                                 $recv: #NameExpr['close']
                              ]
                              $cond: #NameExpr['sock1']
                           ]
                           $statement: #IfExpr[
                              $then: #ApplyExpr[
                                 $recv: #NameExpr['sock2']
                                 $recv: #NameExpr['close']
                              ]
                              $cond: #NameExpr['sock2']
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_get_ephemeral_key']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #Unless[
                              $then: #RReturnStmt['return']
                              $cond: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['SSLSocket']
                                 ]
                                 $recv: #NameExpr['method_defined?']
                                 $param: #List[
                                    $expression: #NameExpr['tmp_key']
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['pkey']
                              $right: #Field[
                                 $recv: #NameExpr['OpenSSL']
                                 $name: #NameExpr['PKey']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['ciphers']
                              $right: #List[
                                 $hash: #Hash[
                                    $key: #StringExpr['ECDHE-RSA-AES128-SHA']
                                    $value: #IfExpr[
                                       $then: #Field[
                                          $recv: #NameExpr['pkey']
                                          $name: #NameExpr['EC']
                                       ]
                                       $cond: #Defined[
                                          $base: #Field[
                                             $recv: #NameExpr['pkey']
                                             $name: #NameExpr['EC']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $hash: #Hash[
                                    $key: #StringExpr['DHE-RSA-AES128-SHA']
                                    $value: #IfExpr[
                                       $then: #Field[
                                          $recv: #NameExpr['pkey']
                                          $name: #NameExpr['DH']
                                       ]
                                       $cond: #Defined[
                                          $base: #Field[
                                             $recv: #NameExpr['pkey']
                                             $name: #NameExpr['DH']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $hash: #Hash[
                                    $key: #StringExpr['AES128-SHA']
                                    $value: #Nil['nil']
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['conf_proc']
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['Proc']
                                 $recv: #NameExpr['new']
                                 $body: #Block[
                                    $param: #NameExpr['ctx']
                                    $body: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['ciphers']
                                       ]
                                       $right: #StringExpr['ALL']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $param: #List[
                                 $hash: #Hash[
                                    $key: #NameExpr['ctx_proc']
                                    $value: #NameExpr['conf_proc']
                                 ]
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #ApplyExpr[
                                    $recv: #NameExpr['ciphers']
                                    $recv: #NameExpr['each']
                                    $body: #Block[
                                       $param: #MultipleLeftHandSideExpression[
                                          $item: #NameExpr['cipher']
                                          $item: #NameExpr['ephemeral']
                                       ]
                                       $body: #List[
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['ctx']
                                             $right: #ApplyExpr[
                                                $recv: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLContext']
                                                ]
                                                $recv: #NameExpr['new']
                                             ]
                                          ]
                                          $statement: #ExceptionBlock[
                                             $main: #AssignExpr[
                                                $left: #Field[
                                                   $base: #NameExpr['ctx']
                                                   $name: #NameExpr['ciphers']
                                                ]
                                                $right: #NameExpr['cipher']
                                             ]
                                             $rescue: #List[
                                                $rescue: #Rescue[
                                                   $class: #Field[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['SSL']
                                                      ]
                                                      $name: #NameExpr['SSLError']
                                                   ]
                                                   $target: #NameExpr['e']
                                                   $then: #List[
                                                      $statement: #IfExpr[
                                                         $then: #Next['next']
                                                         $cond: #Match[
                                                            $left: #Regex['/no cipher match/']
                                                            $right: #ApplyExpr[
                                                               $recv: #NameExpr['e']
                                                               $recv: #NameExpr['message']
                                                            ]
                                                         ]
                                                      ]
                                                      $statement: #NameExpr['raise']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['server_connect']
                                             $param: #List[
                                                $expression: #NameExpr['port']
                                                $expression: #NameExpr['ctx']
                                             ]
                                             $body: #Block[
                                                $param: #NameExpr['ssl']
                                                $body: #IfExpr[
                                                   $cond: #NameExpr['ephemeral']
                                                   $then: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #NameExpr['assert_instance_of']
                                                      $param: #List[
                                                         $expression: #NameExpr['ephemeral']
                                                         $expression: #ApplyExpr[
                                                            $recv: #NameExpr['ssl']
                                                            $recv: #NameExpr['tmp_key']
                                                         ]
                                                      ]
                                                   ]
                                                   $else: #ApplyExpr[
                                                      #Self['self']
                                                      $recv: #NameExpr['assert_nil']
                                                      $param: #List[
                                                         $expression: #ApplyExpr[
                                                            $recv: #NameExpr['ssl']
                                                            $recv: #NameExpr['tmp_key']
                                                         ]
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_dh_callback']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['called']
                              $right: #FalseExpr['false']
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx_proc']
                              $right: #Lambda[
                                 $param: #List[
                                    $param: #Param[
                                       $param: #NameExpr['ctx']
                                    ]
                                 ]
                                 $body: #Block[
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx']
                                             $name: #NameExpr['ciphers']
                                          ]
                                          $right: #StringExpr['DH:!NULL']
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx']
                                             $name: #NameExpr['tmp_dh_callback']
                                          ]
                                          $right: #Lambda[
                                             $param: #List[
                                                $param: #VariadicParam[
                                                   $name: #NameExpr['args']
                                                ]
                                             ]
                                             $body: #Block[
                                                $body: #List[
                                                   $statement: #AssignExpr[
                                                      $left: #NameExpr['called']
                                                      $right: #TrueExpr['true']
                                                   ]
                                                   $statement: #Field[
                                                      $recv: #Field[
                                                         $recv: #NameExpr['OpenSSL']
                                                         $name: #NameExpr['TestUtils']
                                                      ]
                                                      $name: #NameExpr['TEST_KEY_DH1024']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $param: #List[
                                 $hash: #Hash[
                                    $key: #NameExpr['ctx_proc']
                                    $value: #NameExpr['ctx_proc']
                                 ]
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['server_connect']
                                    $param: #List[
                                       $expression: #NameExpr['port']
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['ssl']
                                       $body: #List[
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert']
                                             $param: #List[
                                                $expression: #NameExpr['called']
                                                $expression: #StringExpr['dh callback should be called']
                                             ]
                                          ]
                                          $statement: #IfExpr[
                                             $cond: #ApplyExpr[
                                                $recv: #NameExpr['ssl']
                                                $recv: #NameExpr['respond_to?']
                                                $param: #List[
                                                   $expression: #NameExpr['tmp_key']
                                                ]
                                             ]
                                             $then: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['assert_equal']
                                                $param: #List[
                                                   $expression: #ApplyExpr[
                                                      $recv: #Field[
                                                         $recv: #Field[
                                                            $recv: #NameExpr['OpenSSL']
                                                            $name: #NameExpr['TestUtils']
                                                         ]
                                                         $name: #NameExpr['TEST_KEY_DH1024']
                                                      ]
                                                      $recv: #NameExpr['to_der']
                                                   ]
                                                   $expression: #ApplyExpr[
                                                      $recv: #ApplyExpr[
                                                         $recv: #NameExpr['ssl']
                                                         $recv: #NameExpr['tmp_key']
                                                      ]
                                                      $recv: #NameExpr['to_der']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_connect_works_when_setting_dh_callback_to_nil']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx_proc']
                              $right: #Lambda[
                                 $param: #List[
                                    $param: #Param[
                                       $param: #NameExpr['ctx']
                                    ]
                                 ]
                                 $body: #Block[
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx']
                                             $name: #NameExpr['ciphers']
                                          ]
                                          $right: #StringExpr['DH:!NULL']
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx']
                                             $name: #NameExpr['tmp_dh_callback']
                                          ]
                                          $right: #Nil['nil']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $param: #List[
                                 $hash: #Hash[
                                    $key: #NameExpr['ctx_proc']
                                    $value: #NameExpr['ctx_proc']
                                 ]
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #ApplyExpr[
                                    $recv: #NameExpr['EnvUtil']
                                    $recv: #NameExpr['suppress_warning']
                                    $body: #Block[
                                       $body: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_nothing_raised']
                                          $body: #Block[
                                             $body: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['server_connect']
                                                $param: #List[
                                                   $expression: #NameExpr['port']
                                                ]
                                                $body: #Block[
                                                   $body: #Empty['']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_ecdh_callback']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #Unless[
                              $then: #RReturnStmt['return']
                              $cond: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['OpenSSL']
                                          $name: #NameExpr['SSL']
                                       ]
                                       $name: #NameExpr['SSLContext']
                                    ]
                                    $recv: #NameExpr['instance_methods']
                                 ]
                                 $recv: #NameExpr['include?']
                                 $param: #List[
                                    $expression: #NameExpr['tmp_ecdh_callback']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              $recv: #NameExpr['EnvUtil']
                              $recv: #NameExpr['suppress_warning']
                              $body: #Block[
                                 $body: #ExceptionBlock[
                                    $main: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['called']
                                          $right: #FalseExpr['false']
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['ctx2']
                                          $right: #ApplyExpr[
                                             $recv: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['SSL']
                                                ]
                                                $name: #NameExpr['SSLContext']
                                             ]
                                             $recv: #NameExpr['new']
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx2']
                                             $name: #NameExpr['ciphers']
                                          ]
                                          $right: #StringExpr['ECDH']
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx2']
                                             $name: #NameExpr['security_level']
                                          ]
                                          $right: #IntExpr['0']
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx2']
                                             $name: #NameExpr['tmp_ecdh_callback']
                                          ]
                                          $right: #Lambda[
                                             $param: #List[
                                                $param: #VariadicParam[
                                                   $name: #NameExpr['args']
                                                ]
                                             ]
                                             $body: #Block[
                                                $body: #List[
                                                   $statement: #AssignExpr[
                                                      $left: #NameExpr['called']
                                                      $right: #TrueExpr['true']
                                                   ]
                                                   $statement: #ApplyExpr[
                                                      $base: #Field[
                                                         $recv: #Field[
                                                            $recv: #NameExpr['OpenSSL']
                                                            $name: #NameExpr['PKey']
                                                         ]
                                                         $name: #NameExpr['EC']
                                                      ]
                                                      $recv: #NameExpr['new']
                                                      $param: #List[
                                                         $expression: #StringExpr['prime256v1']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #MultipleAssign[
                                          $left: #MultipleLeftHandSideExpression[
                                             $item: #NameExpr['sock1']
                                             $item: #NameExpr['sock2']
                                          ]
                                          $right: #NameExpr['socketpair']
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['s2']
                                          $right: #ApplyExpr[
                                             $recv: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['SSL']
                                                ]
                                                $name: #NameExpr['SSLSocket']
                                             ]
                                             $recv: #NameExpr['new']
                                             $param: #List[
                                                $expression: #NameExpr['sock2']
                                                $expression: #NameExpr['ctx2']
                                             ]
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['ctx1']
                                          $right: #ApplyExpr[
                                             $recv: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['SSL']
                                                ]
                                                $name: #NameExpr['SSLContext']
                                             ]
                                             $recv: #NameExpr['new']
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx1']
                                             $name: #NameExpr['ciphers']
                                          ]
                                          $right: #StringExpr['ECDH']
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx1']
                                             $name: #NameExpr['security_level']
                                          ]
                                          $right: #IntExpr['0']
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['s1']
                                          $right: #ApplyExpr[
                                             $recv: #Field[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['SSL']
                                                ]
                                                $name: #NameExpr['SSLSocket']
                                             ]
                                             $recv: #NameExpr['new']
                                             $param: #List[
                                                $expression: #NameExpr['sock1']
                                                $expression: #NameExpr['ctx1']
                                             ]
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['th']
                                          $right: #ApplyExpr[
                                             $recv: #NameExpr['Thread']
                                             $recv: #NameExpr['new']
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   $recv: #NameExpr['s1']
                                                   $recv: #NameExpr['connect']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          $recv: #NameExpr['s2']
                                          $recv: #NameExpr['accept']
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert']
                                          $param: #List[
                                             $expression: #NameExpr['called']
                                             $expression: #StringExpr['ecdh callback should be called']
                                          ]
                                       ]
                                    ]
                                    $rescue: #List[
                                       $rescue: #Rescue[
                                          $class: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['SSLError']
                                          ]
                                          $target: #NameExpr['e']
                                          $then: #IfExpr[
                                             $cond: #AssignExpr[
                                                $left: #Field[
                                                   $base: #NameExpr['e']
                                                   $name: #NameExpr['message']
                                                ]
                                                $right: #ComplExpr[
                                                   $expr: #Regex['/no cipher match/']
                                                ]
                                             ]
                                             $then: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['pend']
                                                $param: #List[
                                                   $expression: #StringExpr['ECDH cipher not supported.']
                                                ]
                                             ]
                                             $else: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['raise']
                                                $param: #List[
                                                   $expression: #NameExpr['e']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                    $ensure: #List[
                                       $statement: #IfExpr[
                                          $then: #ApplyExpr[
                                             $recv: #NameExpr['th']
                                             $recv: #NameExpr['join']
                                          ]
                                          $cond: #NameExpr['th']
                                       ]
                                       $statement: #IfExpr[
                                          $then: #ApplyExpr[
                                             $recv: #NameExpr['s1']
                                             $recv: #NameExpr['close']
                                          ]
                                          $cond: #NameExpr['s1']
                                       ]
                                       $statement: #IfExpr[
                                          $then: #ApplyExpr[
                                             $recv: #NameExpr['s2']
                                             $recv: #NameExpr['close']
                                          ]
                                          $cond: #NameExpr['s2']
                                       ]
                                       $statement: #IfExpr[
                                          $then: #ApplyExpr[
                                             $recv: #NameExpr['sock1']
                                             $recv: #NameExpr['close']
                                          ]
                                          $cond: #NameExpr['sock1']
                                       ]
                                       $statement: #IfExpr[
                                          $then: #ApplyExpr[
                                             $recv: #NameExpr['sock2']
                                             $recv: #NameExpr['close']
                                          ]
                                          $cond: #NameExpr['sock2']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_ecdh_curves']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx_proc']
                              $right: #Lambda[
                                 $param: #List[
                                    $param: #Param[
                                       $param: #NameExpr['ctx']
                                    ]
                                 ]
                                 $body: #Block[
                                    $body: #List[
                                       $statement: #ExceptionBlock[
                                          $main: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['ciphers']
                                             ]
                                             $right: #StringExpr['ECDH:!NULL']
                                          ]
                                          $rescue: #List[
                                             $rescue: #Rescue[
                                                $class: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLError']
                                                ]
                                                $then: #List[
                                                   $statement: #IfExpr[
                                                      $then: #ApplyExpr[
                                                         #Self['self']
                                                         $recv: #NameExpr['pend']
                                                         $param: #List[
                                                            $expression: #StringExpr['ECDH is not enabled in this OpenSSL']
                                                         ]
                                                      ]
                                                      $cond: #AssignExpr[
                                                         $left: #Field[
                                                            $base: #BuiltInVariable['$!']
                                                            $name: #NameExpr['message']
                                                         ]
                                                         $right: #ComplExpr[
                                                            $expr: #Regex['/no cipher match/']
                                                         ]
                                                      ]
                                                   ]
                                                   $statement: #NameExpr['raise']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx']
                                             $name: #NameExpr['ecdh_curves']
                                          ]
                                          $right: #StringExpr['P-384:P-521']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $param: #List[
                                 $hash: #Hash[
                                    $key: #NameExpr['ctx_proc']
                                    $value: #NameExpr['ctx_proc']
                                 ]
                                 $hash: #Hash[
                                    $key: #NameExpr['ignore_listener_error']
                                    $value: #TrueExpr['true']
                                 ]
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['server']
                                    $item: #NameExpr['port']
                                 ]
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['ctx']
                                       $right: #ApplyExpr[
                                          $recv: #Field[
                                             $recv: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['SSL']
                                             ]
                                             $name: #NameExpr['SSLContext']
                                          ]
                                          $recv: #NameExpr['new']
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['ctx']
                                          $name: #NameExpr['ecdh_curves']
                                       ]
                                       $right: #StringExpr['P-256:P-384']
                                    ]
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['server_connect']
                                       $param: #List[
                                          $expression: #NameExpr['port']
                                          $expression: #NameExpr['ctx']
                                       ]
                                       $body: #Block[
                                          $param: #NameExpr['ssl']
                                          $body: #List[
                                             $statement: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['assert']
                                                $param: #List[
                                                   $expression: #ApplyExpr[
                                                      $recv: #Indexer[
                                                         $recv: #ApplyExpr[
                                                            $recv: #NameExpr['ssl']
                                                            $recv: #NameExpr['cipher']
                                                         ]
                                                         $index: #List[
                                                            $expression: #IntExpr['0']
                                                         ]
                                                      ]
                                                      $recv: #NameExpr['start_with?']
                                                      $param: #List[
                                                         $expression: #StringExpr['ECDH']
                                                      ]
                                                   ]
                                                   $expression: #StringExpr['ECDH should be used']
                                                ]
                                             ]
                                             $statement: #IfExpr[
                                                $cond: #ApplyExpr[
                                                   $recv: #NameExpr['ssl']
                                                   $recv: #NameExpr['respond_to?']
                                                   $param: #List[
                                                      $expression: #NameExpr['tmp_key']
                                                   ]
                                                ]
                                                $then: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['assert_equal']
                                                   $param: #List[
                                                      $expression: #StringExpr['secp384r1']
                                                      $expression: #ApplyExpr[
                                                         $recv: #ApplyExpr[
                                                            $recv: #ApplyExpr[
                                                               $recv: #NameExpr['ssl']
                                                               $recv: #NameExpr['tmp_key']
                                                            ]
                                                            $recv: #NameExpr['group']
                                                         ]
                                                         $recv: #NameExpr['curve_name']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                    $statement: #IfExpr[
                                       $cond: #LAnd[
                                          $left: #GteExpt[
                                             $left: #Field[
                                                $recv: #NameExpr['OpenSSL']
                                                $name: #NameExpr['OPENSSL_VERSION_NUMBER']
                                             ]
                                             $right: #HexInteger['0x10002000']
                                          ]
                                          $right: #NotExpr[
                                             $expr: #ApplyExpr[
                                                $recv: #Field[
                                                   $recv: #NameExpr['OpenSSL']
                                                   $name: #NameExpr['OPENSSL_VERSION']
                                                ]
                                                $recv: #NameExpr['include?']
                                                $param: #List[
                                                   $expression: #StringExpr['LibreSSL']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $then: #List[
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['ctx']
                                             $right: #ApplyExpr[
                                                $recv: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLContext']
                                                ]
                                                $recv: #NameExpr['new']
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['ecdh_curves']
                                             ]
                                             $right: #StringExpr['P-256']
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_raise']
                                             $param: #List[
                                                $expression: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLError']
                                                ]
                                             ]
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['server_connect']
                                                   $param: #List[
                                                      $expression: #NameExpr['port']
                                                      $expression: #NameExpr['ctx']
                                                   ]
                                                   $body: #Block[
                                                      $body: #Empty['']
                                                   ]
                                                ]
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #NameExpr['ctx']
                                             $right: #ApplyExpr[
                                                $recv: #Field[
                                                   $recv: #Field[
                                                      $recv: #NameExpr['OpenSSL']
                                                      $name: #NameExpr['SSL']
                                                   ]
                                                   $name: #NameExpr['SSLContext']
                                                ]
                                                $recv: #NameExpr['new']
                                             ]
                                          ]
                                          $statement: #AssignExpr[
                                             $left: #Field[
                                                $base: #NameExpr['ctx']
                                                $name: #NameExpr['ecdh_curves']
                                             ]
                                             $right: #StringExpr['P-521:P-384']
                                          ]
                                          $statement: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['server_connect']
                                             $param: #List[
                                                $expression: #NameExpr['port']
                                                $expression: #NameExpr['ctx']
                                             ]
                                             $body: #Block[
                                                $param: #NameExpr['ssl']
                                                $body: #ApplyExpr[
                                                   #Self['self']
                                                   $recv: #NameExpr['assert_equal']
                                                   $param: #List[
                                                      $expression: #StringExpr['secp521r1']
                                                      $expression: #ApplyExpr[
                                                         $recv: #ApplyExpr[
                                                            $recv: #ApplyExpr[
                                                               $recv: #NameExpr['ssl']
                                                               $recv: #NameExpr['tmp_key']
                                                            ]
                                                            $recv: #NameExpr['group']
                                                         ]
                                                         $recv: #NameExpr['curve_name']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_security_level']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['SSLContext']
                                 ]
                                 $recv: #NameExpr['new']
                              ]
                           ]
                           $statement: #ExceptionBlock[
                              $main: #AssignExpr[
                                 $left: #Field[
                                    $base: #NameExpr['ctx']
                                    $name: #NameExpr['security_level']
                                 ]
                                 $right: #IntExpr['1']
                              ]
                              $rescue: #List[
                                 $rescue: #Rescue[
                                    $class: #NameExpr['NotImplementedError']
                                    $then: #List[
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #IntExpr['0']
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['ctx']
                                                $recv: #NameExpr['security_level']
                                             ]
                                          ]
                                       ]
                                       $statement: #RReturnStmt['return']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #IntExpr['1']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['ctx']
                                    $recv: #NameExpr['security_level']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['pend']
                              $param: #List[
                                 $expression: #StringExpr['FIXME: SSLContext#key= currently does not raise because SSL_CTX_use_certificate() is delayed']
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['test_dup']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['SSLContext']
                                 ]
                                 $recv: #NameExpr['new']
                              ]
                           ]
                           $statement: #MultipleAssign[
                              $left: #MultipleLeftHandSideExpression[
                                 $item: #NameExpr['sock1']
                                 $item: #NameExpr['sock2']
                              ]
                              $right: #NameExpr['socketpair']
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['ssl']
                              $right: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #Field[
                                       $recv: #NameExpr['OpenSSL']
                                       $name: #NameExpr['SSL']
                                    ]
                                    $name: #NameExpr['SSLSocket']
                                 ]
                                 $recv: #NameExpr['new']
                                 $param: #List[
                                    $expression: #NameExpr['sock1']
                                    $expression: #NameExpr['ctx']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_raise']
                              $param: #List[
                                 $expression: #NameExpr['NoMethodError']
                              ]
                              $body: #Block[
                                 $body: #ApplyExpr[
                                    $recv: #NameExpr['ctx']
                                    $recv: #NameExpr['dup']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_raise']
                              $param: #List[
                                 $expression: #NameExpr['NoMethodError']
                              ]
                              $body: #Block[
                                 $body: #ApplyExpr[
                                    $recv: #NameExpr['ssl']
                                    $recv: #NameExpr['dup']
                                 ]
                              ]
                           ]
                        ]
                        $ensure: #List[
                           $statement: #IfExpr[
                              $then: #ApplyExpr[
                                 $recv: #NameExpr['ssl']
                                 $recv: #NameExpr['close']
                              ]
                              $cond: #NameExpr['ssl']
                           ]
                           $statement: #ApplyExpr[
                              $recv: #NameExpr['sock1']
                              $recv: #NameExpr['close']
                           ]
                           $statement: #ApplyExpr[
                              $recv: #NameExpr['sock2']
                              $recv: #NameExpr['close']
                           ]
                        ]
                     ]
                  ]
                  $statement: #NameExpr['private']
                  $statement: #FuncDecl[
                     $name: #NameExpr['start_server_version']
                     $param: #List[
                        $param: #Param[
                           $param: #NameExpr['version']
                        ]
                        $param: #OptionalParam[
                           $name: #NameExpr['ctx_proc']
                           $default: #Nil['nil']
                        ]
                        $param: #OptionalParam[
                           $name: #NameExpr['server_proc']
                           $default: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['method']
                              $param: #List[
                                 $expression: #NameExpr['readwrite_loop']
                              ]
                           ]
                        ]
                        $param: #ProcedureParam[
                           $name: #NameExpr['blk']
                        ]
                     ]
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['ctx_wrap']
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['Proc']
                                 $recv: #NameExpr['new']
                                 $body: #Block[
                                    $param: #NameExpr['ctx']
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #Field[
                                             $base: #NameExpr['ctx']
                                             $name: #NameExpr['ssl_version']
                                          ]
                                          $right: #NameExpr['version']
                                       ]
                                       $statement: #IfExpr[
                                          $then: #ApplyExpr[
                                             $recv: #NameExpr['ctx_proc']
                                             $recv: #NameExpr['call']
                                             $param: #List[
                                                $expression: #NameExpr['ctx']
                                             ]
                                          ]
                                          $cond: #NameExpr['ctx_proc']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['start_server']
                              $param: #List[
                                 $hash: #Hash[
                                    $key: #NameExpr['ctx_proc']
                                    $value: #NameExpr['ctx_wrap']
                                 ]
                                 $hash: #Hash[
                                    $key: #NameExpr['server_proc']
                                    $value: #NameExpr['server_proc']
                                 ]
                                 $hash: #Hash[
                                    $key: #NameExpr['ignore_listener_error']
                                    $value: #TrueExpr['true']
                                 ]
                                 $procedure: #Procedure[
                                    $base: #NameExpr['blk']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['server_connect']
                     $param: #List[
                        $param: #Param[
                           $param: #NameExpr['port']
                        ]
                        $param: #OptionalParam[
                           $name: #NameExpr['ctx']
                           $default: #Nil['nil']
                        ]
                     ]
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #AssignExpr[
                              $left: #NameExpr['sock']
                              $right: #ApplyExpr[
                                 $recv: #NameExpr['TCPSocket']
                                 $recv: #NameExpr['new']
                                 $param: #List[
                                    $expression: #StringExpr['127.0.0.1']
                                    $expression: #NameExpr['port']
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['ssl']
                              $right: #Conditional[
                                 $cond: #NameExpr['ctx']
                                 $then: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['OpenSSL']
                                          $name: #NameExpr['SSL']
                                       ]
                                       $name: #NameExpr['SSLSocket']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #NameExpr['sock']
                                       $expression: #NameExpr['ctx']
                                    ]
                                 ]
                                 $else: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['OpenSSL']
                                          $name: #NameExpr['SSL']
                                       ]
                                       $name: #NameExpr['SSLSocket']
                                    ]
                                    $recv: #NameExpr['new']
                                    $param: #List[
                                       $expression: #NameExpr['sock']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['ssl']
                                 $name: #NameExpr['sync_close']
                              ]
                              $right: #TrueExpr['true']
                           ]
                           $statement: #ApplyExpr[
                              $recv: #NameExpr['ssl']
                              $recv: #NameExpr['connect']
                           ]
                           $statement: #IfExpr[
                              $then: #Yield[
                                 $param: #List[
                                    $expression: #NameExpr['ssl']
                                 ]
                              ]
                              $cond: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['block_given?']
                              ]
                           ]
                        ]
                        $ensure: #IfExpr[
                           $cond: #NameExpr['ssl']
                           $then: #ApplyExpr[
                              $recv: #NameExpr['ssl']
                              $recv: #NameExpr['close']
                           ]
                           $else: #IfExpr[
                              $cond: #NameExpr['sock']
                              $then: #ApplyExpr[
                                 $recv: #NameExpr['sock']
                                 $recv: #NameExpr['close']
                              ]
                           ]
                        ]
                     ]
                  ]
                  $statement: #FuncDecl[
                     $name: #NameExpr['assert_handshake_error']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_raise']
                           $param: #List[
                              $expression: #Field[
                                 $recv: #Field[
                                    $recv: #NameExpr['OpenSSL']
                                    $name: #NameExpr['SSL']
                                 ]
                                 $name: #NameExpr['SSLError']
                              ]
                              $expression: #Field[
                                 $recv: #NameExpr['Errno']
                                 $name: #NameExpr['ECONNRESET']
                              ]
                           ]
                           $body: #Block[
                              $body: #Yield['yield']
                           ]
                        ]
                     ]
                  ]
               ]
            ]
         ]
      ]
   ]
   #Comsumed['comsumed']
]
