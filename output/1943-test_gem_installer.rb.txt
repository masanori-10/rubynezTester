#Source[
   #List[
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['rubygems/installer_test_case']
         ]
      ]
      $statement: #Class[
         $name: #NameExpr['TestGemInstaller']
         $super: #Field[
            $recv: #NameExpr['Gem']
            $name: #NameExpr['InstallerTestCase']
         ]
         $body: #BlockExpr[
            $main: #List[
               $statement: #AssignExpr[
                  $left: #NameExpr['@@symlink_supported']
                  $right: #Nil['nil']
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['symlink_supported?']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $cond: #ApplyExpr[
                              $recv: #NameExpr['@@symlink_supported']
                              $recv: #NameExpr['nil?']
                           ]
                           $then: #ExceptionBlock[
                              $main: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['symlink']
                                 $param: #List[
                                    $expression: #StringExpr['']
                                    $expression: #StringExpr['']
                                 ]
                              ]
                              $rescue: #List[
                                 $rescue: #Rescue[
                                    $class: #MultipleRightHandSideExpression[
                                       $expression: #Field[
                                          $recv: #NameExpr['Errno']
                                          $name: #NameExpr['ENOENT']
                                       ]
                                       $expression: #Field[
                                          $recv: #NameExpr['Errno']
                                          $name: #NameExpr['EEXIST']
                                       ]
                                    ]
                                    $then: #AssignExpr[
                                       $left: #NameExpr['@@symlink_supported']
                                       $right: #TrueExpr['true']
                                    ]
                                 ]
                                 $rescue: #Rescue[
                                    $class: #MultipleRightHandSideExpression[
                                       $expression: #NameExpr['NotImplementedError']
                                       $expression: #NameExpr['SystemCallError']
                                    ]
                                    $then: #AssignExpr[
                                       $left: #NameExpr['@@symlink_supported']
                                       $right: #FalseExpr['false']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #NameExpr['@@symlink_supported']
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['setup']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #Super['super']
                        ]
                        $statement: #NameExpr['common_installer_setup']
                        $statement: #IfExpr[
                           $cond: #AssignExpr[
                              $left: #NameExpr['__name__']
                              $right: #ComplExpr[
                                 $expr: #Regex['/^test_install(_|$)/']
                              ]
                           ]
                           $then: #List[
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['FileUtils']
                                 $recv: #NameExpr['rm_r']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['gem_dir']
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['FileUtils']
                                 $recv: #NameExpr['rm_r']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@user_spec']
                                       $recv: #NameExpr['gem_dir']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@config']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['configuration']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['teardown']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #NameExpr['common_installer_teardown']
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #Super['super']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['Gem']
                              $name: #NameExpr['configuration']
                           ]
                           $right: #NameExpr['@config']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_app_script_text']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_make_exec']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #StringExpr['']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['expected']
                           $right: #HereDocument['#!#{Gem.ruby}\n#\n# This file was generated by RubyGems.\n#\n# The application \'a\' is installed as part of a gem, and\n# this file is here to facilitate running it.\n#\n\nrequire \'rubygems\'\n\nversion = \\">= 0.a\\"\n\nif ARGV.first\n  str = ARGV.first\n  str = str.dup.force_encoding("BINARY") if str.respond_to? :force_encoding\n  if str =~ /\\\\A_(.*)_\\\\z/ and Gem::Version.correct?($1) then\n    version = $1\n    ARGV.shift\n  end\nend\n\nload Gem.activate_bin_path(\'a\', \'executable\', version)\n']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['wrapper']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@installer']
                              $recv: #NameExpr['app_script_text']
                              $param: #List[
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['expected']
                              $expression: #NameExpr['wrapper']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_check_executable_overwrite']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@spec']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Specification']
                              ]
                              $recv: #NameExpr['new']
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['files']
                                       ]
                                       $right: #Array[
                                          $index: #List[
                                             $expression: #StringExpr['lib/code.rb']
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['name']
                                       ]
                                       $right: #StringExpr['a']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['version']
                                       ]
                                       $right: #StringExpr['3']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['summary']
                                       ]
                                       $right: #StringExpr['summary']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['description']
                                       ]
                                       $right: #StringExpr['desc']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['require_path']
                                       ]
                                       $right: #StringExpr['lib']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #NameExpr['util_make_exec']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_gem_dir']
                              $param: #List[
                                 $expression: #NameExpr['@spec']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_inst_bindir']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['installed_exec']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['wrapper']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['read']
                              $param: #List[
                                 $expression: #NameExpr['installed_exec']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #Regex['%r|generated by RubyGems|']
                              $expression: #NameExpr['wrapper']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_check_executable_overwrite_default_bin_dir']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $cond: #Defined[
                              $base: #NameExpr['RUBY_FRAMEWORK_VERSION']
                           ]
                           $then: #List[
                              $statement: #AssignExpr[
                                 $left: #NameExpr['orig_RUBY_FRAMEWORK_VERSION']
                                 $right: #NameExpr['RUBY_FRAMEWORK_VERSION']
                              ]
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['Object']
                                 $recv: #NameExpr['send']
                                 $param: #List[
                                    $expression: #NameExpr['remove_const']
                                    $expression: #NameExpr['RUBY_FRAMEWORK_VERSION']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['orig_bindir']
                           $right: #Indexer[
                              $recv: #Field[
                                 $recv: #NameExpr['RbConfig']
                                 $name: #NameExpr['CONFIG']
                              ]
                              $index: #List[
                                 $expression: #StringExpr['bindir']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #Field[
                                 $recv: #NameExpr['RbConfig']
                                 $name: #NameExpr['CONFIG']
                              ]
                              $index: #List[
                                 $expression: #StringExpr['bindir']
                              ]
                           ]
                           $right: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['bindir']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_conflict_executable']
                           $param: #List[
                              $expression: #FalseExpr['false']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['ui']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['MockGemUi']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #StringExpr['n\\n']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['ui']
                                 $body: #Block[
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['e']
                                          $right: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_raises']
                                             $param: #List[
                                                $expression: #Field[
                                                   $recv: #NameExpr['Gem']
                                                   $name: #NameExpr['InstallError']
                                                ]
                                             ]
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   $recv: #NameExpr['@installer']
                                                   $recv: #NameExpr['generate_bin']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['conflicted']
                                          $right: #ApplyExpr[
                                             $base: #NameExpr['File']
                                             $recv: #NameExpr['join']
                                             $param: #List[
                                                $expression: #NameExpr['@gemhome']
                                                $expression: #StringExpr['bin']
                                                $expression: #StringExpr['executable']
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_match']
                                          $param: #List[
                                             $expression: #Regex['%r%\\A"executable" from a conflicts with (?:#{Regexp.quote(conflicted)}|installed executable from conflict)\\z%']
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['e']
                                                $recv: #NameExpr['message']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                     $ensure: #List[
                        $statement: #IfExpr[
                           $then: #ApplyExpr[
                              $base: #NameExpr['Object']
                              $recv: #NameExpr['const_set']
                              $param: #List[
                                 $expression: #NameExpr['RUBY_FRAMEWORK_VERSION']
                                 $expression: #NameExpr['orig_RUBY_FRAMEWORK_VERSION']
                              ]
                           ]
                           $cond: #NameExpr['orig_RUBY_FRAMEWORK_VERSION']
                        ]
                        $statement: #IfExpr[
                           $cond: #NameExpr['orig_bindir']
                           $then: #AssignExpr[
                              $left: #Indexer[
                                 $base: #Field[
                                    $recv: #NameExpr['RbConfig']
                                    $name: #NameExpr['CONFIG']
                                 ]
                                 $index: #List[
                                    $expression: #StringExpr['bindir']
                                 ]
                              ]
                              $right: #NameExpr['orig_bindir']
                           ]
                           $else: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['RbConfig']
                                 $name: #NameExpr['CONFIG']
                              ]
                              $recv: #NameExpr['delete']
                              $param: #List[
                                 $expression: #StringExpr['bindir']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_check_executable_overwrite_format_executable']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@spec']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Specification']
                              ]
                              $recv: #NameExpr['new']
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['files']
                                       ]
                                       $right: #Array[
                                          $index: #List[
                                             $expression: #StringExpr['lib/code.rb']
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['name']
                                       ]
                                       $right: #StringExpr['a']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['version']
                                       ]
                                       $right: #StringExpr['3']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['summary']
                                       ]
                                       $right: #StringExpr['summary']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['description']
                                       ]
                                       $right: #StringExpr['desc']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['require_path']
                                       ]
                                       $right: #StringExpr['lib']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['open']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['util_inst_bindir']
                                    $expression: #StringExpr['executable']
                                 ]
                              ]
                              $expression: #StringExpr['w']
                           ]
                           $body: #Block[
                              $param: #NameExpr['io']
                              $body: #ApplyExpr[
                                 $base: #NameExpr['io']
                                 $recv: #NameExpr['write']
                                 $param: #List[
                                    $expression: #HereDocument['#!/usr/local/bin/ruby\n#\n# This file was generated by RubyGems\n\ngem \'other\', version\n']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #NameExpr['util_make_exec']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $name: #NameExpr['exec_format']
                           ]
                           $right: #StringExpr['foo-%s-bar']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #ApplyExpr[
                              $recv: #NameExpr['@spec']
                              $recv: #NameExpr['gem_dir']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['format_executable']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_inst_bindir']
                                 $expression: #StringExpr['foo-executable-bar']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['installed_exec']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['wrapper']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['read']
                              $param: #List[
                                 $expression: #NameExpr['installed_exec']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #Regex['%r|generated by RubyGems|']
                              $expression: #NameExpr['wrapper']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_check_executable_overwrite_other_gem']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_conflict_executable']
                           $param: #List[
                              $expression: #TrueExpr['true']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['ui']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['MockGemUi']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #StringExpr['n\\n']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['ui']
                                 $body: #Block[
                                    $body: #List[
                                       $statement: #AssignExpr[
                                          $left: #NameExpr['e']
                                          $right: #ApplyExpr[
                                             #Self['self']
                                             $recv: #NameExpr['assert_raises']
                                             $param: #List[
                                                $expression: #Field[
                                                   $recv: #NameExpr['Gem']
                                                   $name: #NameExpr['InstallError']
                                                ]
                                             ]
                                             $body: #Block[
                                                $body: #ApplyExpr[
                                                   $recv: #NameExpr['@installer']
                                                   $recv: #NameExpr['generate_bin']
                                                ]
                                             ]
                                          ]
                                       ]
                                       $statement: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['assert_equal']
                                          $param: #List[
                                             $expression: #StringExpr['"executable" from a conflicts with installed executable from conflict']
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['e']
                                                $recv: #NameExpr['message']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_check_executable_overwrite_other_gem_force']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_conflict_executable']
                           $param: #List[
                              $expression: #TrueExpr['true']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['force']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_inst_bindir']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['installed_exec']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['wrapper']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['read']
                              $param: #List[
                                 $expression: #NameExpr['installed_exec']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #Regex['%r|generated by RubyGems|']
                              $expression: #NameExpr['wrapper']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #Unless[
                  $then: #FuncDecl[
                     $name: #NameExpr['test_check_executable_overwrite_other_non_gem']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_conflict_executable']
                              $param: #List[
                                 $expression: #FalseExpr['false']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #Field[
                                 $base: #NameExpr['@installer']
                                 $name: #NameExpr['wrappers']
                              ]
                              $right: #TrueExpr['true']
                           ]
                           $statement: #ApplyExpr[
                              $recv: #NameExpr['@installer']
                              $recv: #NameExpr['generate_bin']
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['installed_exec']
                              $right: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['util_inst_bindir']
                                    $expression: #StringExpr['executable']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_path_exists']
                              $param: #List[
                                 $expression: #NameExpr['installed_exec']
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['wrapper']
                              $right: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['read']
                                 $param: #List[
                                    $expression: #NameExpr['installed_exec']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_match']
                              $param: #List[
                                 $expression: #Regex['%r|generated by RubyGems|']
                                 $expression: #NameExpr['wrapper']
                              ]
                           ]
                        ]
                     ]
                  ]
                  $cond: #ApplyExpr[
                     $recv: #NameExpr['Gem']
                     $recv: #NameExpr['win_platform?']
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_check_that_user_bin_dir_is_in_path']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['bin_dir']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['@installer']
                              $recv: #NameExpr['bin_dir']
                           ]
                        ]
                        $statement: #IfExpr[
                           $cond: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['win_platform?']
                           ]
                           $then: #AssignExpr[
                              $left: #NameExpr['bin_dir']
                              $right: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['bin_dir']
                                    $recv: #NameExpr['downcase']
                                 ]
                                 $recv: #NameExpr['gsub']
                                 $param: #List[
                                    $expression: #Field[
                                       $recv: #NameExpr['File']
                                       $name: #NameExpr['SEPARATOR']
                                    ]
                                    $expression: #Field[
                                       $recv: #NameExpr['File']
                                       $name: #NameExpr['ALT_SEPARATOR']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #MultipleAssign[
                           $left: #MultipleLeftHandSideExpression[
                              $item: #NameExpr['orig_PATH']
                              $item: #Indexer[
                                 $base: #NameExpr['ENV']
                                 $index: #List[
                                    $expression: #StringExpr['PATH']
                                 ]
                              ]
                           ]
                           $right: #MultipleRightHandSideExpression[
                              $expression: #Indexer[
                                 $recv: #NameExpr['ENV']
                                 $index: #List[
                                    $expression: #StringExpr['PATH']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #Array[
                                    $index: #List[
                                       $expression: #Indexer[
                                          $recv: #NameExpr['ENV']
                                          $index: #List[
                                             $expression: #StringExpr['PATH']
                                          ]
                                       ]
                                       $expression: #NameExpr['bin_dir']
                                    ]
                                 ]
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #Field[
                                       $recv: #NameExpr['File']
                                       $name: #NameExpr['PATH_SEPARATOR']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['check_that_user_bin_dir_is_in_path']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_empty']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@ui']
                                 $recv: #NameExpr['error']
                              ]
                           ]
                        ]
                     ]
                     $ensure: #AssignExpr[
                        $left: #Indexer[
                           $base: #NameExpr['ENV']
                           $index: #List[
                              $expression: #StringExpr['PATH']
                           ]
                        ]
                        $right: #NameExpr['orig_PATH']
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_check_that_user_bin_dir_is_in_path_tilde']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['skip']
                              $param: #List[
                                 $expression: #StringExpr['Tilde is PATH is not supported under MS Windows']
                              ]
                           ]
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['win_platform?']
                           ]
                        ]
                        $statement: #MultipleAssign[
                           $left: #MultipleLeftHandSideExpression[
                              $item: #NameExpr['orig_PATH']
                              $item: #Indexer[
                                 $base: #NameExpr['ENV']
                                 $index: #List[
                                    $expression: #StringExpr['PATH']
                                 ]
                              ]
                           ]
                           $right: #MultipleRightHandSideExpression[
                              $expression: #Indexer[
                                 $recv: #NameExpr['ENV']
                                 $index: #List[
                                    $expression: #StringExpr['PATH']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #Array[
                                    $index: #List[
                                       $expression: #Indexer[
                                          $recv: #NameExpr['ENV']
                                          $index: #List[
                                             $expression: #StringExpr['PATH']
                                          ]
                                       ]
                                       $expression: #StringExpr['~/bin']
                                    ]
                                 ]
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #Field[
                                       $recv: #NameExpr['File']
                                       $name: #NameExpr['PATH_SEPARATOR']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #ApplyExpr[
                              $recv: #NameExpr['@installer']
                              $recv: #NameExpr['bin_dir']
                           ]
                           $recv: #NameExpr['replace']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@userhome']
                                    $expression: #StringExpr['bin']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['check_that_user_bin_dir_is_in_path']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_empty']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@ui']
                                 $recv: #NameExpr['error']
                              ]
                           ]
                        ]
                     ]
                     $ensure: #Unless[
                        $then: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['ENV']
                              $index: #List[
                                 $expression: #StringExpr['PATH']
                              ]
                           ]
                           $right: #NameExpr['orig_PATH']
                        ]
                        $cond: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['win_platform?']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_check_that_user_bin_dir_is_in_path_not_in_path']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['check_that_user_bin_dir_is_in_path']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['expected']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['@installer']
                              $recv: #NameExpr['bin_dir']
                           ]
                        ]
                        $statement: #IfExpr[
                           $cond: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['win_platform?']
                           ]
                           $then: #AssignExpr[
                              $left: #NameExpr['expected']
                              $right: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['expected']
                                    $recv: #NameExpr['downcase']
                                 ]
                                 $recv: #NameExpr['gsub']
                                 $param: #List[
                                    $expression: #Field[
                                       $recv: #NameExpr['File']
                                       $name: #NameExpr['SEPARATOR']
                                    ]
                                    $expression: #Field[
                                       $recv: #NameExpr['File']
                                       $name: #NameExpr['ALT_SEPARATOR']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #NameExpr['expected']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@ui']
                                 $recv: #NameExpr['error']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_ensure_dependency']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_spec']
                           $param: #List[
                              $expression: #StringExpr['a']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['dep']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Dependency']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #StringExpr['a']
                                 $expression: #StringExpr['>= 2']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['ensure_dependency']
                                 $param: #List[
                                    $expression: #NameExpr['@spec']
                                    $expression: #NameExpr['dep']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['dep']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Dependency']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #StringExpr['b']
                                 $expression: #StringExpr['> 2']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['e']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_raises']
                              $param: #List[
                                 $expression: #Field[
                                    $recv: #NameExpr['Gem']
                                    $name: #NameExpr['InstallError']
                                 ]
                              ]
                              $body: #Block[
                                 $body: #ApplyExpr[
                                    $base: #NameExpr['@installer']
                                    $recv: #NameExpr['ensure_dependency']
                                    $param: #List[
                                       $expression: #NameExpr['@spec']
                                       $expression: #NameExpr['dep']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['a requires b (> 2)']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['message']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_ensure_loadable_spec']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #MultipleAssign[
                           $left: #MultipleLeftHandSideExpression[
                              $item: #NameExpr['a']
                              $item: #NameExpr['a_gem']
                           ]
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_gem']
                              $param: #List[
                                 $expression: #StringExpr['a']
                                 $expression: #IntExpr['2']
                              ]
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #ApplyExpr[
                                    $base: #NameExpr['s']
                                    $recv: #NameExpr['add_dependency']
                                    $param: #List[
                                       $expression: #StringExpr['garbage ~> 5']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installer']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $recv: #NameExpr['at']
                              $param: #List[
                                 $expression: #NameExpr['a_gem']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['e']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_raises']
                              $param: #List[
                                 $expression: #Field[
                                    $recv: #NameExpr['Gem']
                                    $name: #NameExpr['InstallError']
                                 ]
                              ]
                              $body: #Block[
                                 $body: #ApplyExpr[
                                    $recv: #NameExpr['installer']
                                    $recv: #NameExpr['ensure_loadable_spec']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #AddExpr[
                                 $left: #StringExpr[
                                    $inner: #ApplyExpr[
                                       $recv: #NameExpr['a']
                                       $recv: #NameExpr['full_name']
                                    ]
                                 ]
                                 $right: #StringExpr['(SyntaxError)']
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['message']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_ensure_loadable_spec_security_policy']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #Unless[
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['skip']
                              $param: #List[
                                 $expression: #StringExpr['openssl is missing']
                              ]
                           ]
                           $cond: #Defined[
                              $base: #Field[
                                 $recv: #NameExpr['OpenSSL']
                                 $name: #NameExpr['SSL']
                              ]
                           ]
                        ]
                        $statement: #MultipleAssign[
                           $left: #MultipleLeftHandSideExpression[
                              $item: #NameExpr['_']
                              $item: #NameExpr['a_gem']
                           ]
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_gem']
                              $param: #List[
                                 $expression: #StringExpr['a']
                                 $expression: #IntExpr['2']
                              ]
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #ApplyExpr[
                                    $base: #NameExpr['s']
                                    $recv: #NameExpr['add_dependency']
                                    $param: #List[
                                       $expression: #StringExpr['garbage ~> 5']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['policy']
                           $right: #Field[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Security']
                              ]
                              $name: #NameExpr['HighSecurity']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installer']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $recv: #NameExpr['at']
                              $param: #List[
                                 $expression: #NameExpr['a_gem']
                                 $hash: #Hash[
                                    $key: #NameExpr['security_policy']
                                    $value: #NameExpr['policy']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_raises']
                           $param: #List[
                              $expression: #Field[
                                 $recv: #Field[
                                    $recv: #NameExpr['Gem']
                                    $name: #NameExpr['Security']
                                 ]
                                 $name: #NameExpr['Exception']
                              ]
                           ]
                           $body: #Block[
                              $body: #ApplyExpr[
                                 $recv: #NameExpr['installer']
                                 $recv: #NameExpr['ensure_loadable_spec']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_extract_files']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['extract_files']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['util_gem_dir']
                                    $expression: #StringExpr['bin/executable']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_bindir']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@spec']
                              $name: #NameExpr['executables']
                           ]
                           $right: #ParcentNotation['%w[executable]']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@spec']
                              $name: #NameExpr['bindir']
                           ]
                           $right: #StringExpr['.']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['exec_file']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@installer']
                              $recv: #NameExpr['formatted_program_filename']
                              $param: #List[
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['exec_path']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['util_gem_dir']
                                    $param: #List[
                                       $expression: #NameExpr['@spec']
                                    ]
                                 ]
                                 $expression: #NameExpr['exec_file']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['File']
                           $recv: #NameExpr['open']
                           $param: #List[
                              $expression: #NameExpr['exec_path']
                              $expression: #StringExpr['w']
                           ]
                           $body: #Block[
                              $param: #NameExpr['f']
                              $body: #ApplyExpr[
                                 $base: #NameExpr['f']
                                 $recv: #NameExpr['puts']
                                 $param: #List[
                                    $expression: #StringExpr['#!/usr/bin/ruby']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #NameExpr['util_gem_dir']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #TrueExpr['true']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['directory?']
                                 $param: #List[
                                    $expression: #NameExpr['util_inst_bindir']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_inst_bindir']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['installed_exec']
                           ]
                        ]
                        $statement: #Unless[
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #NameExpr['mask']
                                 $expression: #ApplyExpr[
                                    $recv: #ApplyExpr[
                                       $recv: #NameExpr['File']
                                       $recv: #NameExpr['stat']
                                       $param: #List[
                                          $expression: #NameExpr['installed_exec']
                                       ]
                                    ]
                                    $recv: #NameExpr['mode']
                                 ]
                              ]
                           ]
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['win_platform?']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['wrapper']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['read']
                              $param: #List[
                                 $expression: #NameExpr['installed_exec']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #Regex['%r|generated by RubyGems|']
                              $expression: #NameExpr['wrapper']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_bindir_with_user_install_warning']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['bin_dir']
                           $right: #Conditional[
                              $cond: #ApplyExpr[
                                 $recv: #NameExpr['Gem']
                                 $recv: #NameExpr['win_platform?']
                              ]
                              $then: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['File']
                                    $recv: #NameExpr['expand_path']
                                    $param: #List[
                                       $expression: #Indexer[
                                          $recv: #NameExpr['ENV']
                                          $index: #List[
                                             $expression: #StringExpr['WINDIR']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $recv: #NameExpr['upcase']
                              ]
                              $else: #StringExpr['/usr/bin']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['options']
                           $right: #List[
                              $hash: #Hash[
                                 $key: #NameExpr['bin_dir']
                                 $value: #NameExpr['bin_dir']
                              ]
                              $hash: #Hash[
                                 $key: #NameExpr['install_dir']
                                 $value: #StringExpr['/non/existent']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['inst']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $recv: #NameExpr['at']
                              $param: #List[
                                 $expression: #StringExpr['']
                                 $expression: #NameExpr['options']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $name: #NameExpr['path_warning']
                           ]
                           $right: #FalseExpr['false']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #ApplyExpr[
                                 $recv: #NameExpr['inst']
                                 $recv: #NameExpr['check_that_user_bin_dir_is_in_path']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@ui']
                                 $recv: #NameExpr['error']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_script']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #NameExpr['util_make_exec']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #NameExpr['util_gem_dir']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['directory?']
                                 $param: #List[
                                    $expression: #NameExpr['util_inst_bindir']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_inst_bindir']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['installed_exec']
                           ]
                        ]
                        $statement: #Unless[
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #NameExpr['mask']
                                 $expression: #ApplyExpr[
                                    $recv: #ApplyExpr[
                                       $recv: #NameExpr['File']
                                       $recv: #NameExpr['stat']
                                       $param: #List[
                                          $expression: #NameExpr['installed_exec']
                                       ]
                                    ]
                                    $recv: #NameExpr['mode']
                                 ]
                              ]
                           ]
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['win_platform?']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['wrapper']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['read']
                              $param: #List[
                                 $expression: #NameExpr['installed_exec']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #Regex['%r|generated by RubyGems|']
                              $expression: #NameExpr['wrapper']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_script_format']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['format_executable']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #NameExpr['util_make_exec']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #NameExpr['util_gem_dir']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $name: #NameExpr['exec_format']
                           ]
                           $right: #StringExpr['foo-%s-bar']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #TrueExpr['true']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['directory?']
                                 $param: #List[
                                    $expression: #NameExpr['util_inst_bindir']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_inst_bindir']
                                 $expression: #StringExpr['foo-executable-bar']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['installed_exec']
                           ]
                        ]
                     ]
                     $ensure: #AssignExpr[
                        $left: #Field[
                           $base: #Field[
                              $recv: #NameExpr['Gem']
                              $name: #NameExpr['Installer']
                           ]
                           $name: #NameExpr['exec_format']
                        ]
                        $right: #Nil['nil']
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_script_format_disabled']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #NameExpr['util_make_exec']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #NameExpr['util_gem_dir']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $name: #NameExpr['exec_format']
                           ]
                           $right: #StringExpr['foo-%s-bar']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #TrueExpr['true']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['directory?']
                                 $param: #List[
                                    $expression: #NameExpr['util_inst_bindir']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_inst_bindir']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['installed_exec']
                           ]
                        ]
                     ]
                     $ensure: #AssignExpr[
                        $left: #Field[
                           $base: #Field[
                              $recv: #NameExpr['Gem']
                              $name: #NameExpr['Installer']
                           ]
                           $name: #NameExpr['exec_format']
                        ]
                        $right: #Nil['nil']
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_script_install_dir']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gem_dir']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #StringExpr[
                                    $inner: #NameExpr['@gemhome']
                                 ]
                                 $expression: #StringExpr['gems']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['full_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gem_bindir']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['gem_dir']
                                 $expression: #StringExpr['bin']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir_p']
                           $param: #List[
                              $expression: #NameExpr['gem_bindir']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['File']
                           $recv: #NameExpr['open']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['gem_bindir']
                                    $expression: #StringExpr['executable']
                                 ]
                              ]
                              $expression: #StringExpr['w']
                           ]
                           $body: #Block[
                              $param: #NameExpr['f']
                              $body: #ApplyExpr[
                                 $base: #NameExpr['f']
                                 $recv: #NameExpr['puts']
                                 $param: #List[
                                    $expression: #StringExpr['#!/bin/ruby']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_home']
                           ]
                           $right: #StringExpr[
                              $inner: #NameExpr['@gemhome']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #NameExpr['gem_dir']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['bin_dir']
                           ]
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #StringExpr[
                                    $inner: #NameExpr['@gemhome']
                                 ]
                                 $expression: #StringExpr['bin']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #StringExpr[
                                    $inner: #NameExpr['@gemhome']
                                 ]
                                 $expression: #StringExpr['bin']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['installed_exec']
                           ]
                        ]
                        $statement: #Unless[
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #NameExpr['mask']
                                 $expression: #ApplyExpr[
                                    $recv: #ApplyExpr[
                                       $recv: #NameExpr['File']
                                       $recv: #NameExpr['stat']
                                       $param: #List[
                                          $expression: #NameExpr['installed_exec']
                                       ]
                                    ]
                                    $recv: #NameExpr['mode']
                                 ]
                              ]
                           ]
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['win_platform?']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['wrapper']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['read']
                              $param: #List[
                                 $expression: #NameExpr['installed_exec']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #Regex['%r|generated by RubyGems|']
                              $expression: #NameExpr['wrapper']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_script_no_execs']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #NameExpr['util_execless']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $expression: #NameExpr['util_inst_bindir']
                              $expression: #StringExpr['bin dir was created when not needed']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_script_no_perms']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #NameExpr['util_make_exec']
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['mkdir']
                           $param: #List[
                              $expression: #NameExpr['util_inst_bindir']
                           ]
                        ]
                        $statement: #IfExpr[
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['win_platform?']
                           ]
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['skip']
                              $param: #List[
                                 $expression: #StringExpr['test_generate_bin_script_no_perms skipped on MS Windows']
                              ]
                           ]
                           $else: #List[
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['FileUtils']
                                 $recv: #NameExpr['chmod']
                                 $param: #List[
                                    $expression: #OctalInteger['0000']
                                    $expression: #NameExpr['util_inst_bindir']
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_raises']
                                 $param: #List[
                                    $expression: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['FilePermissionError']
                                    ]
                                 ]
                                 $body: #Block[
                                    $body: #ApplyExpr[
                                       $recv: #NameExpr['@installer']
                                       $recv: #NameExpr['generate_bin']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                     $ensure: #Unless[
                        $then: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['chmod']
                           $param: #List[
                              $expression: #OctalInteger['0755']
                              $expression: #NameExpr['util_inst_bindir']
                           ]
                        ]
                        $cond: #OrExpr[
                           $left: #NameExpr['$DEBUG']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['win_platform?']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_script_no_shebang']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@spec']
                              $name: #NameExpr['executables']
                           ]
                           $right: #ParcentNotation['%w[executable]']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gem_dir']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['gems']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['full_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gem_bindir']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['gem_dir']
                                 $expression: #StringExpr['bin']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir_p']
                           $param: #List[
                              $expression: #NameExpr['gem_bindir']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['File']
                           $recv: #NameExpr['open']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['gem_bindir']
                                    $expression: #StringExpr['executable']
                                 ]
                              ]
                              $expression: #StringExpr['w']
                           ]
                           $body: #Block[
                              $param: #NameExpr['f']
                              $body: #ApplyExpr[
                                 $base: #NameExpr['f']
                                 $recv: #NameExpr['puts']
                                 $param: #List[
                                    $expression: #StringExpr['blah blah blah']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['bin']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['installed_exec']
                           ]
                        ]
                        $statement: #Unless[
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #NameExpr['mask']
                                 $expression: #ApplyExpr[
                                    $recv: #ApplyExpr[
                                       $recv: #NameExpr['File']
                                       $recv: #NameExpr['stat']
                                       $param: #List[
                                          $expression: #NameExpr['installed_exec']
                                       ]
                                    ]
                                    $recv: #NameExpr['mode']
                                 ]
                              ]
                           ]
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['win_platform?']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['wrapper']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['read']
                              $param: #List[
                                 $expression: #NameExpr['installed_exec']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #Regex['%r|generated by RubyGems|']
                              $expression: #NameExpr['wrapper']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_script_wrappers']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #NameExpr['util_make_exec']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #NameExpr['util_gem_dir']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_inst_bindir']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['real_exec']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_gem_dir']
                                 $expression: #StringExpr['bin']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #Unless[
                           $cond: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['win_platform?']
                           ]
                           $then: #List[
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['FileUtils']
                                 $recv: #NameExpr['mkdir_p']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['File']
                                       $recv: #NameExpr['dirname']
                                       $param: #List[
                                          $expression: #NameExpr['installed_exec']
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['FileUtils']
                                 $recv: #NameExpr['ln_s']
                                 $param: #List[
                                    $expression: #NameExpr['real_exec']
                                    $expression: #NameExpr['installed_exec']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #TrueExpr['true']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['directory?']
                                 $param: #List[
                                    $expression: #NameExpr['util_inst_bindir']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['installed_exec']
                           ]
                        ]
                        $statement: #Unless[
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #NameExpr['mask']
                                 $expression: #ApplyExpr[
                                    $recv: #ApplyExpr[
                                       $recv: #NameExpr['File']
                                       $recv: #NameExpr['stat']
                                       $param: #List[
                                          $expression: #NameExpr['installed_exec']
                                       ]
                                    ]
                                    $recv: #NameExpr['mode']
                                 ]
                              ]
                           ]
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['win_platform?']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #Regex['%r|generated by RubyGems|']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['read']
                                 $param: #List[
                                    $expression: #NameExpr['installed_exec']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_match']
                           $param: #List[
                              $expression: #Regex['%r|generated by RubyGems|']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['read']
                                 $param: #List[
                                    $expression: #NameExpr['real_exec']
                                 ]
                              ]
                              $expression: #StringExpr['real executable overwritten']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_symlink']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $then: #RReturnStmt['return']
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['win_platform?']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #FalseExpr['false']
                        ]
                        $statement: #NameExpr['util_make_exec']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #NameExpr['util_gem_dir']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #TrueExpr['true']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['directory?']
                                 $param: #List[
                                    $expression: #NameExpr['util_inst_bindir']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_inst_bindir']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #TrueExpr['true']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['symlink?']
                                 $param: #List[
                                    $expression: #NameExpr['installed_exec']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['util_gem_dir']
                                    $expression: #StringExpr['bin']
                                    $expression: #StringExpr['executable']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['readlink']
                                 $param: #List[
                                    $expression: #NameExpr['installed_exec']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_symlink_no_execs']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #NameExpr['util_execless']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #FalseExpr['false']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $expression: #NameExpr['util_inst_bindir']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_symlink_no_perms']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #FalseExpr['false']
                        ]
                        $statement: #NameExpr['util_make_exec']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #NameExpr['util_gem_dir']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['mkdir']
                           $param: #List[
                              $expression: #NameExpr['util_inst_bindir']
                           ]
                        ]
                        $statement: #IfExpr[
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['win_platform?']
                           ]
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['skip']
                              $param: #List[
                                 $expression: #StringExpr['test_generate_bin_symlink_no_perms skipped on MS Windows']
                              ]
                           ]
                           $else: #List[
                              $statement: #ApplyExpr[
                                 $base: #NameExpr['FileUtils']
                                 $recv: #NameExpr['chmod']
                                 $param: #List[
                                    $expression: #OctalInteger['0000']
                                    $expression: #NameExpr['util_inst_bindir']
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_raises']
                                 $param: #List[
                                    $expression: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['FilePermissionError']
                                    ]
                                 ]
                                 $body: #Block[
                                    $body: #ApplyExpr[
                                       $recv: #NameExpr['@installer']
                                       $recv: #NameExpr['generate_bin']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                     $ensure: #Unless[
                        $then: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['chmod']
                           $param: #List[
                              $expression: #OctalInteger['0755']
                              $expression: #NameExpr['util_inst_bindir']
                           ]
                        ]
                        $cond: #OrExpr[
                           $left: #NameExpr['$DEBUG']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['win_platform?']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_symlink_update_newer']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $then: #RReturnStmt['return']
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['win_platform?']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #FalseExpr['false']
                        ]
                        $statement: #NameExpr['util_make_exec']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #NameExpr['util_gem_dir']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_inst_bindir']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['util_gem_dir']
                                    $expression: #StringExpr['bin']
                                    $expression: #StringExpr['executable']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['readlink']
                                 $param: #List[
                                    $expression: #NameExpr['installed_exec']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@spec']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Specification']
                              ]
                              $recv: #NameExpr['new']
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['files']
                                       ]
                                       $right: #Array[
                                          $index: #List[
                                             $expression: #StringExpr['lib/code.rb']
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['name']
                                       ]
                                       $right: #StringExpr['a']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['version']
                                       ]
                                       $right: #StringExpr['3']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['summary']
                                       ]
                                       $right: #StringExpr['summary']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['description']
                                       ]
                                       $right: #StringExpr['desc']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['require_path']
                                       ]
                                       $right: #StringExpr['lib']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #NameExpr['util_make_exec']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_gem_dir']
                              $param: #List[
                                 $expression: #NameExpr['@spec']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_inst_bindir']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@spec']
                                 $recv: #NameExpr['bin_file']
                                 $param: #List[
                                    $expression: #StringExpr['executable']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['readlink']
                                 $param: #List[
                                    $expression: #NameExpr['installed_exec']
                                 ]
                              ]
                              $expression: #StringExpr['Ensure symlink moved to latest version']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_symlink_update_older']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $then: #RReturnStmt['return']
                           $cond: #NotExpr[
                              $expr: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['symlink_supported?']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #FalseExpr['false']
                        ]
                        $statement: #NameExpr['util_make_exec']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #NameExpr['util_gem_dir']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_inst_bindir']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['util_gem_dir']
                                    $expression: #StringExpr['bin']
                                    $expression: #StringExpr['executable']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['readlink']
                                 $param: #List[
                                    $expression: #NameExpr['installed_exec']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Specification']
                              ]
                              $recv: #NameExpr['new']
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['files']
                                       ]
                                       $right: #Array[
                                          $index: #List[
                                             $expression: #StringExpr['lib/code.rb']
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['name']
                                       ]
                                       $right: #StringExpr['a']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['version']
                                       ]
                                       $right: #StringExpr['1']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['summary']
                                       ]
                                       $right: #StringExpr['summary']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['description']
                                       ]
                                       $right: #StringExpr['desc']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['require_path']
                                       ]
                                       $right: #StringExpr['lib']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #NameExpr['util_make_exec']
                        $statement: #AssignExpr[
                           $left: #NameExpr['one']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['@spec']
                              $recv: #NameExpr['dup']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['one']
                              $name: #NameExpr['version']
                           ]
                           $right: #IntExpr['1']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@installer']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $recv: #NameExpr['for_spec']
                              $param: #List[
                                 $expression: #NameExpr['spec']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_gem_dir']
                              $param: #List[
                                 $expression: #NameExpr['one']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_inst_bindir']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['expected']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_gem_dir']
                                 $expression: #StringExpr['bin']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['expected']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['readlink']
                                 $param: #List[
                                    $expression: #NameExpr['installed_exec']
                                 ]
                              ]
                              $expression: #StringExpr['Ensure symlink not moved']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_symlink_update_remove_wrapper']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $then: #RReturnStmt['return']
                           $cond: #NotExpr[
                              $expr: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['symlink_supported?']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #NameExpr['util_make_exec']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #NameExpr['util_gem_dir']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_inst_bindir']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['installed_exec']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@spec']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Specification']
                              ]
                              $recv: #NameExpr['new']
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['files']
                                       ]
                                       $right: #Array[
                                          $index: #List[
                                             $expression: #StringExpr['lib/code.rb']
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['name']
                                       ]
                                       $right: #StringExpr['a']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['version']
                                       ]
                                       $right: #StringExpr['3']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['summary']
                                       ]
                                       $right: #StringExpr['summary']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['description']
                                       ]
                                       $right: #StringExpr['desc']
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #Field[
                                          $base: #NameExpr['s']
                                          $name: #NameExpr['require_path']
                                       ]
                                       $right: #StringExpr['lib']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #NameExpr['util_make_exec']
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_installer']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #NameExpr['@gemhome']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #FalseExpr['false']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #NameExpr['util_gem_dir']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_inst_bindir']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@spec']
                                 $recv: #NameExpr['bin_file']
                                 $param: #List[
                                    $expression: #StringExpr['executable']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['readlink']
                                 $param: #List[
                                    $expression: #NameExpr['installed_exec']
                                 ]
                              ]
                              $expression: #StringExpr['Ensure symlink moved to latest version']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_symlink_win32']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['old_win_platform']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['win_platform?']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['Gem']
                              $name: #NameExpr['win_platform']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['old_alt_separator']
                           $right: #Field[
                              $recv: #NameExpr['File']
                              $name: #NameExpr['ALT_SEPARATOR']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['File']
                           $recv: #NameExpr['__send__']
                           $param: #List[
                              $expression: #NameExpr['remove_const']
                              $expression: #NameExpr['ALT_SEPARATOR']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['File']
                           $recv: #NameExpr['const_set']
                           $param: #List[
                              $expression: #NameExpr['ALT_SEPARATOR']
                              $expression: #StringExpr['\\\\']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #FalseExpr['false']
                        ]
                        $statement: #NameExpr['util_make_exec']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #NameExpr['util_gem_dir']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['generate_bin']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #TrueExpr['true']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['directory?']
                                 $param: #List[
                                    $expression: #NameExpr['util_inst_bindir']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_inst_bindir']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['installed_exec']
                           ]
                        ]
                        $statement: #IfExpr[
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['symlink_supported?']
                           ]
                           $then: #List[
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_send']
                                 $param: #List[
                                    $expression: #Array[
                                       $index: #List[
                                          $expression: #NameExpr['File']
                                          $expression: #NameExpr['symlink?']
                                          $expression: #NameExpr['installed_exec']
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #RReturnStmt['return']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #Regex['/Unable to use symlinks, installing wrapper/i']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@ui']
                                 $recv: #NameExpr['error']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['wrapper']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['read']
                              $param: #List[
                                 $expression: #NameExpr['installed_exec']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #Regex['/generated by RubyGems/']
                              $expression: #NameExpr['wrapper']
                           ]
                        ]
                     ]
                     $ensure: #List[
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['File']
                           $recv: #NameExpr['__send__']
                           $param: #List[
                              $expression: #NameExpr['remove_const']
                              $expression: #NameExpr['ALT_SEPARATOR']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['File']
                           $recv: #NameExpr['const_set']
                           $param: #List[
                              $expression: #NameExpr['ALT_SEPARATOR']
                              $expression: #NameExpr['old_alt_separator']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['Gem']
                              $name: #NameExpr['win_platform']
                           ]
                           $right: #NameExpr['old_win_platform']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_generate_bin_uses_default_shebang']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $then: #RReturnStmt['return']
                           $cond: #NotExpr[
                              $expr: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['symlink_supported?']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #NameExpr['util_make_exec']
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['default_shebang']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['ruby']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['shebang_line']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['open']
                              $param: #List[
                                 $expression: #StringExpr[
                                    $inner: #NameExpr['@gemhome']
                                 ]
                              ]
                              $body: #Block[
                                 $param: #NameExpr['f']
                                 $body: #ApplyExpr[
                                    $recv: #ApplyExpr[
                                       $recv: #NameExpr['f']
                                       $recv: #NameExpr['readlines']
                                    ]
                                    $recv: #NameExpr['first']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #Regex['/\\A#!/']
                              $expression: #NameExpr['shebang_line']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #Regex['/#{default_shebang}/']
                              $expression: #NameExpr['shebang_line']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_initialize']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_spec']
                              $param: #List[
                                 $expression: #StringExpr['a']
                              ]
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['s']
                                       $name: #NameExpr['platform']
                                    ]
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Platform']
                                       ]
                                       $recv: #NameExpr['new']
                                       $param: #List[
                                          $expression: #StringExpr['mswin32']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gem']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@tempdir']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['spec']
                                    $recv: #NameExpr['file_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['mkdir']
                           $param: #List[
                              $expression: #NameExpr['util_inst_bindir']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_build_gem']
                           $param: #List[
                              $expression: #NameExpr['spec']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mv']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['spec']
                                 $recv: #NameExpr['cache_file']
                              ]
                              $expression: #NameExpr['@tempdir']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installer']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $recv: #NameExpr['at']
                              $param: #List[
                                 $expression: #NameExpr['gem']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@gemhome']
                                    $expression: #StringExpr['gems']
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['spec']
                                       $recv: #NameExpr['full_name']
                                    ]
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['installer']
                                 $recv: #NameExpr['gem_dir']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@gemhome']
                                    $expression: #StringExpr['bin']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['installer']
                                 $recv: #NameExpr['bin_dir']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_initialize_user_install']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['installer']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $recv: #NameExpr['at']
                              $param: #List[
                                 $expression: #NameExpr['@gem']
                                 $hash: #Hash[
                                    $key: #NameExpr['user_install']
                                    $value: #TrueExpr['true']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['Gem']
                                       $recv: #NameExpr['user_dir']
                                    ]
                                    $expression: #StringExpr['gems']
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['full_name']
                                    ]
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['installer']
                                 $recv: #NameExpr['gem_dir']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['Gem']
                                 $recv: #NameExpr['bindir']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['Gem']
                                       $recv: #NameExpr['user_dir']
                                    ]
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['installer']
                                 $recv: #NameExpr['bin_dir']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_initialize_user_install_bin_dir']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['installer']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $recv: #NameExpr['at']
                              $param: #List[
                                 $expression: #NameExpr['@gem']
                                 $hash: #Hash[
                                    $key: #NameExpr['user_install']
                                    $value: #TrueExpr['true']
                                 ]
                                 $hash: #Hash[
                                    $key: #NameExpr['bin_dir']
                                    $value: #NameExpr['@tempdir']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['Gem']
                                       $recv: #NameExpr['user_dir']
                                    ]
                                    $expression: #StringExpr['gems']
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['full_name']
                                    ]
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['installer']
                                 $recv: #NameExpr['gem_dir']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['@tempdir']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['installer']
                                 $recv: #NameExpr['bin_dir']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['mkdir']
                           $param: #List[
                              $expression: #NameExpr['util_inst_bindir']
                           ]
                        ]
                        $statement: #NameExpr['util_setup_gem']
                        $statement: #NameExpr['util_clear_gems']
                        $statement: #AssignExpr[
                           $left: #NameExpr['gemdir']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['gems']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['full_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['cache_file']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['cache']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['file_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['stub_exe']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['bin']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['rakefile']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['gemdir']
                                 $expression: #StringExpr['ext']
                                 $expression: #StringExpr['a']
                                 $expression: #StringExpr['Rakefile']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec_file']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['specifications']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['spec_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['Gem']
                           $recv: #NameExpr['pre_install']
                           $body: #Block[
                              $param: #NameExpr['installer']
                              $body: #List[
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['refute_path_exists']
                                    $param: #List[
                                       $expression: #NameExpr['cache_file']
                                       $expression: #StringExpr['cache file must not exist yet']
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['refute_path_exists']
                                    $param: #List[
                                       $expression: #NameExpr['spec_file']
                                       $expression: #StringExpr['spec file must not exist yet']
                                    ]
                                 ]
                                 $statement: #TrueExpr['true']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['Gem']
                           $recv: #NameExpr['post_build']
                           $body: #Block[
                              $param: #NameExpr['installer']
                              $body: #List[
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_path_exists']
                                    $param: #List[
                                       $expression: #NameExpr['gemdir']
                                       $expression: #StringExpr['gem install dir must exist']
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_path_exists']
                                    $param: #List[
                                       $expression: #NameExpr['rakefile']
                                       $expression: #StringExpr['gem executable must exist']
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['refute_path_exists']
                                    $param: #List[
                                       $expression: #NameExpr['stub_exe']
                                       $expression: #StringExpr['gem executable must not exist']
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['refute_path_exists']
                                    $param: #List[
                                       $expression: #NameExpr['spec_file']
                                       $expression: #StringExpr['spec file must not exist yet']
                                    ]
                                 ]
                                 $statement: #TrueExpr['true']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['Gem']
                           $recv: #NameExpr['post_install']
                           $body: #Block[
                              $param: #NameExpr['installer']
                              $body: #List[
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_path_exists']
                                    $param: #List[
                                       $expression: #NameExpr['cache_file']
                                       $expression: #StringExpr['cache file must exist']
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_path_exists']
                                    $param: #List[
                                       $expression: #NameExpr['spec_file']
                                       $expression: #StringExpr['spec file must exist']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@newspec']
                           $right: #Nil['nil']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['build_rake_in']
                           $body: #Block[
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['use_ui']
                                 $param: #List[
                                    $expression: #NameExpr['@ui']
                                 ]
                                 $body: #Block[
                                    $body: #AssignExpr[
                                       $left: #NameExpr['@newspec']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['@installer']
                                          $recv: #NameExpr['install']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #NameExpr['@newspec']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['gemdir']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['stub_exe']
                              $expression: #StringExpr['gem executable must exist']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['exe']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['gemdir']
                                 $expression: #StringExpr['bin']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['exe']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['exe_mode']
                           $right: #AndExpr[
                              $left: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['File']
                                    $recv: #NameExpr['stat']
                                    $param: #List[
                                       $expression: #NameExpr['exe']
                                    ]
                                 ]
                                 $recv: #NameExpr['mode']
                              ]
                              $right: #OctalInteger['0111']
                           ]
                        ]
                        $statement: #Unless[
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #OctalInteger['0111']
                                 $expression: #NameExpr['exe_mode']
                                 $expression: #ModExpr[
                                    $left: #StringExpr['0%o']
                                    $right: #NameExpr['exe_mode']
                                 ]
                              ]
                           ]
                           $cond: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['win_platform?']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['gemdir']
                                    $expression: #StringExpr['lib']
                                    $expression: #StringExpr['code.rb']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['rakefile']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec_file']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['specifications']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['spec_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['spec_file']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@newspec']
                                 $recv: #NameExpr['loaded_from']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['spec_file']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_same']
                           $param: #List[
                              $expression: #NameExpr['@installer']
                              $expression: #NameExpr['@post_build_hook_arg']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_same']
                           $param: #List[
                              $expression: #NameExpr['@installer']
                              $expression: #NameExpr['@post_install_hook_arg']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_same']
                           $param: #List[
                              $expression: #NameExpr['@installer']
                              $expression: #NameExpr['@pre_install_hook_arg']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install_creates_working_binstub']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['mkdir']
                           $param: #List[
                              $expression: #NameExpr['util_inst_bindir']
                           ]
                        ]
                        $statement: #NameExpr['util_setup_gem']
                        $statement: #NameExpr['util_clear_gems']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gemdir']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['gems']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['full_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@newspec']
                           $right: #Nil['nil']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['build_rake_in']
                           $body: #Block[
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['use_ui']
                                 $param: #List[
                                    $expression: #NameExpr['@ui']
                                 ]
                                 $body: #Block[
                                    $body: #AssignExpr[
                                       $left: #NameExpr['@newspec']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['@installer']
                                          $recv: #NameExpr['install']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['exe']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['gemdir']
                                 $expression: #StringExpr['bin']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['e']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_raises']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['RuntimeError']
                                    $body: #Block[
                                       $body: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['instance_eval']
                                          $param: #List[
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['File']
                                                $recv: #NameExpr['read']
                                                $param: #List[
                                                   $expression: #NameExpr['exe']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #Regex['/ran executable/']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['message']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_conflicting_binstubs']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['mkdir']
                           $param: #List[
                              $expression: #NameExpr['util_inst_bindir']
                           ]
                        ]
                        $statement: #NameExpr['util_clear_gems']
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_setup_gem']
                           $body: #Block[
                              $param: #NameExpr['spec']
                              $body: #List[
                                 $statement: #ApplyExpr[
                                    $base: #NameExpr['File']
                                    $recv: #NameExpr['open']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['File']
                                          $recv: #NameExpr['join']
                                          $param: #List[
                                             $expression: #StringExpr['bin']
                                             $expression: #StringExpr['executable']
                                          ]
                                       ]
                                       $expression: #StringExpr['w']
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['f']
                                       $body: #ApplyExpr[
                                          $base: #NameExpr['f']
                                          $recv: #NameExpr['puts']
                                          $param: #List[
                                             $expression: #StringExpr['require \'code\'']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $base: #NameExpr['File']
                                    $recv: #NameExpr['open']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['File']
                                          $recv: #NameExpr['join']
                                          $param: #List[
                                             $expression: #StringExpr['lib']
                                             $expression: #StringExpr['code.rb']
                                          ]
                                       ]
                                       $expression: #StringExpr['w']
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['f']
                                       $body: #ApplyExpr[
                                          $base: #NameExpr['f']
                                          $recv: #NameExpr['puts']
                                          $param: #List[
                                             $expression: #StringExpr['raise "I have an executable"']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['build_rake_in']
                           $body: #Block[
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['use_ui']
                                 $param: #List[
                                    $expression: #NameExpr['@ui']
                                 ]
                                 $body: #Block[
                                    $body: #AssignExpr[
                                       $left: #NameExpr['@newspec']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['@installer']
                                          $recv: #NameExpr['install']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['old_bin_file']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@installer']
                                    $recv: #NameExpr['bin_dir']
                                 ]
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_setup_gem']
                           $body: #Block[
                              $param: #NameExpr['spec']
                              $body: #List[
                                 $statement: #ApplyExpr[
                                    $base: #NameExpr['FileUtils']
                                    $recv: #NameExpr['rm']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['File']
                                          $recv: #NameExpr['join']
                                          $param: #List[
                                             $expression: #StringExpr['bin']
                                             $expression: #StringExpr['executable']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $base: #ApplyExpr[
                                       $recv: #NameExpr['spec']
                                       $recv: #NameExpr['files']
                                    ]
                                    $recv: #NameExpr['delete']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['File']
                                          $recv: #NameExpr['join']
                                          $param: #List[
                                             $expression: #StringExpr['bin']
                                             $expression: #StringExpr['executable']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $base: #ApplyExpr[
                                       $recv: #NameExpr['spec']
                                       $recv: #NameExpr['executables']
                                    ]
                                    $recv: #NameExpr['delete']
                                    $param: #List[
                                       $expression: #StringExpr['executable']
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['spec']
                                       $name: #NameExpr['version']
                                    ]
                                    $right: #ApplyExpr[
                                       $recv: #ApplyExpr[
                                          $recv: #NameExpr['@spec']
                                          $recv: #NameExpr['version']
                                       ]
                                       $recv: #NameExpr['bump']
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $base: #NameExpr['File']
                                    $recv: #NameExpr['open']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['File']
                                          $recv: #NameExpr['join']
                                          $param: #List[
                                             $expression: #StringExpr['lib']
                                             $expression: #StringExpr['code.rb']
                                          ]
                                       ]
                                       $expression: #StringExpr['w']
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['f']
                                       $body: #ApplyExpr[
                                          $base: #NameExpr['f']
                                          $recv: #NameExpr['puts']
                                          $param: #List[
                                             $expression: #StringExpr['raise "I do not have an executable"']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['build_rake_in']
                           $body: #Block[
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['use_ui']
                                 $param: #List[
                                    $expression: #NameExpr['@ui']
                                 ]
                                 $body: #Block[
                                    $body: #AssignExpr[
                                       $left: #NameExpr['@newspec']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['@installer']
                                          $recv: #NameExpr['install']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['e']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_raises']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['RuntimeError']
                                    $body: #Block[
                                       $body: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['instance_eval']
                                          $param: #List[
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['File']
                                                $recv: #NameExpr['read']
                                                $param: #List[
                                                   $expression: #NameExpr['old_bin_file']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #StringExpr['I have an executable']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['message']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install_creates_binstub_that_understand_version']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['mkdir']
                           $param: #List[
                              $expression: #NameExpr['util_inst_bindir']
                           ]
                        ]
                        $statement: #NameExpr['util_setup_gem']
                        $statement: #NameExpr['util_clear_gems']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@newspec']
                           $right: #Nil['nil']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['build_rake_in']
                           $body: #Block[
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['use_ui']
                                 $param: #List[
                                    $expression: #NameExpr['@ui']
                                 ]
                                 $body: #Block[
                                    $body: #AssignExpr[
                                       $left: #NameExpr['@newspec']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['@installer']
                                          $recv: #NameExpr['install']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['exe']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['bin']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['ARGV']
                           $recv: #NameExpr['unshift']
                           $param: #List[
                              $expression: #StringExpr['_3.0_']
                           ]
                        ]
                        $statement: #ExceptionBlock[
                           $main: #List[
                              $statement: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #NameExpr['Gem']
                                    $name: #NameExpr['Specification']
                                 ]
                                 $recv: #NameExpr['reset']
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['e']
                                 $right: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_raises']
                                    $param: #List[
                                       $expression: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['GemNotFoundException']
                                       ]
                                    ]
                                    $body: #Block[
                                       $body: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['instance_eval']
                                          $param: #List[
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['File']
                                                $recv: #NameExpr['read']
                                                $param: #List[
                                                   $expression: #NameExpr['exe']
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $ensure: #IfExpr[
                              $then: #ApplyExpr[
                                 $recv: #NameExpr['ARGV']
                                 $recv: #NameExpr['shift']
                              ]
                              $cond: #EqExpr[
                                 $left: #ApplyExpr[
                                    $recv: #NameExpr['ARGV']
                                    $recv: #NameExpr['first']
                                 ]
                                 $right: #StringExpr['_3.0_']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_includes']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['message']
                              ]
                              $expression: #StringExpr['can\'t find gem a (= 3.0)']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install_creates_binstub_that_dont_trust_encoding']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #Unless[
                           $then: #NameExpr['skip']
                           $cond: #ApplyExpr[
                              $recv: #StringExpr['']
                              $recv: #NameExpr['respond_to?']
                              $param: #List[
                                 $expression: #NameExpr['force_encoding']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['mkdir']
                           $param: #List[
                              $expression: #NameExpr['util_inst_bindir']
                           ]
                        ]
                        $statement: #NameExpr['util_setup_gem']
                        $statement: #NameExpr['util_clear_gems']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@newspec']
                           $right: #Nil['nil']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['build_rake_in']
                           $body: #Block[
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['use_ui']
                                 $param: #List[
                                    $expression: #NameExpr['@ui']
                                 ]
                                 $body: #Block[
                                    $body: #AssignExpr[
                                       $left: #NameExpr['@newspec']
                                       $right: #ApplyExpr[
                                          $recv: #NameExpr['@installer']
                                          $recv: #NameExpr['install']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['exe']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['bin']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['extra_arg']
                           $right: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #StringExpr['\\xE4pfel']
                                 $recv: #NameExpr['dup']
                              ]
                              $recv: #NameExpr['force_encoding']
                              $param: #List[
                                 $expression: #StringExpr['UTF-8']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['ARGV']
                           $recv: #NameExpr['unshift']
                           $param: #List[
                              $expression: #NameExpr['extra_arg']
                           ]
                        ]
                        $statement: #ExceptionBlock[
                           $main: #List[
                              $statement: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #NameExpr['Gem']
                                    $name: #NameExpr['Specification']
                                 ]
                                 $recv: #NameExpr['reset']
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['e']
                                 $right: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_raises']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['RuntimeError']
                                          $body: #Block[
                                             $body: #ApplyExpr[
                                                #Self['self']
                                                $recv: #NameExpr['instance_eval']
                                                $param: #List[
                                                   $expression: #ApplyExpr[
                                                      $recv: #NameExpr['File']
                                                      $recv: #NameExpr['read']
                                                      $param: #List[
                                                         $expression: #NameExpr['exe']
                                                      ]
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $ensure: #IfExpr[
                              $then: #ApplyExpr[
                                 $recv: #NameExpr['ARGV']
                                 $recv: #NameExpr['shift']
                              ]
                              $cond: #EqExpr[
                                 $left: #ApplyExpr[
                                    $recv: #NameExpr['ARGV']
                                    $recv: #NameExpr['first']
                                 ]
                                 $right: #NameExpr['extra_arg']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #Regex['/ran executable/']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['e']
                                 $recv: #NameExpr['message']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install_with_no_prior_files']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['mkdir']
                           $param: #List[
                              $expression: #NameExpr['util_inst_bindir']
                           ]
                        ]
                        $statement: #NameExpr['util_clear_gems']
                        $statement: #NameExpr['util_setup_gem']
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['build_rake_in']
                           $body: #Block[
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['use_ui']
                                 $param: #List[
                                    $expression: #NameExpr['@ui']
                                 ]
                                 $body: #Block[
                                    $body: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_equal']
                                       $param: #List[
                                          $expression: #NameExpr['@spec']
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['@installer']
                                             $recv: #NameExpr['install']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gemdir']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['gems']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['full_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['gemdir']
                                    $expression: #StringExpr['lib']
                                    $expression: #StringExpr['code.rb']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #NameExpr['util_setup_gem']
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@spec']
                              $name: #NameExpr['files']
                           ]
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #StringExpr['lib']
                                 $expression: #StringExpr['other.rb']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['Dir']
                           $recv: #NameExpr['chdir']
                           $param: #List[
                              $expression: #NameExpr['@tempdir']
                           ]
                           $body: #Block[
                              $body: #List[
                                 $statement: #ApplyExpr[
                                    $base: #NameExpr['File']
                                    $recv: #NameExpr['open']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['File']
                                          $recv: #NameExpr['join']
                                          $param: #List[
                                             $expression: #StringExpr['lib']
                                             $expression: #StringExpr['other.rb']
                                          ]
                                       ]
                                       $expression: #StringExpr['w']
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['f']
                                       $body: #ApplyExpr[
                                          $base: #NameExpr['f']
                                          $recv: #NameExpr['puts']
                                          $param: #List[
                                             $expression: #StringExpr['1']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['use_ui']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          #Self['self']
                                          $recv: #NameExpr['ui']
                                          $body: #Block[
                                             $body: #List[
                                                $statement: #ApplyExpr[
                                                   $base: #NameExpr['FileUtils']
                                                   $recv: #NameExpr['rm']
                                                   $param: #List[
                                                      $expression: #NameExpr['@gem']
                                                   ]
                                                ]
                                                $statement: #ApplyExpr[
                                                   $base: #Field[
                                                      $recv: #NameExpr['Gem']
                                                      $name: #NameExpr['Package']
                                                   ]
                                                   $recv: #NameExpr['build']
                                                   $param: #List[
                                                      $expression: #NameExpr['@spec']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@installer']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $recv: #NameExpr['at']
                              $param: #List[
                                 $expression: #NameExpr['@gem']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['build_rake_in']
                           $body: #Block[
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['use_ui']
                                 $param: #List[
                                    $expression: #NameExpr['@ui']
                                 ]
                                 $body: #Block[
                                    $body: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_equal']
                                       $param: #List[
                                          $expression: #NameExpr['@spec']
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['@installer']
                                             $recv: #NameExpr['install']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['gemdir']
                                    $expression: #StringExpr['lib']
                                    $expression: #StringExpr['other.rb']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['gemdir']
                                    $expression: #StringExpr['lib']
                                    $expression: #StringExpr['code.rb']
                                    $expression: #StringExpr['code.rb from prior install of same gem shouldn\'t remain here']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install_force']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['installer']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Installer']
                                       ]
                                       $recv: #NameExpr['at']
                                       $param: #List[
                                          $expression: #NameExpr['old_ruby_required']
                                          $hash: #Hash[
                                             $key: #NameExpr['force']
                                             $value: #TrueExpr['true']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['installer']
                                    $recv: #NameExpr['install']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gem_dir']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['gems']
                                 $expression: #StringExpr['old_ruby_required-1']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['gem_dir']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install_missing_dirs']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['rm_f']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['Gem']
                                       $recv: #NameExpr['dir']
                                    ]
                                    $expression: #StringExpr['cache']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['rm_f']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['Gem']
                                       $recv: #NameExpr['dir']
                                    ]
                                    $expression: #StringExpr['docs']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['rm_f']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['Gem']
                                       $recv: #NameExpr['dir']
                                    ]
                                    $expression: #StringExpr['specifications']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['install']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['File']
                           $recv: #NameExpr['directory?']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['Gem']
                                       $recv: #NameExpr['dir']
                                    ]
                                    $expression: #StringExpr['cache']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['File']
                           $recv: #NameExpr['directory?']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['Gem']
                                       $recv: #NameExpr['dir']
                                    ]
                                    $expression: #StringExpr['docs']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['File']
                           $recv: #NameExpr['directory?']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['Gem']
                                       $recv: #NameExpr['dir']
                                    ]
                                    $expression: #StringExpr['specifications']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@gemhome']
                                    $expression: #StringExpr['cache']
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['file_name']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@gemhome']
                                    $expression: #StringExpr['specifications']
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['spec_name']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install_post_build_false']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #NameExpr['util_clear_gems']
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['Gem']
                           $recv: #NameExpr['post_build']
                           $body: #Block[
                              $body: #FalseExpr['false']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['e']
                                    $right: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_raises']
                                       $param: #List[
                                          $expression: #Field[
                                             $recv: #NameExpr['Gem']
                                             $name: #NameExpr['InstallError']
                                          ]
                                       ]
                                       $body: #Block[
                                          $body: #ApplyExpr[
                                             $recv: #NameExpr['@installer']
                                             $recv: #NameExpr['install']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['location']
                                    $right: #StringExpr[
                                       $inner: #File['__FILE__']
                                       $inner: #SubExpr[
                                          $left: #Line['__LINE__']
                                          $right: #IntExpr['9']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_equal']
                                    $param: #List[
                                       $expression: #StringExpr[
                                          $inner: #NameExpr['location']
                                       ]
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['e']
                                          $recv: #NameExpr['message']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec_file']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['specifications']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['spec_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $expression: #NameExpr['spec_file']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gem_dir']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['gems']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['full_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $expression: #NameExpr['gem_dir']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install_post_build_nil']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #NameExpr['util_clear_gems']
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['Gem']
                           $recv: #NameExpr['post_build']
                           $body: #Block[
                              $body: #Nil['nil']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['install']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec_file']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['specifications']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['spec_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['spec_file']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gem_dir']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['gems']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['full_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['gem_dir']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install_pre_install_false']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #NameExpr['util_clear_gems']
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['Gem']
                           $recv: #NameExpr['pre_install']
                           $body: #Block[
                              $body: #FalseExpr['false']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['e']
                                    $right: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_raises']
                                       $param: #List[
                                          $expression: #Field[
                                             $recv: #NameExpr['Gem']
                                             $name: #NameExpr['InstallError']
                                          ]
                                       ]
                                       $body: #Block[
                                          $body: #ApplyExpr[
                                             $recv: #NameExpr['@installer']
                                             $recv: #NameExpr['install']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['location']
                                    $right: #StringExpr[
                                       $inner: #File['__FILE__']
                                       $inner: #SubExpr[
                                          $left: #Line['__LINE__']
                                          $right: #IntExpr['9']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_equal']
                                    $param: #List[
                                       $expression: #StringExpr[
                                          $inner: #NameExpr['location']
                                       ]
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['e']
                                          $recv: #NameExpr['message']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec_file']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['specifications']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['spec_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $expression: #NameExpr['spec_file']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install_pre_install_nil']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #NameExpr['util_clear_gems']
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['Gem']
                           $recv: #NameExpr['pre_install']
                           $body: #Block[
                              $body: #Nil['nil']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['install']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec_file']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['specifications']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['spec_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['spec_file']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install_with_message']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@spec']
                              $name: #NameExpr['post_install_message']
                           ]
                           $right: #StringExpr['I am a shiny gem!']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['path']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Package']
                                       ]
                                       $recv: #NameExpr['build']
                                       $param: #List[
                                          $expression: #NameExpr['@spec']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@installer']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Installer']
                                       ]
                                       $recv: #NameExpr['at']
                                       $param: #List[
                                          $expression: #NameExpr['path']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['@installer']
                                    $recv: #NameExpr['install']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_match']
                           $param: #List[
                              $expression: #Regex['%r|I am a shiny gem!|']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@ui']
                                 $recv: #NameExpr['output']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install_with_skipped_message']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@spec']
                              $name: #NameExpr['post_install_message']
                           ]
                           $right: #StringExpr['I am a shiny gem!']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['path']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Package']
                                       ]
                                       $recv: #NameExpr['build']
                                       $param: #List[
                                          $expression: #NameExpr['@spec']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@installer']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Installer']
                                       ]
                                       $recv: #NameExpr['at']
                                       $param: #List[
                                          $expression: #NameExpr['path']
                                          $hash: #Hash[
                                             $key: #NameExpr['post_install_message']
                                             $value: #FalseExpr['false']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['@installer']
                                    $recv: #NameExpr['install']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_match']
                           $param: #List[
                              $expression: #Regex['%r|I am a shiny gem!|']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@ui']
                                 $recv: #NameExpr['output']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install_extension_dir']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['gemhome2']
                           $right: #StringExpr[
                              $inner: #NameExpr['@gemhome']
                           ]
                        ]
                        $statement: #LShiftExpr[
                           $left: #ApplyExpr[
                              $recv: #NameExpr['@spec']
                              $recv: #NameExpr['extensions']
                           ]
                           $right: #StringExpr['extconf.rb']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['write_file']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@tempdir']
                                    $expression: #StringExpr['extconf.rb']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['io']
                                    $body: #ApplyExpr[
                                       $base: #NameExpr['io']
                                       $recv: #NameExpr['write']
                                       $param: #List[
                                          $expression: #HereDocument['        require "mkmf"\n        create_makefile("#{@spec.name}")\n']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AddAssign[
                           $left: #Field[
                              $base: #NameExpr['@spec']
                              $name: #NameExpr['files']
                           ]
                           $right: #ParcentNotation['%w[extconf.rb]']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['path']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Package']
                                       ]
                                       $recv: #NameExpr['build']
                                       $param: #List[
                                          $expression: #NameExpr['@spec']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['installer']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Installer']
                                       ]
                                       $recv: #NameExpr['at']
                                       $param: #List[
                                          $expression: #NameExpr['path']
                                          $hash: #Hash[
                                             $key: #NameExpr['install_dir']
                                             $value: #NameExpr['gemhome2']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['installer']
                                    $recv: #NameExpr['install']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['expected_makefile']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['gemhome2']
                                 $expression: #StringExpr['gems']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['full_name']
                                 ]
                                 $expression: #StringExpr['Makefile']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['expected_makefile']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install_extension_dir_is_removed_on_reinstall']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #LShiftExpr[
                           $left: #ApplyExpr[
                              $recv: #NameExpr['@spec']
                              $recv: #NameExpr['extensions']
                           ]
                           $right: #StringExpr['extconf.rb']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['write_file']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@tempdir']
                                    $expression: #StringExpr['extconf.rb']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['io']
                                    $body: #ApplyExpr[
                                       $base: #NameExpr['io']
                                       $recv: #NameExpr['write']
                                       $param: #List[
                                          $expression: #HereDocument['        require "mkmf"\n        create_makefile("#{@spec.name}")\n']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AddAssign[
                           $left: #Field[
                              $base: #NameExpr['@spec']
                              $name: #NameExpr['files']
                           ]
                           $right: #ParcentNotation['%w[extconf.rb]']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['path']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Package']
                              ]
                              $recv: #NameExpr['build']
                              $param: #List[
                                 $expression: #NameExpr['@spec']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['installer']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Installer']
                                       ]
                                       $recv: #NameExpr['at']
                                       $param: #List[
                                          $expression: #NameExpr['path']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['installer']
                                    $recv: #NameExpr['install']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['should_be_removed']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['extension_dir']
                                 ]
                                 $expression: #StringExpr[
                                    $inner: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['name']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['write_file']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['should_be_removed']
                                 $body: #Block[
                                    $param: #NameExpr['io']
                                    $body: #ApplyExpr[
                                       $base: #NameExpr['io']
                                       $recv: #NameExpr['write']
                                       $param: #List[
                                          $expression: #StringExpr['DELETE ME ON REINSTALL']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['should_be_removed']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['installer']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Installer']
                                       ]
                                       $recv: #NameExpr['at']
                                       $param: #List[
                                          $expression: #NameExpr['path']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['installer']
                                    $recv: #NameExpr['install']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $expression: #NameExpr['should_be_removed']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install_user_extension_dir']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #LShiftExpr[
                           $left: #ApplyExpr[
                              $recv: #NameExpr['@spec']
                              $recv: #NameExpr['extensions']
                           ]
                           $right: #StringExpr['extconf.rb']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['write_file']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@tempdir']
                                    $expression: #StringExpr['extconf.rb']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['io']
                                    $body: #ApplyExpr[
                                       $base: #NameExpr['io']
                                       $recv: #NameExpr['write']
                                       $param: #List[
                                          $expression: #HereDocument['        require "mkmf"\n        create_makefile("#{@spec.name}")\n']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AddAssign[
                           $left: #Field[
                              $base: #NameExpr['@spec']
                              $name: #NameExpr['files']
                           ]
                           $right: #ParcentNotation['%w[extconf.rb]']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['expected_extension_dir']
                           $right: #ApplyExpr[
                              $recv: #ApplyExpr[
                                 $recv: #NameExpr['@spec']
                                 $recv: #NameExpr['extension_dir']
                              ]
                              $recv: #NameExpr['dup']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir_p']
                           $param: #List[
                              $expression: #NameExpr['expected_extension_dir']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['path']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Package']
                                       ]
                                       $recv: #NameExpr['build']
                                       $param: #List[
                                          $expression: #NameExpr['@spec']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['installer']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Installer']
                                       ]
                                       $recv: #NameExpr['at']
                                       $param: #List[
                                          $expression: #NameExpr['path']
                                          $hash: #Hash[
                                             $key: #NameExpr['user_install']
                                             $value: #TrueExpr['true']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['installer']
                                    $recv: #NameExpr['install']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['expected_makefile']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['user_dir']
                                 ]
                                 $expression: #StringExpr['gems']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['full_name']
                                 ]
                                 $expression: #StringExpr['Makefile']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['expected_makefile']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['expected_extension_dir']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['expected_extension_dir']
                                    $expression: #StringExpr['gem_make.out']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #IfExpr[
                  $cond: #LtExpr[
                     $left: #NameExpr['RUBY_VERSION']
                     $right: #StringExpr['1.9.3']
                  ]
                  $then: #FuncDecl[
                     $name: #NameExpr['test_find_lib_file_after_install']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #LShiftExpr[
                              $left: #ApplyExpr[
                                 $recv: #NameExpr['@spec']
                                 $recv: #NameExpr['extensions']
                              ]
                              $right: #StringExpr['extconf.rb']
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['write_file']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['File']
                                    $recv: #NameExpr['join']
                                    $param: #List[
                                       $expression: #NameExpr['@tempdir']
                                       $expression: #StringExpr['extconf.rb']
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['io']
                                       $body: #ApplyExpr[
                                          $base: #NameExpr['io']
                                          $recv: #NameExpr['write']
                                          $param: #List[
                                             $expression: #HereDocument['          require "mkmf"\n          create_makefile("#{@spec.name}")\n']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['write_file']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['File']
                                    $recv: #NameExpr['join']
                                    $param: #List[
                                       $expression: #NameExpr['@tempdir']
                                       $expression: #StringExpr['a.c']
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['io']
                                       $body: #ApplyExpr[
                                          $base: #NameExpr['io']
                                          $recv: #NameExpr['write']
                                          $param: #List[
                                             $expression: #HereDocument['          #include <ruby.h>\n          void Init_a() { }\n']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              $base: #NameExpr['Dir']
                              $recv: #NameExpr['mkdir']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['File']
                                    $recv: #NameExpr['join']
                                    $param: #List[
                                       $expression: #NameExpr['@tempdir']
                                       $expression: #StringExpr['lib']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['write_file']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['File']
                                    $recv: #NameExpr['join']
                                    $param: #List[
                                       $expression: #NameExpr['@tempdir']
                                       $expression: #StringExpr['lib']
                                       $expression: #StringExpr['b.rb']
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['io']
                                       $body: #ApplyExpr[
                                          $base: #NameExpr['io']
                                          $recv: #NameExpr['write']
                                          $param: #List[
                                             $expression: #StringExpr['# b.rb']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #AddAssign[
                              $left: #Field[
                                 $base: #NameExpr['@spec']
                                 $name: #NameExpr['files']
                              ]
                              $right: #ParcentNotation['%w[extconf.rb lib/b.rb a.c]']
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['use_ui']
                              $param: #List[
                                 $expression: #NameExpr['@ui']
                              ]
                              $body: #Block[
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['path']
                                       $right: #ApplyExpr[
                                          $base: #Field[
                                             $recv: #NameExpr['Gem']
                                             $name: #NameExpr['Package']
                                          ]
                                          $recv: #NameExpr['build']
                                          $param: #List[
                                             $expression: #NameExpr['@spec']
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['installer']
                                       $right: #ApplyExpr[
                                          $base: #Field[
                                             $recv: #NameExpr['Gem']
                                             $name: #NameExpr['Installer']
                                          ]
                                          $recv: #NameExpr['at']
                                          $param: #List[
                                             $expression: #NameExpr['path']
                                          ]
                                       ]
                                    ]
                                    $statement: #ApplyExpr[
                                       $recv: #NameExpr['installer']
                                       $recv: #NameExpr['install']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['expected']
                              $right: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #ApplyExpr[
                                          $recv: #NameExpr['@spec']
                                          $recv: #NameExpr['full_require_paths']
                                       ]
                                       $recv: #NameExpr['find']
                                       $body: #Block[
                                          $param: #NameExpr['path']
                                          $body: #ApplyExpr[
                                             $base: #NameExpr['File']
                                             $recv: #NameExpr['exist?']
                                             $param: #List[
                                                $command: #ApplyExpr[
                                                   $base: #NameExpr['File']
                                                   $recv: #NameExpr['join']
                                                   $param: #List[
                                                      $expression: #NameExpr['path']
                                                      $expression: #StringExpr['b.rb']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                    $expression: #StringExpr['b.rb']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #NameExpr['expected']
                                 $expression: #ApplyExpr[
                                    $recv: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['matches_for_glob']
                                       $param: #List[
                                          $expression: #StringExpr['b.rb']
                                       ]
                                    ]
                                    $recv: #NameExpr['first']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
                  $else: #FuncDecl[
                     $name: #NameExpr['test_find_lib_file_after_install']
                     $param: #List['']
                     $body: #BlockExpr[
                        $main: #List[
                           $statement: #LShiftExpr[
                              $left: #ApplyExpr[
                                 $recv: #NameExpr['@spec']
                                 $recv: #NameExpr['extensions']
                              ]
                              $right: #StringExpr['extconf.rb']
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['write_file']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['File']
                                    $recv: #NameExpr['join']
                                    $param: #List[
                                       $expression: #NameExpr['@tempdir']
                                       $expression: #StringExpr['extconf.rb']
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['io']
                                       $body: #ApplyExpr[
                                          $base: #NameExpr['io']
                                          $recv: #NameExpr['write']
                                          $param: #List[
                                             $expression: #HereDocument['          require "mkmf"\n\n          CONFIG[\'CC\'] = \'$(TOUCH) $@ ||\'\n          CONFIG[\'LDSHARED\'] = \'$(TOUCH) $@ ||\'\n          $ruby = \'#{Gem.ruby}\'\n\n          create_makefile("#{@spec.name}")\n']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['write_file']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['File']
                                    $recv: #NameExpr['join']
                                    $param: #List[
                                       $expression: #NameExpr['@tempdir']
                                       $expression: #StringExpr['depend']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['write_file']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['File']
                                    $recv: #NameExpr['join']
                                    $param: #List[
                                       $expression: #NameExpr['@tempdir']
                                       $expression: #StringExpr['a.c']
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['io']
                                       $body: #ApplyExpr[
                                          $base: #NameExpr['io']
                                          $recv: #NameExpr['write']
                                          $param: #List[
                                             $expression: #HereDocument['          #include <ruby.h>\n          void Init_a() { }\n']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              $base: #NameExpr['Dir']
                              $recv: #NameExpr['mkdir']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['File']
                                    $recv: #NameExpr['join']
                                    $param: #List[
                                       $expression: #NameExpr['@tempdir']
                                       $expression: #StringExpr['lib']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['write_file']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['File']
                                    $recv: #NameExpr['join']
                                    $param: #List[
                                       $expression: #NameExpr['@tempdir']
                                       $expression: #StringExpr['lib']
                                       $expression: #StringExpr['b.rb']
                                    ]
                                    $body: #Block[
                                       $param: #NameExpr['io']
                                       $body: #ApplyExpr[
                                          $base: #NameExpr['io']
                                          $recv: #NameExpr['write']
                                          $param: #List[
                                             $expression: #StringExpr['# b.rb']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #AddAssign[
                              $left: #Field[
                                 $base: #NameExpr['@spec']
                                 $name: #NameExpr['files']
                              ]
                              $right: #ParcentNotation['%w[extconf.rb lib/b.rb depend a.c]']
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['use_ui']
                              $param: #List[
                                 $expression: #NameExpr['@ui']
                              ]
                              $body: #Block[
                                 $body: #List[
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['path']
                                       $right: #ApplyExpr[
                                          $base: #Field[
                                             $recv: #NameExpr['Gem']
                                             $name: #NameExpr['Package']
                                          ]
                                          $recv: #NameExpr['build']
                                          $param: #List[
                                             $expression: #NameExpr['@spec']
                                          ]
                                       ]
                                    ]
                                    $statement: #AssignExpr[
                                       $left: #NameExpr['installer']
                                       $right: #ApplyExpr[
                                          $base: #Field[
                                             $recv: #NameExpr['Gem']
                                             $name: #NameExpr['Installer']
                                          ]
                                          $recv: #NameExpr['at']
                                          $param: #List[
                                             $expression: #NameExpr['path']
                                          ]
                                       ]
                                    ]
                                    $statement: #ApplyExpr[
                                       $recv: #NameExpr['installer']
                                       $recv: #NameExpr['install']
                                    ]
                                 ]
                              ]
                           ]
                           $statement: #AssignExpr[
                              $left: #NameExpr['expected']
                              $right: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #ApplyExpr[
                                          $recv: #NameExpr['@spec']
                                          $recv: #NameExpr['full_require_paths']
                                       ]
                                       $recv: #NameExpr['find']
                                       $body: #Block[
                                          $param: #NameExpr['path']
                                          $body: #ApplyExpr[
                                             $base: #NameExpr['File']
                                             $recv: #NameExpr['exist?']
                                             $param: #List[
                                                $command: #ApplyExpr[
                                                   $base: #NameExpr['File']
                                                   $recv: #NameExpr['join']
                                                   $param: #List[
                                                      $expression: #NameExpr['path']
                                                      $expression: #StringExpr['b.rb']
                                                   ]
                                                ]
                                             ]
                                          ]
                                       ]
                                    ]
                                    $expression: #StringExpr['b.rb']
                                 ]
                              ]
                           ]
                           $statement: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['assert_equal']
                              $param: #List[
                                 $expression: #NameExpr['expected']
                                 $expression: #ApplyExpr[
                                    $recv: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['matches_for_glob']
                                       $param: #List[
                                          $expression: #StringExpr['b.rb']
                                       ]
                                    ]
                                    $recv: #NameExpr['first']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install_extension_and_script']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #LShiftExpr[
                           $left: #ApplyExpr[
                              $recv: #NameExpr['@spec']
                              $recv: #NameExpr['extensions']
                           ]
                           $right: #StringExpr['extconf.rb']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['write_file']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@tempdir']
                                    $expression: #StringExpr['extconf.rb']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['io']
                                    $body: #ApplyExpr[
                                       $base: #NameExpr['io']
                                       $recv: #NameExpr['write']
                                       $param: #List[
                                          $expression: #HereDocument['        require "mkmf"\n        create_makefile("#{@spec.name}")\n']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['rb']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #StringExpr['lib']
                                 $expression: #StringExpr[
                                    $inner: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['name']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AddAssign[
                           $left: #Field[
                              $base: #NameExpr['@spec']
                              $name: #NameExpr['files']
                           ]
                           $right: #Array[
                              $index: #List[
                                 $expression: #NameExpr['rb']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['write_file']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@tempdir']
                                    $expression: #NameExpr['rb']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['io']
                                    $body: #ApplyExpr[
                                       $base: #NameExpr['io']
                                       $recv: #NameExpr['write']
                                       $param: #List[
                                          $expression: #HereDocument['        # #{@spec.name}.rb\n']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['Dir']
                           $recv: #NameExpr['mkdir']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #StringExpr['lib']
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['name']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['rb2']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #StringExpr['lib']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['name']
                                 ]
                                 $expression: #StringExpr[
                                    $inner: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['name']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #LShiftExpr[
                           $left: #ApplyExpr[
                              $recv: #NameExpr['@spec']
                              $recv: #NameExpr['files']
                           ]
                           $right: #NameExpr['rb2']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['write_file']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@tempdir']
                                    $expression: #NameExpr['rb2']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['io']
                                    $body: #ApplyExpr[
                                       $base: #NameExpr['io']
                                       $recv: #NameExpr['write']
                                       $param: #List[
                                          $expression: #HereDocument['        # #{@spec.name}/#{@spec.name}.rb\n']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['gem_dir']
                                    ]
                                    $expression: #NameExpr['rb']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['gem_dir']
                                    ]
                                    $expression: #NameExpr['rb2']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['path']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Package']
                                       ]
                                       $recv: #NameExpr['build']
                                       $param: #List[
                                          $expression: #NameExpr['@spec']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@installer']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Installer']
                                       ]
                                       $recv: #NameExpr['at']
                                       $param: #List[
                                          $expression: #NameExpr['path']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['@installer']
                                    $recv: #NameExpr['install']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['gem_dir']
                                    ]
                                    $expression: #NameExpr['rb']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['gem_dir']
                                    ]
                                    $expression: #NameExpr['rb2']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_install_extension_flat']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #IfExpr[
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['skip']
                              $param: #List[
                                 $expression: #StringExpr['1.9.2 and earlier mkmf.rb does not create TOUCH']
                              ]
                           ]
                           $cond: #LtExpr[
                              $left: #NameExpr['RUBY_VERSION']
                              $right: #StringExpr['1.9.3']
                           ]
                        ]
                        $statement: #IfExpr[
                           $cond: #AndExpr[
                              $left: #EqExpr[
                                 $left: #NameExpr['RUBY_VERSION']
                                 $right: #StringExpr['1.9.3']
                              ]
                              $right: #LteExpr[
                                 $left: #NameExpr['RUBY_PATCHLEVEL']
                                 $right: #IntExpr['194']
                              ]
                           ]
                           $then: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['skip']
                              $param: #List[
                                 $expression: #StringExpr['TOUCH was introduced into 1.9.3 after p194']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@spec']
                              $name: #NameExpr['require_paths']
                           ]
                           $right: #Array[
                              $index: #List[
                                 $expression: #StringExpr['.']
                              ]
                           ]
                        ]
                        $statement: #LShiftExpr[
                           $left: #ApplyExpr[
                              $recv: #NameExpr['@spec']
                              $recv: #NameExpr['extensions']
                           ]
                           $right: #StringExpr['extconf.rb']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['write_file']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@tempdir']
                                    $expression: #StringExpr['extconf.rb']
                                 ]
                                 $body: #Block[
                                    $param: #NameExpr['io']
                                    $body: #ApplyExpr[
                                       $base: #NameExpr['io']
                                       $recv: #NameExpr['write']
                                       $param: #List[
                                          $expression: #HereDocument['        require "mkmf"\n\n        CONFIG[\'CC\'] = \'$(TOUCH) $@ ||\'\n        CONFIG[\'LDSHARED\'] = \'$(TOUCH) $@ ||\'\n        $ruby = \'#{Gem.ruby}\'\n\n        create_makefile("#{@spec.name}")\n']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AddAssign[
                           $left: #Field[
                              $base: #NameExpr['@spec']
                              $name: #NameExpr['files']
                           ]
                           $right: #ApplyExpr[
                              $recv: #ParcentNotation['%W"depend #{@spec.name}.c"']
                              $recv: #NameExpr['each']
                              $body: #Block[
                                 $param: #NameExpr['file']
                                 $body: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['write_file']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['File']
                                          $recv: #NameExpr['join']
                                          $param: #List[
                                             $expression: #NameExpr['@tempdir']
                                             $expression: #NameExpr['file']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['so']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['gem_dir']
                                 ]
                                 $expression: #StringExpr[
                                    $inner: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['name']
                                    ]
                                    $inner: #Indexer[
                                       $recv: #Field[
                                          $recv: #NameExpr['RbConfig']
                                          $name: #NameExpr['CONFIG']
                                       ]
                                       $index: #List[
                                          $expression: #StringExpr['DLEXT']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $expression: #NameExpr['so']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['path']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Package']
                                       ]
                                       $recv: #NameExpr['build']
                                       $param: #List[
                                          $expression: #NameExpr['@spec']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@installer']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Installer']
                                       ]
                                       $recv: #NameExpr['at']
                                       $param: #List[
                                          $expression: #NameExpr['path']
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    $recv: #NameExpr['@installer']
                                    $recv: #NameExpr['install']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['so']
                           ]
                        ]
                     ]
                     $rescue: #List[
                        $rescue: #Rescue[
                           $then: #List[
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['puts']
                                 $param: #List[
                                    $expression: #MulExpr[
                                       $left: #StringExpr['-']
                                       $right: #IntExpr['78']
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['puts']
                                 $param: #List[
                                    $command: #ApplyExpr[
                                       $base: #NameExpr['File']
                                       $recv: #NameExpr['read']
                                       $param: #List[
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['File']
                                             $recv: #NameExpr['join']
                                             $param: #List[
                                                $expression: #NameExpr['@gemhome']
                                                $expression: #StringExpr['gems']
                                                $expression: #StringExpr['a-2']
                                                $expression: #StringExpr['Makefile']
                                             ]
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['puts']
                                 $param: #List[
                                    $expression: #MulExpr[
                                       $left: #StringExpr['-']
                                       $right: #IntExpr['78']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['path']
                                 $right: #ApplyExpr[
                                    $recv: #NameExpr['File']
                                    $recv: #NameExpr['join']
                                    $param: #List[
                                       $expression: #NameExpr['@gemhome']
                                       $expression: #StringExpr['gems']
                                       $expression: #StringExpr['a-2']
                                       $expression: #StringExpr['gem_make.out']
                                    ]
                                 ]
                              ]
                              $statement: #IfExpr[
                                 $cond: #ApplyExpr[
                                    $recv: #NameExpr['File']
                                    $recv: #NameExpr['exist?']
                                    $param: #List[
                                       $expression: #NameExpr['path']
                                    ]
                                 ]
                                 $then: #List[
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['puts']
                                       $param: #List[
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['File']
                                             $recv: #NameExpr['read']
                                             $param: #List[
                                                $expression: #NameExpr['path']
                                             ]
                                          ]
                                       ]
                                    ]
                                    $statement: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['puts']
                                       $param: #List[
                                          $expression: #MulExpr[
                                             $left: #StringExpr['-']
                                             $right: #IntExpr['78']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #NameExpr['raise']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_installation_satisfies_dependency_eh']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_spec']
                           $param: #List[
                              $expression: #StringExpr['a']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['dep']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Dependency']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #StringExpr['a']
                                 $expression: #StringExpr['>= 2']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['installation_satisfies_dependency?']
                                 $param: #List[
                                    $expression: #NameExpr['dep']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['dep']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Dependency']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #StringExpr['a']
                                 $expression: #StringExpr['> 2']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['installation_satisfies_dependency?']
                                 $param: #List[
                                    $expression: #NameExpr['dep']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_installation_satisfies_dependency_eh_development']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['options']
                              ]
                              $index: #List[
                                 $expression: #NameExpr['development']
                              ]
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['options']
                              ]
                              $index: #List[
                                 $expression: #NameExpr['dev_shallow']
                              ]
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_spec']
                           $param: #List[
                              $expression: #StringExpr['a']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['dep']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Dependency']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #StringExpr['a']
                                 $expression: #NameExpr['development']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['installation_satisfies_dependency?']
                                 $param: #List[
                                    $expression: #NameExpr['dep']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_pre_install_checks_dependencies']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@spec']
                           $recv: #NameExpr['add_dependency']
                           $param: #List[
                              $expression: #StringExpr['b']
                              $expression: #StringExpr['> 5']
                           ]
                        ]
                        $statement: #NameExpr['util_setup_gem']
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_raises']
                                 $param: #List[
                                    $expression: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['InstallError']
                                    ]
                                 ]
                                 $body: #Block[
                                    $body: #ApplyExpr[
                                       $recv: #NameExpr['@installer']
                                       $recv: #NameExpr['install']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_pre_install_checks_dependencies_ignore']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@spec']
                           $recv: #NameExpr['add_dependency']
                           $param: #List[
                              $expression: #StringExpr['b']
                              $expression: #StringExpr['> 5']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['ignore_dependencies']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['build_rake_in']
                           $body: #Block[
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['use_ui']
                                 $param: #List[
                                    $expression: #NameExpr['@ui']
                                 ]
                                 $body: #Block[
                                    $body: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert']
                                       $param: #List[
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['@installer']
                                             $recv: #NameExpr['pre_install_checks']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_pre_install_checks_dependencies_install_dir']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['gemhome2']
                           $right: #StringExpr[
                              $inner: #NameExpr['@gemhome']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@spec']
                           $recv: #NameExpr['add_dependency']
                           $param: #List[
                              $expression: #StringExpr['d']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['quick_gem']
                           $param: #List[
                              $expression: #StringExpr['d']
                              $expression: #IntExpr['2']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gem']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['file_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mv']
                           $param: #List[
                              $expression: #NameExpr['@gemhome']
                              $expression: #NameExpr['gemhome2']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mkdir']
                           $param: #List[
                              $expression: #NameExpr['@gemhome']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mv']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['gemhome2']
                                    $expression: #StringExpr['cache']
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['file_name']
                                    ]
                                 ]
                              ]
                              $expression: #NameExpr['gem']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #Field[
                              $recv: #NameExpr['Gem']
                              $name: #NameExpr['Specification']
                           ]
                           $recv: #NameExpr['reset']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installer']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $recv: #NameExpr['at']
                              $param: #List[
                                 $expression: #NameExpr['gem']
                                 $hash: #Hash[
                                    $key: #NameExpr['install_dir']
                                    $value: #NameExpr['gemhome2']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['build_rake_in']
                           $body: #Block[
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['use_ui']
                                 $param: #List[
                                    $expression: #NameExpr['@ui']
                                 ]
                                 $body: #Block[
                                    $body: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert']
                                       $param: #List[
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['installer']
                                             $recv: #NameExpr['pre_install_checks']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_pre_install_checks_ruby_version']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['use_ui']
                        $param: #List[
                           $expression: #NameExpr['@ui']
                        ]
                        $body: #Block[
                           $body: #List[
                              $statement: #AssignExpr[
                                 $left: #NameExpr['installer']
                                 $right: #ApplyExpr[
                                    $base: #Field[
                                       $recv: #NameExpr['Gem']
                                       $name: #NameExpr['Installer']
                                    ]
                                    $recv: #NameExpr['at']
                                    $param: #List[
                                       $expression: #NameExpr['old_ruby_required']
                                    ]
                                 ]
                              ]
                              $statement: #AssignExpr[
                                 $left: #NameExpr['e']
                                 $right: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_raises']
                                    $param: #List[
                                       $expression: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['InstallError']
                                       ]
                                    ]
                                    $body: #Block[
                                       $body: #ApplyExpr[
                                          $recv: #NameExpr['installer']
                                          $recv: #NameExpr['pre_install_checks']
                                       ]
                                    ]
                                 ]
                              ]
                              $statement: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['assert_equal']
                                 $param: #List[
                                    $expression: #StringExpr['old_ruby_required requires Ruby version = 1.4.6.']
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['e']
                                       $recv: #NameExpr['message']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_pre_install_checks_wrong_rubygems_version']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_spec']
                              $param: #List[
                                 $expression: #StringExpr['old_rubygems_required']
                                 $expression: #StringExpr['1']
                              ]
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['s']
                                       $name: #NameExpr['required_rubygems_version']
                                    ]
                                    $right: #StringExpr['< 0']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_build_gem']
                           $param: #List[
                              $expression: #NameExpr['spec']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gem']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['cache']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['spec']
                                    $recv: #NameExpr['file_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['@installer']
                                    $right: #ApplyExpr[
                                       $base: #Field[
                                          $recv: #NameExpr['Gem']
                                          $name: #NameExpr['Installer']
                                       ]
                                       $recv: #NameExpr['at']
                                       $param: #List[
                                          $expression: #NameExpr['gem']
                                       ]
                                    ]
                                 ]
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['e']
                                    $right: #ApplyExpr[
                                       #Self['self']
                                       $recv: #NameExpr['assert_raises']
                                       $param: #List[
                                          $expression: #Field[
                                             $recv: #NameExpr['Gem']
                                             $name: #NameExpr['InstallError']
                                          ]
                                       ]
                                       $body: #Block[
                                          $body: #ApplyExpr[
                                             $recv: #NameExpr['@installer']
                                             $recv: #NameExpr['pre_install_checks']
                                          ]
                                       ]
                                    ]
                                 ]
                                 $statement: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['assert_equal']
                                    $param: #List[
                                       $expression: #AddExpr[
                                          $left: #StringExpr['old_rubygems_required requires RubyGems version < 0. ']
                                          $right: #StringExpr['Try \'gem update --system\' to update RubyGems itself.']
                                       ]
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['e']
                                          $recv: #NameExpr['message']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_shebang']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_make_exec']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #StringExpr['#!/usr/bin/ruby']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['shebang']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@installer']
                              $recv: #NameExpr['shebang']
                              $param: #List[
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['ruby']
                                 ]
                              ]
                              $expression: #NameExpr['shebang']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_process_options']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_nil']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['build_root']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['@gemhome']
                                    $expression: #StringExpr['bin']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['bin_dir']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['@gemhome']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['gem_home']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_process_options_build_root']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['build_root']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@tempdir']
                                 $expression: #StringExpr['build_root']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@installer']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $recv: #NameExpr['at']
                              $param: #List[
                                 $expression: #NameExpr['@gem']
                                 $hash: #Hash[
                                    $key: #NameExpr['build_root']
                                    $value: #NameExpr['build_root']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['Pathname']
                                 $param: #List[
                                    $expression: #NameExpr['build_root']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['build_root']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['build_root']
                                    $expression: #NameExpr['@gemhome']
                                    $expression: #StringExpr['bin']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['bin_dir']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['build_root']
                                    $expression: #NameExpr['@gemhome']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['gem_home']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_shebang_arguments']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_make_exec']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #StringExpr['#!/usr/bin/ruby -ws']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['shebang']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@installer']
                              $recv: #NameExpr['shebang']
                              $param: #List[
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['ruby']
                                 ]
                              ]
                              $expression: #NameExpr['shebang']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_shebang_empty']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_make_exec']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #StringExpr['']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['shebang']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@installer']
                              $recv: #NameExpr['shebang']
                              $param: #List[
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['ruby']
                                 ]
                              ]
                              $expression: #NameExpr['shebang']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_shebang_env']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_make_exec']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #StringExpr['#!/usr/bin/env ruby']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['shebang']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@installer']
                              $recv: #NameExpr['shebang']
                              $param: #List[
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['ruby']
                                 ]
                              ]
                              $expression: #NameExpr['shebang']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_shebang_env_arguments']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_make_exec']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #StringExpr['#!/usr/bin/env ruby -ws']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['shebang']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@installer']
                              $recv: #NameExpr['shebang']
                              $param: #List[
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['ruby']
                                 ]
                              ]
                              $expression: #NameExpr['shebang']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_shebang_env_shebang']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_make_exec']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #StringExpr['']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['env_shebang']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['shebang']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@installer']
                              $recv: #NameExpr['shebang']
                              $param: #List[
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #Unless[
                           $then: #AssignExpr[
                              $left: #NameExpr['env_shebang']
                              $right: #StringExpr['/usr/bin/env']
                           ]
                           $cond: #ApplyExpr[
                              $recv: #NameExpr['Gem']
                              $recv: #NameExpr['win_platform?']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #NameExpr['env_shebang']
                                 $inner: #Indexer[
                                    $recv: #Field[
                                       $recv: #NameExpr['RbConfig']
                                       $name: #NameExpr['CONFIG']
                                    ]
                                    $index: #List[
                                       $expression: #StringExpr['ruby_install_name']
                                    ]
                                 ]
                              ]
                              $expression: #NameExpr['shebang']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_shebang_nested']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_make_exec']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #StringExpr['#!/opt/local/ruby/bin/ruby']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['shebang']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@installer']
                              $recv: #NameExpr['shebang']
                              $param: #List[
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['ruby']
                                 ]
                              ]
                              $expression: #NameExpr['shebang']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_shebang_nested_arguments']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_make_exec']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #StringExpr['#!/opt/local/ruby/bin/ruby -ws']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['shebang']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@installer']
                              $recv: #NameExpr['shebang']
                              $param: #List[
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['ruby']
                                 ]
                              ]
                              $expression: #NameExpr['shebang']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_shebang_version']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_make_exec']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #StringExpr['#!/usr/bin/ruby18']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['shebang']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@installer']
                              $recv: #NameExpr['shebang']
                              $param: #List[
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['ruby']
                                 ]
                              ]
                              $expression: #NameExpr['shebang']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_shebang_version_arguments']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_make_exec']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #StringExpr['#!/usr/bin/ruby18 -ws']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['shebang']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@installer']
                              $recv: #NameExpr['shebang']
                              $param: #List[
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['ruby']
                                 ]
                              ]
                              $expression: #NameExpr['shebang']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_shebang_version_env']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_make_exec']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #StringExpr['#!/usr/bin/env ruby18']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['shebang']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@installer']
                              $recv: #NameExpr['shebang']
                              $param: #List[
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['ruby']
                                 ]
                              ]
                              $expression: #NameExpr['shebang']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_shebang_version_env_arguments']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_make_exec']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #StringExpr['#!/usr/bin/env ruby18 -ws']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['shebang']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@installer']
                              $recv: #NameExpr['shebang']
                              $param: #List[
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['ruby']
                                 ]
                              ]
                              $expression: #NameExpr['shebang']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_shebang_custom']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['conf']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['ConfigFile']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Array['[]']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['conf']
                              $index: #List[
                                 $expression: #NameExpr['custom_shebang']
                              ]
                           ]
                           $right: #StringExpr['test']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['Gem']
                              $name: #NameExpr['configuration']
                           ]
                           $right: #NameExpr['conf']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_make_exec']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #StringExpr['#!/usr/bin/ruby']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['shebang']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@installer']
                              $recv: #NameExpr['shebang']
                              $param: #List[
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['#!test']
                              $expression: #NameExpr['shebang']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_shebang_custom_with_expands']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['bin_env']
                           $right: #Conditional[
                              $cond: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['win_platform?']
                              ]
                              $then: #StringExpr['']
                              $else: #StringExpr['/usr/bin/env']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['conf']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['ConfigFile']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Array['[]']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['conf']
                              $index: #List[
                                 $expression: #NameExpr['custom_shebang']
                              ]
                           ]
                           $right: #StringExpr['1 $env 2 $ruby 3 $exec 4 $name']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['Gem']
                              $name: #NameExpr['configuration']
                           ]
                           $right: #NameExpr['conf']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_make_exec']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #StringExpr['#!/usr/bin/ruby']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['shebang']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@installer']
                              $recv: #NameExpr['shebang']
                              $param: #List[
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #NameExpr['bin_env']
                                 $inner: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['ruby']
                                 ]
                              ]
                              $expression: #NameExpr['shebang']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_shebang_custom_with_expands_and_arguments']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['bin_env']
                           $right: #Conditional[
                              $cond: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['win_platform?']
                              ]
                              $then: #StringExpr['']
                              $else: #StringExpr['/usr/bin/env']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['conf']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['ConfigFile']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Array['[]']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #NameExpr['conf']
                              $index: #List[
                                 $expression: #NameExpr['custom_shebang']
                              ]
                           ]
                           $right: #StringExpr['1 $env 2 $ruby 3 $exec']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['Gem']
                              $name: #NameExpr['configuration']
                           ]
                           $right: #NameExpr['conf']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_make_exec']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #StringExpr['#!/usr/bin/ruby -ws']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['shebang']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@installer']
                              $recv: #NameExpr['shebang']
                              $param: #List[
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[
                                 $inner: #NameExpr['bin_env']
                                 $inner: #ApplyExpr[
                                    $recv: #NameExpr['Gem']
                                    $recv: #NameExpr['ruby']
                                 ]
                              ]
                              $expression: #NameExpr['shebang']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_unpack']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #NameExpr['util_setup_gem']
                        $statement: #AssignExpr[
                           $left: #NameExpr['dest']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['gems']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['full_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@installer']
                           $recv: #NameExpr['unpack']
                           $param: #List[
                              $expression: #NameExpr['dest']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['dest']
                                    $expression: #StringExpr['lib']
                                    $expression: #StringExpr['code.rb']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #NameExpr['dest']
                                    $expression: #StringExpr['bin']
                                    $expression: #StringExpr['executable']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_write_build_info_file']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@spec']
                                 $recv: #NameExpr['build_info_file']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['build_args']
                           ]
                           $right: #ParcentNotation['%w[\n      --with-libyaml-dir /usr/local/Cellar/libyaml/0.1.4\n    ]']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['write_build_info_file']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@spec']
                                 $recv: #NameExpr['build_info_file']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['expected']
                           $right: #StringExpr['--with-libyaml-dir\\n/usr/local/Cellar/libyaml/0.1.4\\n']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['expected']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['read']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['@spec']
                                       $recv: #NameExpr['build_info_file']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_write_build_info_file_empty']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@spec']
                                 $recv: #NameExpr['build_info_file']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['write_build_info_file']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@spec']
                                 $recv: #NameExpr['build_info_file']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_write_build_info_file_install_dir']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['installer']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $recv: #NameExpr['at']
                              $param: #List[
                                 $expression: #NameExpr['@gem']
                                 $hash: #Hash[
                                    $key: #NameExpr['install_dir']
                                    $value: #StringExpr[
                                       $inner: #NameExpr['@gemhome']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['installer']
                              $name: #NameExpr['build_args']
                           ]
                           $right: #ParcentNotation['%w[\n      --with-libyaml-dir /usr/local/Cellar/libyaml/0.1.4\n    ]']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['installer']
                           $recv: #NameExpr['write_build_info_file']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@spec']
                                 $recv: #NameExpr['build_info_file']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #StringExpr[
                                       $inner: #NameExpr['@gemhome']
                                    ]
                                    $expression: #StringExpr['build_info']
                                    $expression: #StringExpr[
                                       $inner: #ApplyExpr[
                                          $recv: #NameExpr['@spec']
                                          $recv: #NameExpr['full_name']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_write_cache_file']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['cache_file']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #StringExpr['cache']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['file_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['gem']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['@gemhome']
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['file_name']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['mv']
                           $param: #List[
                              $expression: #NameExpr['cache_file']
                              $expression: #NameExpr['gem']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $expression: #NameExpr['cache_file']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installer']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $recv: #NameExpr['at']
                              $param: #List[
                                 $expression: #NameExpr['gem']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['installer']
                              $name: #NameExpr['gem_home']
                           ]
                           $right: #NameExpr['@gemhome']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['installer']
                           $recv: #NameExpr['write_cache_file']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['cache_file']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_write_spec']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['rm']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@spec']
                                 $recv: #NameExpr['spec_file']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@spec']
                                 $recv: #NameExpr['spec_file']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@installer']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $recv: #NameExpr['for_spec']
                              $param: #List[
                                 $expression: #NameExpr['@spec']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_home']
                           ]
                           $right: #NameExpr['@gemhome']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['write_spec']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@spec']
                                 $recv: #NameExpr['spec_file']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['loaded']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Specification']
                              ]
                              $recv: #NameExpr['load']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@spec']
                                    $recv: #NameExpr['spec_file']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #NameExpr['loaded']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['Gem']
                                 $recv: #NameExpr['rubygems_version']
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@spec']
                                 $recv: #NameExpr['installed_by_version']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_write_spec_writes_cached_spec']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['rm']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@spec']
                                 $recv: #NameExpr['spec_file']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_path_exists']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['@spec']
                                 $recv: #NameExpr['spec_file']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@spec']
                              $name: #NameExpr['files']
                           ]
                           $right: #ParcentNotation['%w[a.rb b.rb c.rb]']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@installer']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $recv: #NameExpr['for_spec']
                              $param: #List[
                                 $expression: #NameExpr['@spec']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_home']
                           ]
                           $right: #NameExpr['@gemhome']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['write_spec']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@spec']
                              $name: #NameExpr['files']
                           ]
                           $right: #Array['[]']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                              $expression: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['eval']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['File']
                                       $recv: #NameExpr['read']
                                       $param: #List[
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['@spec']
                                             $recv: #NameExpr['spec_file']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_dir']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #ApplyExpr[
                        #Self['self']
                        $recv: #NameExpr['assert_match']
                        $param: #List[
                           $expression: #Regex['%r!/gemhome/gems/a-2$!']
                           $expression: #ApplyExpr[
                              $recv: #NameExpr['@installer']
                              $recv: #NameExpr['dir']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_default_gem_loaded_from']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_spec']
                              $param: #List[
                                 $expression: #StringExpr['a']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installer']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['Gem']
                                 $name: #NameExpr['Installer']
                              ]
                              $recv: #NameExpr['for_spec']
                              $param: #List[
                                 $expression: #NameExpr['spec']
                                 $hash: #Hash[
                                    $key: #NameExpr['install_as_default']
                                    $value: #TrueExpr['true']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['installer']
                           $recv: #NameExpr['install']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_predicate']
                           $param: #List[
                              $expression: #NameExpr['spec']
                              $expression: #NameExpr['default_gem?']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_default_gem']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['FileUtils']
                           $recv: #NameExpr['rm_f']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['File']
                                 $recv: #NameExpr['join']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['Gem']
                                       $recv: #NameExpr['dir']
                                    ]
                                    $expression: #StringExpr['specifications']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #Indexer[
                              $base: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['options']
                              ]
                              $index: #List[
                                 $expression: #NameExpr['install_as_default']
                              ]
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@installer']
                              $name: #NameExpr['gem_dir']
                           ]
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_gem_dir']
                              $param: #List[
                                 $expression: #NameExpr['@spec']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['use_ui']
                           $param: #List[
                              $expression: #NameExpr['@ui']
                           ]
                           $body: #Block[
                              $body: #ApplyExpr[
                                 $recv: #NameExpr['@installer']
                                 $recv: #NameExpr['install']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['directory?']
                                 $param: #List[
                                    $expression: #NameExpr['util_inst_bindir']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installed_exec']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['join']
                              $param: #List[
                                 $expression: #NameExpr['util_inst_bindir']
                                 $expression: #StringExpr['executable']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_path_exists']
                           $param: #List[
                              $expression: #NameExpr['installed_exec']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['directory?']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['File']
                                       $recv: #NameExpr['join']
                                       $param: #List[
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['Gem']
                                             $recv: #NameExpr['default_dir']
                                          ]
                                          $expression: #StringExpr['specifications']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $command: #ApplyExpr[
                                 $base: #NameExpr['File']
                                 $recv: #NameExpr['directory?']
                                 $param: #List[
                                    $expression: #ApplyExpr[
                                       $recv: #NameExpr['File']
                                       $recv: #NameExpr['join']
                                       $param: #List[
                                          $expression: #ApplyExpr[
                                             $recv: #NameExpr['Gem']
                                             $recv: #NameExpr['default_dir']
                                          ]
                                          $expression: #StringExpr['specifications']
                                          $expression: #StringExpr['default']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['default_spec']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['eval']
                              $param: #List[
                                 $command: #ApplyExpr[
                                    $base: #NameExpr['File']
                                    $recv: #NameExpr['read']
                                    $param: #List[
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['File']
                                          $recv: #NameExpr['join']
                                          $param: #List[
                                             $expression: #ApplyExpr[
                                                $recv: #NameExpr['Gem']
                                                $recv: #NameExpr['default_dir']
                                             ]
                                             $expression: #StringExpr['specifications']
                                             $expression: #StringExpr['default']
                                             $expression: #StringExpr['a-2.gemspec']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #Field[
                                    $recv: #NameExpr['Gem']
                                    $name: #NameExpr['Version']
                                 ]
                                 $recv: #NameExpr['new']
                                 $param: #List[
                                    $expression: #StringExpr['2']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['default_spec']
                                 $recv: #NameExpr['version']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #Array[
                                 $index: #List[
                                    $expression: #StringExpr['bin/executable']
                                 ]
                              ]
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['default_spec']
                                 $recv: #NameExpr['files']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['old_ruby_required']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['spec']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_spec']
                              $param: #List[
                                 $expression: #StringExpr['old_ruby_required']
                                 $expression: #StringExpr['1']
                              ]
                              $body: #Block[
                                 $param: #NameExpr['s']
                                 $body: #AssignExpr[
                                    $left: #Field[
                                       $base: #NameExpr['s']
                                       $name: #NameExpr['required_ruby_version']
                                    ]
                                    $right: #StringExpr['= 1.4.6']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_build_gem']
                           $param: #List[
                              $expression: #NameExpr['spec']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['spec']
                           $recv: #NameExpr['cache_file']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['util_execless']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['@spec']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_spec']
                              $param: #List[
                                 $expression: #StringExpr['z']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_build_gem']
                           $param: #List[
                              $expression: #NameExpr['@spec']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@installer']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_installer']
                              $param: #List[
                                 $expression: #NameExpr['@spec']
                                 $expression: #NameExpr['@gemhome']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['util_conflict_executable']
                  $param: #List[
                     $param: #Param[
                        $param: #NameExpr['wrappers']
                     ]
                  ]
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['conflict']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['quick_gem']
                              $param: #List[
                                 $expression: #StringExpr['conflict']
                              ]
                              $body: #Block[
                                 $param: #NameExpr['spec']
                                 $body: #ApplyExpr[
                                    #Self['self']
                                    $recv: #NameExpr['util_make_exec']
                                    $param: #List[
                                       $expression: #NameExpr['spec']
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['util_build_gem']
                           $param: #List[
                              $expression: #NameExpr['conflict']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['installer']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['util_installer']
                              $param: #List[
                                 $expression: #NameExpr['conflict']
                                 $expression: #NameExpr['@gemhome']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['installer']
                              $name: #NameExpr['wrappers']
                           ]
                           $right: #NameExpr['wrappers']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['installer']
                           $recv: #NameExpr['generate_bin']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['mask']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #AndExpr[
                        $left: #OctalInteger['0100755']
                        $right: #ComplExpr[
                           $expr: #ApplyExpr[
                              $recv: #NameExpr['File']
                              $recv: #NameExpr['umask']
                           ]
                        ]
                     ]
                  ]
               ]
            ]
         ]
      ]
   ]
   #Comsumed['comsumed']
]
