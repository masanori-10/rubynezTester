#Source[
   #List[
      $statement: #ApplyExpr[
         #Self['self']
         $recv: #NameExpr['require']
         $param: #List[
            $expression: #StringExpr['rdoc/test_case']
         ]
      ]
      $statement: #Class[
         $name: #NameExpr['TestRDocMarkupPreProcess']
         $super: #Field[
            $recv: #NameExpr['RDoc']
            $name: #NameExpr['TestCase']
         ]
         $body: #BlockExpr[
            $main: #List[
               $statement: #FuncDecl[
                  $name: #NameExpr['setup']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #Super['super']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@tempfile']
                           $right: #ApplyExpr[
                              $base: #NameExpr['Tempfile']
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #StringExpr['test_rdoc_markup_pre_process']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@file_name']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['basename']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@tempfile']
                                    $recv: #NameExpr['path']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@dir']
                           $right: #ApplyExpr[
                              $base: #NameExpr['File']
                              $recv: #NameExpr['dirname']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@tempfile']
                                    $recv: #NameExpr['path']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['@pp']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #Field[
                                    $recv: #NameExpr['RDoc']
                                    $name: #NameExpr['Markup']
                                 ]
                                 $name: #NameExpr['PreProcess']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #ApplyExpr[
                                    $recv: #NameExpr['@tempfile']
                                    $recv: #NameExpr['path']
                                 ]
                                 $expression: #Array[
                                    $index: #List[
                                       $expression: #NameExpr['@dir']
                                       $expression: #ApplyExpr[
                                          $recv: #NameExpr['File']
                                          $recv: #NameExpr['dirname']
                                          $param: #List[
                                             $expression: #File['__FILE__']
                                          ]
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['teardown']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #Super['super']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@tempfile']
                           $recv: #NameExpr['close!']
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_class_register']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #Field[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['Markup']
                              ]
                              $name: #NameExpr['PreProcess']
                           ]
                           $recv: #NameExpr['register']
                           $param: #List[
                              $expression: #StringExpr['for_test']
                           ]
                           $body: #Block[
                              $body: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['raise']
                                 $param: #List[
                                    $expression: #StringExpr['fail']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ParcentNotation['%w[for_test]']
                              $expression: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['RDoc']
                                          $name: #NameExpr['Markup']
                                       ]
                                       $name: #NameExpr['PreProcess']
                                    ]
                                    $recv: #NameExpr['registered']
                                 ]
                                 $recv: #NameExpr['keys']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_class_post_process']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $recv: #Field[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['Markup']
                              ]
                              $name: #NameExpr['PreProcess']
                           ]
                           $recv: #NameExpr['post_process']
                           $body: #Block[
                              $body: #Empty['']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #IntExpr['1']
                              $expression: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #Field[
                                       $recv: #Field[
                                          $recv: #NameExpr['RDoc']
                                          $name: #NameExpr['Markup']
                                       ]
                                       $name: #NameExpr['PreProcess']
                                    ]
                                    $recv: #NameExpr['post_processors']
                                 ]
                                 $recv: #NameExpr['length']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_include_file']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@tempfile']
                           $recv: #NameExpr['write']
                           $param: #List[
                              $expression: #HereDocument['# -*- mode: rdoc; coding: utf-8; fill-column: 74; -*-\n\nRegular expressions (<i>regexp</i>s) are patterns which describe the\ncontents of a string.\n']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@tempfile']
                           $recv: #NameExpr['flush']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@tempfile']
                           $recv: #NameExpr['rewind']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['content']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['include_file']
                              $param: #List[
                                 $expression: #NameExpr['@file_name']
                                 $expression: #StringExpr['']
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['expected']
                           $right: #HereDocument['Regular expressions (<i>regexp</i>s) are patterns which describe the\ncontents of a string.\n']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['expected']
                              $expression: #NameExpr['content']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_include_file_encoding_incompatible']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@tempfile']
                           $recv: #NameExpr['write']
                           $param: #List[
                              $expression: #HereDocument['# -*- mode: rdoc; coding: utf-8; fill-column: 74; -*-\n\nπ\n']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@tempfile']
                           $recv: #NameExpr['flush']
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@tempfile']
                           $recv: #NameExpr['rewind']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['content']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['include_file']
                              $param: #List[
                                 $expression: #NameExpr['@file_name']
                                 $expression: #StringExpr['']
                                 $expression: #Field[
                                    $recv: #NameExpr['Encoding']
                                    $name: #NameExpr['US_ASCII']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['expected']
                           $right: #StringExpr['?\\n']
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #NameExpr['expected']
                              $expression: #NameExpr['content']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_include_file_in_other_directory']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['content']
                           $right: #Nil['nil']
                        ]
                        $statement: #MultipleAssign[
                           $left: #MultipleLeftHandSideExpression[
                              $item: #NameExpr['out']
                              $item: #NameExpr['err']
                           ]
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['capture_io']
                              $body: #Block[
                                 $body: #AssignExpr[
                                    $left: #NameExpr['content']
                                    $right: #ApplyExpr[
                                       $base: #NameExpr['@pp']
                                       $recv: #NameExpr['include_file']
                                       $param: #List[
                                          $expression: #StringExpr['test.txt']
                                          $expression: #StringExpr['']
                                          $expression: #Nil['nil']
                                       ]
                                    ]
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_empty']
                           $param: #List[
                              $expression: #NameExpr['out']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_empty']
                           $param: #List[
                              $expression: #NameExpr['err']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['test file\\n']
                              $expression: #NameExpr['content']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['text']
                           $right: #StringExpr['# :main: M\\n']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['out']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle']
                              $param: #List[
                                 $expression: #NameExpr['text']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_same']
                           $param: #List[
                              $expression: #NameExpr['out']
                              $expression: #NameExpr['text']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['#\\n']
                              $expression: #NameExpr['text']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_comment']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['text']
                           $right: #StringExpr['# :main: M\\n']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['c']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['comment']
                              $param: #List[
                                 $expression: #NameExpr['text']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['out']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle']
                              $param: #List[
                                 $expression: #NameExpr['c']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_same']
                           $param: #List[
                              $expression: #NameExpr['out']
                              $expression: #NameExpr['text']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['#\\n']
                              $expression: #NameExpr['text']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_markup']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['c']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['comment']
                              $param: #List[
                                 $expression: #StringExpr[':markup: rd']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle']
                           $param: #List[
                              $expression: #NameExpr['c']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['rd']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['c']
                                 $recv: #NameExpr['format']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_markup_empty']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['c']
                           $right: #ApplyExpr[
                              #Self['self']
                              $recv: #NameExpr['comment']
                              $param: #List[
                                 $expression: #StringExpr[':markup:']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle']
                           $param: #List[
                              $expression: #NameExpr['c']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['rdoc']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['c']
                                 $recv: #NameExpr['format']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_post_process']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['cd']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['CodeObject']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #Field[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['Markup']
                              ]
                              $name: #NameExpr['PreProcess']
                           ]
                           $recv: #NameExpr['post_process']
                           $body: #Block[
                              $param: #MultipleLeftHandSideExpression[
                                 $item: #NameExpr['text']
                                 $item: #NameExpr['code_object']
                              ]
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #Indexer[
                                       $base: #ApplyExpr[
                                          $recv: #NameExpr['code_object']
                                          $recv: #NameExpr['metadata']
                                       ]
                                       $index: #List[
                                          $expression: #NameExpr['stuff']
                                       ]
                                    ]
                                    $right: #NameExpr['text']
                                 ]
                                 $statement: #NameExpr['junk']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['text']
                           $right: #StringExpr['# a b c\\n']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['out']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle']
                              $param: #List[
                                 $expression: #NameExpr['text']
                                 $expression: #NameExpr['cd']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_same']
                           $param: #List[
                              $expression: #NameExpr['out']
                              $expression: #NameExpr['text']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['# a b c\\n']
                              $expression: #NameExpr['text']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['# a b c\\n']
                              $expression: #Indexer[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['cd']
                                    $recv: #NameExpr['metadata']
                                 ]
                                 $index: #List[
                                    $expression: #NameExpr['stuff']
                                 ]
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_unregistered']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['text']
                           $right: #StringExpr['# :x: y\\n']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['out']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle']
                              $param: #List[
                                 $expression: #NameExpr['text']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_same']
                           $param: #List[
                              $expression: #NameExpr['out']
                              $expression: #NameExpr['text']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['# :x: y\\n']
                              $expression: #NameExpr['text']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_blankline']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['result']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle_directive']
                              $param: #List[
                                 $expression: #StringExpr['#']
                                 $expression: #StringExpr['arg']
                                 $expression: #StringExpr['a, b']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['#:arg: a, b\\n']
                              $expression: #NameExpr['result']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_downcase']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['method']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['AnyMethod']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #StringExpr['m']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['ARG']
                              $expression: #StringExpr['a, b']
                              $expression: #NameExpr['method']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['a, b']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['method']
                                 $recv: #NameExpr['params']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_arg']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['method']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['AnyMethod']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #StringExpr['m']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['arg']
                              $expression: #StringExpr['a, b']
                              $expression: #NameExpr['method']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['a, b']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['method']
                                 $recv: #NameExpr['params']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_arg_no_context']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['result']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle_directive']
                              $param: #List[
                                 $expression: #StringExpr['']
                                 $expression: #StringExpr['arg']
                                 $expression: #StringExpr['a, b']
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[':arg: a, b\\n']
                              $expression: #NameExpr['result']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_args']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['method']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['AnyMethod']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #StringExpr['m']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['args']
                              $expression: #StringExpr['a, b']
                              $expression: #NameExpr['method']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['a, b']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['method']
                                 $recv: #NameExpr['params']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_block']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['result']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle_directive']
                              $param: #List[
                                 $expression: #StringExpr['']
                                 $expression: #StringExpr['x']
                                 $expression: #StringExpr['y']
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['directive']
                                    $item: #NameExpr['param']
                                 ]
                                 $body: #StringExpr['']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_empty']
                           $param: #List[
                              $expression: #NameExpr['result']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_block_false']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['result']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle_directive']
                              $param: #List[
                                 $expression: #StringExpr['']
                                 $expression: #StringExpr['x']
                                 $expression: #StringExpr['y']
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['directive']
                                    $item: #NameExpr['param']
                                 ]
                                 $body: #FalseExpr['false']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[':x: y\\n']
                              $expression: #NameExpr['result']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_block_nil']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['result']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle_directive']
                              $param: #List[
                                 $expression: #StringExpr['']
                                 $expression: #StringExpr['x']
                                 $expression: #StringExpr['y']
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['directive']
                                    $item: #NameExpr['param']
                                 ]
                                 $body: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[':x: y\\n']
                              $expression: #NameExpr['result']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_category']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['context']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['Context']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['original_section']
                           $right: #ApplyExpr[
                              $recv: #NameExpr['context']
                              $recv: #NameExpr['current_section']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['category']
                              $expression: #StringExpr['other']
                              $expression: #NameExpr['context']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute_equal']
                           $param: #List[
                              $expression: #NameExpr['original_section']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['context']
                                 $recv: #NameExpr['current_section']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_doc']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['code_object']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['CodeObject']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['code_object']
                              $name: #NameExpr['document_self']
                           ]
                           $right: #FalseExpr['false']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['code_object']
                              $name: #NameExpr['force_documentation']
                           ]
                           $right: #FalseExpr['false']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['doc']
                              $expression: #Nil['nil']
                              $expression: #NameExpr['code_object']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['code_object']
                                 $recv: #NameExpr['document_self']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['code_object']
                                 $recv: #NameExpr['force_documentation']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_doc_no_context']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['result']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle_directive']
                              $param: #List[
                                 $expression: #StringExpr['']
                                 $expression: #StringExpr['doc']
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['\\n']
                              $expression: #NameExpr['result']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_enddoc']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['code_object']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['CodeObject']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['enddoc']
                              $expression: #Nil['nil']
                              $expression: #NameExpr['code_object']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['code_object']
                                 $recv: #NameExpr['done_documenting']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_include']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@tempfile']
                           $recv: #NameExpr['write']
                           $param: #List[
                              $expression: #StringExpr['included']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['@tempfile']
                           $recv: #NameExpr['flush']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['result']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle_directive']
                              $param: #List[
                                 $expression: #StringExpr['']
                                 $expression: #StringExpr['include']
                                 $expression: #NameExpr['@file_name']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['included']
                              $expression: #NameExpr['result']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_main']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@pp']
                              $name: #NameExpr['options']
                           ]
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['Options']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['main']
                              $expression: #StringExpr['M']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['M']
                              $expression: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['@pp']
                                    $recv: #NameExpr['options']
                                 ]
                                 $recv: #NameExpr['main_page']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_notnew']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['m']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['AnyMethod']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #StringExpr['m']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['notnew']
                              $expression: #Nil['nil']
                              $expression: #NameExpr['m']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['m']
                                 $recv: #NameExpr['dont_rename_initialize']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_not_new']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['m']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['AnyMethod']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #StringExpr['m']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['not_new']
                              $expression: #Nil['nil']
                              $expression: #NameExpr['m']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['m']
                                 $recv: #NameExpr['dont_rename_initialize']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_not_dash_new']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['m']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['AnyMethod']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #StringExpr['m']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['not-new']
                              $expression: #Nil['nil']
                              $expression: #NameExpr['m']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['m']
                                 $recv: #NameExpr['dont_rename_initialize']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_nodoc']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['code_object']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['CodeObject']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['code_object']
                              $name: #NameExpr['document_self']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['code_object']
                              $name: #NameExpr['document_children']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['nodoc']
                              $expression: #Nil['nil']
                              $expression: #NameExpr['code_object']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['code_object']
                                 $recv: #NameExpr['document_self']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['code_object']
                                 $recv: #NameExpr['document_children']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_nodoc_all']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['code_object']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['CodeObject']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['code_object']
                              $name: #NameExpr['document_self']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['code_object']
                              $name: #NameExpr['document_children']
                           ]
                           $right: #TrueExpr['true']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['nodoc']
                              $expression: #StringExpr['all']
                              $expression: #NameExpr['code_object']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['code_object']
                                 $recv: #NameExpr['document_self']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['code_object']
                                 $recv: #NameExpr['document_children']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_nodoc_no_context']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['result']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle_directive']
                              $param: #List[
                                 $expression: #StringExpr['']
                                 $expression: #StringExpr['nodoc']
                                 $expression: #Nil['nil']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['\\n']
                              $expression: #NameExpr['result']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_registered']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #Field[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['Markup']
                              ]
                              $name: #NameExpr['PreProcess']
                           ]
                           $recv: #NameExpr['register']
                           $param: #List[
                              $expression: #StringExpr['x']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['result']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle_directive']
                              $param: #List[
                                 $expression: #StringExpr['']
                                 $expression: #StringExpr['x']
                                 $expression: #StringExpr['y']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_nil']
                           $param: #List[
                              $expression: #NameExpr['result']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['result']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle_directive']
                              $param: #List[
                                 $expression: #StringExpr['']
                                 $expression: #StringExpr['x']
                                 $expression: #StringExpr['y']
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['directive']
                                    $item: #NameExpr['param']
                                 ]
                                 $body: #FalseExpr['false']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[':x: y\\n']
                              $expression: #NameExpr['result']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['result']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle_directive']
                              $param: #List[
                                 $expression: #StringExpr['']
                                 $expression: #StringExpr['x']
                                 $expression: #StringExpr['y']
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['directive']
                                    $item: #NameExpr['param']
                                 ]
                                 $body: #StringExpr['']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #NameExpr['result']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_registered_block']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['called']
                           $right: #Nil['nil']
                        ]
                        $statement: #ApplyExpr[
                           $base: #Field[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['Markup']
                              ]
                              $name: #NameExpr['PreProcess']
                           ]
                           $recv: #NameExpr['register']
                           $param: #List[
                              $expression: #StringExpr['x']
                           ]
                           $body: #Block[
                              $param: #MultipleLeftHandSideExpression[
                                 $item: #NameExpr['directive']
                                 $item: #NameExpr['param']
                              ]
                              $body: #List[
                                 $statement: #AssignExpr[
                                    $left: #NameExpr['called']
                                    $right: #Array[
                                       $index: #List[
                                          $expression: #NameExpr['directive']
                                          $expression: #NameExpr['param']
                                       ]
                                    ]
                                 ]
                                 $statement: #StringExpr['blah']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['result']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle_directive']
                              $param: #List[
                                 $expression: #StringExpr['']
                                 $expression: #StringExpr['x']
                                 $expression: #StringExpr['y']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['blah']
                              $expression: #NameExpr['result']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #ParcentNotation['%w[x y]']
                              $expression: #NameExpr['called']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_registered_code_object']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #ApplyExpr[
                           $base: #Field[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['Markup']
                              ]
                              $name: #NameExpr['PreProcess']
                           ]
                           $recv: #NameExpr['register']
                           $param: #List[
                              $expression: #StringExpr['x']
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['code_object']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['CodeObject']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['x']
                              $expression: #StringExpr['y']
                              $expression: #NameExpr['code_object']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['y']
                              $expression: #Indexer[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['code_object']
                                    $recv: #NameExpr['metadata']
                                 ]
                                 $index: #List[
                                    $expression: #StringExpr['x']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #NameExpr['code_object']
                              $recv: #NameExpr['metadata']
                           ]
                           $recv: #NameExpr['clear']
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['result']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle_directive']
                              $param: #List[
                                 $expression: #StringExpr['']
                                 $expression: #StringExpr['x']
                                 $expression: #StringExpr['y']
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['directive']
                                    $item: #NameExpr['param']
                                 ]
                                 $body: #FalseExpr['false']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr[':x: y\\n']
                              $expression: #NameExpr['result']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_empty']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['code_object']
                                 $recv: #NameExpr['metadata']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #NameExpr['result']
                           $right: #ApplyExpr[
                              $base: #NameExpr['@pp']
                              $recv: #NameExpr['handle_directive']
                              $param: #List[
                                 $expression: #StringExpr['']
                                 $expression: #StringExpr['x']
                                 $expression: #StringExpr['y']
                              ]
                              $body: #Block[
                                 $param: #MultipleLeftHandSideExpression[
                                    $item: #NameExpr['directive']
                                    $item: #NameExpr['param']
                                 ]
                                 $body: #StringExpr['']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #NameExpr['result']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_empty']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['code_object']
                                 $recv: #NameExpr['metadata']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_startdoc']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['code_object']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['CodeObject']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #NameExpr['code_object']
                           $recv: #NameExpr['stop_doc']
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['code_object']
                              $name: #NameExpr['force_documentation']
                           ]
                           $right: #FalseExpr['false']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['startdoc']
                              $expression: #Nil['nil']
                              $expression: #NameExpr['code_object']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['code_object']
                                 $recv: #NameExpr['document_self']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['code_object']
                                 $recv: #NameExpr['document_children']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['code_object']
                                 $recv: #NameExpr['force_documentation']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_stopdoc']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['code_object']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['CodeObject']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['stopdoc']
                              $expression: #Nil['nil']
                              $expression: #NameExpr['code_object']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['code_object']
                                 $recv: #NameExpr['document_self']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['refute']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['code_object']
                                 $recv: #NameExpr['document_children']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_title']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['@pp']
                              $name: #NameExpr['options']
                           ]
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['Options']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['title']
                              $expression: #StringExpr['T']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['T']
                              $expression: #ApplyExpr[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['@pp']
                                    $recv: #NameExpr['options']
                                 ]
                                 $recv: #NameExpr['title']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_unhandled']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['code_object']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['CodeObject']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['x']
                              $expression: #StringExpr['y']
                              $expression: #NameExpr['code_object']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['y']
                              $expression: #Indexer[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['code_object']
                                    $recv: #NameExpr['metadata']
                                 ]
                                 $index: #List[
                                    $expression: #StringExpr['x']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #NameExpr['code_object']
                              $recv: #NameExpr['metadata']
                           ]
                           $recv: #NameExpr['clear']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['x']
                              $expression: #StringExpr['']
                              $expression: #NameExpr['code_object']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_includes']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['code_object']
                                 $recv: #NameExpr['metadata']
                              ]
                              $expression: #StringExpr['x']
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_unhandled_block']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['code_object']
                           $right: #ApplyExpr[
                              $recv: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['CodeObject']
                              ]
                              $recv: #NameExpr['new']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['x']
                              $expression: #StringExpr['y']
                              $expression: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['code_object']
                                 $body: #Block[
                                    $body: #FalseExpr['false']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_empty']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['code_object']
                                 $recv: #NameExpr['metadata']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['x']
                              $expression: #StringExpr['y']
                              $expression: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['code_object']
                                 $body: #Block[
                                    $body: #Nil['nil']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['y']
                              $expression: #Indexer[
                                 $recv: #ApplyExpr[
                                    $recv: #NameExpr['code_object']
                                    $recv: #NameExpr['metadata']
                                 ]
                                 $index: #List[
                                    $expression: #StringExpr['x']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $recv: #ApplyExpr[
                              $recv: #NameExpr['code_object']
                              $recv: #NameExpr['metadata']
                           ]
                           $recv: #NameExpr['clear']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['x']
                              $expression: #StringExpr['y']
                              $expression: #ApplyExpr[
                                 #Self['self']
                                 $recv: #NameExpr['code_object']
                                 $body: #Block[
                                    $body: #StringExpr['']
                                 ]
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_empty']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['code_object']
                                 $recv: #NameExpr['metadata']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_yield']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['method']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['AnyMethod']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #StringExpr['m']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['method']
                              $name: #NameExpr['params']
                           ]
                           $right: #StringExpr['index, &block']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['yield']
                              $expression: #StringExpr['item']
                              $expression: #NameExpr['method']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['item']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['method']
                                 $recv: #NameExpr['block_params']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['index']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['method']
                                 $recv: #NameExpr['params']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_yield_block_param']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['method']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['AnyMethod']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #StringExpr['m']
                              ]
                           ]
                        ]
                        $statement: #AssignExpr[
                           $left: #Field[
                              $base: #NameExpr['method']
                              $name: #NameExpr['params']
                           ]
                           $right: #StringExpr['&block']
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['yield']
                              $expression: #StringExpr['item']
                              $expression: #NameExpr['method']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['item']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['method']
                                 $recv: #NameExpr['block_params']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_empty']
                           $param: #List[
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['method']
                                 $recv: #NameExpr['params']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_yield_no_context']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['method']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['AnyMethod']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #StringExpr['m']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['yield']
                              $expression: #StringExpr['item']
                              $expression: #NameExpr['method']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['item']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['method']
                                 $recv: #NameExpr['block_params']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
               $statement: #FuncDecl[
                  $name: #NameExpr['test_handle_directive_yields']
                  $param: #List['']
                  $body: #BlockExpr[
                     $main: #List[
                        $statement: #AssignExpr[
                           $left: #NameExpr['method']
                           $right: #ApplyExpr[
                              $base: #Field[
                                 $recv: #NameExpr['RDoc']
                                 $name: #NameExpr['AnyMethod']
                              ]
                              $recv: #NameExpr['new']
                              $param: #List[
                                 $expression: #Nil['nil']
                                 $expression: #StringExpr['m']
                              ]
                           ]
                        ]
                        $statement: #ApplyExpr[
                           $base: #NameExpr['@pp']
                           $recv: #NameExpr['handle_directive']
                           $param: #List[
                              $expression: #StringExpr['']
                              $expression: #StringExpr['yields']
                              $expression: #StringExpr['item']
                              $expression: #NameExpr['method']
                           ]
                        ]
                        $statement: #ApplyExpr[
                           #Self['self']
                           $recv: #NameExpr['assert_equal']
                           $param: #List[
                              $expression: #StringExpr['item']
                              $expression: #ApplyExpr[
                                 $recv: #NameExpr['method']
                                 $recv: #NameExpr['block_params']
                              ]
                           ]
                        ]
                     ]
                  ]
               ]
            ]
         ]
      ]
   ]
   #Comsumed['comsumed']
]
